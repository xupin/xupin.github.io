<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mark&#39;s blog</title>
  <icon>https://www.gravatar.com/avatar/2951352e5bcbaf7ac77463667c5bbfa4</icon>
  <subtitle>Keep it simple, stupid</subtitle>
  <link href="http://xupin.im/atom.xml" rel="self"/>
  
  <link href="http://xupin.im/"/>
  <updated>2023-11-10T08:30:41.709Z</updated>
  <id>http://xupin.im/</id>
  
  <author>
    <name>Mark</name>
    <email>xupinbest@163.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ¸¸æˆå¼€å‘ç¬”è®° - åŒå±äººæ•°è£å‰ª</title>
    <link href="http://xupin.im/2023/11/08/game-aoi-opt/"/>
    <id>http://xupin.im/2023/11/08/game-aoi-opt/</id>
    <published>2023-11-07T16:00:00.000Z</published>
    <updated>2023-11-10T08:30:41.709Z</updated>
    
    <content type="html"><![CDATA[<p>ç®€å•ä¼˜åŒ–ä¸‹AOIæ¨¡å—</p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å½“æ¸¸æˆå¼€å¯æ´»åŠ¨è®©å¤§é‡ç©å®¶èšé›†åœ¨æŒ‡å®šåœ°å›¾èŒƒå›´å†…æ—¶ï¼Œç»™æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¸¦æ¥æœ€ç›´æ¥çš„éº»çƒ¦å°±æ˜¯ï¼š</p><ol><li>æœåŠ¡å™¨å¸¦å®½å ç”¨ç‡é«˜</li></ol><blockquote><p>å‡è®¾åŒå±æœ‰1000ä¸ªç©å®¶ï¼Œé‚£ä¹ˆä»»æ„ä¸€ä¸ªç©å®¶ç§»åŠ¨ä¸€æ¬¡éœ€è¦åŒæ­¥å…¶ä»–999ä¸ªç©å®¶ã€‚è¿™å¯¼è‡´æœåŠ¡å™¨æ¶ˆæ¯æ•°é‡æŒ‡æ•°çº§å¢é•¿ï¼Œå¸¦å®½æ‰¿å—å‹åŠ›æé«˜ã€‚</p></blockquote><ol><li>å®¢æˆ·ç«¯æ¸²æŸ“å¡é¡¿</li></ol><blockquote><p>å› ä¸ºåŒå±äººæ•°è¶Šå¤šï¼Œå®¢æˆ·ç«¯éœ€è¦æ¸²æŸ“çš„æ¨¡å‹å°±è¶Šå¤šã€‚è¿™æ ·åœ¨ä¸€äº›æ™®é€šçš„ç¡¬ä»¶è®¾å¤‡ä¸‹ä¼šç›´æ¥å¯¼è‡´å¡é¡¿ã€å‘çƒ­ã€‚</p></blockquote><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>é™¤äº†å‡çº§ç¡¬ä»¶ï¼Œè¿˜å¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–:</p><a id="more"></a><ol><li><p>æœåŠ¡å™¨æ§åˆ¶AOIæ¶ˆæ¯é¢‘ç‡</p></li><li><p>å®¢æˆ·ç«¯è£å‰ªåŒå±äººæ•°</p></li></ol><h3 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h3><p>AOIåŒæ­¥è¢«åŠ¨æ¨é€æ”¹æˆä¸»åŠ¨æ¨é€ï¼ŒåŸæ¥çš„è®¾è®¡æ˜¯ç©å®¶ç§»åŠ¨åï¼ˆMoveæ¶ˆæ¯ï¼‰ï¼Œç„¶åå‘è¯¥ç©å®¶æ¨é€å‘¨å›´ç©å®¶çš„ä¿¡æ¯ã€‚æ–°çš„æ–¹å¼æ˜¯åœ°å›¾AOIæ¨¡å—å›ºå®šé¢‘ç‡åŒæ­¥ä¿¡æ¯ï¼ˆæ¯”å¦‚1så‘é€ä¸€æ¬¡ï¼‰ï¼ŒæŠŠéœ€è¦åŒæ­¥çš„ä¿¡æ¯åˆ†ç±»ï¼š</p><ul><li>ç§»é™¤</li></ul><blockquote><p>ä¸åœ¨è§†é‡èŒƒå›´å†…çš„ç‰©ä½“ï¼Œä¸éœ€è¦æ˜¾ç¤ºåœ¨å±å¹•å†…</p></blockquote><ul><li>æ–°å¢</li></ul><blockquote><p>æ–°å¢çš„ç‰©ä½“ï¼Œéœ€è¦æ˜¾ç¤ºåœ¨å±å¹•å†…</p></blockquote><ul><li>éœ€è¦æ›´æ–°</li></ul><blockquote><p>åŸæ¥åœ¨å±å¹•å†…çš„ç‰©ä½“ï¼Œéœ€è¦æ›´æ–°ä¿¡æ¯</p></blockquote><p><code>ï¼ˆå¦‚æœåŸæ¥åœ¨å±å¹•å†…çš„ç‰©ä½“ï¼Œä¸éœ€è¦æ›´æ–°ä¿¡æ¯åˆ™ä¸ä¼šå‘é€ï¼‰</code></p><p>åŒæ—¶è®¾ç½®åŒå±äººæ•°ä¸Šé™ï¼Œè¶…è¿‡çš„æ•°é‡è£å‰ªæ‰ã€‚ä¸è¿‡è¿™é‡Œé¢ä¹Ÿæœ‰äº›å‘éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚ï¼šNPCä¸èƒ½è¢«è£å‰ªã€é˜Ÿå‹ä¸èƒ½è¢«è£å‰ªåŠè¢«è£å‰ªçš„ç‰©ä½“å°½é‡åˆ†æ•£é¿å…â€œç§ƒå¤´â€ã€‚</p><p>å®ç°ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Map)</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r.aoiMgr = NewAoiMgr(r.config.Cols, r.config.Rows)</span><br><span class="line">    r.aoiNodes = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">uint32</span>]*aoiNode, <span class="number">0</span>)</span><br><span class="line">    r.ticker = time.NewTicker(<span class="number">1</span> * time.Second) <span class="comment">// 1s</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            &lt;-r.ticker.C</span><br><span class="line">            r.Update()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Map)</span> <span class="title">Update</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, node := <span class="keyword">range</span> r.aoiNodes &#123;</span><br><span class="line">        <span class="keyword">if</span> node.Type != enums.LIVING_TYPE_PLAYER &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">go</span> r.send(node)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Map)</span> <span class="title">send</span><span class="params">(role interfaces.IMapRole)</span></span> &#123;</span><br><span class="line">    player := playersvr.Ins.Get(node.MapRole.GetId())</span><br><span class="line">    <span class="keyword">if</span> player == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰çº¿æˆ–æˆ˜æ–—ä¸­ä¸åŒæ­¥è§†é‡</span></span><br><span class="line">    <span class="keyword">if</span> !player.IsOnline() || player.IsInBattle() &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†å‘¨å›´èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    node.UpdateNodes(r.aoiNodes)</span><br><span class="line">    <span class="comment">// å‘¨å›´èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    dels := node.GetLeaveNodes()</span><br><span class="line">    adds := r.buildMapDatas(node.GetEnterNodes(), <span class="literal">true</span>)</span><br><span class="line">    keeps := r.buildMapDatas(node.GetKeepNodes(), <span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(adds) == <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(dels) == <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(keeps) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    bytes, _ := proto.Marshal(&amp;pb.S2C_MapSyncView&#123;</span><br><span class="line">        Adds: adds,</span><br><span class="line">        Dels: dels,</span><br><span class="line">        Keeps:  keeps,</span><br><span class="line">    &#125;)</span><br><span class="line">    player.Send(enums.Cmd_S2C_MapSyncView, bytes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> aoiNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id           <span class="keyword">uint32</span></span><br><span class="line">    Name         <span class="keyword">string</span></span><br><span class="line">    X            <span class="keyword">int32</span></span><br><span class="line">    Y            <span class="keyword">int32</span></span><br><span class="line">    AoiModel     <span class="keyword">string</span></span><br><span class="line">    Type         <span class="keyword">int32</span></span><br><span class="line">    Blink        <span class="keyword">bool</span></span><br><span class="line">    MapRole      interfaces.IMapRole</span><br><span class="line">    MaxViewNodes <span class="keyword">int</span></span><br><span class="line">    enterNodes   <span class="keyword">map</span>[<span class="keyword">uint32</span>]<span class="keyword">bool</span></span><br><span class="line">    keepNodes    <span class="keyword">map</span>[<span class="keyword">uint32</span>]<span class="keyword">bool</span></span><br><span class="line">    leaveNodes   []<span class="keyword">uint32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *aoiNode)</span> <span class="title">UpdateNodes</span><span class="params">(nodes <span class="keyword">map</span>[<span class="keyword">uint32</span>]*aoiNode)</span></span> &#123;</span><br><span class="line">    <span class="comment">// è¶…è¿‡æœ€å¤§æ˜¾ç¤ºæ•°é‡</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(r.enterNodes)+<span class="built_in">len</span>(r.keepNodes) &lt;= r.MaxViewNodes &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        delNum  <span class="keyword">int</span></span><br><span class="line">        delKeep <span class="keyword">bool</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// ä¼˜å…ˆåˆ¤æ–­keep nodes</span></span><br><span class="line">    <span class="keyword">if</span> l := <span class="built_in">len</span>(r.keepNodes); l &gt; r.MaxViewNodes &#123;</span><br><span class="line">        delNum = l - r.MaxViewNodes</span><br><span class="line">        delKeep = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">for</span> id := <span class="keyword">range</span> r.enterNodes &#123;</span><br><span class="line">            node, ok := nodes[id]</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                <span class="built_in">delete</span>(r.enterNodes, id)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// NPCä¸è£å‰ª</span></span><br><span class="line">            <span class="keyword">if</span> node.Type == enums.LIVING_TYPE_NPC &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é˜Ÿå‹ä¸è£å‰ª</span></span><br><span class="line">            <span class="keyword">if</span> teamId := r.MapRole.GetTeamId(); teamId &gt; <span class="number">0</span> &amp;&amp; teamId == node.MapRole.GetTeamId() &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">delete</span>(r.enterNodes, id)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        delNum = <span class="built_in">len</span>(r.enterNodes) - (r.MaxViewNodes - <span class="built_in">len</span>(r.keepNodes))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰¾å‡ºå¯ä»¥è¢«è£å‡çš„ç‰©ä½“</span></span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        mayDelIds = <span class="built_in">make</span>([]<span class="keyword">uint32</span>, <span class="number">0</span>)</span><br><span class="line">        fromNodes = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">uint32</span>]<span class="keyword">bool</span>, <span class="number">0</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> delKeep &#123;</span><br><span class="line">        fromNodes = r.keepNodes</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fromNodes = r.enterNodes</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> id := <span class="keyword">range</span> fromNodes &#123;</span><br><span class="line">        node, ok := nodes[id]</span><br><span class="line">        <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            <span class="built_in">delete</span>(r.enterNodes, id)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// NPCä¸è£å‰ª</span></span><br><span class="line">        <span class="keyword">if</span> node.Type == enums.LIVING_TYPE_NPC &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é˜Ÿå‹ä¸è£å‰ª</span></span><br><span class="line">        <span class="keyword">if</span> teamId := r.MapRole.GetTeamId(); teamId &gt; <span class="number">0</span> &amp;&amp; teamId == node.MapRole.GetTeamId() &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        mayDelIds = <span class="built_in">append</span>(mayDelIds, id)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‡åŒ€åˆ é™¤ï¼Œé¿å…é›†ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> l := <span class="built_in">len</span>(mayDelIds) - delNum; l &gt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// éšæœºä¿ç•™</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; l; i++ &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(mayDelIds) == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            randIdx := helpers.Random(<span class="built_in">len</span>(mayDelIds))</span><br><span class="line">            mayDelIds = <span class="built_in">append</span>(mayDelIds[:randIdx], mayDelIds[randIdx+<span class="number">1</span>:]...)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> _, id := <span class="keyword">range</span> mayDelIds &#123;</span><br><span class="line">        <span class="keyword">if</span> delKeep &#123;</span><br><span class="line">            <span class="built_in">delete</span>(r.keepNodes, id)</span><br><span class="line">            r.leaveNodes = <span class="built_in">append</span>(r.leaveNodes, id)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">delete</span>(r.enterNodes, id)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç®€å•ä¼˜åŒ–ä¸‹AOIæ¨¡å—&lt;/p&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;å½“æ¸¸æˆå¼€å¯æ´»åŠ¨è®©å¤§é‡ç©å®¶èšé›†åœ¨æŒ‡å®šåœ°å›¾èŒƒå›´å†…æ—¶ï¼Œç»™æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¸¦æ¥æœ€ç›´æ¥çš„éº»çƒ¦å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å™¨å¸¦å®½å ç”¨ç‡é«˜&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å‡è®¾åŒå±æœ‰1000ä¸ªç©å®¶ï¼Œé‚£ä¹ˆä»»æ„ä¸€ä¸ªç©å®¶ç§»åŠ¨ä¸€æ¬¡éœ€è¦åŒæ­¥å…¶ä»–999ä¸ªç©å®¶ã€‚è¿™å¯¼è‡´æœåŠ¡å™¨æ¶ˆæ¯æ•°é‡æŒ‡æ•°çº§å¢é•¿ï¼Œå¸¦å®½æ‰¿å—å‹åŠ›æé«˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ¸²æŸ“å¡é¡¿&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºåŒå±äººæ•°è¶Šå¤šï¼Œå®¢æˆ·ç«¯éœ€è¦æ¸²æŸ“çš„æ¨¡å‹å°±è¶Šå¤šã€‚è¿™æ ·åœ¨ä¸€äº›æ™®é€šçš„ç¡¬ä»¶è®¾å¤‡ä¸‹ä¼šç›´æ¥å¯¼è‡´å¡é¡¿ã€å‘çƒ­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;æ€è·¯&quot;&gt;&lt;a href=&quot;#æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;æ€è·¯&quot;&gt;&lt;/a&gt;æ€è·¯&lt;/h3&gt;&lt;p&gt;é™¤äº†å‡çº§ç¡¬ä»¶ï¼Œè¿˜å¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–:&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="game" scheme="http://xupin.im/tags/game/"/>
    
  </entry>
  
  <entry>
    <title>æ¸¸æˆå¼€å‘ç¬”è®° - ä»»åŠ¡ç³»ç»Ÿè®¾è®¡</title>
    <link href="http://xupin.im/2023/11/06/game-task-system/"/>
    <id>http://xupin.im/2023/11/06/game-task-system/</id>
    <published>2023-11-05T16:00:00.000Z</published>
    <updated>2023-11-20T09:16:37.264Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªç²—ç•¥çš„ä»»åŠ¡ç³»ç»Ÿ</p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸ºäº†è®©æ¸¸æˆçš„å†…å®¹ä¸°å¯Œèµ·æ¥ï¼ŒåŒæ—¶ä¹Ÿèƒ½è¾…åŠ©æ„å»ºæ¸¸æˆä¸–ç•Œæ‰€å¤„çš„ç¯å¢ƒå’Œä¸–ç•Œè§‚ç­‰ç­‰ï¼Œæ‰€ä»¥å‡†å¤‡ç®€å•çš„å¼€å‘ä¸€ä¸ªä»»åŠ¡ç³»ç»Ÿã€‚</p><p>e.g.<br>æ”¯çº¿ä»»åŠ¡ - <del>ç äºº</del>ä¹°ç“œ<br>ã€Œå‰å»é•¿å®‰åŸè´­ä¹°ç”˜ç”œå¯å£çš„è¥¿ç“œã€<br><code>å¥–åŠ±ï¼šè½½å…·*1ã€æ­¦å™¨*1</code></p><p><em>æˆ‘ï¼šâ€œå“¥ä»¬å„¿ï¼Œè¿™ç“œå¤šå°‘é’±ä¸€æ–¤å‘â€</em><br>ç“œæ‘Šè€æ¿ï¼šâ€œä¸¤å—é’±ä¸€æ–¤â€<br><em>æˆ‘ï¼šâ€œç»™æˆ‘æŒ‘ä¸€ä¸ªâ€</em><br>ç“œæ‘Šè€æ¿ï¼šâ€œè¡Œï¼Œè¿™ä¸ªæ€ä¹ˆæ ·ï¼Ÿâ€</p><ul><li>é€‰é¡¹1[<code>è¿™ç“œä¿ç†Ÿå—ï¼Ÿ</code>]</li><li>é€‰é¡¹2[<code>ä¸ä¹°äº†</code>]</li></ul><a id="more"></a><h3 id="ä»»åŠ¡è®¾è®¡"><a href="#ä»»åŠ¡è®¾è®¡" class="headerlink" title="ä»»åŠ¡è®¾è®¡"></a>ä»»åŠ¡è®¾è®¡</h3><p>å‚è€ƒäº†ä¸€äº›æˆç†Ÿçš„æ¸¸æˆï¼Œä»»åŠ¡æš‚ä¸”åˆ†4ç±»ï¼š</p><ul><li>ä¸»çº¿ä»»åŠ¡</li></ul><blockquote><p>å‰§æƒ…ä»»åŠ¡ï¼Œé¡ºåºé¢†å–</p></blockquote><ul><li>æ—¥å¸¸ä»»åŠ¡</li></ul><blockquote><p>æ¯æ—¥é¢†å–æ¬¡æ•°å‡æœ‰é™åˆ¶ï¼Œéš”å¤©é‡ç½®ã€‚ä¹Ÿå¯ç»†åˆ†ï¼šå¸ˆé—¨ä»»åŠ¡ã€å¸®æ´¾ä»»åŠ¡ã€ç»„é˜Ÿä»»åŠ¡ç­‰</p></blockquote><ul><li>å‘¨å¸¸ä»»åŠ¡</li></ul><blockquote><p>æ¯å‘¨é¢†å–æ¬¡æ•°å‡æœ‰é™åˆ¶ï¼Œéš”å‘¨é‡ç½®ã€‚æ¯”å¦‚ï¼šå‰¯æœ¬ä»»åŠ¡</p></blockquote><ul><li>æ”¯çº¿ä»»åŠ¡</li></ul><blockquote><p>å›ºå®šNPCé¢†å–æˆ–åŒºåŸŸè§¦å‘</p></blockquote><p>æ¯ä¸ªä»»åŠ¡ç”±æœ€å°‘1ä¸ªäº‹ä»¶ï¼ˆstepï¼‰æ„æˆï¼Œäº‹ä»¶çš„è§¦å‘æ–¹å¼ï¼ˆç±»å‹ï¼‰åˆ†ä¸ºï¼š</p><ul><li>NPCè§¦å‘</li></ul><blockquote><p>ç‚¹å‡»NPCé¢†å–ä»»åŠ¡ï¼Œæ¯”å¦‚ä¸Šé¢çš„ã€Œä¹°ç“œã€ä»»åŠ¡</p></blockquote><ul><li>å‡»æ€è§¦å‘</li></ul><blockquote><p>å‡»æ€æŒ‡å®šNPCé¢†å–ä»»åŠ¡</p></blockquote><ul><li>é“å…·è§¦å‘</li></ul><blockquote><p>ä½¿ç”¨ç‰¹å®šé“å…·é¢†å–ä»»åŠ¡</p></blockquote><ul><li>åŒºåŸŸè§¦å‘</li></ul><blockquote><p>è¿›å…¥æŸä¸ªåæ ‡èŒƒå›´é¢†å–ä»»åŠ¡</p></blockquote><ul><li>æ—¶é—´è§¦å‘</li></ul><blockquote><p>ä»»åŠ¡è¶…æ—¶å¤±è´¥ã€‚æ¯”å¦‚ï¼šé™åˆ¶3åˆ†é’Ÿå†…å®Œæˆã€Œä¹°ç“œã€ä»»åŠ¡</p></blockquote><p>æš‚æ—¶æƒ³åˆ°è¿™ä¹ˆå¤šï¼Œæ–°çš„æƒ³æ³•åé¢å†è¡¥å……</p><h3 id="ä»»åŠ¡é…ç½®ç»“æ„"><a href="#ä»»åŠ¡é…ç½®ç»“æ„" class="headerlink" title="ä»»åŠ¡é…ç½®ç»“æ„"></a>ä»»åŠ¡é…ç½®ç»“æ„</h3><p>å®šä¹‰ã€Œåƒç“œã€è¿™ä¸ªä»»åŠ¡çš„æ•°æ®ç»“æ„</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»»åŠ¡ç±»åˆ«</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    TASK_KIND_UNKNOWN = <span class="literal">iota</span></span><br><span class="line">    TASK_KIND_STORY       <span class="comment">// ä¸»çº¿</span></span><br><span class="line">    TASK_KIND_DAILY       <span class="comment">// æ—¥å¸¸</span></span><br><span class="line">    TASK_KIND_WEEKLY      <span class="comment">// å‘¨å¸¸</span></span><br><span class="line">    TASK_KIND_BRANCH_LINE <span class="comment">// æ”¯çº¿</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    TASK_EVENT_TYPE_UNKNOWN = <span class="literal">iota</span></span><br><span class="line">    TASK_EVENT_TYPE_TALK <span class="comment">// å¯¹è¯</span></span><br><span class="line">    TASK_EVENT_TYPE_KILL <span class="comment">// å‡»æ€</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»åŠ¡å¤±è´¥ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    TASK_FAIL_EVENT_TYPE_UNKNOWN = <span class="literal">iota</span></span><br><span class="line">    TASK_FAIL_EVENT_TYPE_DEAD <span class="comment">// æ­»äº¡</span></span><br><span class="line">    TASK_FAIL_EVENT_TYPE_TIME <span class="comment">// è¶…æ—¶</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">4001</span>, <span class="comment">// ä»»åŠ¡ç¼–å·</span></span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"æ”¯çº¿ ä¹°ç“œ"</span>,</span><br><span class="line">    <span class="attr">"kind"</span>: <span class="number">4</span>, <span class="comment">// ä»»åŠ¡ç±»åˆ«</span></span><br><span class="line">    <span class="attr">"limits"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"åˆ˜åå¼º"</span> <span class="comment">// é™åˆ¶åªèƒ½å«åˆ˜åå¼ºçš„ç©å®¶é¢†å–</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"events"</span>: [&#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="number">1</span>, <span class="comment">// äº‹ä»¶ç±»å‹</span></span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"å‰å»é•¿å®‰åŸè´­ä¹°ç”˜ç”œå¯å£çš„è¥¿ç“œ"</span>, <span class="comment">// äº‹ä»¶æ ‡é¢˜</span></span><br><span class="line">        <span class="attr">"npc"</span>: <span class="number">250</span>, <span class="comment">// NPCç¼–å·</span></span><br><span class="line">        <span class="attr">"dialog"</span>: [ <span class="comment">// å¯¹è¯å†…å®¹ 0:ç©å®¶ !0:NPC</span></span><br><span class="line">            <span class="string">"0:å“¥ä»¬å„¿ï¼Œè¿™ç“œå¤šå°‘é’±ä¸€æ–¤å‘"</span>,</span><br><span class="line">            <span class="string">"250:ä¸¤å—é’±ä¸€æ–¤"</span>,</span><br><span class="line">            <span class="string">"0:ç»™æˆ‘æŒ‘ä¸€ä¸ª"</span>,</span><br><span class="line">            <span class="string">"250:è¡Œï¼Œè¿™ä¸ªæ€ä¹ˆæ ·ï¼Ÿ"</span>,</span><br><span class="line">            <span class="string">"0:è¿™ç“œä¿ç†Ÿå—ï¼Ÿ"</span>,</span><br><span class="line">            <span class="string">"250:æˆ‘å¼€æ°´æœæ‘Šçš„ï¼Œèƒ½å–ç»™ä½ ç”Ÿç“œè›‹å­ï¼Ÿ"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"rewards"</span>: &#123;&#125; <span class="comment">// äº‹ä»¶å¥–åŠ±</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"ä¸ç“œæ‘Šè€æ¿ç†æ€§è®¨è®º"</span>,</span><br><span class="line">        <span class="attr">"npc"</span>: <span class="number">250</span>,</span><br><span class="line">        <span class="attr">"dialog"</span>: [</span><br><span class="line">            <span class="string">"250:ä½ ä»–ğŸ´åŠˆæˆ‘ç“œæ˜¯å§ï¼Ÿ"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"rewards"</span>: &#123;</span><br><span class="line">            <span class="attr">"car"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"weapon"</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">"failEvents"</span>: [&#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="number">2</span>, <span class="comment">// ä»»åŠ¡å¤±è´¥ç±»å‹</span></span><br><span class="line">        <span class="attr">"value"</span>: <span class="number">30</span> <span class="comment">// å…·ä½“æ•°å€¼</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€»è¾‘å®ç°"><a href="#é€»è¾‘å®ç°" class="headerlink" title="é€»è¾‘å®ç°"></a>é€»è¾‘å®ç°</h3><p>å¯¹è¯<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *TaskMgr)</span> <span class="title">OnTalkNpc</span><span class="params">(id <span class="keyword">uint32</span>, step <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    task, ok := r.list[id]</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    event := task.getEvent(step)</span><br><span class="line">    <span class="keyword">if</span> event == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> event.Type != enums.TASK_EVENT_TYPE_TALK_NPC &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> event.State != enums.TASK_EVENT_STATE_ING &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r.eventUpdate(task, event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å‡»æ€<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *TaskMgr)</span> <span class="title">OnKillNpc</span><span class="params">(npc interfaces.INpc)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, task := <span class="keyword">range</span> r.list &#123;</span><br><span class="line">        <span class="keyword">for</span> _, event := <span class="keyword">range</span> task.Events &#123;</span><br><span class="line">            <span class="keyword">if</span> event.Type != enums.TASK_EVENT_TYPE_KILL_NPC &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> event.State != enums.TASK_EVENT_STATE_ING &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> _, eventNpc := <span class="keyword">range</span> event.EventNpcs &#123;</span><br><span class="line">                <span class="keyword">if</span> npc.GetId() != eventNpc.Id &#123;</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line">                event.EventNpcs = event.EventNpcs[<span class="number">1</span>:]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(event.EventNpcs) &gt; <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> r.eventUpdate(task, event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°ä»»åŠ¡äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *TaskMgr)</span> <span class="title">eventUpdate</span><span class="params">(task *Task, event *event)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, ok := r.list[task.Id]; !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‘é€å¥–åŠ±</span></span><br><span class="line">    <span class="keyword">for</span> key, reward := <span class="keyword">range</span> event.config.KvRewards &#123;</span><br><span class="line">        <span class="keyword">switch</span> key &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"car"</span>:</span><br><span class="line">            <span class="comment">// å‘é€è½½å…·</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"weapon"</span>:</span><br><span class="line">            <span class="comment">// å‘é€æ­¦å™¨</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// äº‹ä»¶å®Œæˆ</span></span><br><span class="line">    event.State = enums.TASK_EVENT_STATE_DONE</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€ä¸ªç²—ç•¥çš„ä»»åŠ¡ç³»ç»Ÿ&lt;/p&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;ä¸ºäº†è®©æ¸¸æˆçš„å†…å®¹ä¸°å¯Œèµ·æ¥ï¼ŒåŒæ—¶ä¹Ÿèƒ½è¾…åŠ©æ„å»ºæ¸¸æˆä¸–ç•Œæ‰€å¤„çš„ç¯å¢ƒå’Œä¸–ç•Œè§‚ç­‰ç­‰ï¼Œæ‰€ä»¥å‡†å¤‡ç®€å•çš„å¼€å‘ä¸€ä¸ªä»»åŠ¡ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;e.g.&lt;br&gt;æ”¯çº¿ä»»åŠ¡ - &lt;del&gt;ç äºº&lt;/del&gt;ä¹°ç“œ&lt;br&gt;ã€Œå‰å»é•¿å®‰åŸè´­ä¹°ç”˜ç”œå¯å£çš„è¥¿ç“œã€&lt;br&gt;&lt;code&gt;å¥–åŠ±ï¼šè½½å…·*1ã€æ­¦å™¨*1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;æˆ‘ï¼šâ€œå“¥ä»¬å„¿ï¼Œè¿™ç“œå¤šå°‘é’±ä¸€æ–¤å‘â€&lt;/em&gt;&lt;br&gt;ç“œæ‘Šè€æ¿ï¼šâ€œä¸¤å—é’±ä¸€æ–¤â€&lt;br&gt;&lt;em&gt;æˆ‘ï¼šâ€œç»™æˆ‘æŒ‘ä¸€ä¸ªâ€&lt;/em&gt;&lt;br&gt;ç“œæ‘Šè€æ¿ï¼šâ€œè¡Œï¼Œè¿™ä¸ªæ€ä¹ˆæ ·ï¼Ÿâ€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‰é¡¹1[&lt;code&gt;è¿™ç“œä¿ç†Ÿå—ï¼Ÿ&lt;/code&gt;]&lt;/li&gt;
&lt;li&gt;é€‰é¡¹2[&lt;code&gt;ä¸ä¹°äº†&lt;/code&gt;]&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="game" scheme="http://xupin.im/tags/game/"/>
    
  </entry>
  
  <entry>
    <title>æ¸¸æˆå¼€å‘ç¬”è®° - Behavior Tree(è¡Œä¸ºæ ‘)</title>
    <link href="http://xupin.im/2023/07/21/game-behavior-tree/"/>
    <id>http://xupin.im/2023/07/21/game-behavior-tree/</id>
    <published>2023-07-20T16:00:00.000Z</published>
    <updated>2023-11-08T03:32:03.999Z</updated>
    
    <content type="html"><![CDATA[<p>è¡Œä¸ºæ ‘ä¸€èˆ¬åº”ç”¨äºæ¸¸æˆå†…ç‰©ä½“çš„AIå†³ç­–ï¼Œä»¥æ ‘çš„å½¢å¼æ§åˆ¶ç‰©ä½“æ¥ä¸‹æ¥çš„åŠ¨ä½œã€‚æ¯”å¦‚: è¡€é‡å¤ªå°‘ -&gt; åƒè¯ã€æ”»å‡»è·ç¦»ä¸å¤Ÿ -&gt; ç§»åŠ¨ç­‰ç­‰ã€‚</p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘åœ¨æ‘¸ç´¢å°æ¸¸æˆå¼€å‘ï¼Œæœ‰ä¸€äº›è”æœºå‹çš„åŠŸèƒ½éœ€è¦æœºå™¨äººå‚ä¸ï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸‹æ¸¸æˆAIã€‚ç»¼åˆä¸€ä¸‹å®ç°æ–¹æ¡ˆåŸºæœ¬æ˜¯ä»¥ä¸‹ä¸¤ç§ï¼š</p><ul><li>æœ‰é™çŠ¶æ€æœºï¼ˆFinite State Machineï¼‰</li></ul><blockquote><p>FSMä¹Ÿæ˜¯æœ€å¼€å§‹é‡‡ç”¨çš„æ–¹æ¡ˆï¼Œå®ç°èµ·æ¥ç®€å•ç²—æš´ã€‚ç¼ºç‚¹æ˜¯æ•´ä¸ªé€»è¾‘éå¸¸è‡ƒè‚¿å¾ˆéš¾æ¨¡å—åŒ–ï¼Œåé¢å†å¯¹AIè¿›è¡Œæ›´æ–°å’Œç»´æŠ¤æ¯”è¾ƒæ¶å¿ƒï¼Œå¾ˆå®¹æ˜“å› ä¸ºæ¼æ”¹ã€é”™æ”¹å¯¼è‡´ä¸å¯ç”¨ã€‚</p></blockquote><ul><li>è¡Œä¸ºæ ‘ï¼ˆBehavior Treeï¼‰</li></ul><blockquote><p>è¡Œä¸ºæ ‘æ˜¯ç”±ä¸€ç³»åˆ—èŠ‚ç‚¹æ„æˆçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªåŠ¨ä½œï¼Œè‡ªä¸Šè€Œä¸‹æ‰§è¡Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¿”å›æ‰§è¡ŒçŠ¶æ€ã€‚</p></blockquote><p><img src="/assets/bt/bt.png" alt="drawing" width="300" height="180"></p><a id="more"></a><h3 id="è¡Œä¸ºæ ‘"><a href="#è¡Œä¸ºæ ‘" class="headerlink" title="è¡Œä¸ºæ ‘"></a>è¡Œä¸ºæ ‘</h3><p>è¡Œä¸ºæ ‘ä¸€èˆ¬ç”±ï¼šæ ¹èŠ‚ç‚¹ï¼ˆRootï¼‰ã€åºåˆ—èŠ‚ç‚¹ï¼ˆSequenceï¼‰ã€é€‰æ‹©èŠ‚ç‚¹ï¼ˆSelectorï¼‰ã€å¹¶è¡ŒèŠ‚ç‚¹ï¼ˆParallelï¼‰ç­‰ç­‰èŠ‚ç‚¹ç»„æˆï¼Œå¯èƒ½è¿˜ä¼šæœ‰æ¡ä»¶èŠ‚ç‚¹ï¼ˆConditionï¼‰ã€‚è¿™äº›èŠ‚ç‚¹ä¹Ÿå¯ä»¥è¢«æŠ½è±¡çš„å½’ä¸º4ç±»:</p><ul><li><p>æ§åˆ¶èŠ‚ç‚¹</p><ol><li>åºåˆ—èŠ‚ç‚¹ï¼ˆSequenceï¼‰</li><li>é€‰æ‹©èŠ‚ç‚¹ï¼ˆSelectorï¼‰</li><li>å¹¶è¡ŒèŠ‚ç‚¹ï¼ˆParallelï¼‰</li></ol></li><li><p>æ¡ä»¶èŠ‚ç‚¹</p><ol><li>æ¡ä»¶èŠ‚ç‚¹ï¼ˆConditionï¼‰</li></ol></li><li><p>è¡Œä¸ºèŠ‚ç‚¹</p><ol><li>è‡ªå®šä¹‰èŠ‚ç‚¹ã€‚æ¯”å¦‚ï¼šæ”»å‡»ã€é˜²å¾¡ã€åƒè¯ç­‰ï¼Œæ˜¯çœŸæ­£æ‰§è¡Œæ¸¸æˆé€»è¾‘çš„èŠ‚ç‚¹ã€‚</li></ol></li><li><p>è£…é¥°èŠ‚ç‚¹</p><ol><li>é€†å˜èŠ‚ç‚¹ï¼ˆInverterï¼‰</li><li>é‡å¤æ‰§è¡ŒèŠ‚ç‚¹ï¼ˆRepeaterï¼‰</li><li>è£…é¥°èŠ‚ç‚¹ä¹Ÿç®—æ˜¯è‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œä¸»è¦ä½œç”¨æ˜¯è¾…åŠ©å­èŠ‚ç‚¹æ‰§è¡Œã€‚</li></ol></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆèŠ‚ç‚¹éƒ½å¿…é¡»å®ç°<code>Exec()</code>æ‰§è¡Œæ–¹æ³•ã€‚</p><p>å®šä¹‰èŠ‚ç‚¹æ¥å£ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Status <span class="keyword">int8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    Success Status = <span class="literal">iota</span></span><br><span class="line">    Failure</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> INode <span class="keyword">interface</span> &#123;</span><br><span class="line">    Exec() Status</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åºåˆ—èŠ‚ç‚¹"><a href="#åºåˆ—èŠ‚ç‚¹" class="headerlink" title="åºåˆ—èŠ‚ç‚¹"></a>åºåˆ—èŠ‚ç‚¹</h3><p>æœ‰åºçš„æ‰§è¡Œå­èŠ‚ç‚¹ï¼Œä»»æ„å­èŠ‚ç‚¹å¤±è´¥ç»ˆæ­¢æ‰§è¡Œè¿”å›å¤±è´¥ï¼Œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•è¿”å›æˆåŠŸã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—</span></span><br><span class="line"><span class="keyword">type</span> Sequence <span class="keyword">struct</span> &#123;</span><br><span class="line">    children []INode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSequence</span><span class="params">(children ...INode)</span> *<span class="title">Sequence</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Sequence&#123;</span><br><span class="line">        children: children,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Sequence)</span> <span class="title">Exec</span><span class="params">()</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, child := <span class="keyword">range</span> r.children &#123;</span><br><span class="line">        <span class="keyword">if</span> result := child.Exec(); result == Failure &#123;</span><br><span class="line">            <span class="keyword">return</span> Failure</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Success</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€‰æ‹©èŠ‚ç‚¹"><a href="#é€‰æ‹©èŠ‚ç‚¹" class="headerlink" title="é€‰æ‹©èŠ‚ç‚¹"></a>é€‰æ‹©èŠ‚ç‚¹</h3><p>åŒæ ·æœ‰åºçš„æ‰§è¡Œå­èŠ‚ç‚¹ã€å’Œåºåˆ—èŠ‚ç‚¹ä¸åŒçš„æ˜¯ä»»æ„å­èŠ‚ç‚¹æ‰§è¡ŒæˆåŠŸè¿”å›æˆåŠŸã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Selector <span class="keyword">struct</span> &#123;</span><br><span class="line">    children []INode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSelector</span><span class="params">(children ...INode)</span> *<span class="title">Selector</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Selector&#123;</span><br><span class="line">        children: children,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Selector)</span> <span class="title">Exec</span><span class="params">()</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, child := <span class="keyword">range</span> r.children &#123;</span><br><span class="line">        <span class="keyword">if</span> result := child.Exec(); result == Success &#123;</span><br><span class="line">            <span class="keyword">return</span> Success</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Failure</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¹¶è¡ŒèŠ‚ç‚¹"><a href="#å¹¶è¡ŒèŠ‚ç‚¹" class="headerlink" title="å¹¶è¡ŒèŠ‚ç‚¹"></a>å¹¶è¡ŒèŠ‚ç‚¹</h3><p>åŒæ—¶æ‰§è¡Œæ‰€æœ‰å­èŠ‚ç‚¹</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Parallel <span class="keyword">struct</span> &#123;</span><br><span class="line">    children []INode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewParallel</span><span class="params">(children ...INode)</span> *<span class="title">Parallel</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Parallel&#123;</span><br><span class="line">        children: children,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parallel)</span> <span class="title">Exec</span><span class="params">()</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">    wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, child := <span class="keyword">range</span> r.children &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(node INode)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            node.Exec()</span><br><span class="line">        &#125;(child)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">    <span class="keyword">return</span> Success</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶èŠ‚ç‚¹-è¡Œä¸ºèŠ‚ç‚¹"><a href="#æ¡ä»¶èŠ‚ç‚¹-è¡Œä¸ºèŠ‚ç‚¹" class="headerlink" title="æ¡ä»¶èŠ‚ç‚¹ / è¡Œä¸ºèŠ‚ç‚¹"></a>æ¡ä»¶èŠ‚ç‚¹ / è¡Œä¸ºèŠ‚ç‚¹</h3><p>é¡¾åæ€ä¹‰ï¼Œæ‰§è¡Œå­èŠ‚ç‚¹å‰éœ€è¦æ£€æŸ¥æ˜¯ä¸æ˜¯ç¬¦åˆæ¡ä»¶ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Condition <span class="keyword">struct</span> &#123;</span><br><span class="line">    f <span class="function"><span class="keyword">func</span><span class="params">(IBlackboard)</span> <span class="title">bool</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCondition</span><span class="params">(f <span class="keyword">func</span>(IBlackboard)</span> <span class="title">bool</span>) *<span class="title">Condition</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Condition&#123;</span><br><span class="line">        f: f,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Condition)</span> <span class="title">Exec</span><span class="params">(db IBlackboard)</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> v := r.f(db); !v &#123;</span><br><span class="line">        <span class="keyword">return</span> Failure</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Success</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™å¼•å…¥ä¸€ä¸ªæ¦‚å¿µ: <code>é»‘æ¿ï¼ˆBlackboardï¼‰</code>ï¼Œä¸€èˆ¬ä¸€ä¸ªè¡Œä¸ºæ ‘æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œç”¨äºå„èŠ‚ç‚¹é—´å…±äº«æ•°æ®ã€‚å°±åƒä¸€ç¾¤äººåœ¨é»‘æ¿å‰è®¨è®ºé—®é¢˜ï¼Œå„è‡ªçš„æ€è·¯ã€æ–¹æ¡ˆéƒ½è¢«ä¹¦å†™åœ¨é»‘æ¿ä¸Šä¾›æ‰€æœ‰äººé˜…è¯»ã€‚è°ƒç”¨å®ç°:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»æ‹›</span></span><br><span class="line"><span class="keyword">type</span> JueZhao <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewJueZhao</span><span class="params">()</span> *<span class="title">JueZhao</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;JueZhao&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *JueZhao)</span> <span class="title">Exec</span><span class="params">(db IBlackboard)</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"[ç»æ‹›]done"</span>)</span><br><span class="line">    db.Set(<span class="string">"can_use_skill"</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">return</span> Success</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è“„åŠ›</span></span><br><span class="line"><span class="keyword">type</span> XuLi <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewXuLi</span><span class="params">()</span> *<span class="title">XuLi</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;XuLi&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *XuLi)</span> <span class="title">Exec</span><span class="params">(db IBlackboard)</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">    db.Set(<span class="string">"can_use_skill"</span>, <span class="literal">true</span>)</span><br><span class="line">    fmt.Println(<span class="string">"[è“„åŠ›]done"</span>)</span><br><span class="line">    <span class="keyword">return</span> Success</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    bt := NewSequence(</span><br><span class="line">        NewXuLi(),</span><br><span class="line">        NewCondition(<span class="function"><span class="keyword">func</span><span class="params">(db IBlackboard)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">            result := db.Get(<span class="string">"can_use_skill"</span>)</span><br><span class="line">            <span class="keyword">if</span> result == <span class="literal">nil</span> || !result.(<span class="keyword">bool</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;),</span><br><span class="line">        NewJueZhao(),</span><br><span class="line">    )</span><br><span class="line">    db := &amp;Blackboard&#123;</span><br><span class="line">        data: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    result := bt.Exec(db)</span><br><span class="line">    fmt.Print(<span class="string">"ç»“æœ: "</span>)</span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> Success:</span><br><span class="line">        fmt.Println(<span class="string">"æˆåŠŸ"</span>)</span><br><span class="line">    <span class="keyword">case</span> Failure:</span><br><span class="line">        fmt.Println(<span class="string">"å¤±è´¥"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [è“„åŠ›]done</span></span><br><span class="line"><span class="comment">// [ç»æ‹›]done</span></span><br><span class="line"><span class="comment">// ç»“æœ: æˆåŠŸ</span></span><br></pre></td></tr></table></figure></p><h3 id="è£…é¥°èŠ‚ç‚¹"><a href="#è£…é¥°èŠ‚ç‚¹" class="headerlink" title="è£…é¥°èŠ‚ç‚¹"></a>è£…é¥°èŠ‚ç‚¹</h3><p>æ¯”å¦‚è®©AIè¿ç»­æ‰§è¡Œ3æ¬¡ç»æ‹›ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Repeater <span class="keyword">struct</span> &#123;</span><br><span class="line">    child INode</span><br><span class="line">    count <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRepeater</span><span class="params">(child INode, count <span class="keyword">int8</span>)</span> *<span class="title">Repeater</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Repeater&#123;</span><br><span class="line">        child: child,</span><br><span class="line">        count: count,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Repeater)</span> <span class="title">Exec</span><span class="params">(db IBlackboard)</span> <span class="title">Status</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> r.count &gt; <span class="number">0</span> &#123;</span><br><span class="line">        r.child.Exec(db)</span><br><span class="line">        r.count -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Success</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªç®€å•å®ç°ï¼Œå¤§æ¦‚çŸ¥é“è¡Œä¸ºæ ‘å…¶å®å°±æ˜¯æŠŠæƒ³è¦è®©AIæ‰§è¡Œçš„åŠ¨ä½œæŠ½è±¡æˆä¸€ä¸ªä¸€ä¸ªè¡Œä¸ºèŠ‚ç‚¹ï¼Œä½¿ç”¨ç»„åˆèŠ‚ç‚¹åŠ ä»¥æ§åˆ¶ç»„æˆä¸€ä¸ªå¤æ‚çš„AIæ ‘ã€‚</p><p>ä¼˜ç‚¹æ˜¾è€Œæ˜“è§ï¼Œå¯è¯»æ€§å¥½ã€æ–¹ä¾¿æ‰©å±•ã€å¯ä»¥è„šæœ¬åŒ–ç¼–å†™ã€‚éƒ¨åˆ†æ¸¸æˆå¼•æ“ä¹Ÿæä¾›å¯è§†åŒ–ç¼–å†™ï¼Œæ¯”å¦‚ï¼šUnrealã€Unityçš„Behavior Designeræ’ä»¶ç­‰</p><p>ç¼ºç‚¹æ˜¯æ¯æ¬¡éƒ½ä»æ ¹èŠ‚ç‚¹è¿è¡Œï¼Œè¡Œä¸ºæ ‘æ¯”è¾ƒå¤æ‚çš„æƒ…å†µè¿è¡Œæ•ˆç‡ä¸ä¼šé«˜ã€‚å½“ç„¶é’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼Œå°±æ˜¯å¯¹èŠ‚ç‚¹åšRunningè®°å½•ï¼Œä¸‹æ¬¡ä»RunningèŠ‚ç‚¹ç»§ç»­æ‰§è¡Œã€‚</p><p>é™„ä¸Šç¤ºä¾‹ï¼š<a href="https://github.com/xupin/behavior-tree" target="_blank" rel="noopener">bt</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¡Œä¸ºæ ‘ä¸€èˆ¬åº”ç”¨äºæ¸¸æˆå†…ç‰©ä½“çš„AIå†³ç­–ï¼Œä»¥æ ‘çš„å½¢å¼æ§åˆ¶ç‰©ä½“æ¥ä¸‹æ¥çš„åŠ¨ä½œã€‚æ¯”å¦‚: è¡€é‡å¤ªå°‘ -&amp;gt; åƒè¯ã€æ”»å‡»è·ç¦»ä¸å¤Ÿ -&amp;gt; ç§»åŠ¨ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ€è¿‘åœ¨æ‘¸ç´¢å°æ¸¸æˆå¼€å‘ï¼Œæœ‰ä¸€äº›è”æœºå‹çš„åŠŸèƒ½éœ€è¦æœºå™¨äººå‚ä¸ï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸‹æ¸¸æˆAIã€‚ç»¼åˆä¸€ä¸‹å®ç°æ–¹æ¡ˆåŸºæœ¬æ˜¯ä»¥ä¸‹ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰é™çŠ¶æ€æœºï¼ˆFinite State Machineï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;FSMä¹Ÿæ˜¯æœ€å¼€å§‹é‡‡ç”¨çš„æ–¹æ¡ˆï¼Œå®ç°èµ·æ¥ç®€å•ç²—æš´ã€‚ç¼ºç‚¹æ˜¯æ•´ä¸ªé€»è¾‘éå¸¸è‡ƒè‚¿å¾ˆéš¾æ¨¡å—åŒ–ï¼Œåé¢å†å¯¹AIè¿›è¡Œæ›´æ–°å’Œç»´æŠ¤æ¯”è¾ƒæ¶å¿ƒï¼Œå¾ˆå®¹æ˜“å› ä¸ºæ¼æ”¹ã€é”™æ”¹å¯¼è‡´ä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºæ ‘ï¼ˆBehavior Treeï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è¡Œä¸ºæ ‘æ˜¯ç”±ä¸€ç³»åˆ—èŠ‚ç‚¹æ„æˆçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªåŠ¨ä½œï¼Œè‡ªä¸Šè€Œä¸‹æ‰§è¡Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¿”å›æ‰§è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/assets/bt/bt.png&quot; alt=&quot;drawing&quot; width=&quot;300&quot; height=&quot;180&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="game" scheme="http://xupin.im/tags/game/"/>
    
  </entry>
  
  <entry>
    <title>æ¸¸æˆå¼€å‘ç¬”è®° - é€šä¿¡åè®®</title>
    <link href="http://xupin.im/2023/02/27/game-protocol/"/>
    <id>http://xupin.im/2023/02/27/game-protocol/</id>
    <published>2023-02-26T16:00:00.000Z</published>
    <updated>2023-11-08T03:46:04.368Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç½‘ç»œæ¸¸æˆä¸­ï¼Œé€šä¿¡åè®®æ˜¯å…¶ä¸­å¿…ä¸å¯å°‘çš„ç»„æˆéƒ¨åˆ†ã€‚ä¸€ä¸ªé€šä¿¡åè®®çš„å¤§å°ã€ç»“æ„å°†ä¸æœåŠ¡å™¨è´Ÿè½½åŠå®¢æˆ·ç«¯å»¶è¿Ÿæ¯æ¯ç›¸å…³ã€‚</p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ¸¸æˆçš„é€šä¿¡åè®®ï¼Œä¸€èˆ¬éœ€è¦è€ƒè™‘2ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><p>ç½‘ç»œä¼ è¾“åè®®</p></li><li><p>æ•°æ®äº¤æ¢æ ¼å¼</p></li></ol><a id="more"></a><h3 id="ç½‘ç»œä¼ è¾“åè®®"><a href="#ç½‘ç»œä¼ è¾“åè®®" class="headerlink" title="ç½‘ç»œä¼ è¾“åè®®"></a>ç½‘ç»œä¼ è¾“åè®®</h3><p>æ ¹æ®æ¸¸æˆç±»å‹çš„ä¸åŒï¼Œç½‘ç»œä¼ è¾“åè®®é€‰æ‹©ä¹Ÿæœ‰äº›è®¸ä¸åŒã€‚æ¯”å¦‚ï¼š</p><ul><li>å¼±è”ç½‘ç±»å‹</li></ul><blockquote><p>å•å·¥/åŠåŒå·¥é€šä¿¡åè®®ï¼šHTTP1.0ã€HTTP1.1</p></blockquote><ul><li>å¼ºè”ç½‘ã€å¼ºäº¤äº’ç±»å‹</li></ul><blockquote><p>å…¨åŒå·¥é€šä¿¡åè®®ï¼šWebSocketã€TCP</p></blockquote><ul><li>å¼ºè”ç½‘ã€å®æ—¶äº¤äº’ç±»å‹</li></ul><blockquote><p>UDP</p></blockquote><p>å•å·¥ã€åŠåŒå·¥åŠå…¨åŒå·¥é€šä¿¡åè®®çš„åŒºåˆ«ç”¨3å¼ å›¾æ¥è¡¨ç¤ºä¸€ä¸‹ï¼Œå…·ä½“å†…å®¹ç•™åˆ°ä¸‹ç¯‡å­¦ä¹ ç¬”è®°å†æ°´â€¦</p><p>å•å·¥<br><img src="/assets/game-protocol/single.gif" width="300" height="100" alt="drawing"></p><p>åŠåŒå·¥<br><img src="/assets/game-protocol/two-way.gif" width="300" height="100" alt="drawing"></p><p>å…¨åŒå·¥<br><img src="/assets/game-protocol/full-duplex.gif" width="300" height="100" alt="drawing"></p><h3 id="æ•°æ®äº¤æ¢æ ¼å¼"><a href="#æ•°æ®äº¤æ¢æ ¼å¼" class="headerlink" title="æ•°æ®äº¤æ¢æ ¼å¼"></a>æ•°æ®äº¤æ¢æ ¼å¼</h3><p>å¯¹äºæ•°æ®äº¤æ¢æ ¼å¼æ¥è¯´ï¼Œéœ€è¦è§£å†³çš„æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯å†…å®¹è¯­ä¹‰æ¸…æ™°ï¼Œç»“æ„ç¨³å®šï¼Œé€šä¿—åœ°è¯´ä¸åŒçš„ç¨‹åºéƒ½å¯ä»¥ç¨³å®šçš„è§£æå¹¶ä¸”çŸ¥é“æ€æ ·å»å¤„ç†å®ƒä»¬ã€‚</p><p>å¯¹äºæ•°æ®ç»“æ„ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ä¸ªé€‰æ‹©ï¼š</p><ul><li>XML</li></ul><blockquote><p>å¯è¯»æ€§é«˜ï¼Œè§£æéš¾åº¦é«˜</p></blockquote><ul><li>JSON</li></ul><blockquote><p>å¯è¯»æ€§é«˜ã€æ˜“è§£æã€ä½“ç§¯å°</p></blockquote><ul><li>Protocol Buffers</li></ul><blockquote><p>å¯è¯»æ€§å·®ã€æ˜“è§£æã€ä½“ç§¯ç‰¹åˆ«å°</p></blockquote><p>åœ¨ç¡®å®šæ•°æ®äº¤æ¢åè®®åï¼Œè¿˜éœ€è¦åˆ¶å®šæ•°æ®äº¤æ¢çš„æ ¼å¼ï¼Œä¿è¯æ•°æ®ä¸ä¼šå‡ºç°æ­§ä¹‰ã€‚æ¯”å¦‚ä¸‹å›¾è¿™æ ·çš„æ ¼å¼ï¼ˆæœªè€ƒè™‘åŠ å¯†ï¼‰ã€‚</p><p><img src="/assets/game-protocol/structure.png" alt="drawing"></p><p>ä»å·¦å‘å³ç»“æ„ï¼š<code>å¤´å­—èŠ‚è¡¨ç¤ºåè®®åç§°çš„é•¿åº¦ã€ä¸­é—´éƒ¨åˆ†æ˜¯åè®®åç§°ã€æœ€åæ˜¯åè®®çš„å…·ä½“æ•°æ®ï¼ˆå¯ä»¥æ˜¯XMLã€JSONã€PBç­‰ï¼‰ã€‚</code></p><h3 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h3><p>ä½¿ç”¨WebSocket + PBæ¥å®ç°ä¸€å¥—é€šä¿¡åè®®ï¼Œå®ç°ä¸€ä¸ªç®€æ˜“ç™»å½•åè®®ã€‚</p><p>åè®®æ–‡ä»¶<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line"></span><br><span class="line">option go_package = <span class="string">"./protocol"</span>;</span><br><span class="line"></span><br><span class="line">message login &#123;</span><br><span class="line">    <span class="keyword">string</span> username = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">string</span> password = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœåŠ¡ç«¯æ ¸å¿ƒä»£ç <br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Packet <span class="keyword">struct</span> &#123;</span><br><span class="line">Protocol <span class="keyword">string</span></span><br><span class="line">Bytes    []<span class="keyword">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Packet)</span> <span class="title">Encode</span><span class="params">()</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">buffer := &amp;bytes.Buffer&#123;&#125;</span><br><span class="line"><span class="comment">// 2å­—èŠ‚ï¼Œåè®®åç§°é•¿åº¦</span></span><br><span class="line">buffer.Write(r.shortBytes(<span class="keyword">uint16</span>(<span class="built_in">len</span>(r.Protocol))))</span><br><span class="line"><span class="comment">// åè®®åç§°</span></span><br><span class="line">buffer.WriteString(r.Protocol)</span><br><span class="line"><span class="comment">// åè®®å†…å®¹</span></span><br><span class="line">buffer.Write(r.Bytes)</span><br><span class="line"><span class="keyword">return</span> buffer.Bytes()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Packet)</span> <span class="title">Decode</span><span class="params">()</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">buffer := bytes.NewBuffer(r.Bytes)</span><br><span class="line">byteLen := buffer.Len()</span><br><span class="line"><span class="comment">// 2å­—èŠ‚ï¼Œåè®®åç§°é•¿åº¦</span></span><br><span class="line">headLen := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">2</span>)</span><br><span class="line">buffer.Read(headLen)</span><br><span class="line"><span class="comment">// åè®®åç§°</span></span><br><span class="line">protocolLen := r.readShort(headLen)</span><br><span class="line">protocol := <span class="built_in">make</span>([]<span class="keyword">byte</span>, protocolLen)</span><br><span class="line">buffer.Read(protocol)</span><br><span class="line">r.Protocol = <span class="keyword">string</span>(protocol)</span><br><span class="line"><span class="comment">// åè®®å†…å®¹</span></span><br><span class="line">bytes := <span class="built_in">make</span>([]<span class="keyword">byte</span>, byteLen<span class="number">-2</span>-<span class="keyword">int</span>(protocolLen))</span><br><span class="line">buffer.Read(bytes)</span><br><span class="line">r.Bytes = bytes</span><br><span class="line"><span class="keyword">return</span> bytes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Packet)</span> <span class="title">readShort</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="title">uint16</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> binary.BigEndian.Uint16(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Packet)</span> <span class="title">shortBytes</span><span class="params">(i <span class="keyword">uint16</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">bytes := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">2</span>)</span><br><span class="line">binary.BigEndian.PutUint16(bytes, i)</span><br><span class="line"><span class="keyword">return</span> bytes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é™„ä¸Šå®Œæ•´å®ç°ï¼š<br><a href="https://github.com/xupin/ws-network" target="_blank" rel="noopener">ws-network</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ç½‘ç»œæ¸¸æˆä¸­ï¼Œé€šä¿¡åè®®æ˜¯å…¶ä¸­å¿…ä¸å¯å°‘çš„ç»„æˆéƒ¨åˆ†ã€‚ä¸€ä¸ªé€šä¿¡åè®®çš„å¤§å°ã€ç»“æ„å°†ä¸æœåŠ¡å™¨è´Ÿè½½åŠå®¢æˆ·ç«¯å»¶è¿Ÿæ¯æ¯ç›¸å…³ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æ¸¸æˆçš„é€šä¿¡åè®®ï¼Œä¸€èˆ¬éœ€è¦è€ƒè™‘2ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ç½‘ç»œä¼ è¾“åè®®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ•°æ®äº¤æ¢æ ¼å¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="game" scheme="http://xupin.im/tags/game/"/>
    
  </entry>
  
  <entry>
    <title>æ¸¸æˆå¼€å‘ç¬”è®° - åœ°å›¾ç¼–è¾‘å™¨</title>
    <link href="http://xupin.im/2023/01/30/game-map-editor/"/>
    <id>http://xupin.im/2023/01/30/game-map-editor/</id>
    <published>2023-01-29T16:00:00.000Z</published>
    <updated>2023-11-08T03:25:59.659Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åœ¨å­¦ä¹ <a href="/2022/08/01/data-structures-algorithms-astar/" title="æ•°æ®ç»“æ„ä¸ç®—æ³• - AStar(A*)">æ•°æ®ç»“æ„ä¸ç®—æ³• - AStar(A*)</a>ç­‰å¯»è·¯ç®—æ³•çš„è¿‡ç¨‹ä¸­æåˆ°è¿‡ç½‘æ ¼åœ°å›¾æ—¶ç”±ç±»ä¼¼<code>0æ˜¯å¯ç§»åŠ¨èŠ‚ç‚¹ã€1æ˜¯éšœç¢èŠ‚ç‚¹</code>çš„ç½‘æ ¼ç»„æˆçš„ä¸€å¼ åœ°å›¾ï¼Œè¿™äº›åœ°å›¾ä¿¡æ¯æ˜¯æ€æ ·ç”Ÿæˆå‡ºæ¥çš„å‘¢ï¼Ÿ</p><h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>åœ°å›¾ç¼–è¾‘å™¨æ˜¯ä¸€ç§æ‰€è§å³æ‰€å¾—çš„æ¸¸æˆåœ°å›¾åˆ¶ä½œå·¥å…·ï¼Œå®ƒè¾…åŠ©è®¾è®¡å’Œè¾“å‡ºåœ°å›¾æ•°æ®ï¼ŒåŒ…æ‹¬åˆ›å»ºã€ç¼–è¾‘ã€å­˜å‚¨å’Œç®¡ç†æ¸¸æˆåœ°å›¾æ•°æ®ã€‚</p><h3 id="å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®"><a href="#å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®" class="headerlink" title="å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®"></a>å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®</h3><p>åªè€ƒè™‘2Dåœ°å›¾ï¼Œä¸€èˆ¬æ¥è¯´æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><a id="more"></a><ul><li><p>PhotoShop<br>æ‰“å¼€åŸå§‹åœ°å›¾æ–‡ä»¶ï¼ŒæŒ‰ç…§ç½‘æ ¼å¤§å°è¿›è¡Œæ ‡æ³¨ç±»å‹</p></li><li><p>åœ°å›¾ç¼–è¾‘å™¨<br>2Dæ¸¸æˆæœ‰å¾ˆå¤šæˆç†Ÿçš„ç¼–è¾‘å™¨ï¼Œæ¯”å¦‚ï¼š<a href="https://github.com/mapeditor/tiled" target="_blank" rel="noopener">tiled editor</a>ï¼Œä½†æœ¬ç€â€œé€ è½®å­â€çš„åŸåˆ™å°±æ˜¯å¼€å‘ä¸€å¥—å•¦ï¼</p></li></ul><p>åœ°å›¾ç¼–è¾‘å™¨ä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯æ¥å¼€å‘ï¼Œé€‰æ‹©ä¹Ÿå¾ˆå¤šæ ·æ€§ã€‚</p><p>è€ƒè™‘å­¦ä¹ æˆæœ¬é—®é¢˜ï¼Œè¿™é‡Œä½¿ç”¨Cocos Creator + Typescriptæ¥å¼€å‘ä¸€å¥—ç®€æ˜“çš„åœ°å›¾ç¼–è¾‘å™¨ã€‚</p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><ol><li><p>åŠ è½½è´´å›¾æ–‡ä»¶</p></li><li><p>æ ¹æ®æŒ‡å®šç½‘æ ¼å¤§å°è¿›è¡Œåˆ’åˆ†ç½‘æ ¼</p></li><li><p>å¯ä»¥å¯¹ç½‘æ ¼å¡«å……ä¸åŒçš„é¢œè‰²ï¼ˆå¯è¡Œèµ°ã€ä¸å¯è¡Œèµ°ï¼‰</p></li><li><p>å¯¼å‡ºç»“æœ</p></li></ol><p>åœ°å›¾ç¼–è¾‘å™¨æ˜¯æ¸¸æˆå¼€å‘ä¸­æœ€å…¥é—¨çš„éƒ¨åˆ†ï¼Œç®€å•ç²—æš´ï¼</p><h3 id="åŠ è½½è´´å›¾æ–‡ä»¶"><a href="#åŠ è½½è´´å›¾æ–‡ä»¶" class="headerlink" title="åŠ è½½è´´å›¾æ–‡ä»¶"></a>åŠ è½½è´´å›¾æ–‡ä»¶</h3><p>åˆ›å»ºä¸€ä¸ªç”¨äºæ˜¾ç¤ºåœ°å›¾çš„<code>Sprite</code>èŠ‚ç‚¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = cc._decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> main <span class="keyword">extends</span> cc.Component &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ°å›¾è´´å›¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="meta">@property</span>(cc.Node)</span><br><span class="line">    mapNode: cc.Node = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    start() &#123; &#125;</span><br><span class="line"></span><br><span class="line">    onLoad() &#123;</span><br><span class="line">        <span class="comment">// init logic</span></span><br><span class="line">        cc.resources.load(<span class="string">"textures/4006"</span>, cc.SpriteFrame, <span class="function">(<span class="params">err, frame: cc.SpriteFrame</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(err.message || err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.mapNode.getComponent(cc.Sprite).spriteFrame = frame;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/assets/map-editor/load-sprite.jpg" alt="drawing" width="500" height="313"></p><h3 id="åˆ’åˆ†ç½‘æ ¼"><a href="#åˆ’åˆ†ç½‘æ ¼" class="headerlink" title="åˆ’åˆ†ç½‘æ ¼"></a>åˆ’åˆ†ç½‘æ ¼</h3><p>åœ¨SpriteèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªç»˜å›¾å­èŠ‚ç‚¹<code>Graphics</code>ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»˜å›¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="meta">@property</span>(cc.Graphics)</span><br><span class="line">mapGraphics: cc.Graphics = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ°å›¾åŸå§‹å°ºå¯¸</span></span><br><span class="line">originWidth: <span class="built_in">number</span> = <span class="number">2862</span>;</span><br><span class="line">originHeight: <span class="built_in">number</span> = <span class="number">2304</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç½‘æ ¼å¤§å°</span></span><br><span class="line">gridWidth: <span class="built_in">number</span> = <span class="number">20</span>;</span><br><span class="line">gridHeight: <span class="built_in">number</span> = <span class="number">20</span>;</span><br></pre></td></tr></table></figure></p><p>ä¹‹ååœ¨<code>Graphics</code>èŠ‚ç‚¹è¿›è¡Œç»˜åˆ¶ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.mapGraphics.clear() <span class="comment">// æ¸…é™¤æ‰€æœ‰ç»˜åˆ¶</span></span><br><span class="line"><span class="keyword">this</span>.mapGraphics.strokeColor = cc.Color.RED <span class="comment">// çº¢è‰²</span></span><br><span class="line"><span class="keyword">this</span>.mapGraphics.lineWidth = <span class="number">1</span> <span class="comment">// çº¿å®½åº¦</span></span><br><span class="line"><span class="comment">// ç”»ç«–çº¿</span></span><br><span class="line"><span class="keyword">let</span> xMax: <span class="built_in">number</span> = <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.mapNode.width / <span class="keyword">this</span>.gridWidth)</span><br><span class="line"><span class="comment">// console.log("xMax = width / gridWidth", xMax, this.mapNode.width, this.gridWidth)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i: <span class="built_in">number</span> = <span class="number">0</span>; i &lt; xMax; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = i * <span class="keyword">this</span>.gridWidth;</span><br><span class="line">    <span class="keyword">this</span>.mapGraphics.moveTo(x, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">this</span>.mapGraphics.lineTo(x, <span class="keyword">this</span>.mapNode.height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”»æ¨ªçº¿</span></span><br><span class="line"><span class="keyword">let</span> yMax: <span class="built_in">number</span> = <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.mapNode.height / <span class="keyword">this</span>.gridHeight)</span><br><span class="line"><span class="comment">// console.log("yMax = height / gridHeight", yMax, this.mapNode.height, this.gridHeight)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i: <span class="built_in">number</span> = <span class="number">0</span>; i &lt; yMax; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = i * <span class="keyword">this</span>.gridHeight;</span><br><span class="line">    <span class="keyword">this</span>.mapGraphics.moveTo(<span class="number">0</span>, y)</span><br><span class="line">    <span class="keyword">this</span>.mapGraphics.lineTo(<span class="keyword">this</span>.mapNode.width, y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>.mapGraphics.stroke();</span><br></pre></td></tr></table></figure></p><p><img src="/assets/map-editor/graphics.jpg" alt="drawing" width="500" height="313"></p><h3 id="å¡«å……é¢œè‰²"><a href="#å¡«å……é¢œè‰²" class="headerlink" title="å¡«å……é¢œè‰²"></a>å¡«å……é¢œè‰²</h3><p>ç›‘å¬è§¦å±äº‹ä»¶<code>TOUCH_START</code>ã€<code>TOUCH_MOVE</code>ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mouse event</span></span><br><span class="line"><span class="keyword">this</span>.mapNode.on(cc.Node.EventType.TOUCH_START, <span class="keyword">this</span>.updateGrid, <span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">this</span>.mapNode.on(cc.Node.EventType.TOUCH_MOVE, <span class="keyword">this</span>.updateGrid, <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p><p>äº‹ä»¶è§¦å‘ï¼Œç»™é¼ æ ‡æ‰€åœ¨åæ ‡çš„ç½‘æ ¼å¡«å……é¢œè‰²ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„å°çŸ¥è¯†ç‚¹<code>åæ ‡ç³»çš„è½¬æ¢</code>ï¼Œå¯åˆ†ä¸ºï¼šä¸–ç•Œåæ ‡ã€æœ¬åœ°åæ ‡ã€åƒç´ åæ ‡ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> eventPos: cc.Vec2 = event.getLocation();</span><br><span class="line"><span class="keyword">let</span> pos = <span class="keyword">this</span>.mapNode.convertToNodeSpaceAR(eventPos); <span class="comment">// è½¬æ¢è‡³èŠ‚ç‚¹åæ ‡</span></span><br><span class="line"><span class="keyword">let</span> x: <span class="built_in">number</span> = <span class="built_in">Math</span>.floor(pos.x / <span class="keyword">this</span>.gridWidth);</span><br><span class="line"><span class="keyword">let</span> y: <span class="built_in">number</span> = <span class="built_in">Math</span>.floor(pos.y / <span class="keyword">this</span>.gridHeight);</span><br><span class="line"><span class="keyword">this</span>.mapGraphics.rect(x * <span class="keyword">this</span>.gridWidth, y * <span class="keyword">this</span>.gridHeight, <span class="keyword">this</span>.gridWidth, <span class="keyword">this</span>.gridHeight);</span><br><span class="line"><span class="keyword">this</span>.mapGraphics.fillColor = cc.Color.BLUE;</span><br><span class="line"><span class="keyword">this</span>.mapGraphics.fill();</span><br></pre></td></tr></table></figure></p><p><img src="/assets/map-editor/fill-color.gif" alt="drawing" width="500" height="313"></p><h3 id="å¯¼å‡ºç»“æœ"><a href="#å¯¼å‡ºç»“æœ" class="headerlink" title="å¯¼å‡ºç»“æœ"></a>å¯¼å‡ºç»“æœ</h3><p>å¯¼å‡ºç»“æœé€»è¾‘å¾ˆç®€å•ï¼Œéœ€è¦åœ¨å¡«å……é¢œè‰²æ—¶è®°å½•å¯¹åº”ç½‘æ ¼çš„ç±»å‹ï¼Œæœ€åè¾“å‡ºåˆ°æ–‡ä»¶ã€‚</p><p>ç”Ÿæˆx*yä¸ªç½‘ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç½‘æ ¼ä¿¡æ¯</span></span><br><span class="line">grids: <span class="built_in">Array</span>&lt;<span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt;&gt;;</span><br></pre></td></tr></table></figure></p><p>è®°å½•ç½‘æ ¼ä¿¡æ¯ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•æ ¼å­ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">this</span>.grids = <span class="keyword">new</span> <span class="built_in">Array</span>(xMax);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i: <span class="built_in">number</span> = <span class="number">0</span>; i &lt; xMax; i++) &#123;</span><br><span class="line">    <span class="keyword">this</span>.grids[i] = <span class="keyword">new</span> <span class="built_in">Array</span>(yMax);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j: <span class="built_in">number</span> = <span class="number">0</span>; j &lt; yMax; j++) &#123;</span><br><span class="line">        <span class="keyword">this</span>.grids[i][j] = <span class="number">1</span>; <span class="comment">// é»˜è®¤ä¸å¯è¡Œèµ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºåˆ°æ–‡ä»¶<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> v: object = &#123;</span><br><span class="line">    map: &#123;</span><br><span class="line">        originWidth: <span class="keyword">this</span>.originWidth,</span><br><span class="line">        originHeight: <span class="keyword">this</span>.originHeight,</span><br><span class="line">        width: <span class="keyword">this</span>.mapNode.width,</span><br><span class="line">        height: <span class="keyword">this</span>.mapNode.height,</span><br><span class="line">    &#125;,</span><br><span class="line">    grid: &#123;</span><br><span class="line">        width: <span class="keyword">this</span>.gridWidth,</span><br><span class="line">        height: <span class="keyword">this</span>.gridHeight,</span><br><span class="line">    &#125;,</span><br><span class="line">    data: <span class="keyword">this</span>.grids,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (cc.sys.isBrowser) &#123;</span><br><span class="line">    <span class="keyword">let</span> json = <span class="built_in">JSON</span>.stringify(v)</span><br><span class="line">    <span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([json], &#123; <span class="keyword">type</span>: <span class="string">'application/json'</span> &#125;);</span><br><span class="line">    <span class="keyword">let</span> aLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</span><br><span class="line">    aLink.download = <span class="string">'map.json'</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.webkitURL != <span class="literal">null</span>) &#123;</span><br><span class="line">        aLink.href = <span class="built_in">window</span>.webkitURL.createObjectURL(blob);</span><br><span class="line">    &#125;</span><br><span class="line">    aLink.click();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">"å¯¼å‡ºä»…æ”¯æŒæµè§ˆå™¨"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>é™„ä¸Šå®Œæ•´ä»£ç ï¼š<a href="https://github.com/xupin/map-editor" target="_blank" rel="noopener">map-editor</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰åœ¨å­¦ä¹ &lt;a href=&quot;/2022/08/01/data-structures-algorithms-astar/&quot; title=&quot;æ•°æ®ç»“æ„ä¸ç®—æ³• - AStar(A*)&quot;&gt;æ•°æ®ç»“æ„ä¸ç®—æ³• - AStar(A*)&lt;/a&gt;ç­‰å¯»è·¯ç®—æ³•çš„è¿‡ç¨‹ä¸­æåˆ°è¿‡ç½‘æ ¼åœ°å›¾æ—¶ç”±ç±»ä¼¼&lt;code&gt;0æ˜¯å¯ç§»åŠ¨èŠ‚ç‚¹ã€1æ˜¯éšœç¢èŠ‚ç‚¹&lt;/code&gt;çš„ç½‘æ ¼ç»„æˆçš„ä¸€å¼ åœ°å›¾ï¼Œè¿™äº›åœ°å›¾ä¿¡æ¯æ˜¯æ€æ ·ç”Ÿæˆå‡ºæ¥çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h3&gt;&lt;p&gt;åœ°å›¾ç¼–è¾‘å™¨æ˜¯ä¸€ç§æ‰€è§å³æ‰€å¾—çš„æ¸¸æˆåœ°å›¾åˆ¶ä½œå·¥å…·ï¼Œå®ƒè¾…åŠ©è®¾è®¡å’Œè¾“å‡ºåœ°å›¾æ•°æ®ï¼ŒåŒ…æ‹¬åˆ›å»ºã€ç¼–è¾‘ã€å­˜å‚¨å’Œç®¡ç†æ¸¸æˆåœ°å›¾æ•°æ®ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®&quot;&gt;&lt;a href=&quot;#å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®&quot;&gt;&lt;/a&gt;å¦‚ä½•ç”Ÿæˆåœ°å›¾æ•°æ®&lt;/h3&gt;&lt;p&gt;åªè€ƒè™‘2Dåœ°å›¾ï¼Œä¸€èˆ¬æ¥è¯´æœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="game" scheme="http://xupin.im/tags/game/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - AST</title>
    <link href="http://xupin.im/2022/12/13/data-structures-algorithms-ast/"/>
    <id>http://xupin.im/2022/12/13/data-structures-algorithms-ast/</id>
    <published>2022-12-12T16:00:00.000Z</published>
    <updated>2023-11-06T09:32:17.430Z</updated>
    
    <content type="html"><![CDATA[<p>ASTï¼ˆAbstract syntax treeï¼‰æŠ½è±¡è¯­æ³•æ ‘ï¼Œç”¨äºè¡¨ç¤ºç¼–ç¨‹è¯­è¨€æºä»£ç çš„ä¸€ç§æŠ½è±¡è¯­æ³•çš„ç»“æ„ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”æºä»£ç ä¸­çš„ä¸€ä¸ªç»“æ„ã€‚</p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>è®¡ç®—æœºå¦‚ä½•ç”ŸæˆASTç»“æ„ï¼Ÿä¸€èˆ¬æ¥è¯´é¡ºåºå¦‚ä¸‹ï¼š</p><ol><li>è¯æ³•åˆ†æ</li></ol><blockquote><p>æ‰«ææºä»£ç ï¼Œç”Ÿæˆæ ‡è®°ï¼ˆtokenï¼‰</p></blockquote><ol><li>è¯­æ³•åˆ†æ</li></ol><blockquote><p>è§£ætokensï¼Œæ„é€ ASTç»“æ„</p></blockquote><a id="more"></a><p>åˆ†æè¿‡ç¨‹ï¼š<br><img src="/assets/ast/process.png" alt="drawing" width="400" height="150"></p><p>ASTç»“æ„ï¼š<br><img src="/assets/ast/ast.png" alt="drawing" width="400" height="420"></p><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>ASTåº”ç”¨åœºæ™¯æ¯”è¾ƒå¹¿æ³›ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>Typescriptç¼–è¯‘Javascriptæ–‡ä»¶</p></li><li><p>æ ¼å¼åŒ–æ’ä»¶</p></li><li><p>ä»£ç æ··æ·†/å‹ç¼©</p></li><li><p>ç±»å‹æ£€æŸ¥/æ¨å¯¼</p></li></ul><p>ç­‰ç­‰â€¦è¯¸å¤šåº”ç”¨åœºæ™¯ã€‚</p><h3 id="è¯æ³•åˆ†æ"><a href="#è¯æ³•åˆ†æ" class="headerlink" title="è¯æ³•åˆ†æ"></a>è¯æ³•åˆ†æ</h3><p>å¦‚ä½•è¯»å…¥æºä»£ç ï¼Œæ‰«æã€è§£æä»¥åŠç”ŸæˆASTï¼Ÿä¸‹é¢å°è¯•ç”¨ä¸€ä¸ªå¯ä»¥è®¡ç®—<code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>å…¬å¼çš„å°ç¨‹åºæ¥å­¦ä¹ å’Œå®éªŒã€‚</p><p>å‡è®¾ï¼Œç»™å®šçš„æºç æ˜¯<code>1+2+3</code>ï¼Œåº”è¯¥æ€æ ·å»æ‰«æï¼Ÿæ‰«æåŸç†å¾ˆç®€å•ï¼Œé€šä¿—çš„è¯´å°±æ˜¯æŒ‰å­—ç¬¦è¯»å–è®°å½•ä¸ºTokenã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆå®šä¹‰å­˜å‚¨æ ‡è®°çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> Token <span class="keyword">struct</span> &#123;</span><br><span class="line">Str   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰«ææºç </span></span><br><span class="line">s := <span class="string">"1+2+3"</span></span><br><span class="line">tokens := []Token&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> s &#123;</span><br><span class="line">tokens = <span class="built_in">append</span>(tokens, Token&#123;</span><br><span class="line">Str: <span class="keyword">string</span>(c),</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, tokens)</span><br><span class="line"><span class="comment">// [&#123;Str:1&#125; &#123;Str:+&#125; &#123;Str:2&#125; &#123;Str:+&#125; &#123;Str:3&#125;]</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼Œæ‰«æå·¥ä½œå°±å®Œæˆäº†ï¼</p><p>ä½†è¯æ³•åˆ†æä¸€èˆ¬æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚æ•°å­—<code>1</code>å’Œæ“ä½œç¬¦<code>+</code>ä¹Ÿä¸åº”è¯¥æ˜¯åŒä¸€ç§ç±»å‹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ”¹é€ è¯æ³•åˆ†æå™¨ï¼åœ¨ç”ŸæˆTokençš„åŒæ—¶è®°å½•ç±»å‹ï¼Œæ–¹ä¾¿è¿›ä¸€æ­¥å¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çŠ¶æ€æœºçš„è®¾è®¡æ€è·¯ï¼š</p><ol><li>è¯»å…¥ä¸€ä¸ªå­—ç¬¦</li><li>åˆ¤æ–­å­—ç¬¦ç±»å‹ï¼Œæ•°å­— or æ“ä½œç¬¦<br>&nbsp;&nbsp;&nbsp;&nbsp;1. æ˜¯æ•°å­—ï¼Œè®°å½•å½“å‰å­—ç¬¦ä½ç½®ï¼Œç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´è‡³éæ•°å­—æˆ–è€…å­—ç¬¦è¾¹ç•Œï¼Œè®°å½•å®Œæ•´çš„æ•°å€¼ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;2. ä¸æ˜¯æ•°å­—ï¼Œç›´æ¥è®°å½•æ“ä½œç¬¦ã€‚</li><li>è¿”å›token</li></ol><p>è¯¦ç»†æ‰«æé€»è¾‘ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Lexer <span class="keyword">struct</span> &#123;</span><br><span class="line">Expression <span class="keyword">string</span></span><br><span class="line">Char    <span class="keyword">byte</span></span><br><span class="line">Pos     <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Token <span class="keyword">struct</span> &#123;</span><br><span class="line">Str   <span class="keyword">string</span></span><br><span class="line">Type  <span class="keyword">int</span></span><br><span class="line">Start <span class="keyword">int</span></span><br><span class="line">End   <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Lexer)</span> <span class="title">Lex</span><span class="params">()</span> <span class="params">([]*Token, error)</span></span> &#123;</span><br><span class="line">tokens := <span class="built_in">make</span>([]*Token, <span class="number">0</span>)</span><br><span class="line">r.Char = r.Expression[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> r.Pos &lt; <span class="built_in">len</span>(r.Expression) &#123;</span><br><span class="line">token := r.Scan()</span><br><span class="line"><span class="keyword">if</span> token.Type == enums.ILLEGAL &#123;</span><br><span class="line"><span class="keyword">return</span> []*Token&#123;&#125;, fmt.Errorf(<span class="string">"'%s' is not supported"</span>, token.Str)</span><br><span class="line">&#125;</span><br><span class="line">tokens = <span class="built_in">append</span>(tokens, token)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> tokens, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Lexer)</span> <span class="title">Scan</span><span class="params">()</span> *<span class="title">Token</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> token *Token</span><br><span class="line">pos := r.Pos</span><br><span class="line"><span class="keyword">switch</span> r.Char &#123;</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line"><span class="string">'0'</span>,</span><br><span class="line"><span class="string">'1'</span>,</span><br><span class="line"><span class="string">'2'</span>,</span><br><span class="line"><span class="string">'3'</span>,</span><br><span class="line"><span class="string">'4'</span>,</span><br><span class="line"><span class="string">'5'</span>,</span><br><span class="line"><span class="string">'6'</span>,</span><br><span class="line"><span class="string">'7'</span>,</span><br><span class="line"><span class="string">'8'</span>,</span><br><span class="line"><span class="string">'9'</span>:</span><br><span class="line"><span class="keyword">for</span> r.IsDigit() &#123;</span><br><span class="line"><span class="keyword">if</span> !r.NextChar() &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="keyword">string</span>(r.Expression[pos:r.Pos]),</span><br><span class="line">Type:  enums.NUMBER,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   r.Pos,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'+'</span>:</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="keyword">string</span>(r.Char),</span><br><span class="line">Type:  enums.ADD,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   pos,</span><br><span class="line">&#125;</span><br><span class="line">r.NextChar()</span><br><span class="line"><span class="keyword">case</span> <span class="string">'-'</span>:</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="keyword">string</span>(r.Char),</span><br><span class="line">Type:  enums.SUB,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   pos,</span><br><span class="line">&#125;</span><br><span class="line">r.NextChar()</span><br><span class="line"><span class="keyword">case</span> <span class="string">'*'</span>:</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="keyword">string</span>(r.Char),</span><br><span class="line">Type:  enums.MUL,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   pos,</span><br><span class="line">&#125;</span><br><span class="line">r.NextChar()</span><br><span class="line"><span class="keyword">if</span> r.Char == <span class="string">'*'</span> &#123;</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="string">"**"</span>,</span><br><span class="line">Type:  enums.XOR,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   pos,</span><br><span class="line">&#125;</span><br><span class="line">r.NextChar()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="keyword">string</span>(r.Char),</span><br><span class="line">Type:  enums.QUO,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   pos,</span><br><span class="line">&#125;</span><br><span class="line">r.NextChar()</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">token = &amp;Token&#123;</span><br><span class="line">Str:   <span class="keyword">string</span>(r.Char),</span><br><span class="line">Type:  enums.ILLEGAL,</span><br><span class="line">Start: pos,</span><br><span class="line">End:   r.Pos,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> token</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬è°ƒç”¨è¯æ³•åˆ†æå™¨è§£æ<code>1+2+3</code><br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">lexer := lexer.Lexer&#123;</span><br><span class="line">Expression: <span class="string">"1+2+3"</span>,</span><br><span class="line">&#125;</span><br><span class="line">tokens, err := lexer.Lex()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> _, token := <span class="keyword">range</span> tokens &#123;</span><br><span class="line">fmt.Printf(<span class="string">"%+v \n"</span>, token)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &amp;&#123;Str:1 Type:9 Start:0 End:0&#125;</span></span><br><span class="line"><span class="comment">// &amp;&#123;Str:+ Type:10 Start:1 End:1&#125;</span></span><br><span class="line"><span class="comment">// &amp;&#123;Str:2 Type:9 Start:2 End:2&#125;</span></span><br><span class="line"><span class="comment">// &amp;&#123;Str:+ Type:10 Start:3 End:3&#125;</span></span><br><span class="line"><span class="comment">// &amp;&#123;Str:3 Type:9 Start:4 End:4&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="è¯­æ³•åˆ†æ"><a href="#è¯­æ³•åˆ†æ" class="headerlink" title="è¯­æ³•åˆ†æ"></a>è¯­æ³•åˆ†æ</h3><p>ç”Ÿæˆtokensæ˜¯ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€ä¸²tokenåˆè¦æ€æ ·å»è§£æå‘¢ï¼Ÿ</p><p>å·²çŸ¥+-*/å‡å±äºäºŒå…ƒè¿ç®—ï¼ŒäºŒå…ƒè¿ç®—ä¸‰å…ƒç´ ï¼šè¿ç®—ç¬¦ã€å·¦å˜é‡ã€å³å˜é‡ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·ï¼šNumber{1} Op{+} Number{2} Op{+} Number{3}ï¼Œç”¨äºŒå‰æ ‘æ¥è¡¨ç¤ºï¼š</p><p><img src="/assets/ast/binary-tree.png" alt="drawing"></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¯­æ³•åˆ†æå™¨</span></span><br><span class="line"><span class="keyword">type</span> Parser <span class="keyword">struct</span> &#123;</span><br><span class="line">Tokens   []*lexer.Token <span class="comment">// tokens</span></span><br><span class="line">CurToken *lexer.Token <span class="comment">// å½“å‰token</span></span><br><span class="line">Index      <span class="keyword">int</span><span class="comment">// ä¸‹æ ‡</span></span><br><span class="line">Err      error<span class="comment">// error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°å€¼ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> Number <span class="keyword">struct</span> &#123;</span><br><span class="line">Val <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒå…ƒè¿ç®—ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> Stmt <span class="keyword">struct</span> &#123;</span><br><span class="line">Type  <span class="keyword">int</span></span><br><span class="line">Left  Node</span><br><span class="line">Right Node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>é¡ºåºå–å‡ºä¸€ä¸ªtokenã€‚</li><li>ParseExpr()åˆ¤å®štokenç±»å‹ï¼Œè¿”å›å¯¹åº”ç»“æ„ï¼Œä¸‹æ ‡+1ï¼ˆå¤„ç†ä¸‹ä¸€ä¸ªtokenï¼Œåº”å½“æ˜¯è¿ç®—ç¬¦tokenï¼‰ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;1. å¦‚æœæ˜¯æ•°å€¼ç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›Number{}ç»“æ„ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;2. å¦‚æœæ˜¯è¿ç®—ç¬¦ç±»å‹ï¼Œåˆ™é€’å½’å¤„ç†è¿”å›Stmt{}ç»“æ„ã€‚</li><li>ParseRight()å¤„ç†å³ä¾§å˜é‡ï¼ŒæŠŠå·¦ä¾§å˜é‡ä¼ å…¥å‡½æ•°ã€‚</li><li>æ ¹æ®è¿ç®—ç¬¦åˆ¤æ–­å˜é‡ä¼˜å…ˆçº§é—®é¢˜ï¼Œå¦‚æœå½“å‰è¿ç®—ç¬¦å°äºä¼ å…¥å˜é‡ä¼˜å…ˆçº§ï¼Œåˆ™ç›´æ¥è¿”å›ä¼ å…¥å˜é‡ï¼Œå¤„ç†ç»“æŸã€‚</li><li>è®°å½•å½“å‰è¿ç®—ç¬¦ï¼ˆç±»å‹ï¼‰ï¼Œä¸‹æ ‡+1ï¼Œå¤„ç†å½“å‰æ“ä½œç¬¦å³ä¾§å˜é‡ï¼ˆæ­¥éª¤2ï¼‰ã€‚</li><li>å†æ¬¡åˆ¤æ–­ä¼ å…¥å˜é‡ä¼˜å…ˆçº§æ˜¯å¦ä½äºå½“å‰è¿ç®—ç¬¦ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;1. æ˜¯ï¼Œåˆ™æŠŠå³ä¾§å˜é‡ï¼ˆæ­¥éª¤4ï¼‰å½“æˆå·¦ä¾§å˜é‡ä¼ å…¥é€’å½’å¤„ç†ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;2. ä¸æ˜¯ï¼Œåˆ™æ„é€ äºŒå…ƒè¿ç®—è¡¨è¾¾å¼Stmt{Type: è¿ç®—ç¬¦ç±»å‹, Left: å·¦ä¾§å˜é‡, Right: å³ä¾§å˜é‡}ã€‚</li><li>å½“å‰å¾ªç¯ç»“æŸï¼Œå›åˆ°æ­¥éª¤4ã€‚</li></ol><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parser)</span> <span class="title">Parse</span><span class="params">()</span> <span class="params">(Node, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(r.Tokens) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">"the token list is empty"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r.CurToken == <span class="literal">nil</span> &#123;</span><br><span class="line">r.CurToken = r.Tokens[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> r.Compile(), r.Err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parser)</span> <span class="title">Compile</span><span class="params">()</span> <span class="title">Node</span></span> &#123;</span><br><span class="line">left := r.ParseExpr()</span><br><span class="line">right := r.ParseRight(<span class="number">1</span>, left)</span><br><span class="line"><span class="keyword">return</span> right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parser)</span> <span class="title">ParseExpr</span><span class="params">()</span> <span class="title">Node</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> r.CurToken.Type &#123;</span><br><span class="line"><span class="keyword">case</span> enums.NUMBER:</span><br><span class="line"><span class="keyword">return</span> r.ParseNumber()</span><br><span class="line"><span class="keyword">case</span> enums.ADD:</span><br><span class="line"><span class="keyword">return</span> r.ParseNumber()</span><br><span class="line"><span class="keyword">case</span> enums.SUB:</span><br><span class="line"><span class="keyword">if</span> t := r.NextToken(); t.Type == enums.EOF &#123;</span><br><span class="line">r.Err = errors.New(<span class="string">"expects to be number, eof given"</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;Stmt&#123;</span><br><span class="line">Type:  enums.SUB,</span><br><span class="line">Left:  &amp;Number&#123;&#125;,</span><br><span class="line">Right: r.ParseExpr(),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> enums.MUL:</span><br><span class="line"><span class="keyword">return</span> r.ParseNumber()</span><br><span class="line"><span class="keyword">case</span> enums.QUO:</span><br><span class="line"><span class="keyword">return</span> r.ParseNumber()</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">r.Err = fmt.Errorf(<span class="string">"expects to be number, '%s' given"</span>, r.CurToken.Str)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parser)</span> <span class="title">ParseRight</span><span class="params">(precedence <span class="keyword">int</span>, left Node)</span> <span class="title">Node</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">curPrec := r.Precedence()</span><br><span class="line"><span class="keyword">if</span> curPrec &lt; precedence &#123;</span><br><span class="line"><span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br><span class="line">tokenType := r.CurToken.Type</span><br><span class="line">r.NextToken()</span><br><span class="line">right := r.ParseExpr()</span><br><span class="line"><span class="keyword">if</span> right == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> curPrec &lt; r.Precedence() &#123;</span><br><span class="line">right = r.ParseRight(curPrec, right)</span><br><span class="line"><span class="keyword">if</span> right == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">left = &amp;Stmt&#123;</span><br><span class="line">Type:  tokenType,</span><br><span class="line">Left:  left,</span><br><span class="line">Right: right,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parser)</span> <span class="title">ParseNumber</span><span class="params">()</span> *<span class="title">Number</span></span> &#123;</span><br><span class="line">f, err := strconv.ParseFloat(r.CurToken.Str, <span class="number">64</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Number&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">node := &amp;Number&#123;</span><br><span class="line">Val: f,</span><br><span class="line">&#125;</span><br><span class="line">r.NextToken()</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Parser)</span> <span class="title">Precedence</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> r.CurToken.Type &#123;</span><br><span class="line"><span class="keyword">case</span> enums.ADD, enums.SUB:</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">case</span> enums.MUL, enums.QUO:</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹æ•ˆæœï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">lexer := lexer.Lexer&#123;</span><br><span class="line">Expression: <span class="string">"1+2-3*4"</span>,</span><br><span class="line">&#125;</span><br><span class="line">tokens, err := lexer.Lex()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">p := &amp;parser.Parser&#123;</span><br><span class="line">Tokens: tokens,</span><br><span class="line">&#125;</span><br><span class="line">ast, err := p.Parse()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"%+v \n"</span>, ast)</span><br><span class="line"><span class="comment">// &#123;Type: 10, Left: &#123;Type: 10, Left: &#123;Type: 9, Val: 1&#125;, Right: &#123;Type: 9, Val: 2&#125;&#125;, Right: &#123;Type: 9, Val: 3&#125;&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>æœ‰äº†ASTç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è¿›è¡Œè®¡ç®—å•¦ï½è¿™æ ·ä¸€ä¸ªæ”¯æŒ+-*/çš„å°ç¨‹åºå°±å®Œæˆäº†ï¼è®¡ç®—é€»è¾‘ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œç›´æ¥è´´ä»£ç :<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•°å€¼ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Number)</span> <span class="title">Evaluate</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> r.Val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒå…ƒè¿ç®—ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Stmt)</span> <span class="title">Evaluate</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">left := r.Left.Evaluate()</span><br><span class="line">right := r.Right.Evaluate()</span><br><span class="line"><span class="keyword">switch</span> r.Type &#123;</span><br><span class="line"><span class="keyword">case</span> enums.ADD:</span><br><span class="line"><span class="keyword">return</span> left + right</span><br><span class="line"><span class="keyword">case</span> enums.SUB:</span><br><span class="line"><span class="keyword">return</span> left - right</span><br><span class="line"><span class="keyword">case</span> enums.MUL:</span><br><span class="line"><span class="keyword">return</span> left * right</span><br><span class="line"><span class="keyword">case</span> enums.QUO:</span><br><span class="line"><span class="keyword">if</span> right == <span class="number">0</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"expr[%g/%g]exception, division by zero \n"</span>, left, right)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> left / right</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é™„ä¸Šå®Œæ•´ä»£ç ï¼š<a href="https://github.com/xupin/math-evaluate" target="_blank" rel="noopener">math-evaluate</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ASTï¼ˆAbstract syntax treeï¼‰æŠ½è±¡è¯­æ³•æ ‘ï¼Œç”¨äºè¡¨ç¤ºç¼–ç¨‹è¯­è¨€æºä»£ç çš„ä¸€ç§æŠ½è±¡è¯­æ³•çš„ç»“æ„ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”æºä»£ç ä¸­çš„ä¸€ä¸ªç»“æ„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;è®¡ç®—æœºå¦‚ä½•ç”ŸæˆASTç»“æ„ï¼Ÿä¸€èˆ¬æ¥è¯´é¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯æ³•åˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰«ææºä»£ç ï¼Œç”Ÿæˆæ ‡è®°ï¼ˆtokenï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;è¯­æ³•åˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è§£ætokensï¼Œæ„é€ ASTç»“æ„&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - Tire Tree</title>
    <link href="http://xupin.im/2022/12/11/data-structures-algorithms-tire/"/>
    <id>http://xupin.im/2022/12/11/data-structures-algorithms-tire/</id>
    <published>2022-12-10T16:00:00.000Z</published>
    <updated>2023-11-08T03:24:24.524Z</updated>
    
    <content type="html"><![CDATA[<p>Tireæ ‘åˆç§°å•è¯æŸ¥æ‰¾æ ‘ã€å‰ç¼€æ ‘ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘å˜ç§çš„æ ‘å½¢ç»“æ„ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå¸¸å¸¸è¢«åº”ç”¨å­—ç¬¦ç»Ÿè®¡ã€æ£€ç´¢ç­‰åœºæ™¯ï¼Œæ¯”å¦‚æœç´¢å¼•æ“çš„è¯é¢‘ç»Ÿè®¡å’Œæç¤ºç­‰</p><p><img src="/assets/tire/suggestion.jpeg" alt="drawing" width="400" height="200"></p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å‰ç¼€æ ‘çš„å­˜å‚¨åŸç†å¾ˆç®€å•ï¼Œå³åˆå¹¶å­—ç¬¦ä¸²ç›¸åŒçš„å­—ç¬¦å‰ç¼€è¿›è¡Œå­˜å‚¨ã€‚</p><p>æ¯”å¦‚ï¼Œå­˜å‚¨<code>dog</code>ã€<code>cat</code>ã€<code>doing</code>ä¸‰ä¸ªå­—ç¬¦ä¸²çš„æ ‘ç»“æ„ï¼š</p><a id="more"></a><p><img src="/assets/tire/tire.png" width="150" height="250"></p><p>éœ€è¦æ³¨æ„ï¼š<code>å‰ç¼€æ ‘ä¸æ˜¯äºŒå‰æ ‘ï¼Œè€Œæ˜¯å¤šå‰æ ‘</code>ã€‚</p><p>å‰ç¼€æ ‘çš„ç‰¹å¾ï¼š</p><ol><li>æ ¹ç»“ç‚¹ä¸å­˜å‚¨ä»»ä½•å†…å®¹ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨1ä¸ªå­—ç¬¦ã€‚</li><li>æ ¹èŠ‚ç‚¹åˆ°ä»»æ„å­èŠ‚ç‚¹æ˜¯ä¸ºå­˜å‚¨çš„å­—ç¬¦ä¸²ã€‚</li><li>å†™å…¥å’ŒæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(N)ã€‚</li></ol><h3 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h3><p>ä¸€èˆ¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å®ç°ï¼Œ</p><ol><li>å•å‘é“¾è¡¨ï¼ˆæœ¬æ–‡é‡‡ç”¨æ–¹å¼ï¼‰</li><li>äºŒç»´æ•°ç»„</li></ol><ul><li>å­˜å‚¨</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ ¹ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">type</span> Tire <span class="keyword">struct</span> &#123;</span><br><span class="line">Root *Node</span><br><span class="line">Size <span class="keyword">int</span> <span class="comment">// æ€»å…±å­˜å‚¨å¤šå°‘ä¸ªå­—ç¬¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å­˜å‚¨å­—ç¬¦çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">Char   <span class="keyword">string</span>         <span class="comment">// å½“å‰èŠ‚ç‚¹å­˜å‚¨çš„å­—ç¬¦</span></span><br><span class="line">Count  <span class="keyword">int</span>            <span class="comment">// å‡ºç°è¿‡å¤šå°‘æ¬¡</span></span><br><span class="line">IsWord <span class="keyword">bool</span>           <span class="comment">// æ˜¯å¦æ˜¯å®Œæ•´çš„å•è¯ï¼ˆå­—ç¬¦ä¸²ç»“å°¾ï¼‰</span></span><br><span class="line">Next   <span class="keyword">map</span>[<span class="keyword">rune</span>]*Node <span class="comment">// å­˜å‚¨ä¸‹ä¸€ä¸ªå­—ç¬¦çš„èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å‰ç¼€æ ‘å°±æ˜¯æŠŠå­—ç¬¦ä¸²æŒ‰å­—ç¬¦é¡ºåºå­˜å‚¨ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Tire)</span> <span class="title">Append</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> r.Find(s, <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">node := r.Root</span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> s &#123;</span><br><span class="line">v, ok := node.Next[c] <span class="comment">// æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿›è¡Œå­˜å‚¨ï¼Œåä¹‹å–ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">v = &amp;Node&#123;</span><br><span class="line">Char:   <span class="keyword">string</span>(c),</span><br><span class="line">IsWord: <span class="literal">false</span>,</span><br><span class="line">Count:  <span class="number">1</span>,</span><br><span class="line">Next:   <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">rune</span>]*Node, <span class="number">0</span>),</span><br><span class="line">&#125;</span><br><span class="line">node.Next[c] = v</span><br><span class="line">r.Size += <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">v.Count += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">node = v</span><br><span class="line">&#125;</span><br><span class="line">node.IsWord = <span class="literal">true</span> <span class="comment">// æœ€åä¸€ä¸ªå­—ç¬¦æŠŠIsWordæ ‡è®°ä¸ºtrue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥æ‰¾</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Tire)</span> <span class="title">Find</span><span class="params">(s <span class="keyword">string</span>, isFullMatch <span class="keyword">bool</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">node := r.Root</span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> s &#123;</span><br><span class="line">v, ok := node.Next[c] <span class="comment">// æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥è¿”å›falseï¼Œåä¹‹ç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">node = v</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> (!isFullMatch &amp;&amp; !node.IsWord) || node.IsWord</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤</li></ul><p>åˆ é™¤æ˜¯å‰ç¼€æ ‘ä¸­ç¨å¤æ‚ä¸€ç‚¹çš„æ“ä½œï¼Œå¦‚æœå­—ç¬¦è¢«å…¶ä»–å­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¸èƒ½ç›´æ¥åˆ é™¤ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Tire)</span> <span class="title">Remove</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> !r.Find(s, <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">node := r.Root</span><br><span class="line">prev := r.Root</span><br><span class="line"><span class="keyword">for</span> i, c := <span class="keyword">range</span> s &#123;</span><br><span class="line">node = node.Next[c]</span><br><span class="line">node.Count -= <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> node.Count == <span class="number">0</span> &#123;</span><br><span class="line">r.Size -= (<span class="built_in">len</span>(s) - i)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">prev = node</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> node.Count == <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">delete</span>(prev.Next, <span class="keyword">rune</span>(node.Char[<span class="number">0</span>]))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">node.IsWord = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>é™„ä¸Šå®Œæ•´ä»£ç ï¼š<a href="https://github.com/xupin/tire" target="_blank" rel="noopener">tire</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Tireæ ‘åˆç§°å•è¯æŸ¥æ‰¾æ ‘ã€å‰ç¼€æ ‘ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘å˜ç§çš„æ ‘å½¢ç»“æ„ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå¸¸å¸¸è¢«åº”ç”¨å­—ç¬¦ç»Ÿè®¡ã€æ£€ç´¢ç­‰åœºæ™¯ï¼Œæ¯”å¦‚æœç´¢å¼•æ“çš„è¯é¢‘ç»Ÿè®¡å’Œæç¤ºç­‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/tire/suggestion.jpeg&quot; alt=&quot;drawing&quot; width=&quot;400&quot; height=&quot;200&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;åŸç†&quot;&gt;&lt;a href=&quot;#åŸç†&quot; class=&quot;headerlink&quot; title=&quot;åŸç†&quot;&gt;&lt;/a&gt;åŸç†&lt;/h3&gt;&lt;p&gt;å‰ç¼€æ ‘çš„å­˜å‚¨åŸç†å¾ˆç®€å•ï¼Œå³åˆå¹¶å­—ç¬¦ä¸²ç›¸åŒçš„å­—ç¬¦å‰ç¼€è¿›è¡Œå­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œå­˜å‚¨&lt;code&gt;dog&lt;/code&gt;ã€&lt;code&gt;cat&lt;/code&gt;ã€&lt;code&gt;doing&lt;/code&gt;ä¸‰ä¸ªå­—ç¬¦ä¸²çš„æ ‘ç»“æ„ï¼š&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - AOI</title>
    <link href="http://xupin.im/2022/10/08/data-structures-algorithms-aoi/"/>
    <id>http://xupin.im/2022/10/08/data-structures-algorithms-aoi/</id>
    <published>2022-10-07T16:00:00.000Z</published>
    <updated>2023-11-20T09:30:42.144Z</updated>
    
    <content type="html"><![CDATA[<p>AOIï¼ˆArea Of Interestï¼‰ç¿»è¯‘è¿‡æ¥ç§°ä¸ºâ€œæ„Ÿå…´è¶£çš„åŒºåŸŸâ€ï¼Œç”¨äºè®¡ç®—ç©å®¶ä¸ç©å®¶ï¼ˆæˆ–å…¶ä»–Entityï¼‰ä¹‹é—´å½¼æ­¤è¿›å…¥ã€ç¦»å¼€ã€ç§»åŠ¨è§†é‡çš„ç®—æ³•ã€‚é€šä¿—çš„è§£é‡Šæ¯”å¦‚ï¼Œç©å®¶ç¦»å¼€æŸä¸ªåœ°å›¾æ—¶ï¼Œè®¡ç®—å‡ºéœ€è¦é€šçŸ¥çš„å…¶ä»–ç©å®¶ã€‚</p><p>AOIæ¨¡å—æ˜¯å¤šäººè”æœºæ¸¸æˆæœåŠ¡å™¨ä¸­å¾ˆé‡è¦çš„åŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼ŒAOIæ¨¡å—çš„â€œå¥½â€ä¸â€œåâ€ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>å½“ä¸€ä¸ªç©å®¶è¿›å…¥åœºæ™¯åï¼Œé¦–å…ˆè¦è®¡ç®—å‡ºåœºæ™¯ä¸­çš„å…¶ä»–æ‰€æœ‰ç©å®¶å¹¶æ”¾è¿›å¯¹è±¡é›†åˆï¼ˆåˆç§°è§‚å¯Ÿè€…é›†åˆï¼‰ï¼Œä¹‹åè¯¥ç©å®¶çš„è¿›å…¥ã€ç§»åŠ¨ã€ç¦»å¼€æˆ–å…¶ä»–è¡Œä¸ºéƒ½å°†ä¼šä¸€ä¸€é€šçŸ¥è¯¥é›†åˆå†…çš„ç©å®¶ï¼Œå¹¶ä¸”æ¯ä¸ªç©å®¶éƒ½éœ€è¦ç»´æŠ¤è¿™æ ·ä¸€ä¸ªå¯¹è±¡é›†åˆã€‚</p><blockquote><p>Watchers è§‚å¯Ÿè€…é›†åˆï¼Œå³èƒ½å¤Ÿçœ‹åˆ°æˆ‘çš„å…¶ä»–ç©å®¶æˆ–å®ä½“ã€‚</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>è¯¥å¯¹è±¡é›†åˆå†…çš„ç©å®¶åˆ—è¡¨ä¼šéšç€ç©å®¶çš„è¡Œä¸ºå‘ç”Ÿå˜åŒ–ï¼Œåœ¨ç©å®¶ç¦»å¼€åœºæ™¯åæ¸…ç©ºå¯¹è±¡é›†åˆ</code>ã€‚</p><a id="more"></a><h3 id="å…¨åœºæ™¯åŒæ­¥"><a href="#å…¨åœºæ™¯åŒæ­¥" class="headerlink" title="å…¨åœºæ™¯åŒæ­¥"></a>å…¨åœºæ™¯åŒæ­¥</h3><p>å³æ¯ä¸ªç©å®¶éƒ½èƒ½çœ‹åˆ°è¿›å…¥è¯¥åœºæ™¯çš„æ‰€æœ‰ç©å®¶ï¼Œé‚£ä¹ˆæ‰€æœ‰è¿›å…¥è¯¥åœºæ™¯çš„ç©å®¶å‘ç”Ÿè¡Œä¸ºï¼ŒAOIåœºæ™¯ç®¡ç†å™¨éƒ½ä¼šé€šçŸ¥å…¶ä»–ç©å®¶ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»åœ°å›¾0,0ç§»åŠ¨è‡³åœ°å›¾10,10è¿™æ ·çš„è¡Œä¸ºã€‚</p><ul><li><p>è¿›å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç©å®¶[pp]è¿›å…¥åœ°å›¾ 0,0 </span><br><span class="line">ç©å®¶[wl]è¿›å…¥åœ°å›¾ 2,20</span><br><span class="line">       é€šçŸ¥ç©å®¶[pp]è¿›å…¥è§†é‡</span><br><span class="line">ç©å®¶[sd]è¿›å…¥åœ°å›¾ 0,4 </span><br><span class="line">       é€šçŸ¥ç©å®¶[pp]è¿›å…¥è§†é‡</span><br><span class="line">       é€šçŸ¥ç©å®¶[wl]è¿›å…¥è§†é‡</span><br></pre></td></tr></table></figure></li><li><p>ç§»åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç©å®¶[sd]è¿›è¡Œç§»åŠ¨ 0,4 -&gt; 0,5</span><br><span class="line">       é€šçŸ¥ç©å®¶[pp]è¿›è¡Œç§»åŠ¨</span><br><span class="line">       é€šçŸ¥ç©å®¶[wl]è¿›è¡Œç§»åŠ¨</span><br></pre></td></tr></table></figure></li><li><p>ç¦»å¼€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç©å®¶[sd]ç¦»å¼€åœ°å›¾</span><br><span class="line">       é€šçŸ¥ç©å®¶[pp]ç¦»å¼€åœ°å›¾</span><br><span class="line">       é€šçŸ¥ç©å®¶[wl]ç¦»å¼€åœ°å›¾</span><br></pre></td></tr></table></figure></li></ul><p>ä½†å¦‚æœåœ°å›¾åœºæ™¯å¤§ã€ç©å®¶æ•°é‡å¤šçš„åœºæ™¯ä¸‹é—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥ï¼ŒæœåŠ¡å™¨é€šä¿¡é‡å°†ä¼šååˆ†å·¨å¤§ï¼ˆç©å®¶ä¸ç©å®¶ä¹‹é—´ï¼‰ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€æ¬¾å«ã€Šç»åœ°æ±‚ç”Ÿã€‹çš„æ¸¸æˆä¸­æœ€å¤§çš„åœ°å›¾æ˜¯8km*8kmï¼Œå‡å¦‚ä¸¤ä¸ªç©å®¶ç›¸è·6kmï¼Œè¿™ä¸¤ä¸ªç©å®¶å½¼æ­¤ä¹‹é—´è¿˜éœ€è¦é€šä¿¡å—ï¼Ÿ</p><h3 id="é™åˆ¶ç©å®¶è§†é‡"><a href="#é™åˆ¶ç©å®¶è§†é‡" class="headerlink" title="é™åˆ¶ç©å®¶è§†é‡"></a>é™åˆ¶ç©å®¶è§†é‡</h3><p>ä¸ºäº†æé«˜æœåŠ¡å™¨è¿è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥éœ€è¦å¯¹ç©å®¶çš„å¯è§†èŒƒå›´ï¼ˆè§†é‡ï¼‰è¿›è¡Œä¸€å®šé™åˆ¶ï¼Œä»è€Œå‡å°‘é€šä¿¡é‡ã€‚å³æ¯ä¸ªç©å®¶éƒ½åªèƒ½çœ‹åˆ°è§†é‡å†…çš„å…¶ä»–ç©å®¶ï¼Œå½“å‘ç”Ÿè¡Œä¸ºæ—¶ä¹Ÿåªä¼šåŒæ­¥ä¿¡æ¯ç»™è¿™äº›ç©å®¶ã€‚</p><p>æ¯”å¦‚ï¼Œå½“æ¯ä¸ªç©å®¶éƒ½åªæœ‰5è§†é‡å•ä½æ—¶ï¼š</p><ul><li><p>è¿›å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç©å®¶[pp]è¿›å…¥åœ°å›¾ 0,0 </span><br><span class="line">ç©å®¶[wl]è¿›å…¥åœ°å›¾ 2,20</span><br><span class="line">ç©å®¶[sd]è¿›å…¥åœ°å›¾ 0,4</span><br><span class="line">       é€šçŸ¥ç©å®¶[pp]è¿›å…¥è§†é‡</span><br></pre></td></tr></table></figure></li><li><p>ç§»åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç©å®¶[sd]è¿›è¡Œç§»åŠ¨ 0,4 -&gt; 1,20</span><br><span class="line">       é€šçŸ¥ç©å®¶[pp]ç¦»å¼€è§†é‡</span><br><span class="line">       é€šçŸ¥ç©å®¶[wl]è¿›å…¥è§†é‡</span><br></pre></td></tr></table></figure></li><li><p>ç¦»å¼€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç©å®¶[sd]ç¦»å¼€åœ°å›¾</span><br><span class="line">       é€šçŸ¥ç©å®¶[wl]ç¦»å¼€åœ°å›¾</span><br></pre></td></tr></table></figure></li></ul><p>å¯¹ç©å®¶è¿›è¡Œäº†è§†é‡é™åˆ¶åï¼Œæ¶ˆæ¯é‡ä¼šå¤§å¹…ä¸‹é™ã€‚ä½†å› ä¸ºä¼šå¯¹åœºæ™¯å†…æ‰€æœ‰ç©å®¶è¿›è¡Œæš´åŠ›æŸ¥æ‰¾ï¼Œæ‰€ä»¥æ£€ç´¢æ•ˆç‡å¹¶ä¸é«˜ã€‚</p><h3 id="ä¹å®«æ ¼"><a href="#ä¹å®«æ ¼" class="headerlink" title="ä¹å®«æ ¼"></a>ä¹å®«æ ¼</h3><p>æŠŠåœ°å›¾ç½‘æ ¼åŒ–åï¼Œé™åˆ¶ç©å®¶çš„è§†é‡èŒƒå›´ä¸º9ä¸ªæ ¼å­ã€‚å¦‚å›¾ï¼š</p><p><img src="/assets/aoi/grid9.png" alt="drawing" width="160" height="160"></p><p>ä¸€èˆ¬è®¾è®¡æ˜¯ç©å®¶çš„æ‰‹æœºå±å¹•æ˜¾ç¤ºä¸º4/9æ ¼å­ï¼Œä½†çœŸå®è§†é‡ä¸º1 ï½ 9ç½‘æ ¼ï¼Œæ‰€ä»¥æœåŠ¡å™¨åªéœ€è¦åŒæ­¥æ¶ˆæ¯ç»™ç©å®¶å¯è§†èŒƒå›´å†…çš„9ä¸ªç½‘æ ¼å…¶ä»–ç©å®¶ã€‚</p><ul><li>è¿›å…¥</li></ul><blockquote><p>æ ¹æ®ç©å®¶åæ ‡è®¡ç®—æ ¼å­ï¼ŒæŠŠç©å®¶åŠ å…¥åˆ°æ ¼å­ã€‚é€šçŸ¥ä¹å®«æ ¼å†…çš„ç©å®¶ï¼Œæœ‰ç©å®¶è¿›å…¥åœºæ™¯ã€‚</p></blockquote><ul><li>ç§»åŠ¨</li></ul><blockquote><p>æ ¼å­æ— å˜åŒ–ï¼Œä»…é€šçŸ¥ç§»åŠ¨è¡Œä¸ºç»™ä¹å®«æ ¼å†…çš„ç©å®¶ã€‚<br>æ ¼å­æœ‰å˜åŒ–ï¼Œå¯¹æ ¼å­è¿›è¡Œäº¤é›†ã€å¹¶é›†è¿ç®—ã€‚å¹¶é›†ï¼Œç¦»å¼€æ ¼å­å¹¶é€šçŸ¥æ ¼å­å†…ç©å®¶ç¦»å¼€è¡Œä¸ºï¼ŒåŠ å…¥æ–°æ ¼å­å¹¶é€šçŸ¥æ ¼å­å†…ç©å®¶è¿›å…¥è¡Œä¸ºã€‚äº¤é›†ï¼Œä»…é€šçŸ¥ç§»åŠ¨è¡Œä¸ºã€‚</p></blockquote><ul><li>ç¦»å¼€</li></ul><blockquote><p>æ ¹æ®ç©å®¶åæ ‡è®¡ç®—æ ¼å­ï¼ŒæŠŠç©å®¶ä»æ ¼å­ç§»é™¤ã€‚é€šçŸ¥ä¹å®«æ ¼å†…çš„ç©å®¶ï¼Œæœ‰ç©å®¶ç¦»å¼€åœºæ™¯ã€‚</p></blockquote><h3 id="ç¯å¡”"><a href="#ç¯å¡”" class="headerlink" title="ç¯å¡”"></a>ç¯å¡”</h3><p>ç¯å¡”æ˜¯åœ¨ä¹å®«æ ¼çš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œåœ¨æŠŠåœ°å›¾ç½‘æ ¼åŒ–çš„åŸºç¡€ä¸Šåˆ’åˆ†åŒºåŸŸï¼ˆæ¯”å¦‚4ä¸ªç½‘æ ¼ç»„æˆä¸€ä¸ªåŒºåŸŸï¼‰ï¼Œæ¯ä¸ªåŒºåŸŸæœ‰ä¸€ä¸ªç®¡ç†è€…ï¼šç¯å¡”ï¼Œè¿™ä¸ªç®¡ç†è€…çŸ¥æ™“å½“å‰åŒºåŸŸçš„å…¨éƒ¨ç©å®¶ã€‚å¦‚å›¾ï¼š</p><p><img src="/assets/aoi/tower.png" alt="drawing" width="240" height="240"></p><p>æ¯ä¸ªç¯å¡”ç»´æŠ¤ä¸¤ä¸ªå¯¹è±¡é›†åˆï¼šWatchersï¼ˆè§‚å¯Ÿè€…é›†åˆï¼‰ã€Markersï¼ˆè¢«è§‚å¯Ÿè€…é›†åˆï¼‰ã€‚</p><ul><li>è¿›å…¥</li></ul><blockquote><p>æ ¹æ®ç©å®¶åæ ‡è®¡ç®—å‡ºç¯å¡”ï¼ŒæŠŠç©å®¶åŠ å…¥åˆ°ç¯å¡”çš„Markersã€‚é€šçŸ¥è¯¥ç¯å¡”æ‰€æœ‰Watchersï¼Œæœ‰ç©å®¶è¿›å…¥åœºæ™¯ã€‚æ‰¾å‡ºè¯¥ç©å®¶è§†é‡å†…æ‰€æœ‰ç¯å¡”ï¼ŒæŠŠç©å®¶åŠ å…¥åˆ°ç¯å¡”çš„Watchersï¼ŒåŒæ—¶æŠŠè¿™äº›Watcherså’Œç©å®¶äº’ç›¸åŠ è¿›å¯¹æ–¹çš„è§†é‡åˆ—è¡¨ã€‚</p></blockquote><ul><li>ç§»åŠ¨</li></ul><blockquote><p>ç¯å¡”æ— å˜åŒ–ï¼Œä»…é€šçŸ¥ç§»åŠ¨è¡Œä¸ºç»™ç©å®¶è§†é‡åˆ—è¡¨å†…çš„ç©å®¶ã€‚<br>ç¯å¡”æœ‰å˜åŒ–ï¼Œå¯¹ç¯å¡”åˆ—è¡¨è¿›è¡Œäº¤é›†ã€å¹¶é›†è¿ç®—ã€‚å¹¶é›†ï¼Œä»ç¦»å¼€ç¯å¡”çš„Watchersã€Markersç§»é™¤è¯¥ç©å®¶ï¼Œæ–°è¿›å…¥ç¯å¡”çš„Watchersã€Markersæ·»åŠ è¯¥ç©å®¶ã€‚ äº¤é›†ï¼Œä»…é€šçŸ¥ç§»åŠ¨è¡Œä¸ºã€‚<br>å¯¹ç§»åŠ¨å‰åç¯å¡”çš„Watchersè¿›è¡Œå¹¶é›†è¿ç®—ã€‚ä»ç¦»å¼€çš„Watchersäº’ç›¸ä»å¯¹æ–¹çš„è§†é‡åˆ—è¡¨å†…ç§»é™¤ï¼Œæ–°è¿›å…¥çš„Watchersäº’ç›¸åŠ è¿›å¯¹æ–¹çš„è§†é‡åˆ—è¡¨ã€‚</p></blockquote><ul><li>ç¦»å¼€</li></ul><blockquote><p>æ ¹æ®ç©å®¶åæ ‡è®¡ç®—å‡ºç¯å¡”ï¼ŒæŠŠç©å®¶ä»è¯¥ç¯å¡”çš„Markersä¸­ç§»é™¤ã€‚é€šçŸ¥è¯¥ç¯å¡”æ‰€æœ‰Watchersï¼Œæœ‰ç©å®¶ç¦»å¼€åœºæ™¯ã€‚<br>æ‰¾å‡ºè¯¥ç©å®¶è§†é‡å†…æ‰€æœ‰ç¯å¡”ï¼ŒæŠŠç©å®¶ä»è¿™äº›ç¯å¡”çš„Watchersä¸­ç§»é™¤ï¼ŒåŒæ—¶æŠŠè¯¥ç©å®¶å’Œè§†é‡åˆ—è¡¨å†…çš„æ‰€æœ‰ç©å®¶äº’ç›¸æŠŠå¯¹æ–¹ä»è§†é‡åˆ—è¡¨å†…ç§»é™¤ã€‚</p></blockquote><p>ä¸€èˆ¬è®¾è®¡ä¸Šç¯å¡”åæ ‡æ˜¯éœ€è¦è½¬æ¢çš„ï¼Œç±»ä¼¼äºRedis Clusterçš„slotæœºåˆ¶ï¼Œé€šè¿‡è½¬æ¢ç©å®¶åæ ‡æ¥åˆ¤æ–­ç¯å¡”å½’å±ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Aoi)</span> <span class="title">transPos</span><span class="params">(x, y <span class="keyword">uint</span>)</span> <span class="params">(<span class="keyword">uint</span>, <span class="keyword">uint</span>)</span></span> &#123;</span><br><span class="line">    x = <span class="keyword">uint</span>(math.Floor(<span class="keyword">float64</span>(x) / <span class="keyword">float64</span>(r.TowerWidth)))</span><br><span class="line">    y = <span class="keyword">uint</span>(math.Floor(<span class="keyword">float64</span>(y) / <span class="keyword">float64</span>(r.TowerHeight)))</span><br><span class="line">    <span class="keyword">return</span> x, y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Aoi)</span> <span class="title">getTower</span><span class="params">(x, y <span class="keyword">uint</span>)</span> *<span class="title">Tower</span></span> &#123;</span><br><span class="line">    x, y = r.transPos(x, y)</span><br><span class="line">    tower, ok := r.Towers[x][y]</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        fmt.Printf(<span class="string">"ç¯å¡”[å¼‚å¸¸]ä¸å­˜åœ¨çš„ç¯å¡”: %d,%d \n"</span>, x, y)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tower</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åå­—é“¾è¡¨"><a href="#åå­—é“¾è¡¨" class="headerlink" title="åå­—é“¾è¡¨"></a>åå­—é“¾è¡¨</h3><p>æŠŠXã€Yè½´åˆ†åˆ«ä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨ï¼Œå°†ç©å®¶çš„åæ ‡åˆ†åˆ«å†™å…¥Xã€Yé“¾è¡¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<code>ä¸¤ä¸ªé“¾è¡¨çš„æ’åºæ–¹å¼å¿…é¡»ä¸€è‡´ï¼Œæ¯”å¦‚éƒ½æŒ‰ç…§Xã€Yä»å°åˆ°å¤§</code>ã€‚å½“ç©å®¶è¿›å…¥åœºæ™¯åæ ¹æ®å½“å‰åæ ‡åˆ†åˆ«å–å‡ºXã€Yé“¾è¡¨è§†è·å†…çš„ç©å®¶åˆ—è¡¨å–äº¤é›†ï¼Œè¿™å°±æ˜¯å½“å‰ç©å®¶è§†é‡èŒƒå›´å†…çš„å…¶ä»–ç©å®¶ä»¬ã€‚è‡³äºæ˜¯è¿›å…¥ã€ç§»åŠ¨è¿˜æ˜¯ç¦»å¼€è¿™äº›é€»è¾‘éƒ½å’Œä¹å®«æ ¼ã€ç¯å¡”å…¶å®æ˜¯ä¸€æ ·çš„ã€‚</p><p>å®šä¹‰2ä¸ªé“¾è¡¨<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Aoi <span class="keyword">struct</span> &#123;</span><br><span class="line">    list         <span class="keyword">map</span>[<span class="keyword">uint32</span>]*node</span><br><span class="line">    xList        *node</span><br><span class="line">    yList        *node</span><br><span class="line">    VisibleRange <span class="keyword">uint</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id     <span class="keyword">uint32</span></span><br><span class="line">    xPrev  *node</span><br><span class="line">    xNext  *node</span><br><span class="line">    yPrev  *node</span><br><span class="line">    yNext  *node</span><br><span class="line">    x, y   <span class="keyword">uint</span></span><br><span class="line">    player *entity.Player</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æŸ¥æ‰¾é‚»å±…èŠ‚ç‚¹<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Aoi)</span> <span class="title">findNeighbors</span><span class="params">(targetNode *node, model <span class="keyword">string</span>)</span> <span class="title">map</span>[<span class="title">uint32</span>]*<span class="title">node</span></span> &#123;</span><br><span class="line">    <span class="comment">// æ„Ÿå…´è¶£çš„é‚»å±…</span></span><br><span class="line">    neighbors := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">uint32</span>]*node, <span class="number">0</span>)</span><br><span class="line">    <span class="comment">// å‘åæ‰¾</span></span><br><span class="line">    <span class="keyword">for</span> cur := targetNode.xNext; cur != <span class="literal">nil</span>; cur = cur.xNext &#123;</span><br><span class="line">        <span class="comment">// å½“å‰èŠ‚ç‚¹å·²ç»è¶…å‡ºèŒƒå›´</span></span><br><span class="line">        <span class="keyword">if</span> cur.x-targetNode.x &gt; r.VisibleRange &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// yè½´ä¸ç¬¦åˆ</span></span><br><span class="line">        <span class="keyword">if</span> abs(<span class="keyword">int</span>(cur.y-targetNode.y)) &gt; <span class="keyword">int</span>(r.VisibleRange) &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        neighbors[cur.Id] = cur</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‘å‰æ‰¾</span></span><br><span class="line">    <span class="keyword">for</span> cur := targetNode.xPrev; cur != <span class="literal">nil</span>; cur = cur.xPrev &#123;</span><br><span class="line">        <span class="comment">// å½“å‰èŠ‚ç‚¹å·²ç»è¶…å‡ºèŒƒå›´</span></span><br><span class="line">        <span class="keyword">if</span> targetNode.x-cur.x &gt; r.VisibleRange &#123;</span><br><span class="line">            fmt.Println(targetNode.x, cur.x)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// yè½´ä¸ç¬¦åˆ</span></span><br><span class="line">        <span class="keyword">if</span> abs(<span class="keyword">int</span>(targetNode.y-cur.y)) &gt; <span class="keyword">int</span>(r.VisibleRange) &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å·²å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> _, ok := neighbors[cur.Id]; ok &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        neighbors[cur.Id] = cur</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> neighbors</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿›å…¥ã€ç§»åŠ¨åŠç¦»å¼€åœ°å›¾ä¸å…¶ä»–æ–¹å¼ä¸€æ ·<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Aoi)</span> <span class="title">addX</span><span class="params">(newNode *node)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        prev *node</span><br><span class="line">        cur  *node</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">for</span> cur = r.xList; cur != <span class="literal">nil</span>; cur = cur.xNext &#123;</span><br><span class="line">        <span class="comment">// æ’å…¥curä¹‹å‰</span></span><br><span class="line">        <span class="keyword">if</span> cur.x &gt; newNode.x &#123;</span><br><span class="line">            <span class="comment">// æ ¹èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> cur.xPrev == <span class="literal">nil</span> &#123;</span><br><span class="line">                r.xList = newNode</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newNode.xPrev = cur.xPrev <span class="comment">// å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ä½œä¸ºæ–°èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">                cur.xPrev.xNext = newNode <span class="comment">// æ–°èŠ‚ç‚¹æˆä¸ºå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">            &#125;</span><br><span class="line">            cur.xPrev = newNode <span class="comment">// æ–°èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">            newNode.xNext = cur <span class="comment">// å½“å‰èŠ‚ç‚¹ä½œä¸ºæ–°èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        prev = cur</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ’å…¥å°¾éƒ¨</span></span><br><span class="line">    <span class="keyword">if</span> prev != <span class="literal">nil</span> &amp;&amp; cur == <span class="literal">nil</span> &#123;</span><br><span class="line">        prev.xNext = newNode</span><br><span class="line">        newNode.xPrev = prev</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Aoi)</span> <span class="title">addY</span><span class="params">(newNode *node)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        prev *node</span><br><span class="line">        cur  *node</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">for</span> cur = r.yList; cur != <span class="literal">nil</span>; cur = cur.yNext &#123;</span><br><span class="line">        <span class="comment">// æ’å…¥curä¹‹å‰</span></span><br><span class="line">        <span class="keyword">if</span> cur.y &gt; newNode.y &#123;</span><br><span class="line">            <span class="comment">// æ ¹èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> cur.yPrev == <span class="literal">nil</span> &#123;</span><br><span class="line">                r.yList = newNode</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newNode.yPrev = cur.yPrev <span class="comment">// å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ä½œä¸ºæ–°èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">                cur.yPrev.yNext = newNode <span class="comment">// æ–°èŠ‚ç‚¹æˆä¸ºå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">            &#125;</span><br><span class="line">            cur.yPrev = newNode <span class="comment">// æ–°èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">            newNode.yNext = cur <span class="comment">// å½“å‰èŠ‚ç‚¹ä½œä¸ºæ–°èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        prev = cur</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ’å…¥å°¾éƒ¨</span></span><br><span class="line">    <span class="keyword">if</span> prev != <span class="literal">nil</span> &amp;&amp; cur == <span class="literal">nil</span> &#123;</span><br><span class="line">        prev.yNext = newNode</span><br><span class="line">        newNode.yPrev = prev</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>é™„ä¸Šç¤ºä¾‹ï¼š</p><p><a href="https://github.com/xupin/aoi" target="_blank" rel="noopener">aoi</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;AOIï¼ˆArea Of Interestï¼‰ç¿»è¯‘è¿‡æ¥ç§°ä¸ºâ€œæ„Ÿå…´è¶£çš„åŒºåŸŸâ€ï¼Œç”¨äºè®¡ç®—ç©å®¶ä¸ç©å®¶ï¼ˆæˆ–å…¶ä»–Entityï¼‰ä¹‹é—´å½¼æ­¤è¿›å…¥ã€ç¦»å¼€ã€ç§»åŠ¨è§†é‡çš„ç®—æ³•ã€‚é€šä¿—çš„è§£é‡Šæ¯”å¦‚ï¼Œç©å®¶ç¦»å¼€æŸä¸ªåœ°å›¾æ—¶ï¼Œè®¡ç®—å‡ºéœ€è¦é€šçŸ¥çš„å…¶ä»–ç©å®¶ã€‚&lt;/p&gt;
&lt;p&gt;AOIæ¨¡å—æ˜¯å¤šäººè”æœºæ¸¸æˆæœåŠ¡å™¨ä¸­å¾ˆé‡è¦çš„åŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼ŒAOIæ¨¡å—çš„â€œå¥½â€ä¸â€œåâ€ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“æœåŠ¡å™¨çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ€è·¯&quot;&gt;&lt;a href=&quot;#æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;æ€è·¯&quot;&gt;&lt;/a&gt;æ€è·¯&lt;/h3&gt;&lt;p&gt;å½“ä¸€ä¸ªç©å®¶è¿›å…¥åœºæ™¯åï¼Œé¦–å…ˆè¦è®¡ç®—å‡ºåœºæ™¯ä¸­çš„å…¶ä»–æ‰€æœ‰ç©å®¶å¹¶æ”¾è¿›å¯¹è±¡é›†åˆï¼ˆåˆç§°è§‚å¯Ÿè€…é›†åˆï¼‰ï¼Œä¹‹åè¯¥ç©å®¶çš„è¿›å…¥ã€ç§»åŠ¨ã€ç¦»å¼€æˆ–å…¶ä»–è¡Œä¸ºéƒ½å°†ä¼šä¸€ä¸€é€šçŸ¥è¯¥é›†åˆå†…çš„ç©å®¶ï¼Œå¹¶ä¸”æ¯ä¸ªç©å®¶éƒ½éœ€è¦ç»´æŠ¤è¿™æ ·ä¸€ä¸ªå¯¹è±¡é›†åˆã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Watchers è§‚å¯Ÿè€…é›†åˆï¼Œå³èƒ½å¤Ÿçœ‹åˆ°æˆ‘çš„å…¶ä»–ç©å®¶æˆ–å®ä½“ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;è¯¥å¯¹è±¡é›†åˆå†…çš„ç©å®¶åˆ—è¡¨ä¼šéšç€ç©å®¶çš„è¡Œä¸ºå‘ç”Ÿå˜åŒ–ï¼Œåœ¨ç©å®¶ç¦»å¼€åœºæ™¯åæ¸…ç©ºå¯¹è±¡é›†åˆ&lt;/code&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - BitMap</title>
    <link href="http://xupin.im/2022/08/24/data-structures-algorithms-bitmap/"/>
    <id>http://xupin.im/2022/08/24/data-structures-algorithms-bitmap/</id>
    <published>2022-08-23T16:00:00.000Z</published>
    <updated>2023-11-07T14:54:44.705Z</updated>
    
    <content type="html"><![CDATA[<p>BitMapï¼ˆä½å›¾ï¼‰æ˜¯ä¸€ç§ä»¥bitæ–¹å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œä»¥æ­¤æ¥æé«˜ç©ºé—´åˆ©ç”¨ç‡ã€‚</p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>BitMapï¼Œé€šè¿‡å­—é¢æ„æ€ç†è§£åˆ©ç”¨bitæ˜ å°„æ•°æ®çš„å­˜å‚¨ç»“æ„ã€‚æ‰€ä»¥å®ƒåº”è¯¥æœ‰Keyã€Valueï¼ŒKeyæ˜¯bitã€Valueæ˜¯è¦å­˜å‚¨çš„å…·ä½“çš„å€¼ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡bitæ¥è®°å½•æ•°æ®æ˜¯å¦å­˜å‚¨ï¼š0ä¸å­˜åœ¨ã€1å­˜åœ¨ã€‚</p><p>å®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º8çš„bitæ•°ç»„ï¼Œä»0 ï½ 7åˆ†åˆ«æ˜ å°„å¯¹åº”çš„æ•´å‹æ•°å€¼ã€‚<br><img src="/assets/bitmap/byte.png" alt="drawing" width="400" height="80"></p><p>å½“æ•´æ•°4å­˜å‚¨æ—¶ï¼Œåˆ™æ”¹å˜å¯¹åº”bitçš„çŠ¶æ€ï¼ˆå€¼ï¼‰ã€‚<br><img src="/assets/bitmap/byte-4.png" alt="drawing" width="400" height="80"></p><p>è¿™æ ·åšå¸¦æ¥çš„å¥½å¤„ï¼ŒåŒæ ·ä¸€ä¸ªæ•´æ•°åœ¨æ•°ç»„ä¸­å­˜å‚¨éœ€è¦4byte*8bit=32bitç©ºé—´ï¼Œåœ¨BitMapä¸­åªéœ€è¦1bitç©ºé—´ã€‚</p><a id="more"></a><h3 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h3><p>å®šä¹‰ä¸€ä¸ªå¯ä»¥å­˜å‚¨0 ï½ 32çš„BitMap<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bits := <span class="built_in">make</span>([]<span class="keyword">byte</span>, (<span class="number">32</span>&gt;&gt;<span class="number">3</span>)+<span class="number">1</span>) <span class="comment">// 32 &gt;&gt; 3 ç­‰ä»·äº floor(32 / 8)</span></span><br><span class="line"><span class="comment">// fmt.Printf("%08b\n", bits)</span></span><br><span class="line"><span class="comment">// [00000000 00000000 00000000 00000000 00000000]</span></span><br></pre></td></tr></table></figure></p><p>æŠŠ31å­˜å‚¨è¿›BitMapï¼Œåˆ©ç”¨æŒ‰ä½æˆ–æ“ä½œæ”¹å˜bitå€¼<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bits[<span class="number">31</span>&gt;&gt;<span class="number">3</span>] |= <span class="number">1</span> &lt;&lt; (<span class="number">31</span> % <span class="number">8</span>) </span><br><span class="line"><span class="comment">// æ‹†è§£é€»è¾‘</span></span><br><span class="line"><span class="comment">// bits[3] = 00000000 | 10000000</span></span><br></pre></td></tr></table></figure></p><p>é‡è§æ•°æ®å»é‡ï¼Œåˆ¤æ–­31æ˜¯ä¸æ˜¯å·²å­˜åœ¨<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bits[<span class="number">31</span>&gt;&gt;<span class="number">3</span>]&amp;<span class="number">1</span>&lt;&lt;(<span class="number">31</span>%<span class="number">8</span>) == <span class="number">0</span> </span><br><span class="line"><span class="comment">// æ‹†è§£é€»è¾‘</span></span><br><span class="line"><span class="comment">// 10000000 &amp; 10000000</span></span><br></pre></td></tr></table></figure></p><p>ä»BitMapåˆ é™¤æŒ‡å®šæ•°æ®<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bits[<span class="number">31</span>&gt;&gt;<span class="number">3</span>] &amp;^= <span class="number">1</span> &lt;&lt; (<span class="number">31</span> % <span class="number">8</span>) </span><br><span class="line"><span class="comment">// æ‹†è§£é€»è¾‘</span></span><br><span class="line"><span class="comment">// 10000000 &amp; 10000000 = 10000000</span></span><br><span class="line"><span class="comment">// 10000000 ^ 10000000 = 00000000</span></span><br></pre></td></tr></table></figure></p><p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/xupin/bitmap" target="_blank" rel="noopener">bitmap</a></p><h3 id="ä½æ“ä½œ"><a href="#ä½æ“ä½œ" class="headerlink" title="ä½æ“ä½œ"></a>ä½æ“ä½œ</h3><p>BitMapé€šè¿‡ä½æ“ä½œå»å®ç°ï¼Œæ‰€ä»¥æ¸©ä¹ ä»¥ä¸‹æ“ä½œç¬¦ï¼š</p><ul><li><p>æŒ‰ä½ä¸ï¼š&amp;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ“ä½œç¬¦å·¦å³ä¸¤ä¾§æ•°å€¼çš„bitè¿›è¡Œå¯¹åº” &amp;&amp; è¿ç®—</span></span><br><span class="line"><span class="number">4</span> &amp; <span class="number">5</span> = <span class="number">4</span></span><br><span class="line"><span class="number">00000100</span> &amp; <span class="number">00000101</span> = <span class="number">00000100</span></span><br></pre></td></tr></table></figure></li><li><p>æŒ‰ä½æˆ–ï¼š|</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ“ä½œç¬¦å·¦å³ä¸¤ä¾§æ•°å€¼çš„bitè¿›è¡Œå¯¹åº” || è¿ç®—</span></span><br><span class="line"><span class="number">4</span> | <span class="number">5</span> = <span class="number">5</span></span><br><span class="line"><span class="number">00000100</span> | <span class="number">00000101</span> = <span class="number">00000101</span></span><br></pre></td></tr></table></figure></li><li><p>æŒ‰ä½å¼‚æˆ–ï¼š^</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ“ä½œç¬¦å·¦å³ä¸¤ä¾§æ•°å€¼çš„bitè¿›è¡Œé€»è¾‘é¢„ç®—ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š1 ^ 1 = 0ã€1 ^ 0 = 1ã€0 ^ 1 = 1ã€0 ^ 0 = 0</span></span><br><span class="line"><span class="number">4</span> ^ <span class="number">5</span> = <span class="number">1</span></span><br><span class="line"><span class="number">00000100</span> ^ <span class="number">00000101</span> = <span class="number">00000001</span></span><br></pre></td></tr></table></figure></li><li><p>æŒ‰ä½å–åï¼š^</p></li></ul><p><code>å…¶ä»–è¯­è¨€ä¸€èˆ¬æ˜¯ ~ï¼ŒGoè¯­è¨€æ˜¯ ^</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ“ä½œç¬¦å³ä¾§æ•°å€¼çš„bitè¿›è¡Œå–åï¼Œ0 -&gt; 1ã€1 -&gt; 0</span></span><br><span class="line">^<span class="number">4</span> = <span class="number">-5</span></span><br><span class="line">-(<span class="number">00000100</span> + <span class="number">00000001</span>) = <span class="number">-0000101</span> = <span class="number">10000101</span></span><br></pre></td></tr></table></figure><ul><li><p>å·¦ç§»ï¼š&lt;&lt;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ“ä½œç¬¦å·¦ä¾§æ•°å€¼çš„bitæŒ‰ç…§å³ä¾§æ•°å€¼è¿›è¡Œå·¦ç§»ï¼ˆæº¢å‡ºä½åˆ™èˆå¼ƒï¼‰</span></span><br><span class="line"><span class="number">4</span> &lt;&lt; <span class="number">5</span> = <span class="number">128</span></span><br><span class="line">[<span class="number">00000</span>]<span class="number">100</span> &lt;&lt; <span class="number">5</span> = <span class="number">100</span>[<span class="number">00000</span>] <span class="comment">// å·¦ä¾§èˆå¼ƒçš„ä½åœ¨å³ä¾§è¿›è¡Œè¡¥ä½</span></span><br></pre></td></tr></table></figure></li><li><p>å³ç§»ï¼š&gt;&gt;<br>å’Œå·¦ç§»åŒç†ï¼Œåªä¸è¿‡æ–¹å‘ç›¸å</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;BitMapï¼ˆä½å›¾ï¼‰æ˜¯ä¸€ç§ä»¥bitæ–¹å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œä»¥æ­¤æ¥æé«˜ç©ºé—´åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å®šä¹‰&quot;&gt;&lt;a href=&quot;#å®šä¹‰&quot; class=&quot;headerlink&quot; title=&quot;å®šä¹‰&quot;&gt;&lt;/a&gt;å®šä¹‰&lt;/h3&gt;&lt;p&gt;BitMapï¼Œé€šè¿‡å­—é¢æ„æ€ç†è§£åˆ©ç”¨bitæ˜ å°„æ•°æ®çš„å­˜å‚¨ç»“æ„ã€‚æ‰€ä»¥å®ƒåº”è¯¥æœ‰Keyã€Valueï¼ŒKeyæ˜¯bitã€Valueæ˜¯è¦å­˜å‚¨çš„å…·ä½“çš„å€¼ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡bitæ¥è®°å½•æ•°æ®æ˜¯å¦å­˜å‚¨ï¼š0ä¸å­˜åœ¨ã€1å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;å®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º8çš„bitæ•°ç»„ï¼Œä»0 ï½ 7åˆ†åˆ«æ˜ å°„å¯¹åº”çš„æ•´å‹æ•°å€¼ã€‚&lt;br&gt;&lt;img src=&quot;/assets/bitmap/byte.png&quot; alt=&quot;drawing&quot; width=&quot;400&quot; height=&quot;80&quot;&gt;&lt;/p&gt;
&lt;p&gt;å½“æ•´æ•°4å­˜å‚¨æ—¶ï¼Œåˆ™æ”¹å˜å¯¹åº”bitçš„çŠ¶æ€ï¼ˆå€¼ï¼‰ã€‚&lt;br&gt;&lt;img src=&quot;/assets/bitmap/byte-4.png&quot; alt=&quot;drawing&quot; width=&quot;400&quot; height=&quot;80&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·åšå¸¦æ¥çš„å¥½å¤„ï¼ŒåŒæ ·ä¸€ä¸ªæ•´æ•°åœ¨æ•°ç»„ä¸­å­˜å‚¨éœ€è¦4byte*8bit=32bitç©ºé—´ï¼Œåœ¨BitMapä¸­åªéœ€è¦1bitç©ºé—´ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - JPS</title>
    <link href="http://xupin.im/2022/08/12/data-structures-algorithms-jps/"/>
    <id>http://xupin.im/2022/08/12/data-structures-algorithms-jps/</id>
    <published>2022-08-11T16:00:00.000Z</published>
    <updated>2023-11-07T14:59:01.908Z</updated>
    
    <content type="html"><![CDATA[<p>JPSå¯»è·¯ç®—æ³•æ˜¯åŸºäºA*è®¡ç®—è¿‡ç¨‹ä¸­æŸ¥æ‰¾èŠ‚ç‚¹å†—ä½™ã€æ•ˆç‡è¾ƒä½ç­‰é—®é¢˜ä¼˜åŒ–çš„ä¸€ç§ç®—æ³•ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>A*æ˜¯æ¯”è¾ƒå¸¸è§çš„å¯»è·¯ç®—æ³•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªè¾ƒä¸ºæ˜æ˜¾çš„é—®é¢˜ï¼Œå½“ç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹æ€»æ˜¯ä¼šæŠŠç›¸é‚»èŠ‚ç‚¹ï¼ˆ4ã€8ï¼‰åŠ å…¥åˆ°å¾…æŸ¥æ‰¾åˆ—è¡¨ã€‚è¿™æ ·å¸¦æ¥ä¸¤ä¸ªé—®é¢˜</p><ol><li><p>åœ¨å¤šæ¡ç§»åŠ¨è·¯å¾„æˆæœ¬ç›¸åŒæ—¶ï¼Œå†—ä½™æŸ¥æ‰¾ã€‚</p></li><li><p>å¾…æŸ¥æ‰¾èŠ‚ç‚¹è¿‡å¤šï¼Œå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ã€‚</p></li></ol><a id="more"></a><h3 id="JPS"><a href="#JPS" class="headerlink" title="JPS"></a>JPS</h3><p>JPSå…¨ç§°â€œJump search pointâ€ï¼Œåˆç§°â€œè·³ç‚¹æœç´¢â€ã€â€œæ‹ç‚¹æœç´¢â€ï¼Œç”±ä¸¤ä½æ¾³å¤§åˆ©äºšæ•™æˆ2011å¹´æå‡ºï¼ˆ<a href="https://ojs.aaai.org/index.php/AAAI/article/view/7994" target="_blank" rel="noopener">è®ºæ–‡</a>ï¼‰ã€‚</p><p>JPSå¯»è·¯ç®—æ³•ä¿ç•™A*çš„ä¸»ä½“é€»è¾‘ï¼Œä¸ä¸€æ ·çš„æ˜¯JPSåªä¼šæŠŠæ„Ÿå…´è¶£çš„èŠ‚ç‚¹åŠ å…¥åˆ°å¾…æŸ¥æ‰¾åˆ—è¡¨ï¼Œæ€æ ·è®¡ç®—å‡ºæ„Ÿå…´è¶£çš„èŠ‚ç‚¹å‘¢ï¼Ÿä»¥ä¸‹2ä¸ªæ¦‚å¿µçœ¼ç†Ÿä¸€ä¸‹</p><ol><li><p>å¼ºè¿«é‚»å±…</p></li><li><p>è·³ç‚¹ï¼ˆæ‹ç‚¹ï¼‰</p></li></ol><p>é€šè¿‡æœ‰æ²¡æœ‰å¼ºè¿«é‚»å±…åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦è·³ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ„Ÿå…´è¶£çš„èŠ‚ç‚¹ã€‚</p><h3 id="å¼ºè¿«é‚»å±…"><a href="#å¼ºè¿«é‚»å±…" class="headerlink" title="å¼ºè¿«é‚»å±…"></a>å¼ºè¿«é‚»å±…</h3><p>å¼ºè¿«é‚»å±…çš„å®šä¹‰ï¼š</p><blockquote><p>èŠ‚ç‚¹ x çš„8ä¸ªé‚»å±…ä¸­æœ‰éšœç¢ï¼Œä¸” x çš„çˆ¶èŠ‚ç‚¹ p ç»è¿‡x åˆ°è¾¾ n çš„è·ç¦»ä»£ä»·æ¯”ä¸ç»è¿‡ x åˆ°è¾¾çš„ n çš„ä»»æ„è·¯å¾„çš„è·ç¦»ä»£ä»·å°ï¼Œåˆ™ç§° n æ˜¯ x çš„å¼ºè¿«é‚»å±…ã€‚</p></blockquote><p>å…è®¸å¯¹è§’ç§»åŠ¨çš„æƒ…å†µä¸‹ï¼Œæ£€ç´¢æ–¹å‘å¼ºè¿«é‚»å±…èŠ‚ç‚¹çš„æ–¹å¼åˆ†ä¸º3ç§ï¼šå¯¹è§’ã€å‚ç›´ã€æ°´å¹³ã€‚</p><ul><li>å¯¹è§’ç§»åŠ¨ </li></ul><p><img src="/assets/jps/forced-neighbour/diagonal.jpg" alt="drawing" width="300" height="300"></p><ul><li>å‚ç›´ç§»åŠ¨</li></ul><p><img src="/assets/jps/forced-neighbour/vertical.jpg" alt="drawing" width="300" height="300"></p><ol><li>æ°´å¹³ç§»åŠ¨</li></ol><p><img src="/assets/jps/forced-neighbour/horizontal.jpg" alt="drawing" width="300" height="300"></p><p>ç»¿è‰²æ˜¯<code>çˆ¶èŠ‚ç‚¹</code>ï¼Œçº¢è‰²æ˜¯<code>éšœç¢ç‰©</code>ï¼Œxæ˜¯<code>å½“å‰èŠ‚ç‚¹</code>ï¼Œnæ˜¯<code>å¼ºè¿«é‚»å±…</code>ã€‚</p><p>é€šä¿—çš„è§£é‡Šå°±æ˜¯ï¼Œåœ¨æŒ‡å®šç§»åŠ¨æ–¹å‘ä¸Šâ€œå¼ºè¿«â€å½“å‰èŠ‚ç‚¹æ”¹å˜ç§»åŠ¨æ–¹å‘çš„èŠ‚ç‚¹å°±æ˜¯å½“å‰èŠ‚ç‚¹çš„å¼ºè¿«é‚»å±…ï¼ŒåŒæ—¶å½“å‰èŠ‚ç‚¹ä¹Ÿæ˜¯è·³ç‚¹ï¼Œè·³ç‚¹å’Œå¼ºè¿«é‚»å±…éƒ½ç›¸é‚»éšœç¢èŠ‚ç‚¹ã€‚</p><h3 id="è·³ç‚¹ï¼ˆæ‹ç‚¹ï¼‰"><a href="#è·³ç‚¹ï¼ˆæ‹ç‚¹ï¼‰" class="headerlink" title="è·³ç‚¹ï¼ˆæ‹ç‚¹ï¼‰"></a>è·³ç‚¹ï¼ˆæ‹ç‚¹ï¼‰</h3><p>çŸ¥é“å¦‚æœæœ‰å¼ºè¿«é‚»å±…æ”¹å˜å½“å‰èŠ‚ç‚¹ç§»åŠ¨æ–¹å‘ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±è¢«è§†ä¸ºè·³ç‚¹ï¼Œè¿™æ˜¯åˆ¤æ–­è·³ç‚¹çš„æ¡ä»¶ä¹‹ä¸€ã€‚åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦è·³ç‚¹çš„ä»»ä¸€æ¡ä»¶ï¼š</p><ol><li><p>å½“å‰èŠ‚ç‚¹æ˜¯èµ·ç‚¹æˆ–ç»ˆç‚¹ã€‚</p></li><li><p>å½“å‰èŠ‚ç‚¹æ‹¥æœ‰å¼ºè¿«é‚»å±…ã€‚</p></li><li><p>å¦‚æœç§»åŠ¨æ–¹å‘æ˜¯å¯¹è§’ç§»åŠ¨ï¼Œå½“å‰èŠ‚ç‚¹çš„å‚ç›´ã€æ°´å¹³æ–¹å‘ä¸Šçš„èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶1æˆ–æ¡ä»¶2ï¼Œå½“å‰èŠ‚ç‚¹ä¸€æ ·è¢«è§†ä¸ºè·³ç‚¹ã€‚</p></li></ol><p>æ¡ä»¶3å¯èƒ½æœ‰äº›éš¾ç†è§£ï¼Œç¤ºæ„å›¾:</p><p><img src="/assets/jps/jump-point.jpg" alt="drawing" width="400" height="250"></p><p>é»„è‰²ç½‘æ ¼1ã€2ã€3éƒ½æ˜¯<code>è·³ç‚¹</code>ï¼Œç½‘æ ¼1å› ä¸ºæ»¡è¶³â€œå½“å‰èŠ‚ç‚¹çš„å‚ç›´ã€æ°´å¹³æ–¹å‘ä¸Šçš„èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶1æˆ–æ¡ä»¶2ï¼Œå½“å‰èŠ‚ç‚¹ä¸€æ ·è¢«è§†ä¸ºè·³ç‚¹â€æ¡ä»¶ï¼ˆç½‘æ ¼2æ˜¯è·³ç‚¹ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯è·³ç‚¹ã€‚</p><h3 id="å¯»è·¯æ€è·¯"><a href="#å¯»è·¯æ€è·¯" class="headerlink" title="å¯»è·¯æ€è·¯"></a>å¯»è·¯æ€è·¯</h3><ol><li><p>æŠŠèµ·ç‚¹æ”¾è¿›å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨ã€‚</p></li><li><p>ä»å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨é‡Œé¢å–å‡ºä¸€ä¸ªï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯ç»ˆç‚¹ï¼Œå¦‚æœä¸æ˜¯åˆ™æŸ¥æ‰¾è¯¥èŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹ã€‚</p></li><li><p>éå†ç›¸é‚»èŠ‚ç‚¹ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å·²æŸ¥æ‰¾è¿‡ï¼Œå¦åˆ™å¯¹ç›¸é‚»èŠ‚ç‚¹è¿›è¡Œè·³ç‚¹æŸ¥æ‰¾å¹¶å¯¹è·³ç‚¹è¿›è¡Œä¼°ä»·ï¼ŒåŒæ—¶æŠŠå½“å‰èŠ‚ç‚¹è®¾ä¸ºè·³ç‚¹åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœè·³ç‚¹æ˜¯ç»ˆç‚¹åˆ™è¿”å›ï¼Œå¦åˆ™æŠŠè·³ç‚¹åŠ å…¥åˆ°å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨ã€‚</p></li><li><p>å¯¹å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨æŒ‰ <code>f</code> å€¼è¿›è¡Œæ’åºï¼Œå–æœ€å°å€¼ã€‚é‡å¤2ã€3ã€4æ­¥éª¤ï¼Œç›´è‡³æ‰¾åˆ°ç»ˆç‚¹åæ ‡ï¼ˆæœ€ç»ˆçš„è·³ç‚¹ï¼‰ã€‚</p></li></ol><p>å®Œæ•´çš„å¯»è·¯è¿‡ç¨‹ï¼š</p><p><img src="/assets/jps/full.jpg" alt="drawing" width="400" height="250"></p><p>ä»¥ä¸Šå¯»è·¯è¿‡ç¨‹ï¼ŒJPSå’ŒA*å¯»è·¯è¿‡ç¨‹çš„åŒºåˆ«åœ¨äºè·³ç‚¹æŸ¥æ‰¾ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·³ç‚¹å‡½æ•°</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­å½“å‰ç‚¹æ˜¯å¦æ»¡è¶³è·³ç‚¹æ¡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Jps)</span> <span class="title">jump</span><span class="params">(node, parent *Node)</span> *<span class="title">Node</span></span> &#123;</span><br><span class="line"><span class="comment">// æ˜¯ç»ˆç‚¹ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">if</span> r.isEnd(node) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line">x, y := node.X, node.Y</span><br><span class="line">dx, dy := r.direction(node, parent)</span><br><span class="line"><span class="comment">// å¯¹è§’ç§»åŠ¨</span></span><br><span class="line"><span class="keyword">if</span> dx != <span class="number">0</span> &amp;&amp; dy != <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// [å·¦|å³]ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å·¦ä¸‹|å³ä¸Š|å³ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x-dx, y) &amp;&amp; r.isWalkable(x-dx, y+dy) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [ä¸Š|ä¸‹]ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å³ä¸Š|å·¦ä¸‹|å³ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y-dy) &amp;&amp; r.isWalkable(x+dx, y-dy) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’æŸ¥æ‰¾æ–¹å‘[ä¸Š|ä¸‹]ç»§ç»­æŸ¥æ‰¾</span></span><br><span class="line"><span class="keyword">if</span> r.isWalkable(x+dx, y) &amp;&amp; r.jump(r.nodes[x+dx][y], node) != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’æŸ¥æ‰¾æ–¹å‘[å·¦|å³]ç»§ç»­æŸ¥æ‰¾</span></span><br><span class="line"><span class="keyword">if</span> r.isWalkable(x, y+dy) &amp;&amp; r.jump(r.nodes[x][y+dy], node) != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> dx == <span class="number">0</span> &#123; <span class="comment">// å‚ç›´ç§»åŠ¨</span></span><br><span class="line"><span class="comment">// å³ä¸èƒ½èµ° &amp;&amp; [å³ä¸‹|å³ä¸Š]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x+<span class="number">1</span>, y) &amp;&amp; r.isWalkable(x+<span class="number">1</span>, y+dy) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·¦ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å·¦ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x<span class="number">-1</span>, y) &amp;&amp; r.isWalkable(x<span class="number">-1</span>, y+dy) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// æ°´å¹³ç§»åŠ¨</span></span><br><span class="line"><span class="comment">// ä¸‹ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸‹|å³ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y+<span class="number">1</span>) &amp;&amp; r.isWalkable(x+dx, y+<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸Šä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å³ä¸Š]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y<span class="number">-1</span>) &amp;&amp; r.isWalkable(x+dx, y<span class="number">-1</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’æŸ¥æ‰¾æ–¹å‘[å·¦ä¸Š|å·¦ä¸‹|å³ä¸Š|å³ä¸‹]ç»§ç»­æŸ¥æ‰¾</span></span><br><span class="line"><span class="keyword">if</span> r.isWalkable(x+dx, y+dy) &#123;</span><br><span class="line"><span class="keyword">if</span> next := r.jump(r.nodes[x+dx][y+dy], node); next != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ— å¼ºè¿«é‚»å±…ï¼ˆå½“å‰èŠ‚ç‚¹ä¸æ˜¯è·³ç‚¹ï¼‰æˆ–åˆ°è¾¾è¾¹ç•Œ</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶ï¼Œä¸ºäº†å‡å°‘æŸ¥æ‰¾ä¸å¿…è¦çš„èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾ç›¸é‚»èŠ‚ç‚¹çš„å‡½æ•°ä¹Ÿæœ‰ä¼˜åŒ–<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥æ‰¾ç›¸é‚»èŠ‚ç‚¹ä½ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Jps)</span> <span class="title">findNeighbors</span><span class="params">(node *Node)</span> []*<span class="title">Node</span></span> &#123;</span><br><span class="line">neighbors := <span class="built_in">make</span>([]*Node, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ç§»åŠ¨</span></span><br><span class="line"><span class="keyword">if</span> node.Parent == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> r.neighborPos &#123;</span><br><span class="line">x, y := node.X+v[<span class="number">0</span>], node.Y+v[<span class="number">1</span>]</span><br><span class="line"><span class="comment">// æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦éæ³•</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y) &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x][y])</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// è®¡ç®—å½“å‰èŠ‚ç‚¹ä½äºçˆ¶èŠ‚ç‚¹çš„æ–¹å‘ï¼šæ°´å¹³ã€å‚ç›´å’Œå¯¹è§’æ–¹å‘</span></span><br><span class="line">x, y := node.X, node.Y</span><br><span class="line">dx, dy := r.direction(node, node.Parent)</span><br><span class="line"><span class="comment">// ç§»åŠ¨æ–¹å‘ä¸Šçš„ä¸‹ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">if</span> r.isWalkable(x+dx, y+dy) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x+dx][y+dy])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹è§’ç§»åŠ¨</span></span><br><span class="line"><span class="keyword">if</span> dx != <span class="number">0</span> &amp;&amp; dy != <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// [å·¦|å³]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> r.isWalkable(x+dx, y) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x+dx][y])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [ä¸Š|ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> r.isWalkable(x, y+dy) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x][y+dy])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [å·¦|å³]ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å·¦ä¸‹|å³ä¸Š|å³ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x-dx, y) &amp;&amp; r.isWalkable(x-dx, y+dy) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x-dx][y+dy])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [ä¸Š|ä¸‹]ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å³ä¸Š|å·¦ä¸‹|å³ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y-dy) &amp;&amp; r.isWalkable(x+dx, y-dy) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x+dx][y-dy])</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> dx == <span class="number">0</span> &#123; <span class="comment">// å‚ç›´ç§»åŠ¨</span></span><br><span class="line"><span class="comment">// å³ä¸èƒ½èµ° &amp;&amp; [å³ä¸‹|å³ä¸Š]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x+<span class="number">1</span>, y) &amp;&amp; r.isWalkable(x+<span class="number">1</span>, y+dy) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x+<span class="number">1</span>][y+dy])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·¦ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å·¦ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x<span class="number">-1</span>, y) &amp;&amp; r.isWalkable(x<span class="number">-1</span>, y+dy) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x<span class="number">-1</span>][y+dy])</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// æ°´å¹³ç§»åŠ¨</span></span><br><span class="line"><span class="comment">// ä¸‹ä¸èƒ½èµ° &amp;&amp; [å·¦ä¸‹|å³ä¸‹]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y+<span class="number">1</span>) &amp;&amp; r.isWalkable(x+dx, y+<span class="number">1</span>) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x+dx][y+<span class="number">1</span>])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸Šä¸èƒ½èµ° &amp;&amp; [å·¦ä¸Š|å³ä¸Š]èƒ½èµ°</span></span><br><span class="line"><span class="keyword">if</span> !r.isWalkable(x, y<span class="number">-1</span>) &amp;&amp; r.isWalkable(x+dx, y<span class="number">-1</span>) &#123;</span><br><span class="line">neighbors = <span class="built_in">append</span>(neighbors, r.nodes[x+dx][y<span class="number">-1</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> neighbors</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/xupin/jps" target="_blank" rel="noopener">jps</a></p><h3 id="å…³äºå…¶ä»–ä¼˜åŒ–ç‚¹"><a href="#å…³äºå…¶ä»–ä¼˜åŒ–ç‚¹" class="headerlink" title="å…³äºå…¶ä»–ä¼˜åŒ–ç‚¹"></a>å…³äºå…¶ä»–ä¼˜åŒ–ç‚¹</h3><p>æœ‰å¾ˆå¤šå€¼å¾—ä¼˜åŒ–çš„ç»†èŠ‚ï¼Œ</p><ol><li><p>å› ä¸ºæ˜¯ç½‘æ ¼å¯»è·¯ï¼Œå®¢æˆ·ç«¯è§’è‰²èµ°è·¯ä¼šå‡ºç°æ‹ç›´è§’çš„è¡¨ç°ï¼ˆå¹³æ»‘è·¯å¾„ï¼Œæ¯”å¦‚ï¼šå¼—æ´›ä¼Šå¾·ç®—æ³•ï¼‰ã€‚</p></li><li><p>å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨å¯ä»¥ç”¨äºŒå‰å †å®ç°ï¼Œæ’å…¥å’Œå¼¹å‡ºæ•ˆç‡éƒ½å¾ˆé«˜ã€‚</p></li><li><p>åœ°å›¾èŠ‚ç‚¹ä½¿ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ£€ç´¢æ•ˆç‡è¾ƒé«˜ã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;JPSå¯»è·¯ç®—æ³•æ˜¯åŸºäºA*è®¡ç®—è¿‡ç¨‹ä¸­æŸ¥æ‰¾èŠ‚ç‚¹å†—ä½™ã€æ•ˆç‡è¾ƒä½ç­‰é—®é¢˜ä¼˜åŒ–çš„ä¸€ç§ç®—æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;A*æ˜¯æ¯”è¾ƒå¸¸è§çš„å¯»è·¯ç®—æ³•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªè¾ƒä¸ºæ˜æ˜¾çš„é—®é¢˜ï¼Œå½“ç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹æ€»æ˜¯ä¼šæŠŠç›¸é‚»èŠ‚ç‚¹ï¼ˆ4ã€8ï¼‰åŠ å…¥åˆ°å¾…æŸ¥æ‰¾åˆ—è¡¨ã€‚è¿™æ ·å¸¦æ¥ä¸¤ä¸ªé—®é¢˜&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;åœ¨å¤šæ¡ç§»åŠ¨è·¯å¾„æˆæœ¬ç›¸åŒæ—¶ï¼Œå†—ä½™æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¾…æŸ¥æ‰¾èŠ‚ç‚¹è¿‡å¤šï¼Œå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - AStar(A*)</title>
    <link href="http://xupin.im/2022/08/01/data-structures-algorithms-astar/"/>
    <id>http://xupin.im/2022/08/01/data-structures-algorithms-astar/</id>
    <published>2022-07-31T16:00:00.000Z</published>
    <updated>2023-11-06T09:52:18.862Z</updated>
    
    <content type="html"><![CDATA[<p>å¯»è·¯ç®—æ³•æ˜¯æ¸¸æˆæ¯”è¾ƒé‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨å›½å†…æ¸¸æˆå¾ˆå¸¸è§çš„è‡ªåŠ¨å¯»è·¯ç³»ç»Ÿï¼Œæ¯”å¦‚æ“çºµè§’è‰²ä»Aç‚¹åˆ°Bç‚¹çš„ç§»åŠ¨ã€‚è®¡ç®—æœ€çŸ­è·¯å¾„æœ‰å¾ˆå¤šä¸åŒçš„ç®—æ³•ï¼Œæ¯”å¦‚ï¼šDijkstraã€AStarï¼ˆA*ï¼‰ã€NavMeshï¼ˆå¤šè¾¹å½¢ç®—æ³•ï¼‰ã€RVOåŠ¨æ€é¿éšœç­‰ç­‰</p><h3 id="A-å¯»è·¯ç®—æ³•"><a href="#A-å¯»è·¯ç®—æ³•" class="headerlink" title="A*å¯»è·¯ç®—æ³•"></a>A*å¯»è·¯ç®—æ³•</h3><p>å¯»è·¯ç®—æ³•çš„ç§»åŠ¨è·¯å¾„æ ¸å¿ƒæœ‰2ç‚¹ï¼šæœ€çŸ­ã€å¯ç§»åŠ¨ã€‚</p><p>æ‰€ä»¥é¦–å…ˆéœ€è¦ç¡®å®šèµ·ç‚¹åæ ‡çš„ç›¸é‚»èŠ‚ç‚¹ï¼ˆ4æ–¹å‘ã€8æ–¹å‘ï¼‰ï¼Œç„¶åé€šè¿‡è®¡ç®—æœ€é è¿‘ç»ˆç‚¹åæ ‡çš„ç›¸é‚»åæ ‡ï¼ˆä¸è€ƒè™‘éšœç¢ç‰©ï¼‰ç¡®è®¤æ£€ç´¢æ–¹å‘ï¼Œå†å»è®¡ç®—â€œç›¸é‚»åæ ‡â€ç§»åŠ¨çš„ä¸‹ä¸€ä¸ªåæ ‡ï¼ˆè·ç¦»ç»ˆç‚¹åæ ‡æœ€è¿‘ &amp; å¯ç§»åŠ¨ï¼‰ï¼Œé‡å¤è®¡ç®—è¿™ä¸ªè¿‡ç¨‹ç›´è‡³æ‰¾åˆ°ç»ˆç‚¹åæ ‡ï¼Œè¿™å°±æ˜¯A*ç®—æ³•</p><p>A*ç®—æ³•æ˜¯ä¸€ç±»åŸºäºç½‘æ ¼çš„å¯»è·¯ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯æŠŠåœ°å›¾çœ‹ä½œä¸€ä¸ªç”±ç½‘æ ¼ç»„æˆçš„çŸ©é˜µï¼Œæ¯ä¸ªåæ ‡å°±æ˜¯ä¸€ä¸ªç½‘æ ¼ã€‚</p><p>ä¸€å¼ 3x3åœ°å›¾</p><a id="more"></a><p><img src="/assets/astar/grid.png" alt="drawing" width="90" height="90"></p><h3 id="å¯å‘å‡½æ•°"><a href="#å¯å‘å‡½æ•°" class="headerlink" title="å¯å‘å‡½æ•°"></a>å¯å‘å‡½æ•°</h3><p>ä»èµ·ç‚¹ç§»åŠ¨åˆ°ç»ˆç‚¹åæ ‡å¯èƒ½ä¼šäº§ç”Ÿå¤šæ¡ç§»åŠ¨è·¯å¾„ï¼Œæ‰€ä»¥è¿˜éœ€è¦è®¡ç®—å‡ºå“ªæ¡ç§»åŠ¨è·¯å¾„æœ€çŸ­ï¼Œä¸ç„¶è¶Šèµ°è¶Šè¿œå°±æ¼”å˜æˆã€Šè®ºè¿°å¦‚ä½•å¸®åŠ©ç©å®¶åˆ·å¾®ä¿¡æ­¥æ•°ã€‹çš„å°´å°¬æƒ…å†µã€‚</p><p>åœ¨ç½‘æ ¼åœ°å›¾ä¸­è‚¯å®šæ˜¯ç»è¿‡è¶Šå°‘çš„ç½‘æ ¼è·¯å¾„å°±è¶ŠçŸ­ï¼Œä½†æˆ‘ä»¬ä¸å¯èƒ½æŠŠæ¯æ¡å¯èƒ½çš„è·¯å¾„éƒ½èµ°ä¸€éå†é€‰å‡ºå“ªæ¡è·¯å¾„æœ€çŸ­ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè¯„ä¼°æ¥ä¸‹æ¥èµ°å“ªä¸ªç½‘æ ¼æœ€è¿‘ã€‚</p><p>å‡è®¾æˆ‘ä»¬æŠŠç½‘æ ¼ç›´çº¿ï¼ˆæ°´å¹³ã€å‚ç›´ï¼‰ç§»åŠ¨æˆæœ¬è®¾ä¸º1ã€å¯¹è§’ç§»åŠ¨æˆæœ¬è®¾ä¸ºï¼š1.4ã€‚ç„¶åæŠŠç§»åŠ¨è·¯å¾„ä¸Šçš„åæ ‡çš„æˆæœ¬è¿›è¡Œç›¸åŠ å–å‡ºæœ€å°å€¼å³å¯èƒ½æ˜¯å½“å‰æœ€ä½³ç§»åŠ¨è·¯å¾„ã€‚</p><p>è¿™ä¹Ÿå«å¯å‘å¼ç®—æ³•ï¼Œå³ä¼˜å…ˆæ£€ç´¢å¯èƒ½æ˜¯æˆæœ¬æœ€ä½çš„ç½‘æ ¼ã€‚</p><h3 id="ä¼°ä»·å…¬å¼"><a href="#ä¼°ä»·å…¬å¼" class="headerlink" title="ä¼°ä»·å…¬å¼"></a>ä¼°ä»·å…¬å¼</h3><p>æˆ‘ä»¬ä¸å¯èƒ½æŠŠæ¯æ¡å¯èƒ½çš„è·¯å¾„éƒ½èµ°ä¸€éï¼Œæ‰€ä»¥é€šè¿‡ä¼°ä»·å…¬å¼ï¼š<code>f = g + h</code>ï¼Œæ¥è¯„ä¼°æ¥ä¸‹æ¥èµ°å“ªä¸€ä¸ªç½‘æ ¼ã€‚</p><ul><li>g</li></ul><blockquote><p>ä»èµ·ç‚¹åæ ‡ç§»åŠ¨åˆ°å½“å‰åæ ‡çš„ç§»åŠ¨æˆæœ¬ï¼ˆç½‘æ ¼æ•°ï¼‰</p></blockquote><ul><li>h</li></ul><blockquote><p>ä»å½“å‰åæ ‡ç§»åŠ¨åˆ°ç»ˆç‚¹åæ ‡çš„ç§»åŠ¨æˆæœ¬</p></blockquote><ul><li>f</li></ul><blockquote><p>å½“å‰åæ ‡çš„ç§»åŠ¨æˆæœ¬</p></blockquote><p>é€šè¿‡è¿™æ ·ä¸€ä¸ªç½‘æ ¼ç§»åŠ¨æˆæœ¬çš„è¯„ä¼°å…¬å¼ï¼Œå¯ä»¥å¤§æ¦‚è®¡ç®—å‡ºä»èµ·ç‚¹ç½‘æ ¼ç§»åŠ¨è‡³ç»ˆç‚¹ç½‘æ ¼çš„è·¯å¾„ä¸­ï¼Œä¸‹ä¸€æ­¥èµ°å“ªä¸€ä¸ªç½‘æ ¼å¯èƒ½è·¯å¾„æœ€çŸ­ã€‚</p><h3 id="ç§»åŠ¨æˆæœ¬"><a href="#ç§»åŠ¨æˆæœ¬" class="headerlink" title="ç§»åŠ¨æˆæœ¬"></a>ç§»åŠ¨æˆæœ¬</h3><p>æ€ä¹ˆè®¡ç®—ç§»åŠ¨æˆæœ¬ï¼Ÿä½¿ç”¨è·ç¦»ç®—æ³•ä½œä¸ºä¼°ä»·å‡½æ•°å¯¹ç½‘æ ¼è¿›è¡Œä¼°ä»·ã€‚æ¯”å¦‚ä»¥ä¸‹çš„è·ç¦»ç®—æ³•ï¼ˆä¸ä»…é™äºï¼‰ï¼š</p><ol><li>æ¬§æ°è·ç¦»</li><li>æ›¼å“ˆé¡¿è·ç¦»</li><li>åˆ‡æ¯”é›ªå¤«è·ç¦»</li><li>45åº¦è§’è®¡ç®—ï¼ˆOctileï¼‰</li></ol><p>ä¸åŒçš„è·ç¦»ç®—æ³•åœ¨ä¸åŒçš„åœºæ™¯ä¸Šè¡¨ç°ä¸ä¸€ï¼Œæ¯”å¦‚è¯´åœ¨é™æ€ç½‘æ ¼åœ°å›¾åœºæ™¯ä¸­</p><ul><li><a href="https://zh.wikipedia.org/wiki/æ¬§å‡ é‡Œå¾—è·ç¦»" target="_blank" rel="noopener">æ¬§æ°è·ç¦»</a></li></ul><p>ä¼˜ç‚¹ï¼š</p><blockquote><p>è®¡ç®—ç›´çº¿è·ç¦»ï¼Œç§»åŠ¨è·¯å¾„æœ€çŸ­ã€‚</p></blockquote><p>ç¼ºç‚¹ï¼š</p><blockquote><p>è®¡ç®—è¿‡ç¨‹ä¸­ä¼´éšç€å¹³æ–¹ä¸å¼€æ ¹å·è¿ç®—ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨æµ®ç‚¹æ•°ï¼Œæ€§èƒ½å·®ã€‚</p><p>å› ä¸ºæ˜¯ç½‘æ ¼æ‰€ä»¥åŸºæœ¬ä¸èƒ½æŒ‰ç…§ç›´çº¿è¿›è¡Œç§»åŠ¨ï¼Œç²¾ç¡®åº¦ä¸å¤Ÿã€‚</p></blockquote><ul><li><a href="https://zh.wikipedia.org/wiki/æ›¼å“ˆé¡¿è·ç¦»" target="_blank" rel="noopener">æ›¼å“ˆé¡¿è·ç¦»</a></li></ul><p>ä¼˜ç‚¹ï¼š</p><blockquote><p>è®¡ç®—è¿‡ç¨‹ä¸å­˜åœ¨æµ®ç‚¹æ•°ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</p></blockquote><p>ç¼ºç‚¹ï¼š</p><blockquote><p>åªå¯ä»¥å‚ç›´æˆ–è€…æ°´å¹³ç§»åŠ¨ã€‚</p></blockquote><p>æ‰€ä»¥åœ¨å¯¹4æ–¹å‘ã€8æ–¹å‘åˆæˆ–è€…6æ–¹å‘ä¸Šçš„ç®—æ³•é€‰æ‹©æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚4æ–¹å‘ç§»åŠ¨<code>ä¸Šä¸‹å·¦å³</code>ä½¿ç”¨æ›¼å“ˆé¡¿è·ç¦»æ¥è¿›è¡Œä¼°ä»·å°±å®Œå…¨è¶³å¤Ÿï¼Œä½†å¦‚æœæ˜¯8æ–¹å‘ç§»åŠ¨å°±ä¸å¯ä»¥ï¼ˆå¯ä»¥å¯¹è§’ç§»åŠ¨ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæ˜¯8æ–¹å‘ç§»åŠ¨çš„åœºæ™¯é€šå¸¸ä¼šé‡‡ç”¨æ›¼å“ˆé¡¿+å¯¹è§’è®¡ç®—çš„è·ç¦»ç®—æ³•ã€‚</p><h3 id="å¯»è·¯æ€è·¯"><a href="#å¯»è·¯æ€è·¯" class="headerlink" title="å¯»è·¯æ€è·¯"></a>å¯»è·¯æ€è·¯</h3><p>ç¤ºä¾‹ï¼š3x3 &amp; æ— éšœç¢çš„åœ°å›¾</p><p><img src="/assets/astar/3x3.png" alt="drawing" width="300" height="300"></p><p>ç»¿è‰²æ˜¯<code>èµ·ç‚¹</code>ï¼Œè“è‰²æ˜¯<code>ç»ˆç‚¹</code></p><ol><li><p>æŠŠèµ·ç‚¹æ”¾è¿›å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨ã€‚</p></li><li><p>ä»å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨é‡Œé¢å–å‡ºä¸€ä¸ªï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯ç»ˆç‚¹ï¼Œå¦‚æœä¸æ˜¯åˆ™æŸ¥æ‰¾è¯¥èŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œæ‰¾åˆ°3ä¸ªèŠ‚ç‚¹åˆ†åˆ«æ˜¯å³ã€å³ä¸‹ã€ä¸‹ã€‚</p></li><li><p>éå†ç›¸é‚»èŠ‚ç‚¹ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å·²æŸ¥æ‰¾è¿‡ï¼Œå¦åˆ™å¯¹3ä¸ªç›¸é‚»èŠ‚ç‚¹çš„è¿›è¡Œä¼°ä»·ï¼ˆå› ä¸ºä½¿ç”¨æ›¼å“ˆé¡¿ç®—æ³•æ‰€ä»¥æŠŠæµ®ç‚¹æ•°æ”¾å¤§<code>10å€</code>ï¼‰ï¼Œå¹¶æŠŠç»¿è‰²èŠ‚ç‚¹è®¾ä¸º3ä¸ªç›¸é‚»èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœæŸä¸€ç›¸é‚»èŠ‚ç‚¹æ˜¯ç»ˆç‚¹åˆ™è¿”å›ï¼Œå¦åˆ™æŠŠç›¸é‚»èŠ‚ç‚¹åŠ å…¥åˆ°å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨ã€‚</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> å³</span><br><span class="line">    èµ·ç‚¹è·ç¦»è¯¥èŠ‚ç‚¹æ°´å¹³ç§»åŠ¨ä¸€ä¸ªç½‘æ ¼ï¼Œæ‰€ä»¥g = <span class="number">10</span>ã€‚è¯¥èŠ‚ç‚¹åˆ°ç»ˆç‚¹å¯¹è§’ç§»åŠ¨ä¸€ä¸ªç½‘æ ¼ï¼Œæ‰€ä»¥h = <span class="number">14</span>ã€‚æœ€ç»ˆè¯¥èŠ‚ç‚¹çš„ç§»åŠ¨æˆæœ¬ï¼š<span class="number">14</span>ï¼ˆf = g + h ï¼‰ã€‚</span><br><span class="line"><span class="number">2.</span> å³ä¸‹</span><br><span class="line">    èµ·ç‚¹è·ç¦»è¯¥èŠ‚ç‚¹å¯¹è§’ç§»åŠ¨ä¸€ä¸ªç½‘æ ¼ï¼Œæ‰€ä»¥g = <span class="number">14</span>ã€‚è¯¥èŠ‚ç‚¹åˆ°ç»ˆç‚¹å‚ç›´ç§»åŠ¨ä¸€ä¸ªç½‘æ ¼ï¼Œæ‰€ä»¥h = <span class="number">10</span>ã€‚æœ€ç»ˆè¯¥èŠ‚ç‚¹çš„ç§»åŠ¨æˆæœ¬ï¼š<span class="number">14</span>ï¼ˆf = g + h ï¼‰ã€‚</span><br><span class="line"><span class="number">3.</span> ä¸‹</span><br><span class="line">    èµ·ç‚¹è·ç¦»è¯¥èŠ‚ç‚¹å‚ç›´ç§»åŠ¨ä¸€ä¸ªç½‘æ ¼ï¼Œæ‰€ä»¥g = <span class="number">10</span>ã€‚è¯¥èŠ‚ç‚¹åˆ°ç»ˆç‚¹æ°´å¹³ç§»åŠ¨ä¸¤ä¸ªç½‘æ ¼ï¼Œæ‰€ä»¥h = <span class="number">20</span>ã€‚æœ€ç»ˆè¯¥èŠ‚ç‚¹çš„ç§»åŠ¨æˆæœ¬ï¼š<span class="number">30</span>ï¼ˆf = g + h ï¼‰ã€‚</span><br></pre></td></tr></table></figure></li><li><p>å¯¹å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨æŒ‰ <code>f</code> å€¼è¿›è¡Œæ’åºï¼Œå–æœ€å°å€¼ã€‚é‡å¤2ã€3ã€4æ­¥éª¤ï¼Œç›´è‡³æ‰¾åˆ°ç»ˆç‚¹åæ ‡ã€‚</p></li></ol><h3 id="ä»£ç å®ç°ï¼ˆé™„ä¸Šå®Œæ•´ä»£ç ï¼‰"><a href="#ä»£ç å®ç°ï¼ˆé™„ä¸Šå®Œæ•´ä»£ç ï¼‰" class="headerlink" title="ä»£ç å®ç°ï¼ˆé™„ä¸Šå®Œæ•´ä»£ç ï¼‰"></a>ä»£ç å®ç°ï¼ˆé™„ä¸Šå®Œæ•´ä»£ç ï¼‰</h3><p>é¦–å…ˆæœ€åŸºç¡€çš„æ˜¯æŠŠåœ°å›¾è¿›è¡Œç½‘æ ¼åŒ–ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åœ°å›¾ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ°´å¹³x å‚ç›´y</span></span><br><span class="line"><span class="comment">  y</span></span><br><span class="line"><span class="comment">x 0,0 1,0 2,0</span></span><br><span class="line"><span class="comment">  0,1 1,1 2,1</span></span><br><span class="line"><span class="comment">  0,2 1,2 2,2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 0æ˜¯å¯ç§»åŠ¨èŠ‚ç‚¹ã€1æ˜¯éšœç¢èŠ‚ç‚¹</span></span><br><span class="line">mapData := [][]<span class="keyword">int</span>&#123;</span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¯ä¸ªèŠ‚ç‚¹ï¼ˆç½‘æ ¼ï¼‰å¯¹åº”ä¸€ä¸ªåæ ‡ï¼Œå› ä¸ºä¼°ä»·éœ€è¦åŒæ—¶æ¯ä¸ªèŠ‚ç‚¹è¿˜å­˜å‚¨ç€fã€gã€hå€¼ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åæ ‡</span></span><br><span class="line">X <span class="keyword">int</span></span><br><span class="line">Y <span class="keyword">int</span></span><br><span class="line"><span class="comment">// æˆæœ¬</span></span><br><span class="line">F <span class="keyword">int</span></span><br><span class="line">G <span class="keyword">int</span></span><br><span class="line">H <span class="keyword">int</span></span><br><span class="line"><span class="comment">// çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">Parent *Node</span><br><span class="line"><span class="comment">// ç±»å‹</span></span><br><span class="line">Type <span class="keyword">int</span></span><br><span class="line"><span class="comment">// çŠ¶æ€</span></span><br><span class="line">State <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ‰äº†èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å®šä¹‰æ¯ä¸ªèŠ‚ç‚¹æœ‰å“ªäº›é‚»å±…ï¼ˆè¿™é‡Œæ˜¯8æ–¹å‘ï¼‰<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä¸å…è®¸å¯¹è§’ç§»åŠ¨ï¼Œå»é™¤å¯¹è§’åæ ‡</span></span><br><span class="line">neighborPos = [][]<span class="keyword">int</span>&#123;</span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">-1</span>&#125;,  <span class="comment">// ä¸Š</span></span><br><span class="line">    &#123;<span class="number">1</span>, <span class="number">-1</span>&#125;,  <span class="comment">// å³ä¸Š</span></span><br><span class="line">    &#123;<span class="number">1</span>, <span class="number">0</span>&#125;,   <span class="comment">// å³</span></span><br><span class="line">    &#123;<span class="number">1</span>, <span class="number">1</span>&#125;,   <span class="comment">// å³ä¸‹</span></span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">1</span>&#125;,   <span class="comment">// ä¸‹</span></span><br><span class="line">    &#123;<span class="number">-1</span>, <span class="number">1</span>&#125;,  <span class="comment">// å·¦ä¸‹</span></span><br><span class="line">    &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;,  <span class="comment">// å·¦</span></span><br><span class="line">    &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;, <span class="comment">// å·¦ä¸Š</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¹¶ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æŸ¥æ‰¾ï¼Œæ‰€ä»¥è¿˜éœ€è¦å®šä¹‰å¾…æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨ã€å·²æŸ¥æ‰¾èŠ‚ç‚¹åˆ—è¡¨ï¼ˆå·²æŸ¥æ‰¾è¿‡çš„èŠ‚ç‚¹ä¼šè¢«å¿½ç•¥ï¼‰ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> openList, closeList []*Node</span><br></pre></td></tr></table></figure></p><p>æœ€åï¼ŒæŸ¥æ‰¾èŠ‚ç‚¹çš„é€»è¾‘ï¼ˆè¿™é‡Œå·æ‡’ï¼Œç›´æ¥è´´ä¸Šå°è£…è¿‡çš„é€»è¾‘ï¼‰<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AStar <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// å¯å‘ç®—æ³•</span></span><br><span class="line">Heuristic <span class="function"><span class="keyword">func</span><span class="params">(node, end *Node)</span> <span class="title">int</span></span></span><br><span class="line"><span class="comment">// åœ°å›¾å¤§å°</span></span><br><span class="line">Rows <span class="keyword">int</span> <span class="comment">// y</span></span><br><span class="line">Cols <span class="keyword">int</span> <span class="comment">// x</span></span><br><span class="line"><span class="comment">// åœ°å›¾èŠ‚ç‚¹</span></span><br><span class="line">nodes [][]*Node</span><br><span class="line">start *Node</span><br><span class="line">end   *Node</span><br><span class="line"><span class="comment">// å¼€æ”¾ã€å…³é—­åˆ—è¡¨</span></span><br><span class="line">openList  []*Node</span><br><span class="line">closeList []*Node</span><br><span class="line"><span class="comment">// ç›¸é‚»èŠ‚ç‚¹åæ ‡</span></span><br><span class="line">neighborPos [][]<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *AStar)</span> <span class="title">FindPath</span><span class="params">(start, end *Node)</span> *<span class="title">Node</span></span> &#123;</span><br><span class="line">r.start = r.nodes[start.X][start.Y]</span><br><span class="line">r.end = r.nodes[end.X][end.Y]</span><br><span class="line"><span class="comment">// å¦‚æœèµ·æ­¢ç‚¹æ˜¯éšœç¢ç‰©</span></span><br><span class="line"><span class="keyword">if</span> !r.start.isWalkable() || !r.end.isWalkable() &#123;</span><br><span class="line">fmt.Println(<span class="string">"éšœç¢ç‰©ä¸å¯ç§»åŠ¨"</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…ˆæŠŠå¼€å§‹èŠ‚ç‚¹æ”¾è¿›å¼€æ”¾åˆ—è¡¨</span></span><br><span class="line">r.openListAppend(start)</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(r.openList) &gt; <span class="number">0</span> &#123;</span><br><span class="line">node := r.openListPop()</span><br><span class="line"><span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯ç»ˆç‚¹</span></span><br><span class="line"><span class="keyword">if</span> r.isEnd(node) &#123;</span><br><span class="line"><span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰¾å¼€æ”¾åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹</span></span><br><span class="line">neighbors := r.findNeighbors(node)</span><br><span class="line"><span class="keyword">for</span> _, neighbor := <span class="keyword">range</span> neighbors &#123;</span><br><span class="line"><span class="comment">// æ˜¯å¦åœ¨å…³é—­åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">if</span> neighbor.isClosed() &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¼€å§‹èŠ‚ç‚¹ç§»åŠ¨è‡³å½“å‰èŠ‚ç‚¹çš„æˆæœ¬</span></span><br><span class="line"><span class="comment">// ç›¸é‚»èŠ‚ç‚¹çš„åæ ‡x,y</span></span><br><span class="line"><span class="comment">// å¼€å§‹èŠ‚ç‚¹ç§»åŠ¨è‡³ç›¸é‚»èŠ‚ç‚¹çš„æˆæœ¬</span></span><br><span class="line">g, x, y := node.G, neighbor.X, neighbor.Y</span><br><span class="line"><span class="comment">// åˆ¤æ–­ç§»åŠ¨æ–¹å¼æ˜¯æ°´å¹³ï¼ˆæˆ–å‚ç›´ï¼‰ã€å¯¹è§’ï¼Œè®¡ç®—æˆæœ¬</span></span><br><span class="line"><span class="keyword">if</span> x == node.X || y == node.Y &#123;</span><br><span class="line">g += COST_STRAIGHT</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">g += COST_DIAGONAL</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !neighbor.isOpened() || g &lt; neighbor.G &#123;</span><br><span class="line">neighbor.G = g</span><br><span class="line">neighbor.H = r.Heuristic(neighbor, end)</span><br><span class="line">neighbor.F = neighbor.G + neighbor.H</span><br><span class="line">neighbor.Parent = node</span><br><span class="line"><span class="comment">// ä¼˜åŒ–é€»è¾‘ï¼Œç›¸é‚»èŠ‚ç‚¹æ˜¯å¦æ˜¯ç»ˆç‚¹</span></span><br><span class="line"><span class="comment">// if r.isEnd(neighbor) &#123;</span></span><br><span class="line"><span class="comment">// return neighbor</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">if</span> !neighbor.isOpened() &#123;</span><br><span class="line">r.openListAppend(neighbor)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½“å‰èŠ‚ç‚¹æ”¾è¿›å…³é—­åˆ—è¡¨</span></span><br><span class="line">r.closeListAppend(node)</span><br><span class="line"><span class="comment">// æ›´æ–°å¼€æ”¾åˆ—è¡¨é¡ºåº</span></span><br><span class="line">r.openListSort()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸ºä»€ä¹ˆè¦ç»™èŠ‚ç‚¹å®šä¹‰çˆ¶èŠ‚ç‚¹ï¼Ÿ</p><blockquote><p>è¿™é‡Œä½¿ç”¨é“¾è¡¨è®°å½•ç§»åŠ¨è·¯å¾„ï¼Œå³é€šè¿‡ç»ˆç‚¹èŠ‚ç‚¹ä¸æ–­è¿­ä»£çˆ¶èŠ‚ç‚¹æ‰“å°å‡ºå®Œæ•´è·¯å¾„ã€‚</p></blockquote><p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/xupin/astar" target="_blank" rel="noopener">astar</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¯»è·¯ç®—æ³•æ˜¯æ¸¸æˆæ¯”è¾ƒé‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨å›½å†…æ¸¸æˆå¾ˆå¸¸è§çš„è‡ªåŠ¨å¯»è·¯ç³»ç»Ÿï¼Œæ¯”å¦‚æ“çºµè§’è‰²ä»Aç‚¹åˆ°Bç‚¹çš„ç§»åŠ¨ã€‚è®¡ç®—æœ€çŸ­è·¯å¾„æœ‰å¾ˆå¤šä¸åŒçš„ç®—æ³•ï¼Œæ¯”å¦‚ï¼šDijkstraã€AStarï¼ˆA*ï¼‰ã€NavMeshï¼ˆå¤šè¾¹å½¢ç®—æ³•ï¼‰ã€RVOåŠ¨æ€é¿éšœç­‰ç­‰&lt;/p&gt;
&lt;h3 id=&quot;A-å¯»è·¯ç®—æ³•&quot;&gt;&lt;a href=&quot;#A-å¯»è·¯ç®—æ³•&quot; class=&quot;headerlink&quot; title=&quot;A*å¯»è·¯ç®—æ³•&quot;&gt;&lt;/a&gt;A*å¯»è·¯ç®—æ³•&lt;/h3&gt;&lt;p&gt;å¯»è·¯ç®—æ³•çš„ç§»åŠ¨è·¯å¾„æ ¸å¿ƒæœ‰2ç‚¹ï¼šæœ€çŸ­ã€å¯ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥é¦–å…ˆéœ€è¦ç¡®å®šèµ·ç‚¹åæ ‡çš„ç›¸é‚»èŠ‚ç‚¹ï¼ˆ4æ–¹å‘ã€8æ–¹å‘ï¼‰ï¼Œç„¶åé€šè¿‡è®¡ç®—æœ€é è¿‘ç»ˆç‚¹åæ ‡çš„ç›¸é‚»åæ ‡ï¼ˆä¸è€ƒè™‘éšœç¢ç‰©ï¼‰ç¡®è®¤æ£€ç´¢æ–¹å‘ï¼Œå†å»è®¡ç®—â€œç›¸é‚»åæ ‡â€ç§»åŠ¨çš„ä¸‹ä¸€ä¸ªåæ ‡ï¼ˆè·ç¦»ç»ˆç‚¹åæ ‡æœ€è¿‘ &amp;amp; å¯ç§»åŠ¨ï¼‰ï¼Œé‡å¤è®¡ç®—è¿™ä¸ªè¿‡ç¨‹ç›´è‡³æ‰¾åˆ°ç»ˆç‚¹åæ ‡ï¼Œè¿™å°±æ˜¯A*ç®—æ³•&lt;/p&gt;
&lt;p&gt;A*ç®—æ³•æ˜¯ä¸€ç±»åŸºäºç½‘æ ¼çš„å¯»è·¯ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯æŠŠåœ°å›¾çœ‹ä½œä¸€ä¸ªç”±ç½‘æ ¼ç»„æˆçš„çŸ©é˜µï¼Œæ¯ä¸ªåæ ‡å°±æ˜¯ä¸€ä¸ªç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å¼ 3x3åœ°å›¾&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³• - Linked list</title>
    <link href="http://xupin.im/2022/07/19/data-structures-algorithms-linked-list/"/>
    <id>http://xupin.im/2022/07/19/data-structures-algorithms-linked-list/</id>
    <published>2022-07-18T16:00:00.000Z</published>
    <updated>2022-12-15T04:17:53.810Z</updated>
    
    <content type="html"><![CDATA[<p>é“¾è¡¨æ˜¯ä¸€ç§ä¸éœ€è¦è¿ç»­ç©ºé—´å­˜å‚¨çš„çº¿æ€§æ•°æ®ç»“æ„ï¼Œé€šè¿‡æŒ‡é’ˆæŠŠæ•°æ®èŠ‚ç‚¹é“¾æ¥èµ·æ¥ã€‚æ•°æ®èŠ‚ç‚¹çš„é€»è¾‘é¡ºåºå–å†³äºé“¾è¡¨æŒ‡é’ˆé“¾æ¥çš„å…ˆåé¡ºåºï¼ŒåŒæ—¶ï¼Œé“¾è¡¨ä¹Ÿæœ‰ï¼šå•é“¾è¡¨ã€åŒé“¾è¡¨ã€å¾ªç¯é“¾è¡¨ç­‰å¤šç±»ã€‚</p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>é“¾è¡¨æ˜¯ç”±ä¸€ç³»åˆ—èŠ‚ç‚¹ç»„æˆï¼Œé™¤æ­¤ä¹‹å¤–é“¾è¡¨è¿˜æœ‰å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ul><li>æ•°æ®èŠ‚ç‚¹<blockquote><p>ä¸€èˆ¬ç”±ä¸¤å—ç»„æˆï¼šæ•°æ®åŸŸã€æŒ‡é’ˆåŸŸã€‚</p></blockquote></li><li>é¦–å…ƒèŠ‚ç‚¹<blockquote><p>é“¾è¡¨çš„ç¬¬ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ã€‚</p></blockquote></li><li>å¤´èŠ‚ç‚¹<blockquote><p>éå¿…è¦èŠ‚ç‚¹ï¼Œæ”¾åœ¨ç¬¬ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹å‰ã€‚ä¸€èˆ¬ç”¨äºå­˜å‚¨é“¾è¡¨çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚è¯´é“¾è¡¨é•¿åº¦ç­‰ï¼‰å’Œä¿è¯æ•°æ®èŠ‚ç‚¹æ“ä½œçš„ç»Ÿä¸€æ€§ã€‚</p></blockquote></li><li>å¤´æŒ‡é’ˆ<blockquote><p>æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¦‚æœæœ‰å¤´èŠ‚ç‚¹åˆ™æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¦åˆ™æŒ‡å‘é¦–å…ƒèŠ‚ç‚¹ã€‚</p></blockquote></li></ul><h3 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h3><p>æœ€ç®€å•çš„ä¸€ç§é“¾è¡¨ï¼Œåªæ”¯æŒä¸€ä¸ªéå†æ–¹å‘ï¼šé“¾å¤´ -&gt; é“¾å°¾ã€‚ä¸¤éƒ¨åˆ†ç»„æˆï¼šå½“å‰èŠ‚ç‚¹çš„æ•°æ®ã€æŒ‡å‘åç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆå°¾èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘nilï¼‰ã€‚</p><a id="more"></a><p>ä¾‹å­ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">V    <span class="keyword">string</span></span><br><span class="line">Next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å¤´èŠ‚ç‚¹</span></span><br><span class="line">head := &amp;Node&#123;</span><br><span class="line">V: <span class="string">"head node"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚ç‚¹1</span></span><br><span class="line">node := &amp;Node&#123;</span><br><span class="line">V: <span class="string">"node1"</span>,</span><br><span class="line">&#125;</span><br><span class="line">head.Next = node</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚ç‚¹2</span></span><br><span class="line">node2 := &amp;Node&#123;</span><br><span class="line">V: <span class="string">"node2"</span>,</span><br><span class="line">&#125;</span><br><span class="line">node.Next = node2</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚ç‚¹3</span></span><br><span class="line">node3 := &amp;Node&#123;</span><br><span class="line">V: <span class="string">"node3"</span>,</span><br><span class="line">&#125;</span><br><span class="line">node2.Next = node3</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤´æŒ‡é’ˆ -&gt; å¤´èŠ‚ç‚¹</span></span><br><span class="line">linkedList := head</span><br><span class="line"><span class="keyword">for</span> linkedList.Next != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// æ‰“å°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å€¼ï¼ˆè¿™å—å°±ä½“ç°å‡ºå¤´èŠ‚ç‚¹çš„å¥½å¤„ï¼Œé¦–å…ƒèŠ‚ç‚¹å’Œå…¶ä»–æ•°æ®èŠ‚ç‚¹çš„æ“ä½œä¸€è‡´ï¼‰</span></span><br><span class="line">fmt.Println(linkedList.Next.V)</span><br><span class="line">linkedList = linkedList.Next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šæ˜¯å•é“¾è¡¨çš„ç®€å•å®ç°ï¼Œå…¶ä¸­æ·»åŠ èŠ‚ç‚¹çš„æ“ä½œä¹Ÿè¢«ç§°ä¸ºï¼š<code>å°¾æ’æ³•</code>ï¼Œå°è£…ä¸€ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">V    <span class="keyword">string</span></span><br><span class="line">Next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">Head *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">list := &amp;List&#123;&#125;</span><br><span class="line">n1 := &amp;Node&#123;V: <span class="string">"node1"</span>&#125;</span><br><span class="line">n2 := &amp;Node&#123;V: <span class="string">"node2"</span>&#125;</span><br><span class="line">n3 := &amp;Node&#123;V: <span class="string">"node3"</span>&#125;</span><br><span class="line">list.Append(n1)</span><br><span class="line">list.Append(n2)</span><br><span class="line">list.Append(n3)</span><br><span class="line">list.Traverse() <span class="comment">// è¾“å‡ºç»“æœï¼šnode1-&gt;node2-&gt;node3-&gt;nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°¾æ’æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Append</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line">l.Head = node</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">now := l.Head</span><br><span class="line"><span class="keyword">for</span> now.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">now = now.Next</span><br><span class="line">&#125;</span><br><span class="line">now.Next = node</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Traverse</span><span class="params">()</span></span> &#123;</span><br><span class="line">now := l.Head</span><br><span class="line"><span class="keyword">for</span> now != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> now.Next == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>, <span class="string">"nil"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">now = now.Next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰æ•°æ®èŠ‚ç‚¹æƒ³è¦æ’é˜Ÿï¼Œæ€ä¹ˆåŠï¼Ÿ<code>å¤´æ’æ³•</code>ï¼Œæ€è·¯å°±æ˜¯ï¼šæŠŠå¤´èŠ‚ç‚¹ä½œä¸ºæ–°å¢èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹ï¼Œæ–°å¢èŠ‚ç‚¹ä½œä¸ºæ–°çš„å¤´èŠ‚ç‚¹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Insert</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line">l.Head = node</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">node.Next = l.Head</span><br><span class="line">l.Head = node</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æƒ³æŠŠé“¾è¡¨åè½¬ï¼Œæ•°æ®èŠ‚ç‚¹é€†åºå‘¢ï¼Ÿæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”å¦‚ï¼šåˆ©ç”¨åŒæŒ‡é’ˆè¿­ä»£ã€é€’å½’ç­‰ç­‰</p><p>è¿­ä»£ï¼Œæ€è·¯å’Œå¤´æ’æ³•ä¸€è‡´ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Reverse</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªå¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> head *Node</span><br><span class="line"><span class="comment">// å¼€å§‹éå†é“¾è¡¨ï¼Œ</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ï¼Œheadï¼šnode1 -&gt; nil</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ï¼Œnowï¼šnode2 -&gt; node3 -&gt; nil</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡ï¼Œheadï¼šnode2 -&gt; node1 -&gt; nil</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡ï¼Œnowï¼šnode3 -&gt; nil</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰æ¬¡ï¼Œheadï¼šnode3 -&gt; node2 -&gt; node1 -&gt; nil</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰æ¬¡ï¼Œnowï¼šnil</span></span><br><span class="line">now := l.Head</span><br><span class="line"><span class="keyword">for</span> now != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// è®°å½•å½“å‰èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">next := now.Next</span><br><span class="line"><span class="comment">// å½“å‰èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹å˜ä¸ºå¤´èŠ‚ç‚¹ï¼Œå½“å‰èŠ‚ç‚¹å˜ä¸ºæ–°çš„å¤´èŠ‚ç‚¹ã€‚è¿™ä¸ªæ“ä½œå’Œæ’å…¥èŠ‚ç‚¹çš„é€»è¾‘ä¸€è‡´ï¼ŒæŠŠå¤´èŠ‚ç‚¹ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹ï¼Œå½“å‰èŠ‚ç‚¹ä½œä¸ºæ–°çš„å¤´èŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">now.Next = <span class="literal">nil</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">now.Next = head</span><br><span class="line">&#125;</span><br><span class="line">head = now</span><br><span class="line"><span class="comment">// æŒ‡é’ˆåç§»</span></span><br><span class="line">now = next</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­æ³•ç³–ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">// now, now.Next, head = now.Next, head, now // è¯­æ³•ç³–ç‰ˆæœ¬ï¼Œæ‹†è§£å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">// now = now.Next</span></span><br><span class="line"><span class="comment">// now.Next = head</span></span><br><span class="line"><span class="comment">// head = now</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// printNode(head)</span></span><br><span class="line"><span class="comment">// printNode(now)</span></span><br><span class="line">&#125;</span><br><span class="line">l.Head = head</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printNode</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"nil"</span>)</span><br><span class="line">&#125;</span><br><span class="line">now := node</span><br><span class="line"><span class="keyword">for</span> now != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> now.Next == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>, <span class="string">"nil"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">now = now.Next</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆ é™¤æ“ä½œ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Delete</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯å°¾èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦æ‰¾å‡ºåˆ é™¤èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> node.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">prev := l.Head</span><br><span class="line"><span class="keyword">for</span> prev.Next != node &#123;</span><br><span class="line">prev = prev.Next</span><br><span class="line">&#125;</span><br><span class="line">prev.Next = <span class="literal">nil</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// å¦‚æœä¸æ˜¯å°¾èŠ‚ç‚¹ï¼ŒæŠŠåˆ é™¤èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹æ•°æ®ç›´æ¥è¦†ç›–åˆ é™¤èŠ‚ç‚¹ã€‚</span></span><br><span class="line">*node = *node.Next</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å•é“¾è¡¨çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å¾ˆè½»æ¾çš„æŸ¥è¯¢åˆ°æŒ‡å®šèŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹ï¼Œä½†å¦‚æœæƒ³è¦æŸ¥è¯¢å‰ç½®èŠ‚ç‚¹åˆ™éœ€è¦éå†ä¸€éæ‰å¯ä»¥ï¼Œæ‰€ä»¥è¿™å°±éœ€è¦<code>åŒé“¾è¡¨</code>äº†</p><h3 id="åŒé“¾è¡¨"><a href="#åŒé“¾è¡¨" class="headerlink" title="åŒé“¾è¡¨"></a>åŒé“¾è¡¨</h3><p>åŒé“¾è¡¨é€šä¿—çš„è®²ï¼Œå°±æ˜¯æ¯ä¸ªæ•°æ®èŠ‚ç‚¹æ—¢å¯ä»¥æ‰¾åˆ°å®ƒå‰ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ‰¾çš„åˆ°å®ƒåä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸‰éƒ¨åˆ†ç»„æˆï¼šå‰å€¼èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒèŠ‚ç‚¹æ•°æ®ï¼Œåç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆå°¾èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘nilï¼‰ã€‚</p><p>ç›´æ¥ä¸Šä»£ç :<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">V    <span class="keyword">string</span></span><br><span class="line">Prev *Node</span><br><span class="line">Next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">Head *Node</span><br><span class="line">Tail *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">list := &amp;List&#123;&#125;</span><br><span class="line">n1 := &amp;Node&#123;V: <span class="string">"node1"</span>&#125;</span><br><span class="line">n2 := &amp;Node&#123;V: <span class="string">"node2"</span>&#125;</span><br><span class="line">n3 := &amp;Node&#123;V: <span class="string">"node3"</span>&#125;</span><br><span class="line">list.Append(n1)</span><br><span class="line">list.Append(n2)</span><br><span class="line">list.Append(n3)</span><br><span class="line">list.Traverse() <span class="comment">// è¾“å‡ºç»“æœï¼šnode1&lt;-&gt;node2&lt;-&gt;node3-&gt;nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Append</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line">l.Head = node</span><br><span class="line">l.Tail = node</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// å°¾èŠ‚ç‚¹</span></span><br><span class="line">prev := l.Tail</span><br><span class="line"><span class="comment">// å°¾èŠ‚ç‚¹è®¾ä¸ºå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">node.Prev = prev</span><br><span class="line"><span class="comment">// å½“å‰èŠ‚ç‚¹è®¾ä¸ºå°¾èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">prev.Next = node</span><br><span class="line"><span class="comment">// å½“å‰èŠ‚ç‚¹å˜ä¸ºå°¾èŠ‚ç‚¹</span></span><br><span class="line">l.Tail = node</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Delete</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ é™¤èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">prev := node.Prev</span><br><span class="line"><span class="comment">// åˆ é™¤èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹è®¾ä¸ºå‰ç½®èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">prev.Next = node.Next</span><br><span class="line"><span class="comment">// åˆ é™¤èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹è®¾ä¸ºåç½®èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">node.Next.Prev = node.Prev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Traverse</span><span class="params">()</span></span> &#123;</span><br><span class="line">now := l.Head</span><br><span class="line"><span class="keyword">for</span> now != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> now.Next == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>, <span class="string">"nil"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"&lt;-&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">now = now.Next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŒé“¾è¡¨è¾ƒå•é“¾è¡¨çš„ä¸åŒæ¯”è¾ƒæ˜æ˜¾ï¼ŒåŒé“¾è¡¨å¯ä»¥å¾ˆè½»æ¾çš„æŸ¥æ‰¾åˆ°æŒ‡å®šèŠ‚ç‚¹çš„å‰ç½®å’Œåç½®èŠ‚ç‚¹ï¼Œéå†æ–¹å‘ä¹Ÿå¯ä»¥æ˜¯ä»å¤´åˆ°å°¾æˆ–è€…ä»å°¾åˆ°å¤´ã€‚åŒæ—¶ï¼ŒåŒé“¾è¡¨èŠ‚ç‚¹æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œå ç”¨ç©ºé—´ä¹Ÿæ›´å¤§ã€‚</p><h3 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h3><p>é¡¾åæ€ä¹‰ï¼Œå¾ªç¯é“¾è¡¨æ˜¯ä¸€ä¸ªç¯çŠ¶çš„é“¾è¡¨ã€‚å¾ªç¯é“¾è¡¨åˆåˆ†ä¸ºï¼šå•å‘å¾ªç¯é“¾è¡¨ã€åŒå‘å¾ªç¯é“¾è¡¨ï¼Œå®ç°ä¸Šå°±æ˜¯æŠŠå°¾èŠ‚ç‚¹å’Œå¤´èŠ‚ç‚¹è¿›è¡Œé“¾æ¥ã€‚</p><p>å•å‘å¾ªç¯é“¾è¡¨ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">V    <span class="keyword">string</span></span><br><span class="line">Next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">Head *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">list := &amp;List&#123;&#125;</span><br><span class="line">n1 := &amp;Node&#123;V: <span class="string">"node1"</span>&#125;</span><br><span class="line">n2 := &amp;Node&#123;V: <span class="string">"node2"</span>&#125;</span><br><span class="line">n3 := &amp;Node&#123;V: <span class="string">"node3"</span>&#125;</span><br><span class="line">list.Append(n1)</span><br><span class="line">list.Append(n2)</span><br><span class="line">list.Append(n3)</span><br><span class="line">list.Traverse() <span class="comment">// è¾“å‡ºç»“æœï¼šnode1-&gt;node2-&gt;node3-&gt;node1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Append</span><span class="params">(node *Node)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> l.Head == <span class="literal">nil</span> &#123;</span><br><span class="line">l.Head = node</span><br><span class="line">node.Next = l.Head</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">now := l.Head</span><br><span class="line"><span class="keyword">for</span> now.Next != l.Head &#123;</span><br><span class="line">now = now.Next</span><br><span class="line">&#125;</span><br><span class="line">now.Next = node</span><br><span class="line">node.Next = l.Head</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Traverse</span><span class="params">()</span></span> &#123;</span><br><span class="line">now := l.Head</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> now.Next == l.Head &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>, l.Head.V)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(now.V, <span class="string">"-&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">now = now.Next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>é“¾è¡¨æ˜¯æœ€åŸºç¡€ä¸”å¾ˆå¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥è§£å†³å¾ˆå¤šç®—æ³•é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ„å»ºå…¶ä»–çš„æ•°æ®ç»“æ„ã€‚æ¯”å¦‚è¯´è§£å†³<code>çº¦ç‘Ÿå¤«ç¯é—®é¢˜</code>å’Œå®ç°å †æ ˆã€é˜Ÿåˆ—ç­‰ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;é“¾è¡¨æ˜¯ä¸€ç§ä¸éœ€è¦è¿ç»­ç©ºé—´å­˜å‚¨çš„çº¿æ€§æ•°æ®ç»“æ„ï¼Œé€šè¿‡æŒ‡é’ˆæŠŠæ•°æ®èŠ‚ç‚¹é“¾æ¥èµ·æ¥ã€‚æ•°æ®èŠ‚ç‚¹çš„é€»è¾‘é¡ºåºå–å†³äºé“¾è¡¨æŒ‡é’ˆé“¾æ¥çš„å…ˆåé¡ºåºï¼ŒåŒæ—¶ï¼Œé“¾è¡¨ä¹Ÿæœ‰ï¼šå•é“¾è¡¨ã€åŒé“¾è¡¨ã€å¾ªç¯é“¾è¡¨ç­‰å¤šç±»ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å®šä¹‰&quot;&gt;&lt;a href=&quot;#å®šä¹‰&quot; class=&quot;headerlink&quot; title=&quot;å®šä¹‰&quot;&gt;&lt;/a&gt;å®šä¹‰&lt;/h3&gt;&lt;p&gt;é“¾è¡¨æ˜¯ç”±ä¸€ç³»åˆ—èŠ‚ç‚¹ç»„æˆï¼Œé™¤æ­¤ä¹‹å¤–é“¾è¡¨è¿˜æœ‰å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®èŠ‚ç‚¹&lt;blockquote&gt;
&lt;p&gt;ä¸€èˆ¬ç”±ä¸¤å—ç»„æˆï¼šæ•°æ®åŸŸã€æŒ‡é’ˆåŸŸã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;é¦–å…ƒèŠ‚ç‚¹&lt;blockquote&gt;
&lt;p&gt;é“¾è¡¨çš„ç¬¬ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;å¤´èŠ‚ç‚¹&lt;blockquote&gt;
&lt;p&gt;éå¿…è¦èŠ‚ç‚¹ï¼Œæ”¾åœ¨ç¬¬ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹å‰ã€‚ä¸€èˆ¬ç”¨äºå­˜å‚¨é“¾è¡¨çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚è¯´é“¾è¡¨é•¿åº¦ç­‰ï¼‰å’Œä¿è¯æ•°æ®èŠ‚ç‚¹æ“ä½œçš„ç»Ÿä¸€æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;å¤´æŒ‡é’ˆ&lt;blockquote&gt;
&lt;p&gt;æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¦‚æœæœ‰å¤´èŠ‚ç‚¹åˆ™æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¦åˆ™æŒ‡å‘é¦–å…ƒèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;å•é“¾è¡¨&quot;&gt;&lt;a href=&quot;#å•é“¾è¡¨&quot; class=&quot;headerlink&quot; title=&quot;å•é“¾è¡¨&quot;&gt;&lt;/a&gt;å•é“¾è¡¨&lt;/h3&gt;&lt;p&gt;æœ€ç®€å•çš„ä¸€ç§é“¾è¡¨ï¼Œåªæ”¯æŒä¸€ä¸ªéå†æ–¹å‘ï¼šé“¾å¤´ -&amp;gt; é“¾å°¾ã€‚ä¸¤éƒ¨åˆ†ç»„æˆï¼šå½“å‰èŠ‚ç‚¹çš„æ•°æ®ã€æŒ‡å‘åç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆå°¾èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘nilï¼‰ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="data structures" scheme="http://xupin.im/tags/data-structures/"/>
    
    <category term="algorithms" scheme="http://xupin.im/tags/algorithms/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - æ³›å‹</title>
    <link href="http://xupin.im/2022/07/14/go-generic/"/>
    <id>http://xupin.im/2022/07/14/go-generic/</id>
    <published>2022-07-13T16:00:00.000Z</published>
    <updated>2022-07-15T02:30:58.145Z</updated>
    
    <content type="html"><![CDATA[<p>2009å¹´Goè¯­è¨€é¦–æ¬¡å‘å¸ƒåï¼Œæ”¯æŒæ³›å‹ä¸€ç›´ä»¥æ¥å‘¼å£°æœ€é«˜çš„åŠŸèƒ½ä¹‹ä¸€ã€‚åå¹´ç£¨ä¸€å‰‘ï¼Goå®˜æ–¹ç»ˆäºåœ¨2022å¹´03æœˆ15æ—¥å‘å¸ƒgo1.18 stableæ­£å¼æ”¯æŒ<code>æ³›å‹</code></p><h3 id="ä»€ä¹ˆæ˜¯æ³›å‹"><a href="#ä»€ä¹ˆæ˜¯æ³›å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³›å‹"></a>ä»€ä¹ˆæ˜¯æ³›å‹</h3><p>æ³›å‹çš„æ ¸å¿ƒæ˜¯æŠŠ<code>ç±»å‹å‚æ•°åŒ–</code>ï¼Œé€šä¿—çš„æ¥è¯´å°±æ˜¯å…è®¸ä½¿ç”¨æ—¶æ‰æŒ‡å®šç±»å‹çš„ä¸€ç§è®¾è®¡ã€‚</p><p>å‡è®¾æœ‰ä¸ªä¸¤å˜é‡ç›¸åŠ çš„éœ€æ±‚ï¼Œä¸”è¿™ä¿©å˜é‡å¯èƒ½æ˜¯intæˆ–è€…stringï¼Œç®€å•ç²—æš´å°±ç›´æ¥å®šä¹‰ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«æ”¯æŒintã€string<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿå†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddInt</span><span class="params">(arg1, arg2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> arg1 + arg2</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddString</span><span class="params">(arg1, arg2 <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> arg1 + arg2</span><br><span class="line">&#125;</span><br><span class="line">AddInt(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">AddString(<span class="string">"a"</span>, <span class="string">"b"</span>)</span><br></pre></td></tr></table></figure></p><p>é‚£å¦‚æœä½¿ç”¨æ³›å‹æ¥å®šä¹‰å‘¢ï¼Œå®ƒçš„å†™æ³•å¤§æ¦‚æ˜¯è¿™æ ·çš„</p><a id="more"></a><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³›å‹å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">type</span>] <span class="params">(var1, var2)</span> <span class="title">type</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> var1 + var2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨æ—¶å†æŒ‡å®šæ•°æ®ç±»å‹</span></span><br><span class="line">Add[<span class="keyword">int</span>](<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">Add[<span class="keyword">string</span>](<span class="string">"a"</span>,<span class="string">"b"</span>)</span><br></pre></td></tr></table></figure><p>å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œè‡³å°‘å¯ä»¥å°‘æ‹·è´ä¸€ä¸ªå‡½æ•°ã€‚å½“ç„¶è¿™ä¸è¶³ä»¥ä½“ç°å‡ºæ³›å‹çš„ä¼˜ç‚¹ï¼Œæ¯•ç«Ÿè¿™ç§é€šç”¨å‡½æ•°é€šè¿‡<code>interface</code>ä¸€æ ·å¯ä»¥å®ç°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(var1, var2 <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">r := reflect.TypeOf(var1)</span><br><span class="line"><span class="keyword">switch</span> r.Kind() &#123;</span><br><span class="line"><span class="keyword">case</span> reflect.Int:</span><br><span class="line"><span class="keyword">return</span> var1.(<span class="keyword">int</span>) + var2.(<span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">case</span> reflect.String:</span><br><span class="line"><span class="keyword">return</span> var1.(<span class="keyword">string</span>) + var2.(<span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">Add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">Add(<span class="string">"a"</span>,<span class="string">"b"</span>)</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶é€šè¿‡<code>interface</code>ä¹Ÿå¯ä»¥å®ç°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ³›å‹è¿˜å¤‡å—æ¨å´‡å‘¢ï¼Ÿ</p><ol><li>ä¾¿åˆ©æ€§ &amp; æ•ˆç‡<blockquote><p>ä½¿ç”¨interfaceå®ç°åˆ™éœ€è¦ä½¿ç”¨æ–­è¨€æˆ–è€…åå°„æ¥å¤„ç†ç±»å‹é—®é¢˜ï¼ŒåŒæ—¶Goè¯­è¨€ä¸­åå°„æ€§èƒ½ååˆ†ä½ä¸‹ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚</p></blockquote></li><li>å®‰å…¨æ€§<blockquote><p>interfaceææ˜“å¼•å‘ç±»å‹å¼‚å¸¸é—®é¢˜ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸èƒ½å‘ç°ç±»å‹é—®é¢˜ã€‚</p></blockquote></li></ol><p><img src="/assets/go-generic/reflect-slow.png" alt="drawing" width="400" height="300"></p><h3 id="Goçš„æ³›å‹"><a href="#Goçš„æ³›å‹" class="headerlink" title="Goçš„æ³›å‹"></a>Goçš„æ³›å‹</h3><p>åœ¨Goè¯­è¨€ä¸­å¦‚ä½•ä½¿ç”¨æ³›å‹ï¼Œå…ˆäº†è§£ä¸€ä¸‹æ³›å‹çš„3ä¸ªæ¦‚å¿µï¼š</p><ol><li>æ³›å‹å‚æ•°</li><li>æ³›å‹å‚æ•°ç±»å‹çº¦æŸ</li><li>æ³›å‹å‚æ•°åˆ—è¡¨</li></ol><p>Goæ³›å‹çš„ä»£ç é£æ ¼å’Œå…¶ä»–è¯­è¨€åŸºæœ¬ç±»ä¼¼ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ªåªæ”¯æŒintå’Œstringä¸¤å€¼ç›¸åŠ çš„æ³›å‹å‡½æ•°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">T</span> <span class="title">int</span> | <span class="title">string</span>]<span class="params">(var1, var2 T)</span> <span class="title">T</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> var1 + var2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šå‡½æ•°ï¼Œ</p><ul><li><p>T æ³›å‹å‚æ•°ï¼Œå¯ä»¥æ˜¯ä»»æ„å­—æ¯ä¸”ä¸åŒºåˆ†å¤§å°å†™ï¼ˆä½†é€šå¸¸ä½¿ç”¨å¤§å†™å­—æ¯ï¼‰ã€‚</p></li><li><p>int | string æ³›å‹å‚æ•°ç±»å‹çº¦æŸï¼Œç”¨äºå£°æ˜å’Œçº¦æŸæ³›å‹å‚æ•°Tæ”¯æŒçš„æ•°æ®ç±»å‹ã€‚æ¯”å¦‚</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Add[T <span class="keyword">float64</span>] <span class="comment">// åªæ”¯æŒfloat64ç±»å‹</span></span><br><span class="line">Add[T any] <span class="comment">// æ”¯æŒä»»ä½•ç±»å‹ï¼Œanyç­‰ä»·äºinterface&#123;&#125;</span></span><br><span class="line">Add[T comparable] <span class="comment">// golangæ–°å¢çš„å†…ç½®æ¥å£ï¼Œä»»ä½•å¯è¿›è¡Œæ¯”è¾ƒçš„ç±»å‹ï¼ˆ!=ã€==ã€&amp;&amp;ã€||ï¼‰</span></span><br><span class="line">Add[T ~<span class="keyword">int</span>] <span class="comment">// ä»»ä½•åº•å±‚ç±»å‹ä¸ºintçš„ç±»å‹ï¼Œ~æ˜¯æ–°å¢çš„æ“ä½œç¬¦ã€‚</span></span><br></pre></td></tr></table></figure><ul><li>[] ä¸­æ‹¬å·å†…æ˜¯æ³›å‹å‚æ•°åˆ—è¡¨ï¼Œæ”¯æŒä»»æ„ä¸ªæ³›å‹å‚æ•°ï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add[T <span class="keyword">int64</span>, T2 <span class="keyword">float64</span>](var1, var2 T, var3 T2)</span><br></pre></td></tr></table></figure><p>å¦‚æœæ³›å‹ä»…ä»…èƒ½åœ¨å‡½æ•°ä¸Šä½¿ç”¨å¥½åƒæœ‰ç‚¹â€œé¸¡è‚‹â€ã€‚å®ƒè¿˜å¯ä»¥è¿™æ ·å»ä½¿ç”¨ï¼Œ<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³›å‹ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Resp[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">Code <span class="keyword">int</span></span><br><span class="line">Msg  <span class="keyword">string</span></span><br><span class="line">Data T</span><br><span class="line">&#125;</span><br><span class="line">resp := &amp;Resp[<span class="keyword">string</span>]&#123;</span><br><span class="line">    Code: <span class="number">200</span>,</span><br><span class="line">    Msg:  <span class="string">"OK"</span>,</span><br><span class="line">    Data: <span class="string">""</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹ç®¡é“</span></span><br><span class="line"><span class="keyword">type</span> MyChan[T <span class="keyword">int</span> | <span class="keyword">bool</span>] <span class="keyword">chan</span> T</span><br><span class="line">ch := <span class="built_in">make</span>(MyChan[<span class="keyword">bool</span>], <span class="number">1</span>)</span><br><span class="line">ch &lt;- <span class="literal">true</span></span><br><span class="line">&lt;-ch</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹Map</span></span><br><span class="line"><span class="keyword">type</span> MyMap[T <span class="keyword">int</span> | <span class="keyword">string</span>, T1 any] <span class="keyword">map</span>[T]T1</span><br><span class="line">m := MyMap[<span class="keyword">string</span>, <span class="keyword">string</span>]&#123;</span><br><span class="line">    <span class="string">"key"</span>: <span class="string">"val"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Personer[T any] <span class="keyword">interface</span> &#123;</span><br><span class="line">Say(age T)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Male <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *Male)</span> <span class="title">Say</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(age)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> m Personer[<span class="keyword">int</span>] = &amp;Male&#123;&#125;</span><br><span class="line">m.Say(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Female <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Female)</span> <span class="title">Say</span><span class="params">(age <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(age)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f Personer[<span class="keyword">string</span>] = &amp;Female&#123;&#125;</span><br><span class="line">f.Say(<span class="string">"secret"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> MyType <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="keyword">int</span> | <span class="keyword">string</span> | <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">T</span> <span class="title">MyType</span>]<span class="params">(var1, var2 T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> var1 + var2   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šåªæ˜¯ç®€å•åˆ—ä¸¾ï¼Œè¿˜æ”¯æŒä¸€äº›åˆ—â€œå¥—å¨ƒâ€è¡Œä¸ºã€‚å€¼çš„æ³¨æ„çš„æ˜¯ï¼ŒGoæ–°å¢çš„æ“ä½œç¬¦<code>~</code>ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyType <span class="keyword">interface</span> &#123;</span><br><span class="line">~<span class="keyword">int</span> | <span class="keyword">string</span> | <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">T</span> <span class="title">MyType</span>]<span class="params">(var1, var2 T)</span> <span class="title">T</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> var1 + var2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a, b MyInt = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">Add(a, b)</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨æ“ä½œç¬¦~ï¼Œæ„å‘³ä¸ä»…æ”¯æŒè¯¥æ“ä½œç¬¦åçš„åŸºæœ¬ç±»å‹ï¼ŒåŒæ—¶è¿˜æ”¯æŒä»»æ„åº•å±‚ç±»å‹æ˜¯è¯¥ç±»å‹çš„æ•°æ®ã€‚</p><blockquote><p>ä»¥ä¸Šå†…å®¹å‚è€ƒæ¥æºï¼š<a href="https://tip.golang.org/doc/go1.18" target="_blank" rel="noopener">https://tip.golang.org/doc/go1.18</a></p></blockquote><h3 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹</h3><p>å½“ä½ è¦ä¸ºä¸åŒæ•°æ®ç±»å‹åšç€åŒæ ·çš„å¤„ç†é€»è¾‘æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ³›å‹ã€‚æ³›å‹æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œæ—¢å¯ä»¥æé«˜ç¼–ç æ•ˆç‡ã€æå‡ä»£ç ç¾å­¦ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥è®©ä»£ç å¯è¯»æ€§å˜çš„å¾ˆå·®ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2009å¹´Goè¯­è¨€é¦–æ¬¡å‘å¸ƒåï¼Œæ”¯æŒæ³›å‹ä¸€ç›´ä»¥æ¥å‘¼å£°æœ€é«˜çš„åŠŸèƒ½ä¹‹ä¸€ã€‚åå¹´ç£¨ä¸€å‰‘ï¼Goå®˜æ–¹ç»ˆäºåœ¨2022å¹´03æœˆ15æ—¥å‘å¸ƒgo1.18 stableæ­£å¼æ”¯æŒ&lt;code&gt;æ³›å‹&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯æ³›å‹&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯æ³›å‹&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯æ³›å‹&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯æ³›å‹&lt;/h3&gt;&lt;p&gt;æ³›å‹çš„æ ¸å¿ƒæ˜¯æŠŠ&lt;code&gt;ç±»å‹å‚æ•°åŒ–&lt;/code&gt;ï¼Œé€šä¿—çš„æ¥è¯´å°±æ˜¯å…è®¸ä½¿ç”¨æ—¶æ‰æŒ‡å®šç±»å‹çš„ä¸€ç§è®¾è®¡ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸ªä¸¤å˜é‡ç›¸åŠ çš„éœ€æ±‚ï¼Œä¸”è¿™ä¿©å˜é‡å¯èƒ½æ˜¯intæˆ–è€…stringï¼Œç®€å•ç²—æš´å°±ç›´æ¥å®šä¹‰ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«æ”¯æŒintã€string&lt;br&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¼ ç»Ÿå†™æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AddInt&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(arg1, arg2 &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; arg1 + arg2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AddString&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(arg1, arg2 &lt;span class=&quot;keyword&quot;&gt;string&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;string&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; arg1 + arg2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;AddInt(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;AddString(&lt;span class=&quot;string&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;b&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;é‚£å¦‚æœä½¿ç”¨æ³›å‹æ¥å®šä¹‰å‘¢ï¼Œå®ƒçš„å†™æ³•å¤§æ¦‚æ˜¯è¿™æ ·çš„&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="golang" scheme="http://xupin.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - initå‡½æ•°</title>
    <link href="http://xupin.im/2022/03/08/go-init/"/>
    <id>http://xupin.im/2022/03/08/go-init/</id>
    <published>2022-03-07T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.751Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>Golangä¸­çš„ç‰¹æ®Šå‡½æ•°ï¼Œä¼šå…ˆäºmainå‡½æ•°æ‰§è¡Œä¸”ä¸èƒ½è¢«è°ƒç”¨ã€‚è¯¥å‡½æ•°æ— å…¥å‚ã€è¿”å›å€¼ï¼ŒåŒæ—¶æ”¯æŒé€‰æ‹©æ€§å®šä¹‰ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©å®šä¹‰å¤šä¸ªinitå‡½æ•°ï¼Œä½†å»ºè®®åªå®šä¹‰ä¸€ä¸ªã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"init1"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"init2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"main"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// init1</span></span><br><span class="line"><span class="comment">// init3</span></span><br><span class="line"><span class="comment">// main</span></span><br></pre></td></tr></table></figure></p><a id="more"></a><h3 id="sync-Once"><a href="#sync-Once" class="headerlink" title="sync.Once"></a>sync.Once</h3><p>initå‡½æ•°å®ç°äº†sync.Onceé”ï¼Œåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</p><ul><li><p>my/my.go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> my</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"a.init"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"a.Test"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>main.go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"test/my"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">my.Test()</span><br><span class="line">my.Test()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a.init</span></span><br><span class="line"><span class="comment">// a.Test</span></span><br><span class="line"><span class="comment">// a.Test</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="åˆå§‹åŒ–é¡ºåº"><a href="#åˆå§‹åŒ–é¡ºåº" class="headerlink" title="åˆå§‹åŒ–é¡ºåº"></a>åˆå§‹åŒ–é¡ºåº</h3><p>åœ¨packageå†…éƒ¨<code>å˜é‡èµ‹å€¼ &gt; init() &gt; main()</code>ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">string</span> = sayHello()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"init"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"main"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"sayHello"</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hi"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// sayHello</span></span><br><span class="line"><span class="comment">// init</span></span><br><span class="line"><span class="comment">// main</span></span><br></pre></td></tr></table></figure><p>å¤šä¸ªpackageè°ƒç”¨æ—¶çš„åˆå§‹åŒ–é¡ºåºï¼Œåˆ™å–å†³äºä¾èµ–é¡ºåºã€‚</p><ul><li><p>my.go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> my</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"test/your"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"a.init"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"a.Test"</span>)</span><br><span class="line">your.Test()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>your.go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> your</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"your.init"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"your.Test"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>main.go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"test/my"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">my.Test()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// your.init</span></span><br><span class="line"><span class="comment">// a.init</span></span><br><span class="line"><span class="comment">// a.Test</span></span><br><span class="line"><span class="comment">// your.Test</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h3><p>å½“packageå†…å®šä¹‰å¤šä¸ªinitå‡½æ•°ï¼Œå®ƒçš„æ‰§è¡Œé¡ºåºï¼Ÿ</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;å®šä¹‰&quot;&gt;&lt;a href=&quot;#å®šä¹‰&quot; class=&quot;headerlink&quot; title=&quot;å®šä¹‰&quot;&gt;&lt;/a&gt;å®šä¹‰&lt;/h3&gt;&lt;p&gt;Golangä¸­çš„ç‰¹æ®Šå‡½æ•°ï¼Œä¼šå…ˆäºmainå‡½æ•°æ‰§è¡Œä¸”ä¸èƒ½è¢«è°ƒç”¨ã€‚è¯¥å‡½æ•°æ— å…¥å‚ã€è¿”å›å€¼ï¼ŒåŒæ—¶æ”¯æŒé€‰æ‹©æ€§å®šä¹‰ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©å®šä¹‰å¤šä¸ªinitå‡½æ•°ï¼Œä½†å»ºè®®åªå®šä¹‰ä¸€ä¸ªã€‚&lt;br&gt;&lt;figure class=&quot;highlight golang&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;package&lt;/span&gt; main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fmt.Println(&lt;span class=&quot;string&quot;&gt;&quot;init1&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fmt.Println(&lt;span class=&quot;string&quot;&gt;&quot;init2&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fmt.Println(&lt;span class=&quot;string&quot;&gt;&quot;main&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// init1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// init3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// main&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="golang" scheme="http://xupin.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>ClickHouseå­¦ä¹ ç¬”è®° - MergeTreeå­˜å‚¨ç»“æ„</title>
    <link href="http://xupin.im/2022/01/26/clickhouse-mergetree/"/>
    <id>http://xupin.im/2022/01/26/clickhouse-mergetree/</id>
    <published>2022-01-25T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.749Z</updated>
    
    <content type="html"><![CDATA[<p>ClickHouseæ˜¯è¿™ä¸¤å¹´å¤‡å—ç©ç›®çš„å¼€æºåˆ—å¼æ•°æ®åº“ï¼Œä¸»è¦åº”ç”¨åœºæ™¯æ˜¯OLAPï¼ˆåœ¨çº¿æ•°æ®åˆ†æå¤„ç†ï¼‰åœºæ™¯ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ä¹‹å‰å› ä¸ºé‡è§ä¸€äº›å°é—®é¢˜ï¼Œæ‰€ä»¥æƒ³é€šè¿‡å­˜å‚¨ç»“æ„å’Œç´¢å¼•æ–¹å¼ä¸¤ä¸ªæ–¹é¢ææ¸…æ¥šå®ƒä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆå¿«ã€‚</p><p>ClickHouseæ˜¯OLAPå‹çš„åˆ—å¼æ•°æ®åº“ï¼Œå®˜æ–¹ç§°æ¯”è¾ƒè¡Œå¼æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡æå‡è‡³å°‘100å€ï¼Œ<a href="https://clickhouse.com/benchmark/dbms/#[%22100000000%22,[%22ClickHouse%22,%22Vertica%22,%22MySQL%22,%22PostgreSQL%22],[%221%22,%222%22]]" target="_blank" rel="noopener">DB Benchmark</a>æ˜¾ç¤ºClickHouseæ¯”Mysqlå¿«800å€ï¼</p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯OLAPå‹åˆ—å¼æ•°æ®åº“"><a href="#ä»€ä¹ˆæ˜¯OLAPå‹åˆ—å¼æ•°æ®åº“" class="headerlink" title="ä»€ä¹ˆæ˜¯OLAPå‹åˆ—å¼æ•°æ®åº“"></a>ä»€ä¹ˆæ˜¯OLAPå‹åˆ—å¼æ•°æ®åº“</h3><p>OLAPä¸šåŠ¡åœºæ™¯ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p><ol><li>å¤šæ•°æ˜¯æŸ¥è¯¢è¯·æ±‚ï¼Œä½†è¯·æ±‚ä¸å¯†é›†ã€‚</li><li>æ•°æ®å†™å…¥ä¸é¢‘ç¹ï¼Œæˆ–è€…å•æ¬¡å¤§æ‰¹é‡å†™å…¥æ•°æ®ã€‚</li><li>å°½é‡ä¸æ›´æ–°æˆ–å°‘æ›´æ–°å†å²æ•°æ®ã€‚</li><li>æ•°æ®è¡¨åˆ—æ¯”è¾ƒå¤šï¼ˆå®½è¡¨ï¼‰ï¼Œä½†æ¯åˆ—å­˜å‚¨æ•°æ®è¾ƒå°ã€‚</li><li>å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒä½ï¼Œä¸ä¾èµ–äº‹åŠ¡ã€‚</li><li>æŸ¥è¯¢è¯·æ±‚ç›®æ ‡æ•°æ®è¡¨æ¯”è¾ƒç‹¬ç«‹ï¼Œæˆ–è€…é™¤ç›®æ ‡è¡¨å¤–å…¶ä»–éœ€è¦å…³è”çš„è¡¨çš„æ•°æ®é‡ç›¸å¯¹å¾ˆå°‘ã€‚</li><li>æŸ¥è¯¢ç»“æœé›†æ•°æ®é‡è¿œè¿œå°äºæºæ•°æ®è¡¨ï¼Œè‡³å°‘æœåŠ¡å™¨å†…å­˜ä¸ä¼šæº¢å‡ºã€‚</li><li>ç®€å•çš„æŸ¥è¯¢ï¼Œæ¯«ç§’çº§åˆ«çš„å“åº”ã€‚</li><li>å•æ¬¡æŸ¥è¯¢é«˜ååé‡ã€‚</li></ol><h3 id="åˆ—å¼å’Œè¡Œå¼æ•°æ®åº“çš„åŒºåˆ«"><a href="#åˆ—å¼å’Œè¡Œå¼æ•°æ®åº“çš„åŒºåˆ«" class="headerlink" title="åˆ—å¼å’Œè¡Œå¼æ•°æ®åº“çš„åŒºåˆ«"></a>åˆ—å¼å’Œè¡Œå¼æ•°æ®åº“çš„åŒºåˆ«</h3><p>å­˜å‚¨æ–¹å¼</p><ul><li>è¡Œå¼</li></ul><table><thead><tr><th>Row</th><th>WatchID</th><th>JavaEnable</th><th>Title</th><th>GoodEvent</th><th>EventTime</th></tr></thead><tbody><tr><td>#0</td><td>89354350662</td><td>1</td><td>Investor Relations</td><td>1</td><td>2016-05-18 05:19:20</td></tr><tr><td>#1</td><td>90329509958</td><td>0</td><td>Contact us</td><td>1</td><td>2016-05-18 08:10:20</td></tr><tr><td>#2</td><td>89953706054</td><td>1</td><td>Mission</td><td>1</td><td>2016-05-18 07:38:00</td></tr><tr><td>#N</td><td>â€¦</td><td>â€¦</td><td>â€¦</td><td>â€¦</td><td>â€¦</td></tr></tbody></table><ul><li>åˆ—å¼</li></ul><table><thead><tr><th>Row:</th><th>#0</th><th>#1</th><th>#2</th><th>#N</th></tr></thead><tbody><tr><td>WatchID:</td><td>89354350662</td><td>90329509958</td><td>89953706054</td><td>â€¦</td></tr><tr><td>JavaEnable:</td><td>1</td><td>0</td><td>1</td><td>â€¦</td></tr><tr><td>Title:</td><td>Investor Relations</td><td>Contact us</td><td>Mission</td><td>â€¦</td></tr><tr><td>GoodEvent:</td><td>1</td><td>1</td><td>1</td><td>â€¦</td></tr><tr><td>EventTime:</td><td>2016-05-18 05:19:20</td><td>2016-05-18 08:10:20</td><td>2016-05-18 07:38:00</td><td>â€¦</td></tr></tbody></table><p>æ£€ç´¢æ–¹å¼ï¼ˆé€šè¿‡ä¸¤å¼ å›¾æ„Ÿå—ä¸€ä¸‹ï¼‰</p><ul><li><p>è¡Œå¼ï¼š<br><img src="https://clickhouse.com/docs/en/images/row-oriented.gif" alt></p></li><li><p>åˆ—å¼ï¼š<br><img src="https://clickhouse.com/docs/en/images/column-oriented.gif" alt></p></li></ul><p>åˆ—å¼æ•°æ®åº“çš„ä¼˜åŠ¿</p><ol><li>æŸ¥è¯¢è¯·æ±‚æ—¶åªè¯»å–éœ€è¦çš„åˆ—ï¼Œè€Œä¸æ˜¯åƒè¡Œå¼æ•°æ®åº“éœ€è¦è¯»å–ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰blockï¼ˆå³ä½¿æ˜¯è¡Œå¼æ•°æ®åº“ä¹Ÿä¸æ˜¯æŒ‰è¡Œè¯»å–æ•°æ®è€Œæ˜¯å—ï¼Œæœ‰äº›æ•°æ®åº“ä¹Ÿç§°é¡µï¼‰ã€‚éœ€è¦è¯»å–æ•°æ®é‡çš„å‡å°‘ï¼Œæ„å‘³ç€IOæ“ä½œä¼šæ›´å¿«ã€‚</li><li>åŒä¸€åˆ—çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥ä½¿ç”¨æœ€é€‚ç”¨çš„å‹ç¼©ç®—æ³•ï¼ˆæ›´é«˜çš„å‹ç¼©æ¯”ï¼‰ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</li></ol><h3 id="ClickHouseçš„ä¼˜ç¼ºç‚¹"><a href="#ClickHouseçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ClickHouseçš„ä¼˜ç¼ºç‚¹"></a>ClickHouseçš„ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹</li></ul><ol><li>æ”¯æŒSQLè¯­æ³•ï¼Œä¸åƒESçš„DSLé‚£æ ·æ™¦æ¶©éš¾æ‡‚ã€‚</li><li>å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆæœ€ç»ˆï¼‰ã€‚</li><li>å‹æ¦¨æ€§èƒ½æé™ï¼Œå¤šæ ¸å¿ƒå¤„ç†ä½¿ç”¨æœºå™¨ä¸€åˆ‡å¯ç”¨èµ„æºã€‚</li><li>é«˜æ•ˆçš„ç£ç›˜IOï¼Œæ•°æ®éƒ½æ˜¯æœ‰åºå­˜å‚¨ã€‚</li><li>æŸ¥è¯¢ä¸éœ€è¦éµå®ˆç´¢å¼•<code>æœ€å·¦åŸåˆ™</code>ã€‚</li><li>æ‰¹é‡å†™å…¥é€Ÿåº¦å¿«ã€‚</li></ol><ul><li>ç¼ºç‚¹</li></ul><ol><li>éƒ¨åˆ†SQLè¯­æ³•ä¸æ”¯æŒï¼Œä½†æ— ä¼¤å¤§é›…ã€‚</li><li>æ›´æ–°å’Œåˆ é™¤æ“ä½œæ”¯æŒä¸å¥½ã€‚</li><li>ä¸æ”¯æŒäº‹åŠ¡ã€‚</li><li>ä¸æ”¯æŒé«˜å¹¶å‘ï¼Œå®˜æ–¹é»˜è®¤QPSï¼š100ï¼ˆå¯ä»¥é€šè¿‡é…ç½®ä¿®æ”¹ï¼‰</li></ol><p>ç®€å•çš„åˆ—ä¸¾äº†ä¼˜ç¼ºç‚¹ï¼Œè¿™åªæ˜¯å†°å±±ä¸€è§’ã€‚å®é™…ä¸ŠClickHouseå€¼å¾—æ·±å…¥æ¢è®¨çš„å¤ªå¤šå¤ªå¤šã€‚</p><h3 id="MergeTreeçš„ç‰¹æ€§"><a href="#MergeTreeçš„ç‰¹æ€§" class="headerlink" title="MergeTreeçš„ç‰¹æ€§"></a>MergeTreeçš„ç‰¹æ€§</h3><p>ClickHouseæ˜¯çœŸæ­£çš„åˆ—å¼å­˜å‚¨æ•°æ®åº“ï¼Œä¸åŒäºå†…å­˜è®¡ç®—å¼•æ“ï¼ˆæ¯”å¦‚SparkSQLã€Prestoï¼‰ï¼Œå®ƒæœ‰è‡ªå·±çš„æ•°æ®å­˜å‚¨æœºåˆ¶å’Œç´¢å¼•æ–¹å¼ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [db.]table_name [<span class="keyword">ON</span> CLUSTER cluster]</span><br><span class="line">(</span><br><span class="line">    name1 [type1] [<span class="keyword">DEFAULT</span>|<span class="keyword">MATERIALIZED</span>|<span class="keyword">ALIAS</span> expr1] [TTL expr1],</span><br><span class="line">    name2 [type2] [<span class="keyword">DEFAULT</span>|<span class="keyword">MATERIALIZED</span>|<span class="keyword">ALIAS</span> expr2] [TTL expr2],</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">INDEX</span> index_name1 expr1 <span class="keyword">TYPE</span> type1(...) GRANULARITY value1,</span><br><span class="line">    <span class="keyword">INDEX</span> index_name2 expr2 <span class="keyword">TYPE</span> type2(...) GRANULARITY value2</span><br><span class="line">) <span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> expr</span><br><span class="line">[<span class="keyword">PARTITION</span> <span class="keyword">BY</span> expr]</span><br><span class="line">[PRIMARY <span class="keyword">KEY</span> expr]</span><br><span class="line">[<span class="keyword">SAMPLE</span> <span class="keyword">BY</span> expr]</span><br><span class="line">[TTL expr [<span class="keyword">DELETE</span>|<span class="keyword">TO</span> DISK <span class="string">'xxx'</span>|<span class="keyword">TO</span> VOLUME <span class="string">'xxx'</span>], ...]</span><br><span class="line">[<span class="keyword">SETTINGS</span> <span class="keyword">name</span>=<span class="keyword">value</span>, ...]</span><br></pre></td></tr></table></figure><ul><li><p>ORDER BY</p><blockquote><p>æ’åºå­—æ®µï¼Œæ•°æ®å­˜å‚¨æ—¶æŒ‰ç…§æ’åºå­—æ®µï¼ˆæ’åºå­—æ®µå¯ä»¥æ˜¯ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å…ƒç»„ï¼‰è¿›è¡Œæœ‰åºå­˜å‚¨ã€‚</p></blockquote></li><li><p>PARTITION BY</p><blockquote><p>ClickHouseæ”¯æŒæŒ‰åˆ—å€¼è¿›è¡Œæ•°æ®åˆ†åŒºï¼Œä¹Ÿæ”¯æŒä»¥è¡¨è¾¾å¼è¿›è¡Œåˆ†åŒºï¼ˆæ¯”å¦‚<code>toYear(date)</code>ï¼‰ï¼Œåˆ†åŒºå­—æ®µå€¼ä¸å¯ä»¥è¿‡å¤šï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼ˆæ¯”å¦‚æŒ‰ç…§user_idåˆ†åŒºï¼‰ã€‚ä¸»è¦ä½œç”¨æ˜¯åˆ†åŒºè£å‰ªï¼Œè¿‡æ»¤éå¿…è¦çš„æŸ¥è¯¢æ•°æ®ã€‚</p></blockquote></li><li><p>PRIMARY KEY</p><blockquote><p>ClickHouseçš„MergeTreeå¼•æ“å¯ä»¥å®šä¹‰ä¸»é”®ï¼Œä½†ä¸åŒäºè¡Œå¼æ•°æ®åº“ã€‚ä¸»é”®ä¸åšå”¯ä¸€çº¦æŸï¼Œå¯ä»¥æ˜¯å¤šä¸ªå­—æ®µã€‚é»˜è®¤ä¸å®šä¹‰ä¸»é”®ï¼Œä¼šå°†æ’åºé”®ä½œä¸ºä¸»é”®ã€‚å¦‚æœå®šä¹‰ä¸»é”®ï¼ˆæ’åºé”®è¿‡å¤§ï¼Œä¸ºäº†æ§åˆ¶ä¸»é”®æ–‡ä»¶å¤§å°ï¼‰ï¼Œåˆ™å°½é‡ä¿è¯æ˜¯æ’åºé”®çš„å‰éƒ¨åˆ†é”®ã€‚</p></blockquote></li><li><p>SAMPLE BY</p><blockquote><p>ClickHouseæä¾›çš„æŠ½æ ·è¡¨è¾¾å¼æœºåˆ¶ï¼ŒæŸ¥è¯¢è¯·æ±‚æ—¶é€šè¿‡é‡‡æ ·å­å¥è¿›è¡Œæ•°æ®é‡‡æ ·åŠŸèƒ½ã€‚<br>å»ºè¡¨æ—¶éœ€è¦å£°æ˜é‡‡æ ·è¡¨è¾¾å¼ï¼ˆé€šè¿‡å“ªä¸ªå­—æ®µé‡‡æ ·ï¼‰ï¼Œè¯¥å­—æ®µå¿…é¡»æ˜¯<code>UIntç±»å‹</code>ä¸”å¿…é¡»å‡ºç°åœ¨ä¸»é”®æˆ–æ’åºé”®ä¸­ï¼ˆå¦‚æœä¸æ˜¯UIntç±»å‹å¯ä»¥å£°æ˜ï¼Œä½†ä½¿ç”¨ä¼šæŠ¥é”™ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> example</span><br><span class="line">(</span><br><span class="line">    user_id UInt64,</span><br><span class="line">    <span class="keyword">name</span> <span class="keyword">String</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> intHash32(user_id)</span><br><span class="line"><span class="keyword">SAMPLE</span> <span class="keyword">BY</span> intHash32(user_id)</span><br></pre></td></tr></table></figure></blockquote></li></ul><blockquote><p>æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œé€šè¿‡<code>sample</code>å…³é”®å­—è¿›è¡Œä¼ªéšæœºæ•°æ®é‡‡æ ·ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> example <span class="keyword">sample</span> <span class="number">1</span>/<span class="number">10</span> <span class="comment"># æ•°æ®çš„10%</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> example <span class="keyword">sample</span> <span class="number">10</span> <span class="comment"># 10è¡Œæ•°æ®</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> example <span class="keyword">sample</span> <span class="number">1</span>/<span class="number">10</span> <span class="keyword">offset</span> <span class="number">1</span>/<span class="number">2</span> <span class="comment"># ä»æ•°æ®è¡¨50%éƒ¨åˆ†ä¸­å–å‡º10%çš„æ•°æ®</span></span><br></pre></td></tr></table></figure></p><p>å¯ä»¥é€šè¿‡å­—æ®µ<code>_sample_factor</code>æŸ¥è¯¢é‡‡æ ·ç³»æ•°ï¼Œè¯¥å­—æ®µæ˜¯è™šæ‹Ÿçš„ã€‚</p></blockquote><ul><li>TTL<blockquote><p>ClickHouseåŸç”Ÿæ”¯æŒçš„æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æœºåˆ¶ï¼Œåœ¨MergeTreeä¸­å¯ä»¥ä¸ºåˆ—ã€è¡¨2ä¸ªçº§åˆ«è®¾ç½®TTLï¼Œå½“æ—¶é—´åˆ°æœŸåè§¦å‘ç›¸åº”çº§åˆ«çš„æ•°æ®åˆ é™¤æ“ä½œã€‚<br>æ— è®ºæ˜¯å“ªç§çº§åˆ«çš„TTLï¼Œå­—æ®µå¿…é¡»ä¸º<code>Datetime</code>æˆ–<code>Date</code>ç±»å‹ï¼Œå› ä¸ºä¾èµ–INTERVALè®¾ç½®ç”Ÿå‘½å‘¨æœŸã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> example</span><br><span class="line">(</span><br><span class="line">    <span class="built_in">date</span> <span class="built_in">Date</span>,</span><br><span class="line">    login_ip <span class="keyword">String</span> TTL <span class="built_in">date</span> + <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span></span><br><span class="line">)</span><br><span class="line">TTL <span class="built_in">date</span> + <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span> <span class="comment"># [DELETE,TO VOLUME,TO DISK] é»˜è®¤å€¼: DELETE</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><blockquote><ol><li>å½“åˆ—çº§TTLè§¦å‘æ—¶ï¼Œä¼šæŠŠå¯¹åº”å€¼ä¿®æ”¹ä¸ºåˆ—ç±»å‹çš„é»˜è®¤å€¼ï¼Œå¦‚æœè¯¥åˆ—æ•°æ®å…¨éƒ¨è¿‡æœŸåˆ™ä¼š<code>åˆ é™¤è¯¥åˆ—</code>ã€‚</li><li>å½“è¡¨çº§TTLè§¦å‘æ—¶ï¼Œä¼šåˆ é™¤æ‰€æœ‰ç¬¦åˆè¿‡æœŸæ¡ä»¶çš„æ•°æ®è¡Œã€‚</li><li>å½“åŒæ—¶è®¾ç½®åˆ—çº§ã€è¡¨çº§TTLï¼Œä»¥å…ˆåˆ°æœŸçš„ä¸ºå‡†ã€‚</li></ol></blockquote><ul><li>SETTINGS<blockquote><p>æ§åˆ¶ MergeTree è¡Œä¸ºçš„é¢å¤–å‚æ•°ï¼Œå¯é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index_granularity <span class="comment"># ç´¢å¼•ç²’åº¦ã€‚ç´¢å¼•ä¸­ç›¸é‚»çš„ã€æ ‡è®°ã€é—´çš„æ•°æ®è¡Œæ•°ã€‚é»˜è®¤å€¼8192 ã€‚</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><p>å…¶ä»–æ›´å¤šå‚æ•°ï¼Œå¯ä»¥æŸ¥é˜…<a href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-query-clauses" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a><code>SETTINGS</code>éƒ¨åˆ†ã€‚</p><h3 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h3><p>ä½¿ç”¨MergeTreeå¼•æ“ï¼Œä¸€å¼ æ•°æ®è¡¨ä¼šåˆ†æˆNä¸ªæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªæ•°æ®åˆ†åŒºå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ç›®å½•ã€‚<br>å¯ä»¥é€šè¿‡SQLæŸ¥è¯¢åˆ°åˆ†åŒºä¿¡æ¯ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> system.parts <span class="keyword">WHERE</span> <span class="string">`table`</span> = <span class="string">'&#123;table&#125;'</span> <span class="comment">-- pathå­—æ®µæ˜¯æ•°æ®åˆ†åŒºçš„å­˜å‚¨ä½ç½®</span></span><br></pre></td></tr></table></figure></p><p>æˆ–è€…åœ¨ClickHouseæ•°æ®å­˜å‚¨ç›®å½•æŸ¥çœ‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /data/clickhouse/data</span><br><span class="line">$ tree -d</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ default</span><br><span class="line">â”‚   â”œâ”€â”€ test_a -&gt; /data/clickhouse/store/adf/adf66eb8-4f34-4a9c-adf6-6eb84f346a9c/</span><br><span class="line">â”‚   â””â”€â”€ test_b -&gt; /data/clickhouse/store/ed9/ed96975a-4048-4846-ad96-975a40484846/</span><br><span class="line">â””â”€â”€ system</span><br><span class="line">    â”œâ”€â”€ asynchronous_metric_log -&gt; /data/clickhouse/store/507/5075436a-cb6c-4fac-9075-436acb6ccfac/</span><br><span class="line">    â”œâ”€â”€ metric_log -&gt; /data/clickhouse/store/86c/86cd831c-1bd4-4df2-86cd-831c1bd43df2/</span><br><span class="line">    â”œâ”€â”€ query_log -&gt; /data/clickhouse/store/986/9860fbbb-e965-476f-9860-fbbbe965776f/</span><br><span class="line">    â”œâ”€â”€ query_thread_log -&gt; /data/clickhouse/store/c1b/c1b39615-68ee-4fb7-81b3-961568eeafb7/</span><br><span class="line">    â””â”€â”€ trace_log -&gt; /data/clickhouse/store/b6d/b6d34f2c-1580-411b-b6d3-4f2c1580911b/</span><br><span class="line">$ <span class="built_in">cd</span> /data/clickhouse/store/adf/adf66eb8-4f34-4a9c-adf6-6eb84f346a9c/</span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ 20220101_1_3_0</span><br><span class="line">â”‚   â”œâ”€â”€ checksums.txt</span><br><span class="line">â”‚   â”œâ”€â”€ columns.txt </span><br><span class="line">â”‚   â”œâ”€â”€ &#123;column&#125;.bin</span><br><span class="line">â”‚   â”œâ”€â”€ &#123;column&#125;.mrk</span><br><span class="line">â”‚   â”œâ”€â”€ count.txt</span><br><span class="line">â”‚   â”œâ”€â”€ primary.idx</span><br><span class="line">â”‚   â”œâ”€â”€ partition.dat</span><br><span class="line">â”‚   â”œâ”€â”€ minmax_&#123;column&#125;.idx</span><br><span class="line">â”‚   â”œâ”€â”€ skp_idx_&#123;column&#125;.idx</span><br><span class="line">â”‚   â””â”€â”€ skp_idx_&#123;column&#125;.mrk</span><br><span class="line">â”œâ”€â”€ detached</span><br><span class="line">â”œâ”€â”€ format_version.txt</span><br><span class="line">â””â”€â”€ mutation_&#123;key&#125;.txt</span><br></pre></td></tr></table></figure></p><ul><li>20220101_1_3_0<blockquote><p>æ•°æ®åˆ†åŒºçš„åç§°ï¼Œç”±4éƒ¨åˆ†ç»„æˆã€‚</p></blockquote></li></ul><ol><li>åç§°ï¼š20220101</li><li>æœ€å°æ•°æ®å—ç¼–å·ï¼š1</li><li>æœ€å¤§æ•°æ®å—ç¼–å·ï¼š3</li><li>æ•°æ®å—çº§åˆ«ï¼š0ï¼ˆå³åœ¨ç”±å—ç»„æˆçš„åˆå¹¶æ ‘ä¸­ï¼Œè¯¥å—åœ¨æ ‘ä¸­çš„æ·±åº¦ï¼‰</li></ol><ul><li><p>checksums.txt</p><blockquote><p>æ ¡éªŒæ–‡ä»¶ï¼Œä½¿ç”¨äºŒè¿›åˆ¶å­˜å‚¨æ•°æ®ç›®å½•çš„æ–‡ä»¶ä¿¡æ¯ï¼Œä¿è¯å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚</p></blockquote></li><li><p>columns.txt</p><blockquote><p>æ˜æ–‡å­˜å‚¨åˆ—ä¿¡æ¯ï¼ˆåˆ—åï¼Œåˆ—ç±»å‹ï¼‰</p></blockquote></li><li><p>{column}.bin</p><blockquote><p>æ ¸å¿ƒæ•°æ®æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶å­˜å‚¨ï¼‰ï¼Œåˆ†åŒºå­—æ®µ<code>part_type</code>ä¸º<code>Wide</code>æ—¶ä¼šä¸ºæ¯åˆ—åˆ›å»ºå¯¹åº”çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœæ˜¯<code>Compact</code>åˆ™æ‰€æœ‰åˆ—å­˜å‚¨åœ¨ä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚è¯¥å€¼å—é…ç½®<code>min_bytes_for_wide_part</code>ã€<code>min_rows_for_wide_part</code>å½±å“ã€‚<br>è¯¥æ–‡ä»¶çš„å†…å®¹ä»¥æ•°æ®Blockå­˜å‚¨ï¼ˆä¹Ÿç§°é¡µï¼‰ï¼Œæ•°æ®æ˜¯å¦å‹ç¼©å—é…ç½®<code>max_compress_block_size</code>ã€<code>min_compress_block_size</code>å½±å“ã€‚é»˜è®¤å‹ç¼©æ ¼å¼ï¼š<a href="https://github.com/lz4/lz4#lz4---extremely-fast-compression" target="_blank" rel="noopener">lz4</a>ã€‚<br>Blockæ•°æ®å—åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå¤´ä¿¡æ¯å’Œæ•°æ®ã€‚å¤´ä¿¡æ¯å›ºå®šå 9å­—èŠ‚ï¼šå‹ç¼©æ–¹å¼1å­—èŠ‚ã€å‹ç¼©åå¤§å°4å­—èŠ‚ã€å‹ç¼©å‰å¤§å°4å­—èŠ‚ã€‚</p></blockquote></li><li><p>{column}.mrk</p><blockquote><p>åˆ—å­—æ®µæ ‡è®°æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶å­˜å‚¨ï¼‰ï¼Œæ–‡ä»¶ä¸­è®°å½•{column}.binæ–‡ä»¶ä¸­æ•°æ®Blockçš„åç§»é‡ã€‚</p></blockquote></li><li><p>count.txt</p><blockquote><p>è¯¥æ•°æ®åˆ†åŒºçš„æ•°æ®è¡Œæ•°ã€‚</p></blockquote></li><li><p>primary.idx</p><blockquote><p>ä¸»é”®ç´¢å¼•æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶å­˜å‚¨ï¼‰ï¼Œæ¯<code>index_granularity</code>è¡Œå–ä¸»é”®å€¼ä½œä¸ºç¨€ç–ç´¢å¼•ã€‚</p></blockquote></li><li><p>partition.dat</p><blockquote><p>å½“å‰æ•°æ®åˆ†åŒºçš„ç¼–å·ã€‚</p></blockquote></li><li><p>minmax_{column}.idx</p><blockquote><p>åˆ—ç´¢å¼•æ–‡ä»¶ï¼Œå­˜å‚¨åˆ—çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚</p></blockquote></li><li><p>skp<em>idx</em>{column}.idx</p><blockquote><p>è·³æ•°ç´¢å¼•ï¼ˆåˆç§°äºŒçº§ç´¢å¼•ï¼‰æ–‡ä»¶ï¼Œå—<code>allow_experimental_data_skipping_indices</code>å‚æ•°æ§åˆ¶ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚</p></blockquote></li><li><p>skp<em>idx</em>{column}.mrk</p><blockquote><p>è·³æ•°ç´¢å¼•æ ‡è®°æ–‡ä»¶ã€‚</p></blockquote></li><li><p>detached</p><blockquote><p>æ‰§è¡Œ<code>ALTER TABLE table_name DETACH PARTITION|PART partition_expr</code>å‘½ä»¤åï¼Œä¼šå°†å¯¹åº”çš„æ•°æ®åˆ†ç¦»è‡³è¯¥ç›®å½•å¹¶â€œé—å¿˜â€ã€‚</p></blockquote></li><li><p>format_version.txt</p><blockquote><p>è®°å½•å­˜å‚¨çš„æ ¼å¼ã€‚</p></blockquote></li><li><p>mutation_{key}.txt</p><blockquote><p>ä¸åŒäºè¡Œå¼æ•°æ®åº“ï¼ŒClickHouseå¯¹äºmutationæ“ä½œï¼ˆUpdateã€Deleteï¼‰æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ŒåŒæ—¶ä¼šç”Ÿæˆ<code>mutation_{key}.txt</code>æ–‡ä»¶è®°å½•æ“ä½œå’Œç”Ÿæˆæ–°çš„æ•°æ®ç›®å½•<code>20220101_1_3_0_{key}</code>ã€‚å¯ä»¥é€šè¿‡SQLæŸ¥è¯¢:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> system.mutations <span class="keyword">WHERE</span> <span class="string">`table`</span>  = <span class="string">'&#123;table&#125;'</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><p>å› ä¸ºä½¿ç”¨ç±»LSMæ¶æ„ï¼Œè¯¥ç±»æ“ä½œå°½é‡å°‘æ‰§è¡Œï¼ˆåŸ‹ä¸ªå‘ï¼Œåé¢å†å»ç ”ç©¶ï¼‰</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ClickHouseæ˜¯è¿™ä¸¤å¹´å¤‡å—ç©ç›®çš„å¼€æºåˆ—å¼æ•°æ®åº“ï¼Œä¸»è¦åº”ç”¨åœºæ™¯æ˜¯OLAPï¼ˆåœ¨çº¿æ•°æ®åˆ†æå¤„ç†ï¼‰åœºæ™¯ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;ä¹‹å‰å› ä¸ºé‡è§ä¸€äº›å°é—®é¢˜ï¼Œæ‰€ä»¥æƒ³é€šè¿‡å­˜å‚¨ç»“æ„å’Œç´¢å¼•æ–¹å¼ä¸¤ä¸ªæ–¹é¢ææ¸…æ¥šå®ƒä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆå¿«ã€‚&lt;/p&gt;
&lt;p&gt;ClickHouseæ˜¯OLAPå‹çš„åˆ—å¼æ•°æ®åº“ï¼Œå®˜æ–¹ç§°æ¯”è¾ƒè¡Œå¼æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡æå‡è‡³å°‘100å€ï¼Œ&lt;a href=&quot;https://clickhouse.com/benchmark/dbms/#[%22100000000%22,[%22ClickHouse%22,%22Vertica%22,%22MySQL%22,%22PostgreSQL%22],[%221%22,%222%22]]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DB Benchmark&lt;/a&gt;æ˜¾ç¤ºClickHouseæ¯”Mysqlå¿«800å€ï¼&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="clickhouse" scheme="http://xupin.im/tags/clickhouse/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•° - é—­åŒ…å‡½æ•°ã€åŒ¿åå‡½æ•°åŠlambdaâ€œå‡½æ•°â€æœ‰ä»€ä¹ˆå…³ç³»</title>
    <link href="http://xupin.im/2022/01/19/func-closure-lambda-diff/"/>
    <id>http://xupin.im/2022/01/19/func-closure-lambda-diff/</id>
    <published>2022-01-18T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.749Z</updated>
    
    <content type="html"><![CDATA[<p>ç»å¸¸åœ¨æŠ€æœ¯åšå®¢ä¸­çœ‹åˆ°åŒ¿åå‡½æ•°ã€é—­åŒ…å‡½æ•°å’Œlambdaè¡¨è¾¾å¼è¿™æ ·åè¯ï¼Œä½†ä¸€ç›´å‚»å‚»åˆ†ä¸æ¸…ä»–ä»¬ä¹‹é—´ç©¶ç«Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ‰€ä»¥æƒ³ä¸€æ¢ç©¶ç«Ÿã€‚</p><h3 id="å‡½æ•°å®šä¹‰"><a href="#å‡½æ•°å®šä¹‰" class="headerlink" title="å‡½æ•°å®šä¹‰"></a>å‡½æ•°å®šä¹‰</h3><p>ä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ï¼Œä¸€èˆ¬ä¼šåŒ…å«ï¼šå‡½æ•°åã€å‡½æ•°çš„å‚æ•°ã€å‡½æ•°çš„ä¸»ä½“ï¼ˆä»£ç å—ï¼‰ã€å‡½æ•°çš„è¿”å›ç±»å‹/å€¼ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Hello, "</span> + name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><a id="more"></a><h3 id="é—­åŒ…å‡½æ•°"><a href="#é—­åŒ…å‡½æ•°" class="headerlink" title="é—­åŒ…å‡½æ•°"></a>é—­åŒ…å‡½æ•°</h3><p>é€šè¿‡å­—é¢æ„æ€ç†è§£ï¼Œå³å®šä¹‰åœ¨å†…éƒ¨çš„å‡½æ•°ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">t := test()</span><br><span class="line">t()</span><br><span class="line">t()</span><br><span class="line">t()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">x := <span class="number">0</span></span><br><span class="line">fmt.Println(<span class="string">"test()"</span>, x, &amp;x)</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">x += <span class="number">1</span></span><br><span class="line">fmt.Println(<span class="string">"closure()"</span>, x, &amp;x)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç¨‹åºè¾“å‡ºä»¥ä¸‹å†…å®¹</span></span><br><span class="line"><span class="comment">// test() 0 0xc000016098</span></span><br><span class="line"><span class="comment">// closure() 1 0xc000016098</span></span><br><span class="line"><span class="comment">// closure() 2 0xc000016098</span></span><br><span class="line"><span class="comment">// closure() 3 0xc000016098</span></span><br></pre></td></tr></table></figure></p><ol><li>æ‰§è¡Œtest()å‡½æ•°è¿”å›é—­åŒ…å‡½æ•°ã€‚</li><li>æ‰§è¡Œé—­åŒ…å‡½æ•°å‘ç°å¯ä»¥ä½¿ç”¨xå˜é‡ï¼Œä½†ä¸ç”¨å£°æ˜xå˜é‡ã€‚</li><li>å†æ¬¡æ‰§è¡Œé—­åŒ…å‡½æ•°ä»æ—§å¯ä»¥ä½¿ç”¨xå˜é‡ï¼Œè¯´æ˜é—­åŒ…å‡½æ•°è‡ªèº«åœ¨â€œç»´æŠ¤â€xå˜é‡ã€‚</li><li>é€šè¿‡å†…å­˜åœ°å€å¯ä»¥çœ‹å‡ºé—­åŒ…å‡½æ•°å’Œtest()å‡½æ•°çš„xå˜é‡æ˜¯åŒä¸€ä¸ªå˜é‡ã€‚</li></ol><blockquote><p>æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ä¸ºï¼š<code>å‡½æ•°åˆ›å»ºæ—¶è·å–æ‰€éœ€å¤–éƒ¨çŠ¶æ€ï¼Œå³ä½¿å¤–éƒ¨çŠ¶æ€å…³é—­ï¼Œå‡½æ•°ä¸­çš„çŠ¶æ€è¿˜ä¼šå­˜åœ¨ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯â€œé—­åŒ…â€ï¼Œæˆ–è®¸é—­åŒ…å‡½æ•°è§£å†³çš„æ˜¯å˜é‡ä½œç”¨åŸŸçš„é—®é¢˜ï¼Ÿ</code></p></blockquote><p>å¼•ç”¨JavaScript MDNå¯¹é—­åŒ…å‡½æ•°çš„ä¸€å¥è§£é‡Šï¼š</p><blockquote><p>A closure is the combination of a function and the lexical environment within which that function was declared.</p></blockquote><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><p>åŒ¿åå‡½æ•°ï¼Œå³â€œæ— åâ€å‡½æ•°ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">lam := <span class="function"><span class="keyword">func</span><span class="params">(x, y, z <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line">x := lam(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŒ¿åå‡½æ•°å¯ä»¥ç›´æ¥å®šä¹‰åœ¨ä»£ç å—ä¸­ã€‚åŒ¿åå‡½æ•°å¯ä»¥å‡å°‘å‡½æ•°æš´éœ²ï¼Œé˜²æ­¢è¢«å¤–éƒ¨ä»£ç è°ƒç”¨æ‰§è¡Œï¼ˆé¿å…æ•°æ®æ±¡æŸ“ï¼‰ã€‚</p><h3 id="lambdaâ€œå‡½æ•°â€"><a href="#lambdaâ€œå‡½æ•°â€" class="headerlink" title="lambdaâ€œå‡½æ•°â€"></a>lambdaâ€œå‡½æ•°â€</h3><p>lambdaâ€œå‡½æ•°â€ï¼Œä¸¥æ ¼æ¥è¯´åº”è¯¥å«lambdaè¡¨è¾¾å¼ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—Nä¸ªå‚æ•°ä½†åªè¿”å›å•ä¸ªè¡¨è¾¾å¼å€¼çš„â€œå‡½æ•°â€ï¼Œå¯ä»¥ç†è§£ä¸ºå®ƒæ˜¯åŒ¿åå‡½æ•°çš„ä¸€ç§ä»£ç é£æ ¼æˆ–è€…è¯­æ³•ç³–ã€‚</p><p>lambdaä¼šä½¿ä»£ç çœ‹èµ·æ¥æ¯”è¾ƒç®€æ´ï¼Œå¾ˆé€‚ç”¨äºè¿™ä¸ªå‡½æ•°â€œåªç”¨ä¸€æ¬¡â€çš„åœºæ™¯ã€‚æ¯”å¦‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * x</span><br><span class="line">print(<span class="string">"square()"</span>, list(map(square, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"lambda"</span>, list(map(<span class="keyword">lambda</span> x: x * x, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="comment"># square() [1, 4, 9, 16, 25]</span></span><br><span class="line"><span class="comment"># lambda [1, 4, 9, 16, 25]</span></span><br></pre></td></tr></table></figure></p><p>lambdaè¡¨è¾¾å¼å¸¦æ¥ä»£ç ç®€æ´çš„åŒæ—¶ä¹Ÿæœ‰å‰¯ä½œç”¨ï¼Œlambdaå¯è¯»æ€§è¾ƒå·®ï¼Œä¸é€‚ç”¨äºå¾ˆé•¿å¾ˆå¤æ‚çš„é€»è¾‘ï¼Œæ‰€ä»¥ä¸è¦ä¸ºäº†å†™lambdaè€Œå†™lambdaã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func = <span class="keyword">lambda</span> x, y, z: x + y + z</span><br><span class="line">x = func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»£ç è¢«è‡ªåŠ¨è½¬æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x, y, z)</span>:</span> <span class="keyword">return</span> x + y + z</span><br><span class="line">x = func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure></p><p>åœ¨<code>Visual Studio Code</code>ä¸­ç¼–è¾‘ä¿å­˜è¿™æ®µä»£ç ä¼šè¢«è‡ªåŠ¨è½¬æ¢ï¼Œåœ¨<code>PyCharm</code>ä¸­åˆ™ä¼šç›´æ¥ç»™å‡ºè­¦å‘Š<code>PEP 8: E731 do not assign a lambda expression, use a def</code><a href="https://pypi.org/project/autopep8/#features" target="_blank" rel="noopener">autopep8</a></p><p>è‡³äºä¸ºä»€ä¹ˆè¿™ç§ä¹¦å†™æ–¹å¼ç§°ä¹‹ä¸ºlambdaè¡¨è¾¾å¼ï¼Œåˆ™æ˜¯æœ‰åŸå› çš„ï¼š</p><blockquote><p>Alonzo Churchåœ¨30å¹´ä»£å‘æ˜çš„<a href="https://en.wikipedia.org/wiki/Lambda_calculus" target="_blank" rel="noopener">Lambda Calculus</a>ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­åšçš„ä¸€ä»¶äº‹å°±æ˜¯Î»è¿ç®—ã€‚</p></blockquote><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>çŒœçŒœä»¥ä¸‹è¿™æ®µä»£ç æ‰§è¡Œåä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">a := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">i := v</span><br><span class="line">fmt.Printf(<span class="string">"for v:%d i:%d\n"</span>, v, i)</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">fmt.Printf(<span class="string">"func v:%d i:%d\n"</span>, v, i)</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»å¸¸åœ¨æŠ€æœ¯åšå®¢ä¸­çœ‹åˆ°åŒ¿åå‡½æ•°ã€é—­åŒ…å‡½æ•°å’Œlambdaè¡¨è¾¾å¼è¿™æ ·åè¯ï¼Œä½†ä¸€ç›´å‚»å‚»åˆ†ä¸æ¸…ä»–ä»¬ä¹‹é—´ç©¶ç«Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ‰€ä»¥æƒ³ä¸€æ¢ç©¶ç«Ÿã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‡½æ•°å®šä¹‰&quot;&gt;&lt;a href=&quot;#å‡½æ•°å®šä¹‰&quot; class=&quot;headerlink&quot; title=&quot;å‡½æ•°å®šä¹‰&quot;&gt;&lt;/a&gt;å‡½æ•°å®šä¹‰&lt;/h3&gt;&lt;p&gt;ä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ï¼Œä¸€èˆ¬ä¼šåŒ…å«ï¼šå‡½æ•°åã€å‡½æ•°çš„å‚æ•°ã€å‡½æ•°çš„ä¸»ä½“ï¼ˆä»£ç å—ï¼‰ã€å‡½æ•°çš„è¿”å›ç±»å‹/å€¼ã€‚&lt;br&gt;&lt;figure class=&quot;highlight golang&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(name &lt;span class=&quot;keyword&quot;&gt;string&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;string&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello, &quot;&lt;/span&gt; + name&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="lambda" scheme="http://xupin.im/tags/lambda/"/>
    
    <category term="closure" scheme="http://xupin.im/tags/closure/"/>
    
    <category term="function" scheme="http://xupin.im/tags/function/"/>
    
  </entry>
  
  <entry>
    <title>ClickHouseå­¦ä¹ ç¬”è®° - æ•°æ®å¼•æ“</title>
    <link href="http://xupin.im/2022/01/16/clickhouse-engines/"/>
    <id>http://xupin.im/2022/01/16/clickhouse-engines/</id>
    <published>2022-01-15T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.749Z</updated>
    
    <content type="html"><![CDATA[<p>ClickHouseæ˜¯ä¸ªç”±è€æ¯›å­å›½å†…å¸‚åœºä½¿ç”¨ç‡ç¬¬ä¸€çš„æœç´¢å¼•æ“Yandexå¼€æºçš„OLAPå‹åˆ—å¼æ•°æ®åº“ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ä¹‹å‰å› ä¸ºä¸šåŠ¡æ¥è§¦åˆ°ClickHouseï¼Œä½†å› ä¸ºæ²¡æœ‰ç³»ç»Ÿçš„äº†è§£è¿‡å¯¼è‡´é‡è§ä¸ªå¾ˆå°çš„é—®é¢˜ã€èŠ±äº†å¤§é‡çš„æ—¶é—´ã€ç”¨äº†å¾ˆæŒ«çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ï¼Œç—›å®šæ€ç—›çš„æƒ…å†µä¸‹å†³å¿ƒç³»ç»Ÿçš„é€æ­¥å­¦ä¹ ä¸€ä¸‹ã€‚ClickHouseæ— è®ºæ˜¯å­˜å‚¨è¿˜æ˜¯ä½¿ç”¨æ–¹å¼éƒ½ä¸åŒç¨‹åº¦çš„å¼‚äºæˆ‘ä»¬å¸¸ç”¨çš„Mysqlï¼ŒPostgreSqlï¼ŒMssqlç­‰è¡Œå¼æ•°æ®åº“ï¼Œä½†å®ƒæ”¯æŒç»å¤§éƒ¨åˆ†çš„SQLè¯­æ³•ã€‚</p><a id="more"></a><h3 id="æ•°æ®å¼•æ“"><a href="#æ•°æ®å¼•æ“" class="headerlink" title="æ•°æ®å¼•æ“"></a>æ•°æ®å¼•æ“</h3><p>ClickHouseï¼ˆåŸºäºv21.7ï¼‰çš„å¼•æ“åˆ†ä¸ºæ•°æ®åº“å¼•æ“å’Œè¡¨å¼•æ“ã€‚</p><ul><li><p>æ•°æ®åº“å¼•æ“</p><ol><li>MySQL<blockquote><p>é¡¾åæ€ä¹‰ï¼Œå’ŒMysqlæ•°æ®åº“æœ‰å…³ç³»ã€‚è¯¥å¼•æ“å…è®¸è¿æ¥è¿œç¨‹Mysqlæ•°æ®åº“å¹¶ä¸”æ‰§è¡ŒSqläº¤æ¢æ•°æ®ã€‚ä½†æ˜¯ä»…æ”¯æŒéƒ¨åˆ†æ“ä½œï¼ˆè¯»å†™ï¼‰ã€‚</p></blockquote></li><li>MaterializeMySQL<blockquote><p>v20.8æ–°å¢çš„å¼•æ“ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„åœ¨<code>å®éªŒé˜¶æ®µçš„å¼•æ“</code>ï¼Œé€šè¿‡åç§°å¯ä»¥çœ‹å‡ºæ¥ä¹Ÿæ˜¯å’ŒMysqlç›¸å…³çš„å¼•æ“ï¼Œè¯¥å¼•æ“é€šè¿‡binlogæ—¥å¿—è¿›è¡Œå…¨é‡ï¼ˆç¬¬ä¸€æ¬¡ï¼‰å’Œå¢é‡å®æ—¶ç‰©åŒ–ï¼ˆå¯ä»¥ç†è§£ä¸ºåŒæ­¥ï¼Ÿï¼‰Mysqlæ•°æ®ï¼ŒåŸæœ¬Mysqlçš„DDLå’ŒDMLæ“ä½œéƒ½å¯ä»¥é€šè¿‡ClickHouseæ‰§è¡Œã€‚</p></blockquote></li><li>Lazy<blockquote><p>åœ¨æœ€åä¸€æ¬¡æ“ä½œè¯¥è¡¨ä¹‹åï¼Œä»…åœ¨å›ºå®šç§’æ•°å†…å°†è¡¨ä¿ç•™åœ¨è¿å­˜ä¸­ï¼Œè¯¥ç§’æ•°é€šè¿‡<code>expiration_time_in_seconds</code>å‚æ•°æ§åˆ¶ã€‚</p></blockquote></li><li>Atomic<blockquote><p>æ–°ç‰ˆæœ¬é»˜è®¤çš„æ•°æ®åº“å¼•æ“ï¼Œæ”¯æŒå¯¹è¡¨éé˜»å¡çš„<code>drop</code>ã€<code>rename</code>æ“ä½œä»¥åŠåŸå­æ“ä½œäº¤æ¢ä¸¤å¼ è¡¨ã€‚</p></blockquote></li><li>PostgreSQL<blockquote><p>è¯¥å¼•æ“çš„ç‰¹æ€§å’Œ<code>MySQL</code>å¼•æ“å¤§è‡´ç›¸åŒï¼Œåªä¸è¿‡æ˜¯å¯¹PostgreSqlçš„æ”¯æŒã€‚</p></blockquote></li><li>MaterializedPostgreSQL<blockquote><p>ä¸<code>MaterializeMySQL</code>ä¸€æ ·ï¼Œæ˜¯<code>å®éªŒé˜¶æ®µçš„å¼•æ“</code>ã€‚ä½œä¸ºPostgreSqlæ•°æ®è¡¨çš„å‰¯æœ¬è¿›è¡Œåå°åŒæ­¥ã€‚</p></blockquote></li><li>Replicated<blockquote><p>åŸºäº<code>Atomic</code>å¼•æ“ï¼Œé€šè¿‡å°†DDLæ“ä½œæ—¥å¿—å†™å…¥ZKå¹¶åœ¨æ•°æ®åº“çš„æ‰€æœ‰å‰¯æœ¬ä¸Šæ‰§è¡Œçš„å…ƒæ•°æ®å¤åˆ¶ï¼ˆå¤åˆ¶æ•°æ®åº“ï¼‰ã€‚å¯ä»¥åŒæ—¶è¿è¡Œå’Œæ›´æ–°å¤šä¸ªå¤åˆ¶çš„æ•°æ®åº“ã€‚ä½†æ˜¯åŒä¸€ä¸ªå¤åˆ¶çš„æ•°æ®åº“ä¸èƒ½æœ‰å¤šä¸ªå‰¯æœ¬ã€‚</p></blockquote></li></ol></li><li><p>è¡¨å¼•æ“ï¼ˆè¡¨å¼•æ“æ¯”æ•°æ®åº“å¼•æ“ç¨å¾®å¤æ‚ä¸€äº›ï¼Œè¡¨å¼•æ“åˆåˆ†ä¸ºå››å¤§ç³»åˆ—ï¼‰</p><ol><li>MergeTreeç³»åˆ—</li><li>Logç³»åˆ—</li><li>Integrationsç³»åˆ—</li><li>Specialç±»</li></ol></li></ul><h3 id="MergeTreeç³»åˆ—"><a href="#MergeTreeç³»åˆ—" class="headerlink" title="MergeTreeç³»åˆ—"></a>MergeTreeç³»åˆ—</h3><p>MergeTreeç³»åˆ—çš„è¡¨å¼•æ“æ¯”è¾ƒå¸¸ç”¨ï¼Œå®ƒæ”¯æŒä¸»é”®ã€æ•°æ®åˆ†åŒºã€æ•°æ®å‰¯æœ¬å’Œæ•°æ®é‡‡æ ·ç­‰ç‰¹æ€§ï¼ŒåŒæ—¶æ”¯æŒé‡è¦çš„<code>alter</code>æ“ä½œè¯­å¥ã€‚</p><ul><li>ReplacingMergeTree<blockquote><p>æ¸…æ´—æ•°æ®ï¼Œå»é™¤é‡å¤æ•°æ®ã€‚å½“æ•°æ®é‡å¤æ—¶æ•°æ®å»é‡ç­–ç•¥æœ‰ä¸¤ç§ï¼šé€šè¿‡<code>ReplacingMergeTree({version})</code>å»ºç«‹versionå­—æ®µåˆ™ä¿ç•™versionå­—æ®µæœ€å¤§å€¼ï¼Œå¦åˆ™åˆ™ä¿ç•™æœ€åä¸€è¡Œã€‚</p></blockquote></li><li>SummingMergeTree<blockquote><p>æŒ‰ç…§é¢„å…ˆå®šä¹‰çš„èšåˆæ¡ä»¶æ±‡æ€»æ•°æ®</p></blockquote></li><li>AggregatingMergeTree<blockquote><p><code>SummingMergeTree</code>å¼•æ“çš„è¿›é˜¶ç‰ˆã€‚èƒ½å¤Ÿåœ¨åˆå¹¶åˆ†åŒºæ—¶ï¼ŒæŒ‰ç…§é¢„å…ˆå®šä¹‰çš„èšåˆæ¡ä»¶æ±‡æ€»æ•°æ®ã€‚</p></blockquote></li><li>CollapsingMergeTree<blockquote><p>æ”¯æŒè¡Œçº§æ•°æ®çš„æ›´æ–°å’Œåˆ é™¤ï¼Œé€šè¿‡æŒ‡å®šå­—æ®µ<code>CollapsingMergeTree({sign})</code>æ ‡è®°æ•°æ®è¡Œçš„çŠ¶æ€ï¼ˆçŠ¶æ€å€¼ï¼š1ï¼Œ-1ï¼‰ã€‚åˆ†åŒºåˆå¹¶æ—¶ï¼ŒåŒä¸€ä¸ªæ•°æ®åˆ†åŒºå†…signå€¼ä¸º1çš„æ•°æ®è¡Œä¼šå’Œä¸‹ä¸€è¡Œsignå€¼ä¸º-1çš„æŠµæ¶ˆåˆ é™¤ã€‚å¦‚æœå¹¶å‘å†™å…¥æ—¶åˆ™ä¼šå¯¼è‡´ä¹±åºé—®é¢˜ï¼Œå³signå€¼1å’Œ-1çš„æ•°æ®è¡Œå¹¶ä¸ç›¸ä¸´çš„é—®é¢˜ã€‚</p></blockquote></li><li>VersionedCollapsingMergeTree<blockquote><p><code>CollapsingMergeTree</code>å¼•æ“çš„è¿›é˜¶ç‰ˆã€‚é€šè¿‡<code>VersionedCollapsingMergeTree({sign},{version})</code>æ–°å¢versionå­—æ®µè§£å†³ä¹±åºé—®é¢˜ã€‚</p></blockquote></li><li>GraphiteMergeTree<blockquote><p>å­˜å‚¨æ—¶åºæ•°æ®åº“Graphiteçš„æ•°æ®ã€‚</p></blockquote></li></ul><h3 id="Logç³»åˆ—"><a href="#Logç³»åˆ—" class="headerlink" title="Logç³»åˆ—"></a>Logç³»åˆ—</h3><p>Logå¼•æ“é¢å‘çš„åº”ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯ï¼šå°æ•°æ®é‡ã€å¤šå†™å°‘æŸ¥ã€å•æ¬¡æŸ¥è¯¢æ•°æ®è¾ƒå¤§ã€‚</p><ul><li>StripLog<blockquote><p>æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è¯»å–æ–‡ä»¶ï¼ˆdata.binï¼‰ï¼Œæ•°æ®å†™å…¥æ—¶ä¼šå°†æ‰€æœ‰æ•°æ®åˆ—å­˜å‚¨åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p></blockquote></li><li>TinyLog<blockquote><p>æ•°æ®å†™å…¥æ—¶æ¯ä¸ªæ•°æ®åˆ—å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶ï¼ˆ{column}.binï¼‰ï¼Œä½†ä¸æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è¯»å–æ–‡ä»¶ã€‚</p></blockquote></li><li>Log<blockquote><p>æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è¯»å–æ–‡ä»¶ï¼Œå†™å…¥æ—¶æ¯ä¸ªæ•°æ®åˆ—å•ç‹¬å­˜å‚¨æ–‡ä»¶ã€‚</p></blockquote></li></ul><h3 id="Integrationsç³»åˆ—"><a href="#Integrationsç³»åˆ—" class="headerlink" title="Integrationsç³»åˆ—"></a>Integrationsç³»åˆ—</h3><p>è¯¥ç±»å¼•æ“æä¾›å¤šç§æ–¹å¼ä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆï¼ˆå¤–éƒ¨è¡¨ï¼‰ï¼Œæ”¯æŒåŒ…æ‹¬ä½†ä¸ä»…é™äºï¼š</p><ol><li>ODBC</li><li>JDBC</li><li>Mysql</li><li>MongoDB</li><li>HDFS</li><li>S3</li><li>Kafka</li><li>EmbeddedRocksDB</li><li>RabbitMQ</li><li>PostgreSQL</li><li>SQLite</li><li>Hive</li></ol><h3 id="Specialç±»"><a href="#Specialç±»" class="headerlink" title="Specialç±»"></a>Specialç±»</h3><p>è¿™ä¸ªåˆ†ç±»ä¸‹çš„å¼•æ“é€‚ç”¨äºå®šåˆ¶åŒ–çš„ä¸šåŠ¡åœºæ™¯ã€‚</p><ul><li>å†…å­˜ç±»<ol><li>Memory<blockquote><p>å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½†ä¸æä¾›æŒä¹…åŒ–æ“ä½œï¼Œé‡å¯æ•°æ®å°±è·‘ä¸¢äº†ã€‚</p></blockquote></li><li>Set<blockquote><p>é€‚ç”¨äºé›†åˆç±»å‹çš„æŸ¥è¯¢æ“ä½œï¼Œæ¯”å¦‚ï¼šinã€‚</p></blockquote></li><li>Join<blockquote><p>æœ›æ–‡ç”Ÿä¹‰ï¼Œä¸ºäº†è¿è¡¨æŸ¥è¯¢ã€‚</p></blockquote></li><li>Buffer<blockquote><p>é€šä¿—çš„è¯´åƒæ˜¯æ•°æ®è„é¡µè®¾ç½®ä¸€ä¸ªåˆ·æ–°é˜ˆå€¼ï¼Œè¾¾åˆ°å³åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</p></blockquote></li></ol></li><li>ä¸­é—´ä»¶ç±»<ol><li>Distributed<blockquote><p>è‡ªåŠ¨åˆ†ç‰‡ã€è‡ªåŠ¨å†™å…¥å’ŒæŸ¥è¯¢æ•°æ®ã€‚</p></blockquote></li><li>Dictionary<blockquote><p>è‡ªåŠ¨ä¸ºæ•°æ®å­—å…¸åˆ›å»ºæ•°æ®è¡¨ã€‚</p></blockquote></li><li>Merge<blockquote><p>åˆå¹¶å¤šä¸ªç›¸åŒè¡¨ç»“æ„çš„æŸ¥è¯¢ç»“æœã€‚</p></blockquote></li></ol></li><li>å…¶ä»–<ol><li>Null<blockquote><p>å†™å…¥çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒ â€¦ æš‚æ—¶ä¸æ‡‚ä»€ä¹ˆç”¨é€”ï¼Œå®˜æ–¹çš„æè¿°æ˜¯é€‚ç”¨äºè§†å›¾å±•ç¤ºã€‚</p></blockquote></li><li>Url<blockquote><p>é…åˆRESTfulæ¥å£ï¼Œæ“ä½œä¼šè½¬åŒ–ä¸ºï¼šinsert =&gt; postã€select =&gt; getã€‚</p></blockquote></li><li>Live View<blockquote><p><code>å®éªŒé˜¶æ®µçš„å¼•æ“</code>ï¼Œå¯¹äº‹ä»¶ç›‘å¬è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€‚é€‚ç”¨åœºæ™¯æ¯”å¦‚ï¼šè¯åˆ¸ç½‘ç«™ã€‚</p></blockquote></li></ol></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç®€å•çš„æµè§ˆäº†ClickHouseä¸åŒçš„æ•°æ®å¼•æ“ï¼Œæ¥ä¸‹æ¥ä¼šå­¦ä¹ å­˜å‚¨ç»“æ„å’Œç´¢å¼•æ–¹å¼ï¼ˆææ¸…æ¥šä¸ºä»€ä¹ˆæŸ¥è¯¢è¿™ä¹ˆå¿«ï¼‰ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ClickHouseæ˜¯ä¸ªç”±è€æ¯›å­å›½å†…å¸‚åœºä½¿ç”¨ç‡ç¬¬ä¸€çš„æœç´¢å¼•æ“Yandexå¼€æºçš„OLAPå‹åˆ—å¼æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;ä¹‹å‰å› ä¸ºä¸šåŠ¡æ¥è§¦åˆ°ClickHouseï¼Œä½†å› ä¸ºæ²¡æœ‰ç³»ç»Ÿçš„äº†è§£è¿‡å¯¼è‡´é‡è§ä¸ªå¾ˆå°çš„é—®é¢˜ã€èŠ±äº†å¤§é‡çš„æ—¶é—´ã€ç”¨äº†å¾ˆæŒ«çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ï¼Œç—›å®šæ€ç—›çš„æƒ…å†µä¸‹å†³å¿ƒç³»ç»Ÿçš„é€æ­¥å­¦ä¹ ä¸€ä¸‹ã€‚ClickHouseæ— è®ºæ˜¯å­˜å‚¨è¿˜æ˜¯ä½¿ç”¨æ–¹å¼éƒ½ä¸åŒç¨‹åº¦çš„å¼‚äºæˆ‘ä»¬å¸¸ç”¨çš„Mysqlï¼ŒPostgreSqlï¼ŒMssqlç­‰è¡Œå¼æ•°æ®åº“ï¼Œä½†å®ƒæ”¯æŒç»å¤§éƒ¨åˆ†çš„SQLè¯­æ³•ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="clickhouse" scheme="http://xupin.im/tags/clickhouse/"/>
    
  </entry>
  
  <entry>
    <title>ClickHouseå­¦ä¹ ç¬”è®° - æ•°ç»„æ‹†åˆ†å†åˆ†ç»„</title>
    <link href="http://xupin.im/2022/01/14/clickhouse-array-split-group/"/>
    <id>http://xupin.im/2022/01/14/clickhouse-array-split-group/</id>
    <published>2022-01-13T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.749Z</updated>
    
    <content type="html"><![CDATA[<p>ClickHouseæ˜¯ä¸ªç”±è€æ¯›å­å›½å†…å¸‚åœºä½¿ç”¨ç‡ç¬¬ä¸€çš„æœç´¢å¼•æ“Yandexå¼€æºçš„OLAPå‹åˆ—å¼æ•°æ®åº“ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æœ€è¿‘ï¼Œæ•°æ®åˆ†æé¡¹ç›®è¦åšä¸€ä¸ªå¹¿å‘Šç´ ææ¨å¹¿æˆæ•ˆåˆ†æåŠŸèƒ½ã€‚éœ€æ±‚è¯„å®¡ä¸‹æ¥å¤§æ¦‚æ˜¯é€šè¿‡ç»™å¹¿å‘Šç´ ææ‰“æ ‡ç­¾è¿›è¡Œåˆ†ç±»ï¼Œç„¶åæŒ‰æ ‡ç­¾çº¬åº¦è¿›è¡Œåˆ†ææ•°æ®ã€‚</p><h3 id="æ•°æ®åº“é€‰å‹"><a href="#æ•°æ®åº“é€‰å‹" class="headerlink" title="æ•°æ®åº“é€‰å‹"></a>æ•°æ®åº“é€‰å‹</h3><p>è¯¥é¡¹ç›®ä¹‹å‰çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨Elasticsearchï¼Œä½†æ€»æ˜¯æ„Ÿè§‰ESçš„DSLè¯­å¥è¿‡äºç¹çä¸åˆ©äºé˜…è¯»ä¸”å­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼Œå†…éƒ¨é’ˆå¯¹è¯¥é—®é¢˜è®¨è®ºä¹‹åé€‰ç”¨äº†åœ¨å¤§æ•°æ®å¤„ç†ä¸ŠåŒæ ·å‡ºè‰²çš„ClickHouseä½œä¸ºæ–°åŠŸèƒ½çš„æ•°æ®ä»“åº“ï¼ˆè¯•ç‚¹åŠŸèƒ½233ï¼‰ã€‚</p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>å› ä¸ºæ˜¯åˆ—å¼æ•°æ®åº“ï¼Œæ‰€ä»¥ä¸éœ€è¦éµå®ˆ<code>æ•°æ®åº“ä¸‰å¤§èŒƒå¼</code>ã€‚</p><a id="more"></a><p>ä¼ªè¡¨ç»“æ„ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> creative_daily_summary</span><br><span class="line">(</span><br><span class="line">    <span class="string">`date`</span> <span class="built_in">Date</span>,</span><br><span class="line">    <span class="string">`creative_id`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`tags`</span> <span class="built_in">Array</span>(<span class="keyword">String</span>),</span><br><span class="line">    <span class="string">`revenue`</span> Float64,</span><br><span class="line">    <span class="string">`cost`</span> Float64,</span><br><span class="line">    <span class="string">`impressions`</span> Int64,</span><br><span class="line">    <span class="string">`clicks`</span> Int64,</span><br><span class="line">    <span class="string">`installs`</span> Int64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">date</span></span><br><span class="line"><span class="keyword">SETTINGS</span> index_granularity = <span class="number">8192</span></span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå› ä¸ºè€ƒè™‘æ•°æ®å†—ä½™çš„é—®é¢˜ï¼Œæ ‡ç­¾å­˜å‚¨ä¸ºæ•°ç»„ç±»å‹ï¼ˆæ‰€ä»¥ä¹Ÿå°±å‡ºç°äº†è¿™ç¯‡ç¬”è®°ï¼‰ã€‚</p><p>å­˜å‚¨ä¸€äº›æ•°æ®ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> creative_daily_summary (<span class="string">`date`</span>,creative_id,tags,revenue,<span class="keyword">cost</span>,impressions,clicks,installs) <span class="keyword">VALUES</span> (<span class="string">'2022-01-07'</span>,<span class="string">'1721'</span>,[<span class="string">'ä»£å…¥/ä»£å…¥è§’è‰²/å±å¹•å¤–è§’è‰²'</span>,<span class="string">'ç©æ³•/è£…ä¿®/ä¿®ç†'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§'</span>,<span class="string">'ç©æ³•/å°æ¸¸æˆ/æƒ…æ™¯é€‰æ‹©(åºŸé™¤)'</span>,<span class="string">'å…ƒç´ /å…¶ä»–/äººæ‰‹'</span>,<span class="string">'å…ƒç´ /å…¶ä»–/è¡¨æƒ…åŒ…'</span>,<span class="string">'å…ƒç´ /åœºæ™¯/å†œåœº'</span>],<span class="number">0.0</span>,<span class="number">2.41</span>,<span class="number">2204</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> creative_daily_summary (<span class="string">`date`</span>,creative_id,tags,revenue,<span class="keyword">cost</span>,impressions,clicks,installs) <span class="keyword">VALUES</span> (<span class="string">'2022-01-07'</span>,<span class="string">'1721'</span>,[<span class="string">'ä»£å…¥/ä»£å…¥è§’è‰²/å±å¹•å¤–è§’è‰²'</span>,<span class="string">'ç©æ³•/è£…ä¿®/ä¿®ç†'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§'</span>,<span class="string">'ç©æ³•/å°æ¸¸æˆ/æƒ…æ™¯é€‰æ‹©(åºŸé™¤)'</span>,<span class="string">'å…ƒç´ /å…¶ä»–/äººæ‰‹'</span>,<span class="string">'å…ƒç´ /å…¶ä»–/è¡¨æƒ…åŒ…'</span>,<span class="string">'å…ƒç´ /åœºæ™¯/å†œåœº'</span>],<span class="number">0.0</span>,<span class="number">0.05</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> creative_daily_summary (<span class="string">`date`</span>,creative_id,tags,revenue,<span class="keyword">cost</span>,impressions,clicks,installs) <span class="keyword">VALUES</span> (<span class="string">'2022-01-08'</span>,<span class="string">'1788'</span>,[<span class="string">'ä»£å…¥/è§†è§’é•œå¤´/ç¬¬ä¸€äººç§°'</span>,<span class="string">'å‰§æƒ…/æƒ…æ„Ÿå…±é¸£/è‚²å„¿'</span>,<span class="string">'å‰§æƒ…/æ´åŠ©/è§£æ•‘'</span>,<span class="string">'å‰§æƒ…/å›°å¢ƒ/è‡ªç„¶ç¾å®³'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/æ‘˜æœ'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/å¼•æ°´'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§'</span>,<span class="string">'ç©æ³•/æ”¹å˜åœ°å½¢/æŒ–æ²³é“'</span>],<span class="number">0.0</span>,<span class="number">130.64</span>,<span class="number">31868</span>,<span class="number">63</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> creative_daily_summary (<span class="string">`date`</span>,creative_id,tags,revenue,<span class="keyword">cost</span>,impressions,clicks,installs) <span class="keyword">VALUES</span> (<span class="string">'2022-01-09'</span>,<span class="string">'1788'</span>,[<span class="string">'ä»£å…¥/è§†è§’é•œå¤´/ç¬¬ä¸€äººç§°'</span>,<span class="string">'å‰§æƒ…/æƒ…æ„Ÿå…±é¸£/è‚²å„¿'</span>,<span class="string">'å‰§æƒ…/æ´åŠ©/è§£æ•‘'</span>,<span class="string">'å‰§æƒ…/å›°å¢ƒ/è‡ªç„¶ç¾å®³'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/æ‘˜æœ'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/å¼•æ°´'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§'</span>,<span class="string">'ç©æ³•/æ”¹å˜åœ°å½¢/æŒ–æ²³é“'</span>],<span class="number">0.0</span>,<span class="number">0.04</span>,<span class="number">76</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> creative_daily_summary (<span class="string">`date`</span>,creative_id,tags,revenue,<span class="keyword">cost</span>,impressions,clicks,installs) <span class="keyword">VALUES</span> (<span class="string">'2022-01-10'</span>,<span class="string">'2124'</span>,[<span class="string">'ä»£å…¥/ä»£å…¥è§’è‰²/å›ºå®šè§’è‰²-å¥³æ€§'</span>,<span class="string">'å‰§æƒ…/æƒ…æ„Ÿå…±é¸£/è´­ç‰©ç„¦è™‘'</span>,<span class="string">'ç›®çš„/ç›®çš„/æ‹‰æ–°'</span>,<span class="string">'å½¢å¼/æŠ€æœ¯å½¢å¼/3D'</span>,<span class="string">'å…ƒç´ /åœºæ™¯/åŸå¸‚è¡—é“'</span>,<span class="string">'å…ƒç´ /åœºæ™¯/å®¤å†…å…¬å…±åœºæ‰€'</span>],<span class="number">0.0</span>,<span class="number">0.02</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p><table><thead><tr><th>date</th><th>creative_id</th><th>tags</th><th>revenue</th><th>cost</th><th>impressions</th><th>clicks</th><th>installs</th></tr></thead><tbody><tr><td>2022-01-07</td><td>1721</td><td>[â€˜ä»£å…¥/ä»£å…¥è§’è‰²/å±å¹•å¤–è§’è‰²â€™,â€™ç©æ³•/è£…ä¿®/ä¿®ç†â€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§â€™,â€™ç©æ³•/å°æ¸¸æˆ/æƒ…æ™¯é€‰æ‹©(åºŸé™¤)â€™,â€™å…ƒç´ /å…¶ä»–/äººæ‰‹â€™,â€™å…ƒç´ /å…¶ä»–/è¡¨æƒ…åŒ…â€™,â€™å…ƒç´ /åœºæ™¯/å†œåœºâ€™]</td><td>0.0</td><td>2.41</td><td>2204</td><td>0</td><td>0</td></tr><tr><td>2022-01-07</td><td>1721</td><td>[â€˜ä»£å…¥/ä»£å…¥è§’è‰²/å±å¹•å¤–è§’è‰²â€™,â€™ç©æ³•/è£…ä¿®/ä¿®ç†â€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§â€™,â€™ç©æ³•/å°æ¸¸æˆ/æƒ…æ™¯é€‰æ‹©(åºŸé™¤)â€™,â€™å…ƒç´ /å…¶ä»–/äººæ‰‹â€™,â€™å…ƒç´ /å…¶ä»–/è¡¨æƒ…åŒ…â€™,â€™å…ƒç´ /åœºæ™¯/å†œåœºâ€™]</td><td>0.0</td><td>0.05</td><td>9</td><td>1</td><td>0</td></tr><tr><td>2022-01-08</td><td>1788</td><td>[â€˜ä»£å…¥/è§†è§’é•œå¤´/ç¬¬ä¸€äººç§°â€™,â€™å‰§æƒ…/æƒ…æ„Ÿå…±é¸£/è‚²å„¿â€™,â€™å‰§æƒ…/æ´åŠ©/è§£æ•‘â€™,â€™å‰§æƒ…/å›°å¢ƒ/è‡ªç„¶ç¾å®³â€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/æ‘˜æœâ€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/å¼•æ°´â€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§â€™,â€™ç©æ³•/æ”¹å˜åœ°å½¢/æŒ–æ²³é“â€™]</td><td>0.0</td><td>130.64</td><td>31868</td><td>63</td><td>7</td></tr><tr><td>2022-01-09</td><td>1788</td><td>[â€˜ä»£å…¥/è§†è§’é•œå¤´/ç¬¬ä¸€äººç§°â€™,â€™å‰§æƒ…/æƒ…æ„Ÿå…±é¸£/è‚²å„¿â€™,â€™å‰§æƒ…/æ´åŠ©/è§£æ•‘â€™,â€™å‰§æƒ…/å›°å¢ƒ/è‡ªç„¶ç¾å®³â€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/æ‘˜æœâ€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/å¼•æ°´â€™,â€™ç©æ³•/æ¨¡æ‹Ÿç»è¥/å»ºç­‘å‡çº§â€™,â€™ç©æ³•/æ”¹å˜åœ°å½¢/æŒ–æ²³é“â€™]</td><td>0.0</td><td>0.04</td><td>76</td><td>0</td><td>0</td></tr><tr><td>2022-01-10</td><td>2124</td><td>[â€˜ä»£å…¥/ä»£å…¥è§’è‰²/å›ºå®šè§’è‰²-å¥³æ€§â€™,â€™å‰§æƒ…/æƒ…æ„Ÿå…±é¸£/è´­ç‰©ç„¦è™‘â€™,â€™ç›®çš„/ç›®çš„/æ‹‰æ–°â€™,â€™å½¢å¼/æŠ€æœ¯å½¢å¼/3Dâ€™,â€™å…ƒç´ /åœºæ™¯/åŸå¸‚è¡—é“â€™,â€™å…ƒç´ /åœºæ™¯/å®¤å†…å…¬å…±åœºæ‰€â€™]</td><td>0.0</td><td>0.02</td><td>5</td><td>0</td><td>0</td></tr></tbody></table><h3 id="æ£€ç´¢æ•ˆæœ"><a href="#æ£€ç´¢æ•ˆæœ" class="headerlink" title="æ£€ç´¢æ•ˆæœ"></a>æ£€ç´¢æ•ˆæœ</h3><p>äº§å“æœŸæœ›å®ç°çš„éœ€æ±‚æ˜¯ç»Ÿè®¡â€œæ ‡ç­¾â€çš„æ•°æ®ï¼Œä½†è¿™ä¸ªâ€œæ ‡ç­¾â€å¹¶ä¸æ˜¯å®Œæ•´çš„æ ‡ç­¾ï¼ˆä»£å…¥/ä»£å…¥è§’è‰²/å±å¹•å¤–è§’è‰²ï¼‰ï¼Œè€Œæ˜¯æ ‡ç­¾çš„ä¸€éƒ¨åˆ†ï¼ˆæ¯”å¦‚ä»£å…¥ã€ä»£å…¥è§’è‰²ã€å±å¹•å¤–è§’è‰²ç­‰ï¼Œæ‹†åˆ†å¼€æ¥çš„ï¼‰ï¼ŒåŒæ—¶ä¸€ä¸ªå¹¿å‘Šç´ æå¦‚æœæ»¡è¶³å¤šä¸ªæ ‡ç­¾å³æ‹†åˆ†æˆå¤šæ¡æ•°æ®ã€‚</p><ul><li>æ€è·¯1</li></ul><p>åˆ©ç”¨å­æŸ¥è¯¢å†åˆ†ç»„ï¼Œè¿™æ ·ä¼šæœ‰æ•°æ®é‡å¤çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦å†å¥—ä¸€å±‚æŸ¥è¯¢å»é‡ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">date</span>,</span><br><span class="line">tag,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">cost</span>) <span class="keyword">as</span> <span class="keyword">cost</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">date</span>,</span><br><span class="line">tag,</span><br><span class="line">creative_id,</span><br><span class="line">sumDistinct(<span class="keyword">cost</span>) <span class="keyword">as</span> <span class="keyword">cost</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">date</span>,</span><br><span class="line">arrayJoin(tags) <span class="keyword">as</span> t,</span><br><span class="line"><span class="keyword">concat</span>(arrayElement(splitByChar(<span class="string">'/'</span>,t),<span class="number">1</span>),<span class="string">'/'</span>,arrayElement(splitByChar(<span class="string">'/'</span>,t),<span class="number">2</span>)) <span class="keyword">as</span> tag,</span><br><span class="line">creative_id,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">cost</span>) <span class="keyword">as</span> <span class="keyword">cost</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">creative_daily_summary</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">tag <span class="keyword">in</span> (<span class="string">'ä»£å…¥/ä»£å…¥è§’è‰²'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥'</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">t,</span><br><span class="line">creative_id,</span><br><span class="line"><span class="built_in">date</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">tag,</span><br><span class="line">creative_id,</span><br><span class="line"><span class="built_in">date</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">tag,</span><br><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure></p><table><thead><tr><th>date</th><th>tag</th><th>cost</th></tr></thead><tbody><tr><td>2022-01-08</td><td>ç©æ³•/æ¨¡æ‹Ÿç»è¥</td><td>130.64</td></tr><tr><td>2022-01-07</td><td>ä»£å…¥/ä»£å…¥è§’è‰²</td><td>2.46</td></tr><tr><td>2022-01-10</td><td>ä»£å…¥/ä»£å…¥è§’è‰²</td><td>0.02</td></tr><tr><td>2022-01-09</td><td>ç©æ³•/æ¨¡æ‹Ÿç»è¥</td><td>0.04</td></tr><tr><td>2022-01-07</td><td>ç©æ³•/æ¨¡æ‹Ÿç»è¥</td><td>2.46</td></tr></tbody></table><ul><li>æ€è·¯2</li></ul><p>å› ä¸ºæ·±æ„Ÿç¬¬ä¸€ç§æ–¹å¼å¤ªæŒ«ï¼Œæ•ˆç‡ä¸é«˜ä¸”æ¯«æ— ç¾æ„Ÿï¼ˆæœ€é‡è¦çš„æ˜¯æ€»æ„Ÿè§‰è§£å†³çš„æ–¹å‘ä¸å¯¹ï¼‰ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">date</span>,</span><br><span class="line">arrayJoin(arrayDistinct(arrayMap(tag -&gt; <span class="keyword">concat</span>(arrayElement(splitByChar(<span class="string">'/'</span>,tag),<span class="number">1</span>),<span class="string">'/'</span>,arrayElement(splitByChar(<span class="string">'/'</span>,tag),<span class="number">2</span>)),tags))) <span class="keyword">as</span> tag,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">cost</span>) <span class="keyword">as</span> <span class="keyword">cost</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">creative_daily_summary</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"> tag <span class="keyword">in</span>(<span class="string">'ä»£å…¥/ä»£å…¥è§’è‰²'</span>,<span class="string">'ç©æ³•/æ¨¡æ‹Ÿç»è¥'</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line"><span class="built_in">date</span>,</span><br><span class="line">tag</span><br></pre></td></tr></table></figure></p><table><thead><tr><th>date</th><th>tag</th><th>cost</th></tr></thead><tbody><tr><td>2022-01-10</td><td>ä»£å…¥/ä»£å…¥è§’è‰²</td><td>0.02</td></tr><tr><td>2022-01-07</td><td>ä»£å…¥/ä»£å…¥è§’è‰²</td><td>2.46</td></tr><tr><td>2022-01-08</td><td>ç©æ³•/æ¨¡æ‹Ÿç»è¥</td><td>130.64</td></tr><tr><td>2022-01-07</td><td>ç©æ³•/æ¨¡æ‹Ÿç»è¥</td><td>2.46</td></tr><tr><td>2022-01-09</td><td>ç©æ³•/æ¨¡æ‹Ÿç»è¥</td><td>0.04</td></tr></tbody></table><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ¥è§¦æ–°çš„äº‹ç‰©è¿˜æ˜¯è¦æŠ±ç€è°¦é€Šçš„æ€åº¦å…ˆç³»ç»Ÿçš„äº†è§£ä¸€ä¸‹ä¼˜åŠ¿å’Œç¼ºç‚¹ï¼Œä¸ç„¶è§£å†³é—®é¢˜æ—¶æ€»ä¼šé™·å…¥å®šå¼æ€ç»´çš„æ€ªåœˆï¼ˆåœ¨é”™è¯¯çš„æ–¹å‘æµªè´¹æ—¶é—´å’Œç²¾åŠ›ï¼‰ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ClickHouseæ˜¯ä¸ªç”±è€æ¯›å­å›½å†…å¸‚åœºä½¿ç”¨ç‡ç¬¬ä¸€çš„æœç´¢å¼•æ“Yandexå¼€æºçš„OLAPå‹åˆ—å¼æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;æœ€è¿‘ï¼Œæ•°æ®åˆ†æé¡¹ç›®è¦åšä¸€ä¸ªå¹¿å‘Šç´ ææ¨å¹¿æˆæ•ˆåˆ†æåŠŸèƒ½ã€‚éœ€æ±‚è¯„å®¡ä¸‹æ¥å¤§æ¦‚æ˜¯é€šè¿‡ç»™å¹¿å‘Šç´ ææ‰“æ ‡ç­¾è¿›è¡Œåˆ†ç±»ï¼Œç„¶åæŒ‰æ ‡ç­¾çº¬åº¦è¿›è¡Œåˆ†ææ•°æ®ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ•°æ®åº“é€‰å‹&quot;&gt;&lt;a href=&quot;#æ•°æ®åº“é€‰å‹&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®åº“é€‰å‹&quot;&gt;&lt;/a&gt;æ•°æ®åº“é€‰å‹&lt;/h3&gt;&lt;p&gt;è¯¥é¡¹ç›®ä¹‹å‰çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨Elasticsearchï¼Œä½†æ€»æ˜¯æ„Ÿè§‰ESçš„DSLè¯­å¥è¿‡äºç¹çä¸åˆ©äºé˜…è¯»ä¸”å­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼Œå†…éƒ¨é’ˆå¯¹è¯¥é—®é¢˜è®¨è®ºä¹‹åé€‰ç”¨äº†åœ¨å¤§æ•°æ®å¤„ç†ä¸ŠåŒæ ·å‡ºè‰²çš„ClickHouseä½œä¸ºæ–°åŠŸèƒ½çš„æ•°æ®ä»“åº“ï¼ˆè¯•ç‚¹åŠŸèƒ½233ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ•°æ®ç»“æ„&quot;&gt;&lt;a href=&quot;#æ•°æ®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®ç»“æ„&quot;&gt;&lt;/a&gt;æ•°æ®ç»“æ„&lt;/h3&gt;&lt;p&gt;å› ä¸ºæ˜¯åˆ—å¼æ•°æ®åº“ï¼Œæ‰€ä»¥ä¸éœ€è¦éµå®ˆ&lt;code&gt;æ•°æ®åº“ä¸‰å¤§èŒƒå¼&lt;/code&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="clickhouse" scheme="http://xupin.im/tags/clickhouse/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - æ§åˆ¶åç¨‹æ•°é‡</title>
    <link href="http://xupin.im/2021/12/03/go-coroutine-number/"/>
    <id>http://xupin.im/2021/12/03/go-coroutine-number/</id>
    <published>2021-12-02T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.750Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰å› ä¸ºéœ€è¦å¹¶å‘åŒæ­¥å•å¼ æ•°æ®è¡¨çš„è„šæœ¬ï¼Œå› ä¸ºè®¾ç½®åç¨‹æ•°é‡å¤ªå¤šè¿æ¥æ•°è¿‡é«˜å¯¼è‡´æœåŠ¡å®•æœº â€¦ å¾—ä¸å¿å¤±ï¼Œæ‰€ä»¥æƒ³æ€ä¹ˆæ§åˆ¶ä¸€ä¸‹åç¨‹æ•°é‡</p><h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>åˆ©ç”¨channelé˜»å¡ï¼Œä¸Šä»£ç ï¼š</p><a id="more"></a><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å…è®¸æœ€å¤§åç¨‹æ•°</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">5</span>)</span><br><span class="line">wg := &amp;sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line">ch &lt;- i <span class="comment">// ché•¿åº¦ç­‰äº5æ—¶ï¼Œé˜»å¡ç­‰å¾…</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">fmt.Println(<span class="string">"è®°å½•æ‰§è¡Œ "</span>, i)</span><br><span class="line">time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">fmt.Println(<span class="string">"æ‰§è¡Œå®Œæ¯• "</span>, &lt;-ch)</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†å°±æ˜¯åˆ©ç”¨<code>channel</code>é€šé“çš„ç‰¹æ€§ï¼Œå½“é€šé“æ»¡çš„æ—¶å€™ç»§ç»­å‘é€šé“ä¸¢æ•°æ®ä¼šé˜»å¡ä»£ç æ‰§è¡Œã€‚</p><p>å°è£…ä¸€ä¸‹:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Worker <span class="keyword">struct</span> &#123;</span><br><span class="line">ch <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">wg *sync.WaitGroup</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å…è®¸æœ€å¤§åç¨‹æ•°</span></span><br><span class="line">worker := NewWorker(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">worker.Run(i)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"è®°å½•æ‰§è¡Œ "</span>, i)</span><br><span class="line">time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">key := worker.Done()</span><br><span class="line">fmt.Println(<span class="string">"æ‰§è¡Œå®Œæ¯• "</span>, key)</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">worker.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWorker</span><span class="params">(size <span class="keyword">int</span>)</span> *<span class="title">Worker</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Worker&#123;</span><br><span class="line">ch: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, size),</span><br><span class="line">wg: &amp;sync.WaitGroup&#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Run</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">w.ch &lt;- key</span><br><span class="line">w.wg.Add(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Done</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">key := &lt;-w.ch</span><br><span class="line">w.wg.Done()</span><br><span class="line"><span class="keyword">return</span> key</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Wait</span><span class="params">()</span></span> &#123;</span><br><span class="line">w.wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="Goroutine-Pool"><a href="#Goroutine-Pool" class="headerlink" title="Goroutine Pool"></a>Goroutine Pool</h3><p>æ„Ÿè§‰Duckä¸å¿… â€¦ æ—¥åå†è°ˆ</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰å› ä¸ºéœ€è¦å¹¶å‘åŒæ­¥å•å¼ æ•°æ®è¡¨çš„è„šæœ¬ï¼Œå› ä¸ºè®¾ç½®åç¨‹æ•°é‡å¤ªå¤šè¿æ¥æ•°è¿‡é«˜å¯¼è‡´æœåŠ¡å®•æœº â€¦ å¾—ä¸å¿å¤±ï¼Œæ‰€ä»¥æƒ³æ€ä¹ˆæ§åˆ¶ä¸€ä¸‹åç¨‹æ•°é‡&lt;/p&gt;
&lt;h3 id=&quot;Channel&quot;&gt;&lt;a href=&quot;#Channel&quot; class=&quot;headerlink&quot; title=&quot;Channel&quot;&gt;&lt;/a&gt;Channel&lt;/h3&gt;&lt;p&gt;åˆ©ç”¨channelé˜»å¡ï¼Œä¸Šä»£ç ï¼š&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="golang" scheme="http://xupin.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - å¹¶å‘æŸ¥è¯¢å•è¡¨</title>
    <link href="http://xupin.im/2021/12/02/go-coroutine-query/"/>
    <id>http://xupin.im/2021/12/02/go-coroutine-query/</id>
    <published>2021-12-01T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.750Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ¥è§¦ä¸€ä¸ªé¡¹ç›®ï¼Œéœ€è¦æ¯å¤©å®šæ—¶æŠŠPgSqlä¸€å¼ æ•°æ®é‡è¶…å¤§çš„æ•°æ®è¡¨åŒæ­¥åˆ°ClickHouse æ€è€ƒè¿™ç§åœºæ™¯ä¸‹æ€ä¹ˆæé«˜åŒæ­¥é€Ÿåº¦ã€‚</p><h3 id="æŒ‰ä¸»é”®åˆ†é¡µ"><a href="#æŒ‰ä¸»é”®åˆ†é¡µ" class="headerlink" title="æŒ‰ä¸»é”®åˆ†é¡µ"></a>æŒ‰ä¸»é”®åˆ†é¡µ</h3><p>æ€è·¯</p><blockquote><p>æŒ‰ç…§ä¸»é”®æ’åºåˆ†åŒºé—´æŸ¥è¯¢</p></blockquote><a id="more"></a><p>ä»£ç <br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"math"</span></span><br><span class="line"><span class="string">"strconv"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">maxId := <span class="number">203202</span></span><br><span class="line">pageNum := <span class="number">1500</span></span><br><span class="line">num, _ := strconv.ParseFloat(fmt.Sprintf(<span class="string">"%.2f"</span>, <span class="keyword">float64</span>(maxId)/<span class="keyword">float64</span>(pageNum)), <span class="number">64</span>)</span><br><span class="line">maxPage := <span class="keyword">int</span>(math.Ceil(num))</span><br><span class="line"></span><br><span class="line">wg := &amp;sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; maxPage; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">startId := (i * pageNum)</span><br><span class="line">endId := startId + pageNum</span><br><span class="line"><span class="keyword">if</span> endId &gt; maxId &#123;</span><br><span class="line">endId = maxId</span><br><span class="line">&#125;</span><br><span class="line">sql := fmt.Sprintf(<span class="string">"select * from logs where id &gt;= %d and id &lt;= %d"</span>, startId, endId)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"ç¬¬ %d é¡µ SQL: %s\n"</span>, i+<span class="number">1</span>, sql)</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>ä¼˜ç‚¹</p><blockquote><p>å‘½ä¸­ç´¢å¼•æŸ¥è¯¢</p></blockquote></li><li><p>ç¼ºç‚¹</p><blockquote><p>PgSqlè®¾ç½®ä¸»é”®ä¼šå½±å“æ’å…¥å’ŒæŸ¥è¯¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆPgSqlæ•°æ®è¡¨ä¸€èˆ¬ä¸è®¾ç½®ä¸»é”®çš„åŸå› </p></blockquote></li></ul><h3 id="æ¸¸æ ‡"><a href="#æ¸¸æ ‡" class="headerlink" title="æ¸¸æ ‡"></a>æ¸¸æ ‡</h3><p>æ€è·¯</p><blockquote><p>å¤šä¸ªåç¨‹è·å–åŒä¸€ä¸ªæ¸¸æ ‡çš„æ•°æ®</p></blockquote><p>ä»£ç <br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"project/postgresql"</span></span><br><span class="line"><span class="string">"math"</span></span><br><span class="line"><span class="string">"strconv"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// pgSql client</span></span><br><span class="line">cli := postgresql.GetClient()</span><br><span class="line"></span><br><span class="line"><span class="comment">// trx</span></span><br><span class="line">tx, err := cli.Begin()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—å¤šå°‘ä¸ªcoroutine</span></span><br><span class="line">cnt := <span class="number">0</span></span><br><span class="line">cli.QueryRow(<span class="string">"select count(*) from logs"</span>).Scan(&amp;cnt)</span><br><span class="line">pageNum := <span class="number">1500</span></span><br><span class="line">num, _ := strconv.ParseFloat(fmt.Sprintf(<span class="string">"%.2f"</span>, <span class="keyword">float64</span>(cnt)/<span class="keyword">float64</span>(pageNum)), <span class="number">64</span>)</span><br><span class="line">maxPage := <span class="keyword">int</span>(math.Ceil(num))</span><br><span class="line"></span><br><span class="line"><span class="comment">// cursor</span></span><br><span class="line">cursorName := <span class="string">"cursor_name"</span></span><br><span class="line">cursorQuery := <span class="string">"select * from logs"</span></span><br><span class="line">tx.Query(<span class="string">"DECLARE "</span> + cursorName + <span class="string">" CURSOR FOR "</span> + cursorQuery)</span><br><span class="line"></span><br><span class="line">wg := &amp;sync.WaitGroup&#123;&#125;</span><br><span class="line">lock := &amp;sync.Mutex&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= maxPage; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº’æ–¥é”</span></span><br><span class="line">lock.Lock()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯æ¬¡å–&#123;pageNum&#125;æ¡</span></span><br><span class="line">rows, err := tx.Query(<span class="string">"FETCH FORWARD "</span> + strconv.Itoa(pageNum) + <span class="string">" FROM "</span> + cursorName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> rows.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†è¿­ä»£é€»è¾‘</span></span><br><span class="line"><span class="comment">// for rows.Next() &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">fmt.Printf(<span class="string">"ç¬¬ %d é¡µ ç»“æœ: %v\n"</span>, i, rows)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£é”</span></span><br><span class="line"><span class="comment">// TODO ä¸€å®šè¦è¿­ä»£å®Œæˆåå†è§£é”</span></span><br><span class="line">lock.Unlock()</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">tx.Commit()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>ä¼˜ç‚¹</p><blockquote><p>èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´ï¼Œå¯é æ€§è¾ƒé«˜</p></blockquote></li><li><p>ç¼ºç‚¹</p><blockquote><p>å¿…é¡»ç­‰å¾…ç»“æœé›†è¿­ä»£å®Œæˆåæ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ª</p></blockquote></li></ul><h3 id="ä¸ºå•¥ä¸ç”¨-offset-limit"><a href="#ä¸ºå•¥ä¸ç”¨-offset-limit" class="headerlink" title="ä¸ºå•¥ä¸ç”¨ offset, limit"></a>ä¸ºå•¥ä¸ç”¨ offset, limit</h3><p>å› ä¸º<code>offset, limit</code>ä¼šæ‰«å…¨è¡¨ 233</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘æ¥è§¦ä¸€ä¸ªé¡¹ç›®ï¼Œéœ€è¦æ¯å¤©å®šæ—¶æŠŠPgSqlä¸€å¼ æ•°æ®é‡è¶…å¤§çš„æ•°æ®è¡¨åŒæ­¥åˆ°ClickHouse æ€è€ƒè¿™ç§åœºæ™¯ä¸‹æ€ä¹ˆæé«˜åŒæ­¥é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æŒ‰ä¸»é”®åˆ†é¡µ&quot;&gt;&lt;a href=&quot;#æŒ‰ä¸»é”®åˆ†é¡µ&quot; class=&quot;headerlink&quot; title=&quot;æŒ‰ä¸»é”®åˆ†é¡µ&quot;&gt;&lt;/a&gt;æŒ‰ä¸»é”®åˆ†é¡µ&lt;/h3&gt;&lt;p&gt;æ€è·¯&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æŒ‰ç…§ä¸»é”®æ’åºåˆ†åŒºé—´æŸ¥è¯¢&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="golang" scheme="http://xupin.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Pythonå­¦ä¹ ç¬”è®° - yield</title>
    <link href="http://xupin.im/2021/11/22/python-yield/"/>
    <id>http://xupin.im/2021/11/22/python-yield/</id>
    <published>2021-11-21T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.755Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç¨‹åºä¸­é™¤äº†è¿­ä»£å™¨è¿˜æœ‰ç”Ÿæˆå™¨å‡æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œè¿­ä»£å™¨æ˜¯é€šè¿‡ç§»åŠ¨æ¸¸æ ‡æ¥éå†æ•°æ®ï¼Œé‚£ç”Ÿæˆå™¨å‘¢</p><h3 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h3><p>ç”Ÿæˆå™¨åˆ›å»ºæ–¹å¼ï¼ˆpythonï¼‰</p><ul><li>(è¡¨è¾¾å¼)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">generator = (i <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) // è¿™é‡Œæœ‰åŒºåˆ«äº [i <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line">print(generator)  <span class="comment"># &lt;generator object &lt;genexpr&gt; at 0x10c312870&gt;</span></span><br><span class="line">print(next(generator))  <span class="comment"># 1</span></span><br><span class="line">print(next(generator))  <span class="comment"># 2</span></span><br><span class="line">print(next(generator))  <span class="comment"># 3</span></span><br><span class="line">print(next(generator))  <span class="comment"># raise StopIteration</span></span><br></pre></td></tr></table></figure></li></ul><a id="more"></a><ul><li>yield<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getGenerator</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]: </span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">    print(<span class="string">"done"</span>)</span><br><span class="line"></span><br><span class="line">generator = getGenerator()</span><br><span class="line">print(generator)  <span class="comment"># &lt;generator object getGenerator at 0x10c3128c0&gt;</span></span><br><span class="line">print(next(generator))  <span class="comment"># 1</span></span><br><span class="line">print(next(generator))  <span class="comment"># 2</span></span><br><span class="line">print(next(generator))  <span class="comment"># 3</span></span><br><span class="line">print(next(generator))  <span class="comment"># done &amp; raise StopIteration</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å½“<code>yield</code>å‡ºç°åœ¨å‡½æ•°ä¸­ï¼ˆyieldåªèƒ½å®šä¹‰åœ¨å‡½æ•°ä¸­ï¼‰ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ä¸ä¼šç›´æ¥è¿è¡Œå‡½æ•°è€Œæ˜¯è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨ï¼ˆå®ç°äº†è¿­ä»£å™¨åè®®çš„å¯¹è±¡ï¼‰ã€‚</p><ul><li>ç¬¬ä¸€æ¬¡è°ƒç”¨<code>next()</code>å‡½æ•°ï¼Œé‡è§<code>yield</code>åœä¸‹è¿”å›yieldåé¢çš„å†…å®¹</li><li>å†æ¬¡è°ƒç”¨<code>next()</code>å‡½æ•°ï¼Œä»ä¸Šæ¬¡yieldè¯­å¥å¤„æ¢å¤ï¼Œå¦‚æœè¿˜å­˜åœ¨<code>yield</code>åˆ™æ­£å¸¸æ‰§è¡Œï¼Œå¦åˆ™å‡½æ•°ä½“æ‰§è¡Œå®Œæ¯•æŠ›å‡º<code>StopIteration</code>å¼‚å¸¸<blockquote><p>é€šä¿—çš„æ¥è¯´ï¼šyieldç›¸å½“äºreturnï¼Œä½†yieldä¼šè®°ä½è¿™ä¸ªè¿”å›ä½ç½®ï¼Œå†æ¬¡æ‰§è¡Œä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ã€‚</p></blockquote></li></ul><p>ç”Ÿæˆå™¨ä¸­<code>send()</code>æ˜¯å’Œ<code>next()</code>ä¸€æ ·èƒ½è®©ç”Ÿæˆå™¨æ¢å¤æ‰§è¡Œçš„å‡½æ•°ï¼Œä¸åŒçš„æ˜¯<code>send(arg)</code>å‡½æ•°å¯ä»¥ä¼ é€’å‚æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getGenerator</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]:</span><br><span class="line">        print(<span class="string">"before: "</span>, i)</span><br><span class="line">        t = <span class="keyword">yield</span> i</span><br><span class="line">        print(<span class="string">"after: "</span>, i, t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generator = getGenerator()</span><br><span class="line">print(generator)  <span class="comment"># &lt;generator object getGenerator at 0x10c3128c0&gt;</span></span><br><span class="line">generator.send(<span class="literal">None</span>)  <span class="comment"># before:  1</span></span><br><span class="line">next(generator)  <span class="comment"># after:  1 None &amp; before:  2</span></span><br><span class="line">generator.send(<span class="number">22</span>)  <span class="comment"># after:  2 22 &amp; before:  3</span></span><br><span class="line">generator.send(<span class="number">33</span>)  <span class="comment"># after:  3 33 &amp; raise StopIteration</span></span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ç¬¬ä¸€æ¬¡è°ƒç”¨ç”Ÿæˆå™¨ä¸å¯ä»¥ç›´æ¥ä¼ é€’éNoneå‚æ•°ï¼Œå› ä¸ºyieldè¿˜æœªå‡†å¤‡å¥½ï¼ˆæ— è¿”å›å€¼ï¼‰ï¼Œå¯ä»¥<code>generator.send(None)</code>æˆ–<code>next(generator)</code>ã€‚å…·ä½“å¯ä»¥å‚è€ƒpythonæºç :<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const char *msg = <span class="string">"can't send non-None value to a "</span></span><br><span class="line">                              <span class="string">"just-started generator"</span>;</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/python/cpython/blob/3.9/Objects/genobject.c#L181" target="_blank" rel="noopener">https://github.com/python/cpython/blob/3.9/Objects/genobject.c#L181</a></p><h3 id="è¿­ä»£åè®®"><a href="#è¿­ä»£åè®®" class="headerlink" title="è¿­ä»£åè®®"></a>è¿­ä»£åè®®</h3><p>ä»€ä¹ˆæ˜¯å¯è¿­ä»£åè®®ï¼Ÿ</p><blockquote><p>å½“å¤„ç†è¿­ä»£æ—¶é¦–å…ˆè°ƒç”¨<code>å¯è¿­ä»£å¯¹è±¡.__iter__()</code>ï¼Œè¿”å›è¿­ä»£å™¨ã€‚ç„¶åé€šè¿‡<code>è¿­ä»£å™¨.__next__()</code>è·å–è¿­ä»£å™¨çš„å…ƒç´ ï¼Œç›´è‡³æŠ›å‡º<code>StopIteration</code>ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"look at me"</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.index &lt; len(self.data):</span><br><span class="line">            val = self.data[self.index]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generator = CustomGenerator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print(generator)  <span class="comment"># &lt;__main__.CustomGenerator object at 0x1047161f0&gt;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> generator:</span><br><span class="line">    print(x)</span><br><span class="line"><span class="comment"># look at me</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">print(next(generator))  <span class="comment"># raise StopIteration</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ç¨‹åºä¸­é™¤äº†è¿­ä»£å™¨è¿˜æœ‰ç”Ÿæˆå™¨å‡æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œè¿­ä»£å™¨æ˜¯é€šè¿‡ç§»åŠ¨æ¸¸æ ‡æ¥éå†æ•°æ®ï¼Œé‚£ç”Ÿæˆå™¨å‘¢&lt;/p&gt;
&lt;h3 id=&quot;ç”Ÿæˆå™¨&quot;&gt;&lt;a href=&quot;#ç”Ÿæˆå™¨&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿæˆå™¨&quot;&gt;&lt;/a&gt;ç”Ÿæˆå™¨&lt;/h3&gt;&lt;p&gt;ç”Ÿæˆå™¨åˆ›å»ºæ–¹å¼ï¼ˆpythonï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(è¡¨è¾¾å¼)&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;generator = (i &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) // è¿™é‡Œæœ‰åŒºåˆ«äº [i &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(generator)  &lt;span class=&quot;comment&quot;&gt;# &amp;lt;generator object &amp;lt;genexpr&amp;gt; at 0x10c312870&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(next(generator))  &lt;span class=&quot;comment&quot;&gt;# 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(next(generator))  &lt;span class=&quot;comment&quot;&gt;# 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(next(generator))  &lt;span class=&quot;comment&quot;&gt;# 3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(next(generator))  &lt;span class=&quot;comment&quot;&gt;# raise StopIteration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="python" scheme="http://xupin.im/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - cursor</title>
    <link href="http://xupin.im/2021/11/18/mysql-cursor/"/>
    <id>http://xupin.im/2021/11/18/mysql-cursor/</id>
    <published>2021-11-17T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.752Z</updated>
    
    <content type="html"><![CDATA[<p>æ¸¸æ ‡ï¼ˆcursorï¼‰æ˜¯å¯ä»¥ä»æ•°æ®åº“æ£€ç´¢ç»“æœé›†ä¸­æ¯æ¬¡æå–ä¸€è¡Œè®°å½•çš„æœºåˆ¶ï¼Œæ¸¸æ ‡çš„ä½œç”¨å°±æ˜¯å¯¹ç»“æœé›†è¿›è¡Œéå†ï¼Œæ–¹ä¾¿å¯¹è®°å½•è¿›è¡Œæ“ä½œã€‚</p><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p>ä¸‰ç§ç‰¹æ€§ï¼š</p><ul><li>åªè¯»<blockquote><p>ä¸èƒ½æ›´æ–°å®ƒ</p></blockquote></li><li>éæ»šåŠ¨<blockquote><p>æ ¹æ®SQLè¯­å¥ç¡®å®šé¡ºåºï¼Œä¸èƒ½å‘åè·å–è®°å½•å’Œè·³è¿‡è®°å½•</p></blockquote></li><li>æ•æ„Ÿ/ä¸æ•æ„Ÿ<blockquote><p>æ•æ„Ÿæ¸¸æ ‡æŒ‡å‘çš„æ˜¯æ•°æ®è¡¨ï¼Œä¸æ•æ„Ÿæ¸¸æ ‡æŒ‡å‘çš„åˆ™æ˜¯ä¸´æ—¶æ•°æ®è¡¨ã€‚ï¼ˆMysqlä½¿ç”¨çš„æ˜¯æ•æ„Ÿæ¸¸æ ‡ï¼‰</p></blockquote></li></ul><h3 id="å£°æ˜æ¸¸æ ‡"><a href="#å£°æ˜æ¸¸æ ‡" class="headerlink" title="å£°æ˜æ¸¸æ ‡"></a>å£°æ˜æ¸¸æ ‡</h3><p>æ¸¸æ ‡ä½¿ç”¨çš„å˜é‡å¿…é¡»åœ¨å£°æ˜æ¸¸æ ‡ä¹‹å‰å£°æ˜</p><a id="more"></a><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// Mysql</span><br><span class="line">// ä¸åŒäºå…¶ä»–æ•°æ®åº“ï¼ŒMysqlçš„æ¸¸æ ‡å¿…é¡»å£°æ˜åœ¨å­˜å‚¨è¿‡ç¨‹/å‡½æ•°ä¸­ã€‚</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> cur_func()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> &#123;...VARs&#125; // e.g. <span class="keyword">declare</span> email <span class="built_in">varchar</span>(<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">declare</span> &#123;CUR_NAME&#125; <span class="keyword">cursor</span> <span class="keyword">for</span> &#123;<span class="keyword">STATEMENT</span>&#125;;</span><br><span class="line">    open &#123;CUR_NAME&#125;;</span><br><span class="line">    fetch &#123;CUR_NAME&#125; into &#123;...VARs&#125; // e.g. fetch cur1 into email,name // å–å‡º1è¡Œè®°å½• &amp; æŠŠå€¼èµ‹ç»™å˜é‡emailã€name</span><br><span class="line">    close &#123;CUR_NAME&#125;;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">// PgSql</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> &#123;CUR_NAME&#125; <span class="keyword">cursor</span> <span class="keyword">for</span> &#123;<span class="keyword">STATEMENT</span>&#125;;</span><br><span class="line">    fetch &#123;STATEMENT&#125; from &#123;CUR_NAME&#125; // e.g. fetch forward 10 from cur1 å–å‡º10è¡Œè®°å½•</span><br><span class="line">    close &#123;CUR_NAME&#125;;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æ¸¸æ ‡æœ‰ç€ç±»ä¼¼æŒ‡é’ˆçš„ä½œç”¨ï¼Œå®ƒæ˜¯éå†å®¹å™¨çš„ä¸€å¥—æ¥å£ï¼ˆè¿­ä»£å™¨ï¼‰ï¼Œç®€å•å®ç°ï¼ˆgolangï¼‰:</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CustomArray []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Iterator <span class="keyword">struct</span> &#123;</span><br><span class="line">data  CustomArray</span><br><span class="line">index <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cusArr := CustomArray&#123;<span class="string">"1_1"</span>, <span class="number">22</span>, <span class="number">3.3</span>&#125;</span><br><span class="line"><span class="keyword">for</span> iter := cusArr.iterator(); iter.hasNext(); &#123;</span><br><span class="line">fmt.Println(iter.key(), iter.next())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arr CustomArray)</span> <span class="title">iterator</span><span class="params">()</span> *<span class="title">Iterator</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Iterator&#123;</span><br><span class="line">data:  arr,</span><br><span class="line">index: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸¸æ ‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iter *Iterator)</span> <span class="title">key</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> iter.index</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iter *Iterator)</span> <span class="title">hasNext</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> iter.index &lt; <span class="built_in">len</span>(iter.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–å‡ºæ•°æ®&amp;ç§»åŠ¨æ¸¸æ ‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iter *Iterator)</span> <span class="title">next</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">val := iter.data[iter.index]</span><br><span class="line">iter.index += <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„è¯´ï¼šæ¸¸æ ‡è¿”å›ä¸€ä¸ªæ•°æ®é›†åˆè¿­ä»£å™¨ï¼Œå½“ä½ å–ä¸€è¡Œè®°å½•åŒæ—¶æ¸¸æ ‡æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p><p>ä¸¾ä¾‹ä½¿ç”¨æ¸¸æ ‡çš„DBåº“ï¼Œä»¥ä¸‹ï¼š<br><a href="https://github.com/PyMySQL/PyMySQL/blob/46d17402af/pymysql/cursors.py#L278" target="_blank" rel="noopener">https://github.com/PyMySQL/PyMySQL/blob/46d17402af/pymysql/cursors.py#L278</a><br><a href="https://github.com/golang/go/blob/master/src/database/sql/sql.go#L2983" target="_blank" rel="noopener">https://github.com/golang/go/blob/master/src/database/sql/sql.go#L2983</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¸¸æ ‡ï¼ˆcursorï¼‰æ˜¯å¯ä»¥ä»æ•°æ®åº“æ£€ç´¢ç»“æœé›†ä¸­æ¯æ¬¡æå–ä¸€è¡Œè®°å½•çš„æœºåˆ¶ï¼Œæ¸¸æ ‡çš„ä½œç”¨å°±æ˜¯å¯¹ç»“æœé›†è¿›è¡Œéå†ï¼Œæ–¹ä¾¿å¯¹è®°å½•è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&quot;ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;ç‰¹æ€§&quot;&gt;&lt;/a&gt;ç‰¹æ€§&lt;/h3&gt;&lt;p&gt;ä¸‰ç§ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè¯»&lt;blockquote&gt;
&lt;p&gt;ä¸èƒ½æ›´æ–°å®ƒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;éæ»šåŠ¨&lt;blockquote&gt;
&lt;p&gt;æ ¹æ®SQLè¯­å¥ç¡®å®šé¡ºåºï¼Œä¸èƒ½å‘åè·å–è®°å½•å’Œè·³è¿‡è®°å½•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;æ•æ„Ÿ/ä¸æ•æ„Ÿ&lt;blockquote&gt;
&lt;p&gt;æ•æ„Ÿæ¸¸æ ‡æŒ‡å‘çš„æ˜¯æ•°æ®è¡¨ï¼Œä¸æ•æ„Ÿæ¸¸æ ‡æŒ‡å‘çš„åˆ™æ˜¯ä¸´æ—¶æ•°æ®è¡¨ã€‚ï¼ˆMysqlä½¿ç”¨çš„æ˜¯æ•æ„Ÿæ¸¸æ ‡ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;å£°æ˜æ¸¸æ ‡&quot;&gt;&lt;a href=&quot;#å£°æ˜æ¸¸æ ‡&quot; class=&quot;headerlink&quot; title=&quot;å£°æ˜æ¸¸æ ‡&quot;&gt;&lt;/a&gt;å£°æ˜æ¸¸æ ‡&lt;/h3&gt;&lt;p&gt;æ¸¸æ ‡ä½¿ç”¨çš„å˜é‡å¿…é¡»åœ¨å£°æ˜æ¸¸æ ‡ä¹‹å‰å£°æ˜&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - InnoDBå¹¶å‘æ­»é”é—®é¢˜</title>
    <link href="http://xupin.im/2021/11/15/mysql-deadlock/"/>
    <id>http://xupin.im/2021/11/15/mysql-deadlock/</id>
    <published>2021-11-14T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.752Z</updated>
    
    <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­æŸä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°æ­»é”é—®é¢˜ï¼Œå…·ä½“é”™è¯¯å¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error 1213: Deadlock found when trying to get lock; try restarting transaction</span><br></pre></td></tr></table></figure></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ£€æŸ¥ä¸€ä¸‹è¡¨å¼•æ“ &amp; äº‹åŠ¡éš”ç¦»çº§åˆ«<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'%storage_engine%'</span>;</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">| Variable_name                   | Value     |</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">| default_storage_engine          | InnoDB    |</span><br><span class="line">| default_tmp_storage_engine      | InnoDB    |</span><br><span class="line">| disabled_storage_engines        |           |</span><br><span class="line">| internal_tmp_mem_storage_engine | TempTable |</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@global.tx_isolation;</span><br><span class="line">ERROR 1193 (HY000): Unknown system variable <span class="string">'tx_isolation'</span> // Mysql8.0ä»¥åå–æ¶ˆäº†è¯¥å˜é‡</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@transaction_isolation;</span><br><span class="line">+-------------------------+</span><br><span class="line">| @@transaction_isolation |</span><br><span class="line">+-------------------------+</span><br><span class="line">| REPEATABLE-READ         |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure></p><a id="more"></a><p>é»˜è®¤ä½¿ç”¨çš„å¼•æ“æ˜¯InnoDBï¼ŒInsertã€Updateã€Deleteæ“ä½œä¼šè§¦å‘æ’å®ƒé”ï¼ˆXé”ï¼‰å³è¡Œé”ï¼Œæ‰€ä»¥æ€€ç–‘æ˜¯ä¸æ˜¯è§¦å‘äº†å…±äº«é”ï¼ˆSé”ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engine innodb status;</span><br><span class="line"></span><br><span class="line">=====================================</span><br><span class="line">2021-11-15 02:42:28 0x2b1f5b160700 INNODB MONITOR OUTPUT</span><br><span class="line">=====================================</span><br><span class="line">Per second averages calculated from the last 59 seconds</span><br><span class="line">...</span><br><span class="line">------------------------</span><br><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line">------------------------</span><br><span class="line">2021-11-12 14:21:02 0x2b204ca06700</span><br><span class="line">*** (1) TRANSACTION:</span><br><span class="line">TRANSACTION 3805455, ACTIVE 0 sec inserting</span><br><span class="line">mysql tables <span class="keyword">in</span> use 1, locked 1</span><br><span class="line">LOCK WAIT 4 lock struct(s), heap size 1136, 3 row lock(s), undo <span class="built_in">log</span> entries 1</span><br><span class="line">MySQL thread id 875327, OS thread handle 47411963238144, query id 20765167 10.85.62.212 dsc update</span><br><span class="line">INSERT INTO `user_tag_distributes` (`created_at`,`updated_at`,`deleted_at`,`app_id`,`tag_name`,`tag_value`,`account_num`) VALUES (<span class="string">'2021-11-12 14:21:02.386'</span>,<span class="string">'2021-11-12 14:21:02.386'</span>,NULL,<span class="string">'im'</span>,<span class="string">'churn_model_v2'</span>,<span class="string">'0.70709264'</span>,1)</span><br><span class="line"></span><br><span class="line">*** (1) HOLDS THE LOCK(S):</span><br><span class="line">RECORD LOCKS space id 334 page no 341 n bits 160 index PRIMARY of table `api`.`user_tag_distributes` trx id 3805455 lock_mode X locks rec but not gap</span><br><span class="line">Record lock, heap no 89 PHYSICAL RECORD: n_fields 11; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 000000000002515d; asc       Q];;</span><br><span class="line"> 1: len 6; hex 0000003a110f; asc    :  ;;</span><br><span class="line"> 2: len 7; hex 81000001960110; asc        ;;</span><br><span class="line"> 3: len 7; hex 99ab18e5420f14; asc     B  ;;</span><br><span class="line"> 4: len 7; hex 99ab18e5420f14; asc     B  ;;</span><br><span class="line"> 5: SQL NULL;</span><br><span class="line"> 6: SQL NULL;</span><br><span class="line"> 7: len 2; hex 696d; asc im;;</span><br><span class="line"> 8: len 14; hex 636875726e5f6d6f64656c5f7632; asc churn_model_v2;;</span><br><span class="line"> 9: len 10; hex 302e3730373039323634; asc 0.70709264;;</span><br><span class="line"> 10: len 3; hex 800001; asc    ;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** (1) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 334 page no 203 n bits 392 index tag of table `api`.`user_tag_distributes` trx id 3805455 lock mode S waiting</span><br><span class="line">Record lock, heap no 88 PHYSICAL RECORD: n_fields 3; compact format; info bits 32</span><br><span class="line"> 0: len 14; hex 636875726e5f6d6f64656c5f7632; asc churn_model_v2;;</span><br><span class="line"> 1: len 9; hex 302e37303730393735; asc 0.7070975;;</span><br><span class="line"> 2: len 8; hex 0000000000022d5f; asc       -_;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** (2) TRANSACTION:</span><br><span class="line">TRANSACTION 3805441, ACTIVE 0 sec fetching rows</span><br><span class="line">mysql tables <span class="keyword">in</span> use 1, locked 1</span><br><span class="line">LOCK WAIT 89 lock struct(s), heap size 24784, 17767 row lock(s), undo <span class="built_in">log</span> entries 10247</span><br><span class="line">MySQL thread id 875354, OS thread handle 47415383693056, query id 20765093 10.85.62.212 dsc updating</span><br><span class="line">DELETE FROM `user_tag_distributes` WHERE app_id = <span class="string">'im'</span> and tag_name = <span class="string">'churn_model_v2'</span></span><br><span class="line"></span><br><span class="line">*** (2) HOLDS THE LOCK(S):</span><br><span class="line">RECORD LOCKS space id 334 page no 203 n bits 392 index tag of table `api`.`user_tag_distributes` trx id 3805441 lock_mode X locks rec but not gap</span><br><span class="line">Record lock, heap no 88 PHYSICAL RECORD: n_fields 3; compact format; info bits 32</span><br><span class="line"> 0: len 14; hex 636875726e5f6d6f64656c5f7632; asc churn_model_v2;;</span><br><span class="line"> 1: len 9; hex 302e37303730393735; asc 0.7070975;;</span><br><span class="line"> 2: len 8; hex 0000000000022d5f; asc       -_;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 334 page no 341 n bits 160 index PRIMARY of table `api`.`user_tag_distributes` trx id 3805441 lock_mode X waiting</span><br><span class="line">Record lock, heap no 89 PHYSICAL RECORD: n_fields 11; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 000000000002515d; asc       Q];;</span><br><span class="line"> 1: len 6; hex 0000003a110f; asc    :  ;;</span><br><span class="line"> 2: len 7; hex 81000001960110; asc        ;;</span><br><span class="line"> 3: len 7; hex 99ab18e5420f14; asc     B  ;;</span><br><span class="line"> 4: len 7; hex 99ab18e5420f14; asc     B  ;;</span><br><span class="line"> 5: SQL NULL;</span><br><span class="line"> 6: SQL NULL;</span><br><span class="line"> 7: len 2; hex 696d; asc im;;</span><br><span class="line"> 8: len 14; hex 636875726e5f6d6f64656c5f7632; asc churn_model_v2;;</span><br><span class="line"> 9: len 10; hex 302e3730373039323634; asc 0.70709264;;</span><br><span class="line"> 10: len 3; hex 800001; asc    ;;</span><br><span class="line"></span><br><span class="line">*** WE ROLL BACK TRANSACTION (1)</span><br><span class="line">------------</span><br><span class="line">TRANSACTIONS</span><br><span class="line">------------</span><br><span class="line">Trx id counter 3945122</span><br><span class="line">Purge <span class="keyword">done</span> <span class="keyword">for</span> trx<span class="string">'s n:o &lt; 3945122 undo n:o &lt; 0 state: running but idle</span></span><br><span class="line"><span class="string">History list length 3</span></span><br><span class="line"><span class="string">LIST OF TRANSACTIONS FOR EACH SESSION:</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640459544, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640456152, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640455304, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640457000, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640448520, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640447672, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640452760, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640458696, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640446824, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640453608, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640457848, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640451912, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640451064, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640454456, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640450216, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640449368, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640445976, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">---TRANSACTION 328886640445128, not started</span></span><br><span class="line"><span class="string">0 lock struct(s), heap size 1136, 0 row lock(s)</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">----------------------------</span></span><br><span class="line"><span class="string">END OF INNODB MONITOR OUTPUT</span></span><br><span class="line"><span class="string">============================</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šä¿¡æ¯ç¡®è®¤æ˜¯å› ä¸º[äº‹åŠ¡1]Insert &amp; [äº‹åŠ¡2]Deleteäº’ç›¸ç­‰å¾…å¯¹æ–¹äº‹åŠ¡é‡Šæ”¾é”çš„é—®é¢˜é€ æˆæ­»é”ï¼Œæœ€å[äº‹åŠ¡1]è¿›è¡Œå›æ»šã€‚</p><h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>reviewä»£ç æ¢³ç†ä¸€ä¸‹ä¸šåŠ¡é€»è¾‘ï¼Œåœºæ™¯åº”è¯¥å¦‚ä¸‹ï¼š</p><table><thead><tr><th>trx1</th><th>trx2</th></tr></thead><tbody><tr><td></td><td>BEGIN</td></tr><tr><td>BEGIN</td><td>DELETE FROM <code>user_tag_distributes</code> WHERE app_id = â€˜imâ€™ and tag_name = â€˜churn_model_v2â€™</td></tr><tr><td>DELETE FROM <code>user_tag_distributes</code> WHERE app_id = â€˜imâ€™ and tag_name = â€˜churn_model_v2â€™</td><td></td></tr><tr><td>INSERT INTO <code>user_tag_distributes</code> (<code>created_at</code>,<code>updated_at</code>,<code>deleted_at</code>,<code>app_id</code>,<code>tag_name</code>,<code>tag_value</code>,<code>account_num</code>) VALUES (â€˜2021-11-12 14:21:02.386â€™,â€™2021-11-12 14:21:02.386â€™,NULL,â€™imâ€™,â€™churn_model_v2â€™,â€™0.70709264â€™,1)</td><td></td></tr><tr><td>ERROR 1213 (40001): Deadlock found when trying to get lock</td><td></td></tr><tr><td>ROLLBACK</td><td>â€¦</td></tr><tr><td></td><td>COMMIT</td></tr></tbody></table><p>å¯ä»¥çœ‹å‡º[äº‹åŠ¡1]è¿›è¡ŒInsertæ“ä½œæ—¶å‘ç°[äº‹åŠ¡2]è¿›è¡ŒDeleteæ“ä½œä¸”å·²ç”³è¯·Xé”ï¼Œ[äº‹åŠ¡1]æƒ³è¦è·å–Sé”åˆ™éœ€è¦[äº‹åŠ¡2]æäº¤ï¼Œæ‰€ä»¥[äº‹åŠ¡1]ã€[äº‹åŠ¡2]åœ¨ç›¸äº’ç­‰å¾…å¯¹æ–¹æäº¤äº‹åŠ¡ï¼ˆé‡Šæ”¾é”ï¼‰ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ç›®å‰æƒ³åˆ°çš„å‡ ç§æªæ–½ï¼š</p><ul><li>å°½é‡é¿å…åœ¨å¹¶å‘ç¨‹åºä¸­Delete &amp; Insertæ“ä½œæ— ç¼æ‰§è¡Œ</li><li>å¹¶å‘ç¨‹åºé‡‡ç”¨åˆ†å¸ƒå¼é”æ§åˆ¶</li><li>ç¨‹åºä¸å…è®¸å¹¶å‘æ‰§è¡Œ</li></ul><p><a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html</a><br><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-standard-monitor.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/innodb-standard-monitor.html</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;é¡¹ç›®ä¸­æŸä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°æ­»é”é—®é¢˜ï¼Œå…·ä½“é”™è¯¯å¦‚ä¸‹:&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Error 1213: Deadlock found when trying to get lock; try restarting transaction&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h3&gt;&lt;p&gt;æ£€æŸ¥ä¸€ä¸‹è¡¨å¼•æ“ &amp;amp; äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; show variables like &lt;span class=&quot;string&quot;&gt;&#39;%storage_engine%&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+---------------------------------+-----------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| Variable_name                   | Value     |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+---------------------------------+-----------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| default_storage_engine          | InnoDB    |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| default_tmp_storage_engine      | InnoDB    |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| disabled_storage_engines        |           |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| internal_tmp_mem_storage_engine | TempTable |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+---------------------------------+-----------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4 rows &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; (0.00 sec)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; select @@global.tx_isolation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR 1193 (HY000): Unknown system variable &lt;span class=&quot;string&quot;&gt;&#39;tx_isolation&#39;&lt;/span&gt; // Mysql8.0ä»¥åå–æ¶ˆäº†è¯¥å˜é‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; select @@transaction_isolation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| @@transaction_isolation |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| REPEATABLE-READ         |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1 row &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; (0.00 sec)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - æ•°æ®è¿ç§»</title>
    <link href="http://xupin.im/2021/11/12/mysql-migrate/"/>
    <id>http://xupin.im/2021/11/12/mysql-migrate/</id>
    <published>2021-11-11T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.753Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰é¡¹ç›®æ•°æ®è¡¨æœ‰åˆ†è¡¨è®¾è®¡ï¼Œç°åœ¨å› ä¸ºä¸šåŠ¡é‡å¢é•¿æ•°æ®è¡¨æ•°æ®é‡è†¨èƒ€æ•°å€å¯¼è‡´å•è¡¨æ€§èƒ½ä¸ç†æƒ³ â€¦ æ‰€ä»¥å¸Œæœ›åœ¨ä¸å½±å“ç”¨æˆ·ä½¿ç”¨çš„æƒ…å†µä¸‹æ‰©å±•æ•°æ®è¡¨ï¼ˆè¿ç§»ï¼‰</p><h3 id="æ•°æ®è¿ç§»æ–¹æ¡ˆ"><a href="#æ•°æ®è¿ç§»æ–¹æ¡ˆ" class="headerlink" title="æ•°æ®è¿ç§»æ–¹æ¡ˆ"></a>æ•°æ®è¿ç§»æ–¹æ¡ˆ</h3><p>åŸºæœ¬åˆ†ä¸º<code>çƒ­è¿ç§»</code>å’Œ<code>å†·è¿ç§»</code>ä¸¤ç§æ–¹å¼</p><ul><li>å†·è¿ç§»</li></ul><p>é€šä¿—çš„æ¥è¯´å°±æ˜¯åœæœºè¿ç§»ï¼Œæ¯”å¦‚æŸäº›æ¸¸æˆåˆæœç»´æŠ¤ç­‰</p><blockquote><p>ä¼˜ç‚¹: æ“ä½œå¯é æ€§é«˜ã€æ•°æ®ä¸€è‡´æ€§æœ‰ä¿è¯ã€æ•°æ®å›æ»šæ–¹ä¾¿</p><p>ç¼ºç‚¹: ç”¨æˆ·ä½“éªŒå·®</p></blockquote><a id="more"></a><p><img src="/assets/migrate/cold-migrate.jpg" width="400" height="400"></p><ul><li>çƒ­è¿ç§»</li></ul><p>åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹æŠŠæ•°æ®è¡¨è¿ç§»ï¼Œæ–°æ—§è¡¨åŒå†™</p><blockquote><p>ä¼˜ç‚¹: ç”¨æˆ·æ— æ„ŸçŸ¥</p><p>ç¼ºç‚¹: å®¹æ˜“ä¸¢å¤±æ•°æ®ã€æ•°æ®ä¸€è‡´æ€§ä¸å¥½ä¿è¯</p></blockquote><p><img src="/assets/migrate/hot-migrate.jpg" width="400" height="400"></p><p>è¿™ç§çƒ­è¿ç§»æ–¹å¼æ˜¯ä¸ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œçº¯é DBå®Œæˆè¿ç§»ï¼Œæç«¯åœºæ™¯ä¸‹å¯é æ€§ä¸ç¡®å®šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰é¡¹ç›®æ•°æ®è¡¨æœ‰åˆ†è¡¨è®¾è®¡ï¼Œç°åœ¨å› ä¸ºä¸šåŠ¡é‡å¢é•¿æ•°æ®è¡¨æ•°æ®é‡è†¨èƒ€æ•°å€å¯¼è‡´å•è¡¨æ€§èƒ½ä¸ç†æƒ³ â€¦ æ‰€ä»¥å¸Œæœ›åœ¨ä¸å½±å“ç”¨æˆ·ä½¿ç”¨çš„æƒ…å†µä¸‹æ‰©å±•æ•°æ®è¡¨ï¼ˆè¿ç§»ï¼‰&lt;/p&gt;
&lt;h3 id=&quot;æ•°æ®è¿ç§»æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#æ•°æ®è¿ç§»æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®è¿ç§»æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;æ•°æ®è¿ç§»æ–¹æ¡ˆ&lt;/h3&gt;&lt;p&gt;åŸºæœ¬åˆ†ä¸º&lt;code&gt;çƒ­è¿ç§»&lt;/code&gt;å’Œ&lt;code&gt;å†·è¿ç§»&lt;/code&gt;ä¸¤ç§æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†·è¿ç§»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šä¿—çš„æ¥è¯´å°±æ˜¯åœæœºè¿ç§»ï¼Œæ¯”å¦‚æŸäº›æ¸¸æˆåˆæœç»´æŠ¤ç­‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¼˜ç‚¹: æ“ä½œå¯é æ€§é«˜ã€æ•°æ®ä¸€è‡´æ€§æœ‰ä¿è¯ã€æ•°æ®å›æ»šæ–¹ä¾¿&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹: ç”¨æˆ·ä½“éªŒå·®&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Gitå°çŸ¥è¯† - depth</title>
    <link href="http://xupin.im/2021/11/01/git-depth/"/>
    <id>http://xupin.im/2021/11/01/git-depth/</id>
    <published>2021-10-31T16:00:00.000Z</published>
    <updated>2022-12-15T04:31:24.364Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰æ—¶å€™gité¡¹ç›®æ¯”è¾ƒå¤§ï¼Œgit cloneä¼šå› ä¸ºå„ç§åŸå› ä¸­æ–­ï¼Œä½†æ˜¯Gitå¹¶ä¸ä¼šæ–­ç‚¹ç»­â€œä¼ â€å†æ¬¡cloneåˆæ˜¯é‡æ–°æ¥è¿‡,ç±»ä¼¼è¿™ç§é—®é¢˜â€¦è®©äººå¾ˆæ˜¯è‹¦æ¼<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ error: RPC failed; HTTP 504 curl 22 The requested URL returned error: 504 Gateway Time-out</span><br><span class="line">$ ...</span><br><span class="line">$ error: RPC failed; curl 18 transfer closed with outstanding <span class="built_in">read</span> data remaining</span><br></pre></td></tr></table></figure></p><h3 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h3><ul><li><p>gité…ç½®æµ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global http.lowSpeedLimit 0 // æœ€å°é€Ÿåº¦</span><br><span class="line">$ git config --global http.lowSpeedTime 999999 // æœ€å¤§é€Ÿåº¦</span><br><span class="line">$ git config --global http.postBuffer 524288000 // æ–‡ä»¶å¤§å°</span><br><span class="line">$ git config --global compression 0 // å…³é—­å‹ç¼©</span><br></pre></td></tr></table></figure></li><li><p>åˆ†å—æ‹‰å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> --depth=1 &#123;repo&#125; // æ‹‰å–æœ€æ–°çš„ä»£ç ï¼ˆæœ€åä¸€æ¬¡commitï¼‰</span><br></pre></td></tr></table></figure></li></ul><p>ä½†è¿™æ ·ä¼šå¸¦æ¥å…¶ä»–çš„å°é—®é¢˜ï¼Œå°±æ˜¯æ‹‰ä¸‹æ¥çš„ä»£ç é»˜è®¤åˆ†æ”¯æ—¢ä¸æ˜¯masterä¹Ÿä¸æ˜¯å…¶ä»–åˆ†æ”¯ â€¦ éœ€è¦æ‹‰å–å®Œæ•´çš„é¡¹ç›®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch --unshallow // æ‹‰å–æ·±å±‚ä»£ç </span><br><span class="line">$ git config remote.origin.fetch <span class="string">"+refs/heads/*:refs/remotes/origin/*"</span> // ä¿®æ­£remoteå…³ç³»ï¼ˆä¿®æ”¹ä¹‹å‰: <span class="string">"fetch = +refs/heads/master:refs/remotes/origin/master"</span>ï¼‰</span><br><span class="line">$ git fetch -pv // æ‹‰å–æ‰€æœ‰åˆ†æ”¯</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ‰æ—¶å€™gité¡¹ç›®æ¯”è¾ƒå¤§ï¼Œgit cloneä¼šå› ä¸ºå„ç§åŸå› ä¸­æ–­ï¼Œä½†æ˜¯Gitå¹¶ä¸ä¼šæ–­ç‚¹ç»­â€œä¼ â€å†æ¬¡cloneåˆæ˜¯é‡æ–°æ¥è¿‡,ç±»ä¼¼è¿™ç§é—®é¢˜â€¦è®©äººå¾ˆæ˜¯è‹¦æ¼&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="biscuits" scheme="http://xupin.im/tags/biscuits/"/>
    
    <category term="git" scheme="http://xupin.im/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼ - æ§åˆ¶åè½¬/ä¾èµ–æ³¨å…¥</title>
    <link href="http://xupin.im/2020/10/18/design-ioc-di/"/>
    <id>http://xupin.im/2020/10/18/design-ioc-di/</id>
    <published>2020-10-17T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.749Z</updated>
    
    <content type="html"><![CDATA[<p>Laravelæ¡†æ¶ä¸­æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥åŠŸèƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ<br>å…¶å®æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒæœ€æ—©æºäºJava Springæ¡†æ¶è®¾è®¡ä¸­çš„æœºåˆ¶ï¼Œæ‰€ä»¥èº«è¾¹å¦‚æœæœ‰åšJavaå¼€å‘çš„å°ä¼™ä¼´~ç®€å•èŠèŠå°±èƒ½æ˜ç™½è®¸å¤šã€‚</p><h3 id="1-ä¾èµ–æ³¨å…¥"><a href="#1-ä¾èµ–æ³¨å…¥" class="headerlink" title="1.ä¾èµ–æ³¨å…¥"></a>1.ä¾èµ–æ³¨å…¥</h3><p>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ï¼Œé€šä¿—çš„è§£é‡Šæ˜¯å½“æˆ‘ä»¬æ„å»ºå¯¹è±¡æ—¶éœ€è¦çš„å‚æ•°ï¼Œåªè¦ä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºè€Œæ˜¯ä»¥å®ä¾‹å¯¹è±¡çš„å½¢å¼æ³¨å…¥éƒ½å¯ä»¥ç§°ä¸ºä¾èµ–æ³¨å…¥ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå°æ¸¸æˆä¸­ç©å®¶å¯ä»¥åˆ›å»ºä¸åŒçš„èŒä¸šã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èŒä¸šæ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–èŒä¸šå</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dh</span> <span class="keyword">implements</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="comment">// èŒä¸šå</span></span><br><span class="line">    <span class="keyword">protected</span> $name = <span class="string">'çŒé­”äºº'</span>;</span><br><span class="line">    <span class="comment">// æ”»å‡»æˆé•¿</span></span><br><span class="line">    <span class="keyword">protected</span> $attack;</span><br><span class="line">    <span class="comment">// é€Ÿåº¦æˆé•¿</span></span><br><span class="line">    <span class="keyword">protected</span> $speed;</span><br><span class="line">    <span class="comment">// æ°”è¡€æˆé•¿</span></span><br><span class="line">    <span class="keyword">protected</span> $hp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($attack,$speed,$hp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attack = $attack;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;speed = $speed;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hp = $hp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç©å®¶ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="comment">// èŒä¸š</span></span><br><span class="line">    <span class="keyword">protected</span> $role;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($role)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;role = $role;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çŒé­”äºº</span></span><br><span class="line">$dh = <span class="keyword">new</span> Dh(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç©å®¶1-&gt;çŒé­”äºº</span></span><br><span class="line">$player1 = <span class="keyword">new</span> Player($dh);</span><br></pre></td></tr></table></figure><a id="more"></a><p>ä»¥ä¸Šæ˜¯åˆ›å»ºç©å®¶è§’è‰²çš„é€»è¾‘ï¼Œåˆ›å»ºè§’è‰²<code>â€œplayer1â€</code>æ—¶é€‰æ‹©è§’è‰²<code>â€œdhâ€</code>ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å…¶å®å°±æ˜¯ä¾èµ–æ³¨å…¥ã€‚</p><h3 id="2-æ§åˆ¶åè½¬ï¼ˆIocï¼‰"><a href="#2-æ§åˆ¶åè½¬ï¼ˆIocï¼‰" class="headerlink" title="2.æ§åˆ¶åè½¬ï¼ˆIocï¼‰"></a>2.æ§åˆ¶åè½¬ï¼ˆIocï¼‰</h3><p>æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼‰ï¼Œä»å­—é¢æ„æ€æ¥ç†è§£å°±æ˜¯æŠŠæ§åˆ¶æƒåè½¬ï¼Œé‚£ä¹ˆç©¶ç«Ÿæ€ä¹ˆåè½¬å‘¢ï¼Ÿ</p><p>ä¹‹å‰åˆ›å»ºç©å®¶è§’è‰²çš„é€»è¾‘ï¼Œé€šè¿‡ç¨‹åºå¯ä»¥çœ‹å‡ºæ‰€æœ‰ä¾èµ–å¯¹è±¡éƒ½æ˜¯ç¨‹åºä¸»åŠ¨å»åˆ›å»ºï¼ˆèŒä¸šå¯¹è±¡ï¼Œç©å®¶å¯¹è±¡ï¼‰ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³æŠŠæ‰€æœ‰éœ€è¦çš„å‚æ•°éƒ½æå‰å‡†å¤‡å¥½ï¼Œæ€ä¹ˆä¼˜åŒ–ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $binds;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> $instances;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bind</span><span class="params">($abstract, $concrete)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($concrete <span class="keyword">instanceof</span> Closure) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binds[$abstract] = $concrete;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;instances[$abstract] = $concrete;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span><span class="params">($abstract, $parameters = [])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;instances[$abstract])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;instances[$abstract];</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        array_unshift($parameters, <span class="keyword">$this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;binds[$abstract], $parameters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$container = <span class="keyword">new</span> Container();</span><br><span class="line"></span><br><span class="line">$container-&gt;bind(<span class="string">'player'</span>, <span class="function"><span class="keyword">function</span><span class="params">($container, $role)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Player($container-&gt;make($role));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$container-&gt;bind(<span class="string">'dh'</span>, <span class="function"><span class="keyword">function</span><span class="params">($container)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Dh(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç©å®¶1-&gt;çŒé­”äºº</span></span><br><span class="line">$player1 = $container-&gt;make(<span class="string">'player'</span>, [<span class="string">'dh'</span>]);</span><br></pre></td></tr></table></figure><p>åŠ å…¥äº†ä¸€ä¸ªåå«<code>â€œContainerâ€</code>çš„ç±»ï¼Œé‡Œé¢å­˜æ”¾æå‰è®¾è®¡å¥½çš„å¯¹è±¡ï¼Œå½“ç¨‹åºéœ€è¦æŸäº›ä¾èµ–å¯¹è±¡æ—¶<code>â€œContainerâ€</code>è‡ªåŠ¨å¸®ä½ å»å¯»æ‰¾æ‰§è¡Œã€‚è¿™å…¶å®å°±æ˜¯<br>Iocè®¾è®¡æ€æƒ³ä¸­éµå¾ªâ€œDonâ€™t call us, weâ€™ll call youâ€çš„åŸåˆ™ï¼Œä¸éœ€è¦ç¨‹åºå»åˆ›å»ºä¾èµ–ï¼Œè€Œæ˜¯ä¸»åŠ¨å»å¸®ç¨‹åºå¯»æ‰¾ç›¸åº”ä¾èµ–ã€‚è¿™ä¹Ÿå°±æ˜¯æ‰€è¯´çš„æ§åˆ¶åè½¬ï¼Œä»ç‹­ä¹‰ä¸Šè®²ä¾èµ–æ³¨å…¥å…¶å®ç®—æ˜¯æ§åˆ¶åè½¬çš„ä¸€ç§å®ç°ã€‚</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>å¯èƒ½å¾ˆå¤šå°ä¼™ä¼´ä¼šè§‰å¾—æ§åˆ¶åè½¬çš„æ€æƒ³å’Œå·¥å‚æ¨¡å¼å¾ˆç›¸åƒï¼Œå®ƒä»¬æ˜¯ä¸æ˜¯å°±æ˜¯åŒä¸€ä¸ªä¸œè¥¿å‘¢ï¼Ÿæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹çœ‹<a href="https://stackoverflow.com/questions/557742/dependency-injection-vs-factory-pattern" target="_blank" rel="noopener">Dependency Injection vs Factory Pattern</a>ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Laravelæ¡†æ¶ä¸­æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥åŠŸèƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ&lt;br&gt;å…¶å®æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒæœ€æ—©æºäºJava Springæ¡†æ¶è®¾è®¡ä¸­çš„æœºåˆ¶ï¼Œæ‰€ä»¥èº«è¾¹å¦‚æœæœ‰åšJavaå¼€å‘çš„å°ä¼™ä¼´~ç®€å•èŠèŠå°±èƒ½æ˜ç™½è®¸å¤šã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä¾èµ–æ³¨å…¥&quot;&gt;&lt;a href=&quot;#1-ä¾èµ–æ³¨å…¥&quot; class=&quot;headerlink&quot; title=&quot;1.ä¾èµ–æ³¨å…¥&quot;&gt;&lt;/a&gt;1.ä¾èµ–æ³¨å…¥&lt;/h3&gt;&lt;p&gt;ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ï¼Œé€šä¿—çš„è§£é‡Šæ˜¯å½“æˆ‘ä»¬æ„å»ºå¯¹è±¡æ—¶éœ€è¦çš„å‚æ•°ï¼Œåªè¦ä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºè€Œæ˜¯ä»¥å®ä¾‹å¯¹è±¡çš„å½¢å¼æ³¨å…¥éƒ½å¯ä»¥ç§°ä¸ºä¾èµ–æ³¨å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå°æ¸¸æˆä¸­ç©å®¶å¯ä»¥åˆ›å»ºä¸åŒçš„èŒä¸šã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// èŒä¸šæ¥å£&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Role&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è·å–èŒä¸šå&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Dh&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Role&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// èŒä¸šå&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $name = &lt;span class=&quot;string&quot;&gt;&#39;çŒé­”äºº&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ”»å‡»æˆé•¿&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $attack;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é€Ÿåº¦æˆé•¿&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $speed;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ°”è¡€æˆé•¿&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $hp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;($attack,$speed,$hp)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;attack = $attack;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;speed = $speed;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;hp = $hp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç©å®¶ç±»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Player&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// èŒä¸š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $role;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;($role)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;role = $role;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// çŒé­”äºº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$dh = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Dh(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç©å®¶1-&amp;gt;çŒé­”äºº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$player1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Player($dh);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="design" scheme="http://xupin.im/tags/design/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - èšç°‡ç´¢å¼•å’Œå›è¡¨æŸ¥è¯¢çš„å…³ç³»</title>
    <link href="http://xupin.im/2020/08/12/mysql-clustered-index/"/>
    <id>http://xupin.im/2020/08/12/mysql-clustered-index/</id>
    <published>2020-08-11T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.752Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ç®€å•äº†è§£è¿‡Mysqlçš„ç´¢å¼•ï¼Œä»Šå¤©æ¥å­¦ä¹ ä¸€ä¸‹Mysqlï¼ˆInnoDBï¼‰çš„èšç°‡ç´¢å¼•ä»¥åŠSQLä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå›è¡¨æŸ¥è¯¢ï¼Ÿ</p><h3 id="1-ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ</h3><p>éƒ½çŸ¥é“Mysqlå­˜å‚¨çš„æ•°æ®ç»“æ„æ˜¯B+Treeï¼Œæ‰€ä»¥å½“æŸ¥è¯¢æ•°æ®çš„æ—¶å€™èƒ½æœ€å¿«æ‰¾åˆ°å¶å­èŠ‚ç‚¹çš„æ£€ç´¢æ–¹å¼æ—¶æ˜¯æœ€å¿«çš„ã€‚æ¯”å¦‚ï¼šä¸»é”®ç›´æ¥å®šä½è¡Œè®°å½•ï¼Œè€Œæœ‰äº›æŸ¥è¯¢éœ€è¦å…ˆæ£€ç´¢ç´¢å¼•æ ‘æ‰¾åˆ°å¶å­èŠ‚ç‚¹çš„ä¸»é”®å€¼ï¼Œå†é€šè¿‡ä¸»é”®å€¼å®šä½è¡Œè®°å½•è¿™ç§æ‰«æ2æ¬¡ç´¢å¼•æ ‘çš„æ–¹å¼å°±å«åšå›è¡¨æŸ¥è¯¢ã€‚</p><p>å¦‚ä½•ç¡®å®šSQLè¯­å¥ä¼šä¸ä¼šé€ æˆå›è¡¨æŸ¥è¯¢ï¼Ÿå¦‚ä¸‹è¡¨ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`user`</span> <span class="built_in">varchar</span>(<span class="number">125</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`created_at`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> <span class="string">`user`</span>(<span class="string">`user`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">INDEX</span> <span class="string">`name`</span>(<span class="string">`name`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">1</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_unicode_ci ROW_FORMAT = <span class="keyword">Compact</span>;</span><br></pre></td></tr></table></figure></p><p>2ç§æŸ¥è¯¢æ–¹å¼ï¼š</p><a id="more"></a><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœªå›è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'test1'</span>;</span><br><span class="line">+<span class="comment">------+-------------+-------+------+---------------+------+---------+-------+------+--------------------------+</span></span><br><span class="line">| id   | select_type | table | type | possible_keys | key  | key_len | ref   | rows | Extra                    |</span><br><span class="line">+<span class="comment">------+-------------+-------+------+---------------+------+---------+-------+------+--------------------------+</span></span><br><span class="line">|    1 | SIMPLE      | users | ref  | name          | name | 202     | const |    1 | Using where; Using index |</span><br><span class="line">+<span class="comment">------+-------------+-------+------+---------------+------+---------+-------+------+--------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å›è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">user</span>,<span class="keyword">name</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'test1'</span>;</span><br><span class="line">+<span class="comment">------+-------------+-------+------+---------------+------+---------+-------+------+-----------------------+</span></span><br><span class="line">| id   | select_type | table | type | possible_keys | key  | key_len | ref   | rows | Extra                 |</span><br><span class="line">+<span class="comment">------+-------------+-------+------+---------------+------+---------+-------+------+-----------------------+</span></span><br><span class="line">|    1 | SIMPLE      | users | ref  | name          | name | 202     | const |    1 | Using index condition |</span><br><span class="line">+<span class="comment">------+-------------+-------+------+---------------+------+---------+-------+------+-----------------------+</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„çœ‹<code>Extra</code>å­—æ®µï¼Œå½“å€¼ä¸º<code>Using index condition</code>æ—¶è¡¨ç¤ºè¯¥SQLéœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œé‚£ä»¥ä¸Šä¸¤æ¡SQLåˆ°åº•æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><ol><li><p><font color="gray">SQL1</font>å‘½ä¸­<code>name</code>ç´¢å¼•å¹¶ä¸”åœ¨ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ‰¾åˆ°ä¸»é”®<code>id</code>ï¼Œæ»¡è¶³äº†æŸ¥è¯¢éœ€æ±‚æ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢å…¶ä»–å­—æ®µã€‚</p></li><li><p><font color="gray">SQL2</font>åŒæ ·æ˜¯å‘½ä¸­<code>name</code>ç´¢å¼•å¹¶ä¸”åœ¨ç´¢å¼•æ ‘å¶å­èŠ‚ç‚¹æ‰¾åˆ°ä¸»é”®<code>id</code>ï¼Œä½†è¿˜æœ‰ä¸€ä¸ª<code>user</code>å­—æ®µæ²¡æœ‰å¾—åˆ°ï¼Œæ‰€ä»¥éœ€è¦æ‹¿ç€ä¸»é”®<code>id</code>å»ç´¢å¼•æ ‘æŸ¥è¯¢<code>user</code>å­—æ®µã€‚</p></li></ol><p>ä»¥ä¸Šå°±æ˜¯æ˜¯å¦å›è¡¨æŸ¥è¯¢çš„åŒºåˆ«ï¼Œå›è¡¨æŸ¥è¯¢ä¼šé¢å¤–äº§ç”Ÿä¸€æ¬¡æŸ¥è¯¢çš„å¼€é”€ï¼Œæ•…æ­¤æ•ˆç‡è¾ƒä½ã€‚ä¸è¿‡å›è¡¨æŸ¥è¯¢å’Œèšç°‡ç´¢å¼•åˆæœ‰ä»€ä¹ˆå…³è”å‘¢ï¼Ÿä¸ºä»€ä¹ˆå›è¡¨æŸ¥è¯¢éœ€è¦éå†2æ¬¡ç´¢å¼•æ ‘å‘¢ï¼Ÿ</p><h3 id="2-èšç°‡ç´¢å¼•"><a href="#2-èšç°‡ç´¢å¼•" class="headerlink" title="2. èšç°‡ç´¢å¼•"></a>2. èšç°‡ç´¢å¼•</h3><p>InnoDBçš„ç´¢å¼•ç±»å‹ä¹‹å‰æœ‰è¯´è¿‡ï¼Œå¤šæ•°ä½¿ç”¨B+Treeåšç´¢å¼•ä½†åœ¨å®ç°ä¸ŠåˆåŒºåˆ†ä¸ºï¼š<code>èšç°‡ç´¢å¼•</code>å’Œ<code>è¾…åŠ©ç´¢å¼•</code>ã€‚</p><ul><li>èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰</li></ul><blockquote><p>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼ŒInnoDBæœ‰ä¸”åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥é¢å¯¹RangeæŸ¥è¯¢èšç°‡ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InnoDBé»˜è®¤ä¸»é”®æ˜¯èšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®åˆ™ç¬¬ä¸€ä¸ªNot Null &amp; Uniqueç´¢å¼•åˆ—ä¸ºèšç°‡ç´¢å¼•ã€‚å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ª6å­—èŠ‚çš„éšå¼è‡ªå¢é•¿ä¸»é”®`row-id`ã€‚</span><br></pre></td></tr></table></figure><p>ï¼ˆ<font color="yellow">è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆInnoDBå¼•æ“ä¸‹è¦æ±‚æ•°æ®è¡¨å°½å¯èƒ½éƒ½è¦åˆ›å»ºä¸»é”®çš„åŸå› </font>ã€‚ï¼‰</p><ul><li>è¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼‰</li></ul><blockquote><p>è¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ï¼ˆèšç°‡ç´¢å¼•ï¼‰ã€‚</p></blockquote><p>äº†è§£äº†ç´¢å¼•æ ‘çš„ç»“æ„ï¼Œå…¶å®ä¹Ÿå°±æ˜ç™½äº†ä¸ºä»€ä¹ˆæ˜æ˜å‘½ä¸­äº†ç´¢å¼•å´è¿˜ä¼šäº§ç”Ÿå›è¡¨æŸ¥è¯¢éœ€è¦æ‰«æ2æ¬¡ç´¢å¼•æ ‘ï¼Œå³ï¼šå…ˆæ‰«æè¾…åŠ©ç´¢å¼•æ ‘æ‹¿åˆ°ä¸»é”®å€¼ï¼Œå†æ‰«æèšç°‡ç´¢å¼•æ ‘è·å–è¡Œè®°å½•ã€‚</p><h3 id="3-å¦‚ä½•é¿å…å›è¡¨æŸ¥è¯¢ï¼Ÿ"><a href="#3-å¦‚ä½•é¿å…å›è¡¨æŸ¥è¯¢ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•é¿å…å›è¡¨æŸ¥è¯¢ï¼Ÿ"></a>3. å¦‚ä½•é¿å…å›è¡¨æŸ¥è¯¢ï¼Ÿ</h3><p>é¿å…å›è¡¨æŸ¥è¯¢è¿™é‡Œæœ‰ä¸ªæ¦‚å¿µï¼šè¦†ç›–ç´¢å¼•ï¼ˆCovering indexï¼‰ï¼ŒMysqlå®˜æ–¹è™½ç„¶æ²¡æœ‰æ˜ç¡®å®šä¹‰<code>è¦†ç›–ç´¢å¼•</code>ä½†æ˜¯æœ‰åŒæ ·çš„æ¦‚å¿µå‡ºç°ã€‚</p><blockquote><p>æŸ¥è¯¢çš„å­—æ®µå°½å¯èƒ½åœ¨ä¸€æ£µç´¢å¼•æ ‘éƒ½èƒ½è·å–åˆ°ï¼Œé¿å…å›è¡¨ã€‚</p></blockquote><p>ï¼ˆæ¦‚å¿µå‡ºå¤„ï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html#explain-extra-information" target="_blank" rel="noopener">Using index</a>ï¼‰</p><p>å…·ä½“æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿç›´æ¥ä¸ŠSQLã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`users`</span> <span class="keyword">DROP</span> <span class="keyword">INDEX</span> <span class="string">`name`</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`users`</span> <span class="keyword">ADD</span> <span class="keyword">INDEX</span> <span class="string">`user_name`</span> ( <span class="string">`user`</span>, <span class="string">`name`</span> );</span><br></pre></td></tr></table></figure></p><p>åˆ›å»º<code>user</code>ã€<code>name</code>å¤åˆç´¢å¼•ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¦†ç›–ç´¢å¼•ä¸éœ€è¦å›è¡¨ã€‚</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>åŸ‹ä¸ªå‘ï¼Œåé¢æœ‰æ—¶é—´ä¼šç»§ç»­å­¦ä¹ ç›¸æ¯”è¾…åŠ©ç´¢å¼•èšç°‡ç´¢å¼•å¹³å‡ä¼šå‡å°‘å¤šå°‘æ¬¡IOæ“ä½œã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰ç®€å•äº†è§£è¿‡Mysqlçš„ç´¢å¼•ï¼Œä»Šå¤©æ¥å­¦ä¹ ä¸€ä¸‹Mysqlï¼ˆInnoDBï¼‰çš„èšç°‡ç´¢å¼•ä»¥åŠSQLä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå›è¡¨æŸ¥è¯¢ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1. ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ&quot;&gt;&lt;/a&gt;1. ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ&lt;/h3&gt;&lt;p&gt;éƒ½çŸ¥é“Mysqlå­˜å‚¨çš„æ•°æ®ç»“æ„æ˜¯B+Treeï¼Œæ‰€ä»¥å½“æŸ¥è¯¢æ•°æ®çš„æ—¶å€™èƒ½æœ€å¿«æ‰¾åˆ°å¶å­èŠ‚ç‚¹çš„æ£€ç´¢æ–¹å¼æ—¶æ˜¯æœ€å¿«çš„ã€‚æ¯”å¦‚ï¼šä¸»é”®ç›´æ¥å®šä½è¡Œè®°å½•ï¼Œè€Œæœ‰äº›æŸ¥è¯¢éœ€è¦å…ˆæ£€ç´¢ç´¢å¼•æ ‘æ‰¾åˆ°å¶å­èŠ‚ç‚¹çš„ä¸»é”®å€¼ï¼Œå†é€šè¿‡ä¸»é”®å€¼å®šä½è¡Œè®°å½•è¿™ç§æ‰«æ2æ¬¡ç´¢å¼•æ ‘çš„æ–¹å¼å°±å«åšå›è¡¨æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ç¡®å®šSQLè¯­å¥ä¼šä¸ä¼šé€ æˆå›è¡¨æŸ¥è¯¢ï¼Ÿå¦‚ä¸‹è¡¨ï¼š&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;`users`&lt;/span&gt;  (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`user`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;125&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; utf8mb4 &lt;span class=&quot;keyword&quot;&gt;COLLATE&lt;/span&gt; utf8mb4_unicode_ci &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; utf8mb4 &lt;span class=&quot;keyword&quot;&gt;COLLATE&lt;/span&gt; utf8mb4_unicode_ci &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`status`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;tinyint&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`created_at`&lt;/span&gt; datetime &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PRIMARY &lt;span class=&quot;keyword&quot;&gt;KEY&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;`id`&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;USING&lt;/span&gt; BTREE,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;UNIQUE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;INDEX&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;`user`&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`user`&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;USING&lt;/span&gt; BTREE,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;INDEX&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;`name`&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`name`&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;USING&lt;/span&gt; BTREE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;) &lt;span class=&quot;keyword&quot;&gt;ENGINE&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;InnoDB&lt;/span&gt; AUTO_INCREMENT = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; = utf8mb4 &lt;span class=&quot;keyword&quot;&gt;COLLATE&lt;/span&gt; = utf8mb4_unicode_ci ROW_FORMAT = &lt;span class=&quot;keyword&quot;&gt;Compact&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;2ç§æŸ¥è¯¢æ–¹å¼ï¼š&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®° - Keyäº‹ä»¶é€šçŸ¥</title>
    <link href="http://xupin.im/2020/08/10/redis-keyspace-notify/"/>
    <id>http://xupin.im/2020/08/10/redis-keyspace-notify/</id>
    <published>2020-08-09T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.756Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ä¸Šè´­ç‰©çœ‹åˆ°è‡ªå·±å–œæ¬¢çš„ä¸œè¥¿åŠ å…¥è´­ç‰©è½¦ç„¶åä»˜æ¬¾ï¼Œä½†æ˜¯åœ¨ä»˜æ¬¾çš„çªç„¶ä¸æƒ³è¦äº† â€¦ å¾€å¾€è¿™ä¸ªè®¢å•ä¼šç»™ä¸€ä¸ª30åˆ†é’Ÿçš„æ”¯ä»˜æ—¶é—´ï¼Œæ—¶é—´ä¸€åˆ°å°±è‡ªåŠ¨å…³é—­äº† æ‰€ä»¥è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><h3 id="1-å®ç°æ–¹å¼"><a href="#1-å®ç°æ–¹å¼" class="headerlink" title="1.å®ç°æ–¹å¼"></a>1.å®ç°æ–¹å¼</h3><ul><li><p>è½®è¯¢</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è„šæœ¬æ¯éš”ä¸€å®šæ—¶é—´å°±å»æ•°æ®è¡¨æ£€æŸ¥ä¸€ä¸‹çŠ¶æ€ï¼Œæ˜¯å¦è¿‡æœŸéœ€è¦å…³é—­ã€‚</span><br></pre></td></tr></table></figure></li><li><p>å®šæ—¶å™¨</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºè®¢å•æ—¶å¼€å§‹è®¡æ—¶ï¼Œè®¡æ—¶ç»“æŸåç›´æ¥å¤„ç†å…³é—­è®¢å•ã€‚</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®åº“äº‹ä»¶+å­˜å‚¨è¿‡ç¨‹</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®åº“å»ºç«‹æ£€æŸ¥äº‹ä»¶ï¼Œæ¯éš”ä¸€å®šæ—¶é—´å»æ‰§è¡Œä¸€æ¬¡å­˜å‚¨è¿‡ç¨‹ã€‚</span><br></pre></td></tr></table></figure></li><li><p>Keyäº‹ä»¶é€šçŸ¥</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºæ›´æ”¹ä»»ä½•Redis Keyçš„æ¯ä¸ªæ“ä½œï¼Œéƒ½å¯ä»¥é…ç½®Rediså°†æ¶ˆæ¯å‘å¸ƒåˆ°Pub/Subï¼Œç„¶åè®¢é˜…è¿™äº›é€šçŸ¥ã€‚</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-æ•°æ®åº“äº‹ä»¶-å­˜å‚¨è¿‡ç¨‹"><a href="#2-æ•°æ®åº“äº‹ä»¶-å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="2.æ•°æ®åº“äº‹ä»¶+å­˜å‚¨è¿‡ç¨‹"></a>2.æ•°æ®åº“äº‹ä»¶+å­˜å‚¨è¿‡ç¨‹</h3><p>ä¸å¤šè¯´ï¼Œç›´æ¥ä¸ŠSQL</p><a id="more"></a><ol><li><p>è®¢å•è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`orders`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`good_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'0:å¾…ä»˜æ¬¾ï¼Œ1:å·²ä»˜æ¬¾ï¼Œ-1:è®¢å•å…³é—­'</span>,</span><br><span class="line">  <span class="string">`created_at`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">1</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_unicode_ci ROW_FORMAT = <span class="keyword">Compact</span>;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼Œå¤„ç†å…³é—­è®¢å•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> job_proce()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"> <span class="keyword">update</span> orders <span class="keyword">set</span> <span class="keyword">status</span> = <span class="number">-1</span> <span class="keyword">where</span> time_to_sec(<span class="keyword">timediff</span>(<span class="keyword">now</span>(), created_at)) &gt; <span class="number">1800</span> <span class="keyword">and</span> <span class="keyword">status</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºäº‹ä»¶ï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> event_scheduler = <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EVENT</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> job_event</span><br><span class="line"><span class="keyword">ON</span> SCHEDULE EVERY <span class="number">1</span> <span class="keyword">SECOND</span> <span class="comment"># 1ç§’æ£€æŸ¥ä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">ON</span> COMPLETION <span class="keyword">PRESERVE</span>  </span><br><span class="line"><span class="keyword">DO</span> <span class="keyword">CALL</span> job_proce();</span><br></pre></td></tr></table></figure></li><li><p>å¼€å¯äº‹ä»¶ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">EVENT</span> job_event <span class="keyword">ON</span>  COMPLETION <span class="keyword">PRESERVE</span> <span class="keyword">ENABLE</span>;</span><br></pre></td></tr></table></figure></li></ol><p>è¿™æ ·<code>job_event</code>äº‹ä»¶å°±ä¼šä»¥1ç§’/æ¬¡çš„é¢‘ç‡å»æ‰§è¡Œ<code>job_proce</code>å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œæ•°æ®æ£€æŸ¥ã€‚</p><h3 id="3-Keyäº‹ä»¶é€šçŸ¥"><a href="#3-Keyäº‹ä»¶é€šçŸ¥" class="headerlink" title="3. Keyäº‹ä»¶é€šçŸ¥"></a>3. Keyäº‹ä»¶é€šçŸ¥</h3><p>Keyäº‹ä»¶é€šçŸ¥ï¼ˆRedis Keyspace Notificationsï¼‰æœºåˆ¶è‡ª2.8ç‰ˆæœ¬ä»¥åå‡ºç°ï¼Œè¯¥æœºåˆ¶é»˜è®¤æ˜¯å…³é—­çš„ã€‚å¯é€šè¿‡é…ç½®<code>redis.conf</code>è¿›è¡Œå¼€å¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">notify-keyspace-events Ex # Eè¡¨ç¤ºKeyäº‹ä»¶é€šçŸ¥ï¼Œxä»£è¡¨Keyè¿‡æœŸè¡Œä¸ºã€‚</span><br><span class="line"></span><br><span class="line"># notify-keyspace-eventså¯é…ç½®å‚æ•°</span><br><span class="line"># K é”®ç©ºé—´äº‹ä»¶ï¼Œä»¥__keyspace@&lt;db&gt;__å‰ç¼€å‘å¸ƒã€‚</span><br><span class="line"># E é”®äº‹ä»¶äº‹ä»¶ï¼Œä»¥__keyevent@&lt;db&gt;__å‰ç¼€å‘å¸ƒã€‚</span><br><span class="line"># g é€šç”¨å‘½ä»¤ï¼ˆéç±»å‹ç‰¹å®šï¼‰ï¼Œå¦‚DELï¼ŒEXPIREï¼ŒRENAMEç­‰ç­‰</span><br><span class="line"># $ å­—ç¬¦ä¸²å‘½ä»¤</span><br><span class="line"># l åˆ—è¡¨å‘½ä»¤</span><br><span class="line"># s é›†åˆå‘½ä»¤</span><br><span class="line"># h å“ˆå¸Œå‘½ä»¤</span><br><span class="line"># z æœ‰åºé›†åˆå‘½ä»¤</span><br><span class="line"># x è¿‡æœŸäº‹ä»¶ï¼ˆæ¯æ¬¡é”®åˆ°æœŸæ—¶ç”Ÿæˆçš„äº‹ä»¶ï¼‰</span><br><span class="line"># e è¢«é©±é€çš„äº‹ä»¶ï¼ˆå½“ä¸€ä¸ªé”®ç”±äºè¾¾åˆ°æœ€å¤§å†…å­˜è€Œè¢«é©±é€æ—¶äº§ç”Ÿçš„äº‹ä»¶ï¼‰</span><br><span class="line"># A g$lshzxeçš„åˆ«åï¼Œå› æ­¤å­—ç¬¦ä¸²AKEè¡¨ç¤ºæ‰€æœ‰çš„äº‹ä»¶ã€‚</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹é…ç½®å¼€å¯Keyäº‹ä»¶é€šçŸ¥ä»¥åï¼Œå½“Redisåœ¨åˆ é™¤è¿‡æœŸKeyçš„æ—¶å€™ä¼šå‘æŒ‡å®šchannelï¼ˆè¿‡æœŸè¡Œä¸ºçš„channelï¼š<code>__keyevent@0__:expired</code>ï¼‰ publishæ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å¯ä»¥ä½¿ç”¨subscribe/psubscribeè¿›è¡Œè®¢é˜…ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PSUBSCRIBE __keyevent@<span class="number">0</span>__:expired</span><br><span class="line">Reading messages... (<span class="built_in">press</span> Ctrl-C to quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">"psubscribe"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"__keyevent@0__:expired"</span></span><br><span class="line"><span class="number">3</span>) (integer) <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å†™ä¸ªç¨‹åºæ‰§è¡Œredis-&gt;psubscribe()è¿›è¡Œç›‘å¬å³å¯ã€‚</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>emmmmâ€¦</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç½‘ä¸Šè´­ç‰©çœ‹åˆ°è‡ªå·±å–œæ¬¢çš„ä¸œè¥¿åŠ å…¥è´­ç‰©è½¦ç„¶åä»˜æ¬¾ï¼Œä½†æ˜¯åœ¨ä»˜æ¬¾çš„çªç„¶ä¸æƒ³è¦äº† â€¦ å¾€å¾€è¿™ä¸ªè®¢å•ä¼šç»™ä¸€ä¸ª30åˆ†é’Ÿçš„æ”¯ä»˜æ—¶é—´ï¼Œæ—¶é—´ä¸€åˆ°å°±è‡ªåŠ¨å…³é—­äº† æ‰€ä»¥è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;1-å®ç°æ–¹å¼&quot;&gt;&lt;a href=&quot;#1-å®ç°æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;1.å®ç°æ–¹å¼&quot;&gt;&lt;/a&gt;1.å®ç°æ–¹å¼&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;è½®è¯¢&lt;/p&gt;
  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;è„šæœ¬æ¯éš”ä¸€å®šæ—¶é—´å°±å»æ•°æ®è¡¨æ£€æŸ¥ä¸€ä¸‹çŠ¶æ€ï¼Œæ˜¯å¦è¿‡æœŸéœ€è¦å…³é—­ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å®šæ—¶å™¨&lt;/p&gt;
  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;åˆ›å»ºè®¢å•æ—¶å¼€å§‹è®¡æ—¶ï¼Œè®¡æ—¶ç»“æŸåç›´æ¥å¤„ç†å…³é—­è®¢å•ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ•°æ®åº“äº‹ä»¶+å­˜å‚¨è¿‡ç¨‹&lt;/p&gt;
  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;æ•°æ®åº“å»ºç«‹æ£€æŸ¥äº‹ä»¶ï¼Œæ¯éš”ä¸€å®šæ—¶é—´å»æ‰§è¡Œä¸€æ¬¡å­˜å‚¨è¿‡ç¨‹ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Keyäº‹ä»¶é€šçŸ¥&lt;/p&gt;
  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å¯¹äºæ›´æ”¹ä»»ä½•Redis Keyçš„æ¯ä¸ªæ“ä½œï¼Œéƒ½å¯ä»¥é…ç½®Rediså°†æ¶ˆæ¯å‘å¸ƒåˆ°Pub/Subï¼Œç„¶åè®¢é˜…è¿™äº›é€šçŸ¥ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-æ•°æ®åº“äº‹ä»¶-å­˜å‚¨è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#2-æ•°æ®åº“äº‹ä»¶-å­˜å‚¨è¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;2.æ•°æ®åº“äº‹ä»¶+å­˜å‚¨è¿‡ç¨‹&quot;&gt;&lt;/a&gt;2.æ•°æ®åº“äº‹ä»¶+å­˜å‚¨è¿‡ç¨‹&lt;/h3&gt;&lt;p&gt;ä¸å¤šè¯´ï¼Œç›´æ¥ä¸ŠSQL&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="redis" scheme="http://xupin.im/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Gitå°çŸ¥è¯† - Cloneé¡¹ç›®é€Ÿåº¦æ…¢çš„å°æŠ€å·§</title>
    <link href="http://xupin.im/2020/07/05/git-cloning-slow/"/>
    <id>http://xupin.im/2020/07/05/git-cloning-slow/</id>
    <published>2020-07-04T16:00:00.000Z</published>
    <updated>2022-12-15T04:31:28.035Z</updated>
    
    <content type="html"><![CDATA[<p>ç¢°ä¸Šgithubç½‘ç»œæŠ½é£çš„æ—¶å€™ï¼Œæ°å·§ä½ åˆéœ€è¦æ‹‰å–githubä¸Šæ‰˜ç®¡çš„é¡¹ç›®ï¼Œè¿™ä¸ªæ—¶å€™çœ‹ç€2kb/sçš„ä¸‹è½½é€Ÿåº¦æ˜¯ä¸æ˜¯å¾ˆæŠ“ç‹‚ï¼Ÿ</p><h3 id="ç²—æš´çš„è§£å†³æ–¹å¼"><a href="#ç²—æš´çš„è§£å†³æ–¹å¼" class="headerlink" title="ç²—æš´çš„è§£å†³æ–¹å¼"></a>ç²—æš´çš„è§£å†³æ–¹å¼</h3><p>æ‰“å¼€<a href="https://www.ipaddress.com" target="_blank" rel="noopener">ipaddress</a>æŸ¥è¯¢ä»¥ä¸‹ä¸‰ä¸ªåŸŸåçš„ipï¼Œå†™åˆ°hostsæ–‡ä»¶ä¸­ã€‚</p><ul><li>github.com</li><li>github.global.ssl.fastly.net</li><li>codeload.github.com</li></ul><h3 id="è¿›é˜¶çš„æ–¹å¼"><a href="#è¿›é˜¶çš„æ–¹å¼" class="headerlink" title="è¿›é˜¶çš„æ–¹å¼"></a>è¿›é˜¶çš„æ–¹å¼</h3><a id="more"></a><p>æŒ‚ä»£ç†ï¼Œå“¦è±<br>export ALL_PROXY=socks5://127.0.0.1:4000</p><h3 id="ç©¶ææ–¹å¼"><a href="#ç©¶ææ–¹å¼" class="headerlink" title="ç©¶ææ–¹å¼"></a>ç©¶ææ–¹å¼</h3><ol><li><p>å¤åˆ¶ä½ è¦æ‹‰å–çš„é¡¹ç›®githubåœ°å€ï¼Œæ¯”å¦‚ï¼š<a href="https://github.com/v2ray/v2ray-core" target="_blank" rel="noopener">https://github.com/v2ray/v2ray-core</a></p></li><li><p>æ‰“å¼€<a href="https://gitee.com" target="_blank" rel="noopener">ç äº‘</a>ï¼Œåˆ›å»ºä»“åº“-&gt;ä» GitHub / GitLab å¯¼å…¥ä»“åº“</p></li><li><p>æå®šï¼git clone <a href="https://gitee.com/xupinbest/v2ray-core" target="_blank" rel="noopener">https://gitee.com/xupinbest/v2ray-core</a></p></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¢°ä¸Šgithubç½‘ç»œæŠ½é£çš„æ—¶å€™ï¼Œæ°å·§ä½ åˆéœ€è¦æ‹‰å–githubä¸Šæ‰˜ç®¡çš„é¡¹ç›®ï¼Œè¿™ä¸ªæ—¶å€™çœ‹ç€2kb/sçš„ä¸‹è½½é€Ÿåº¦æ˜¯ä¸æ˜¯å¾ˆæŠ“ç‹‚ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;ç²—æš´çš„è§£å†³æ–¹å¼&quot;&gt;&lt;a href=&quot;#ç²—æš´çš„è§£å†³æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;ç²—æš´çš„è§£å†³æ–¹å¼&quot;&gt;&lt;/a&gt;ç²—æš´çš„è§£å†³æ–¹å¼&lt;/h3&gt;&lt;p&gt;æ‰“å¼€&lt;a href=&quot;https://www.ipaddress.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ipaddress&lt;/a&gt;æŸ¥è¯¢ä»¥ä¸‹ä¸‰ä¸ªåŸŸåçš„ipï¼Œå†™åˆ°hostsæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;github.com&lt;/li&gt;
&lt;li&gt;github.global.ssl.fastly.net&lt;/li&gt;
&lt;li&gt;codeload.github.com&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;è¿›é˜¶çš„æ–¹å¼&quot;&gt;&lt;a href=&quot;#è¿›é˜¶çš„æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;è¿›é˜¶çš„æ–¹å¼&quot;&gt;&lt;/a&gt;è¿›é˜¶çš„æ–¹å¼&lt;/h3&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="github" scheme="http://xupin.im/tags/github/"/>
    
    <category term="biscuits" scheme="http://xupin.im/tags/biscuits/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - goroutine</title>
    <link href="http://xupin.im/2020/06/12/goroutine/"/>
    <id>http://xupin.im/2020/06/12/goroutine/</id>
    <published>2020-06-11T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.751Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç°åœ¨å¤§æ•°æ®ã€é«˜å¹¶å‘ï¼Œåˆ°å¤„éƒ½å……æ–¥ç€æµé‡çš„äº’è”ç½‘æ—¶ä»£ï¼Œèƒ½ä¸èƒ½åº”å¯¹é«˜å¹¶å‘ä¿¨ç„¶å·²ç»å‘å±•æˆä¸€ä¸ªè¡¡é‡æœåŠ¡ç«¯æ¶æ„æ˜¯å¦åˆæ ¼çš„æ ‡å‡†ï¼Œä½œä¸ºç¨‹åºåª›æˆ‘ä»¬æ€è€ƒå¦‚ä½•åˆ©ç”¨è¯­è¨€åœ¨ä»£ç å±‚é¢æœ€ä¼˜è®¾è®¡èƒ½åº”å¯¹å¹¶å‘çš„ç¨‹åºå»å¹¶è¡Œå¤„ç†ä»»åŠ¡ã€‚åœ¨ç¨‹åºä¸­å¯¹äºä»»åŠ¡å¹¶è¡Œå¤„ç†ä¸€èˆ¬è¶‹äºä½¿ç”¨ï¼šè¿›ç¨‹ã€çº¿ç¨‹ï¼Œä»¥åŠå¦å¤–ä¸€ç§ï¼š<code>åç¨‹</code>ã€‚æ”¯æŒåç¨‹çš„è¯­è¨€æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šC/C++ã€Rubyã€ Pythonï¼ˆ2.5+ï¼‰ã€Golangç­‰ç­‰ï¼Œå®ƒä»¬æœ‰äº›æ˜¯æœ¬èº«è¯­è¨€æ”¯æŒåç¨‹ï¼Œæœ‰äº›åˆ™æ˜¯éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…æ¥ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸»è¦æ¥å­¦ä¹ ä¸€ä¸‹Golangè¿™é—¨è¯­è¨€ï¼ˆç®€ç§°Goï¼‰ï¼Œå®ƒæ˜¯å¦‚ä½•ç†è§£ä»¥åŠå®ç°åç¨‹çš„ã€‚</p><h3 id="ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ"><a href="#ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ"></a>ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ</h3><p>éƒ½çŸ¥é“ä¸€å°è®¡ç®—æœºçš„æ ¸å¿ƒæ˜¯CPUï¼Œå®ƒæ‰¿æ‹…ç€æ‰€æœ‰çš„è¿ç®—ã€‚è€Œè®¡ç®—æœºæ‰¿è½½çš„æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰åˆ™æ˜¯è´Ÿè´£æ‰€æœ‰ä»»åŠ¡çš„å¤„ç†å’Œè°ƒåº¦CPUä»¥åŠèµ„æºçš„åˆ†é…ã€‚å¦‚æœç”¨äººç±»æ¥æ¯”å–»ï¼Œå¤§è„‘æ˜¯CPUï¼Œæ€ç»´åˆ™æ˜¯æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰ã€‚</p><h4 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h4><p>æœ€æ—©çš„è®¡ç®—æœºæ¯æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œå¦‚æœè¿˜æœ‰å…¶ä»–ç¨‹åºéœ€è¦æ‰§è¡Œåˆ™è¦æ’é˜Ÿç­‰å¾…ã€‚åæ¥CPUè¿ç®—èƒ½åŠ›æé«˜äº†ï¼Œè¿™ç§æ–¹å¼è¿‡äºåŸå§‹æœ‰äº›æµªè´¹æ€§èƒ½ï¼Œäºæ˜¯å°è¯•è®©å¤šä¸ªç¨‹åºå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œä½†æ˜¯è¿™æ ·é¢ä¸´ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šè·‘åœ¨åŒä¸€ä¸ªCPUä¸­çš„ç¨‹åºéƒ½ä¼šä½¿ç”¨è®¡ç®—æœºèµ„æºï¼Œé‚£ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œæ•°æ®æ€ä¹ˆä¿éšœï¼Ÿ<code>è¿›ç¨‹</code>ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿›ç¨‹æ˜¯å†…æ ¸èµ„æºç®¡ç†åˆ†é…çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚å†…æ ¸ä¸­çš„æ¯ä¸ªç¨‹åºéƒ½è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸Šä¸‹æ–‡æ˜¯ç”±ç¨‹åºæ­£å¸¸è¿è¡Œéœ€è¦çš„ä¸€ç³»åˆ—å‚æ•°ç»„æˆï¼Œå‚æ•°åŒ…æ‹¬å­˜å‚¨å™¨ä¸­çš„ä»£ç å’Œæ•°æ®ï¼Œå¯„å­˜å™¨ä¸­çš„å†…å®¹ä»¥åŠè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ–‡ä»¶å¥æŸ„ï¼‰ç­‰ã€‚å¯ä»¥æŠŠä¸Šä¸‹æ–‡é€šä¿—ç†è§£ä¸ºï¼š`ç¯å¢ƒ`ã€‚</span><br></pre></td></tr></table></figure></p><p>å¦‚æœç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦è¿›è¡ŒIOæ“ä½œï¼ŒIOæ“ä½œé˜»å¡äº†ç¨‹åºåé¢çš„è®¡ç®—ï¼Œè¿™æ—¶å€™CPUå±äºç©ºé—²çŠ¶æ€ï¼Œé‚£å†…æ ¸ä¼šæŠŠCPUåˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹å»å¤„ç†ã€‚ä¸è¿‡å½“è¿›ç¨‹æ•°é‡å˜é«˜ä»¥åï¼Œè®¡ç®—æœºçš„å¤§éƒ¨åˆ†èµ„æºéƒ½è¢«è¿›ç¨‹åˆ‡æ¢è¿™ä¸ªæ“ä½œæ¶ˆè€—æ‰äº†ã€‚ä¸ºä»€ä¹ˆè¯´è¿›ç¨‹åˆ‡æ¢æ“ä½œæ¶ˆè€—èµ„æºä»£ä»·æ¯”è¾ƒé«˜ï¼Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰€è°“è¿›ç¨‹åˆ‡æ¢å…¶å®å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œéœ€è¦åˆ‡æ¢æ–°çš„é¡µè¡¨å¹¶åŠ è½½æ–°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€åˆ‡æ¢å†…æ ¸æ ˆä»¥åŠç¡¬ä»¶ä¸Šä¸‹æ–‡ç­‰ã€‚åªè¦å‘ç”Ÿè¿›ç¨‹åˆ‡æ¢æ“ä½œå°±å¾—åå¤è¿›å…¥å†…æ ¸ï¼ŒåŠ è½½åˆ‡æ¢ä¸€ç³»åˆ—çŠ¶æ€ã€‚</span><br></pre></td></tr></table></figure></p><h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><p>ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼Œ<code>çº¿ç¨‹</code>åº”è¿è€Œç”Ÿã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹æ˜¯å†…æ ¸è°ƒåº¦CPUæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡çš„é€»è¾‘æµï¼Œçº¿ç¨‹æ˜¯å…·ä½“æ‰§è¡Œç¨‹åºçš„å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘åŒ…å«ä¸€ä¸ªä¸»çº¿ç¨‹ï¼ˆå¯ä»¥æ‹¥æœ‰å¤šä¸ªå­çº¿ç¨‹ï¼‰ï¼Œä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½å­˜åœ¨äºä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚</span><br></pre></td></tr></table></figure></p><p>çº¿ç¨‹åˆ‡æ¢ç›¸æ¯”è¿›ç¨‹åˆ‡æ¢å¼€é”€å°±å°äº†å¾ˆå¤šï¼Œçº¿ç¨‹åˆ‡æ¢åªéœ€è¦æŠŠå¯„å­˜å™¨åˆ·æ–°å³å¯ã€‚</p><h4 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h4><p>åé¢ç¨‹åºåª›ä»¬å‘ç°çº¿ç¨‹è¿™æ ·è¿˜æ˜¯æœ‰æ€§èƒ½ç“¶é¢ˆï¼ˆIOé˜»å¡ï¼‰ï¼Œæ— è®ºæ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹å› ä¸ºæ¶‰åŠåˆ°å¤§é‡çš„è®¡ç®—æœºèµ„æºï¼Œæ‰€ä»¥éƒ½æ˜¯ç”±å†…æ ¸è°ƒåº¦ç®¡ç†ã€‚èƒ½ä¸èƒ½å¼€å‘ä¸€ç§ç”±ä»£ç æ§åˆ¶çš„çº¿ç¨‹å‘¢ï¼Ÿè¿™å°±æ˜¯<code>åç¨‹</code>ã€‚</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åç¨‹æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„çº¿ç¨‹ï¼ˆç”¨æˆ·æ€çº¿ç¨‹ï¼‰ï¼Œåç¨‹åœ¨ç¨‹åºä¸­å®ç°è‡ªæˆ‘è°ƒåº¦ï¼Œä¸éœ€è¦åƒè¿›ç¨‹åˆ‡æ¢ä¸€æ ·è¿›å…¥å†…æ ¸åŠ è½½åˆ‡æ¢çŠ¶æ€ï¼Œæé«˜äº†çº¿ç¨‹åœ¨IOä¸Šçš„æ€§èƒ½é—®é¢˜ï¼ˆIOå¤šè·¯å¤ç”¨ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åç¨‹ä¹Ÿæœ‰ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå‡å¦‚è¿›ç¨‹ä¸­çš„æŸä¸€ç¨‹åºå‡ºç°äº†é˜»å¡æ“ä½œåŒæ—¶è¢«CPUä¸­æ–­å¤„ç†ï¼ˆæŠ¢å å¼è°ƒåº¦ï¼‰ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚</p><p>åé¢ä¼šä¸“é—¨å†™ä¸€ç¯‡å…³äºè¿›ç¨‹å’Œçº¿ç¨‹ä»¥åŠåç¨‹çš„ç‰¹æ€§ä»¥åŠåŒºåˆ«ã€‚ï¼ˆä¸å¤Ÿè¯¦ç»†ï¼ŒåŸ‹å‘Orz~ï¼‰</p><h3 id="äºŒã€ä»€ä¹ˆæ˜¯goroutineï¼Ÿ"><a href="#äºŒã€ä»€ä¹ˆæ˜¯goroutineï¼Ÿ" class="headerlink" title="äºŒã€ä»€ä¹ˆæ˜¯goroutineï¼Ÿ"></a>äºŒã€ä»€ä¹ˆæ˜¯goroutineï¼Ÿ</h3><p>ä¸Šé¢ç®€å•å­¦ä¹ äº†è¿›ç¨‹å’Œçº¿ç¨‹ä»¥åŠåç¨‹çš„æ¸Šæºï¼Œè™½ç„¶ä¸å¤Ÿè¯¦ç»†ä½†æ˜¯æˆ‘ä»¬å¤§æ¦‚çŸ¥é“å…¶å®åœ¨è¿›ç¨‹æˆ–è€…çº¿ç¨‹ç”šè‡³äºåç¨‹å­˜åœ¨çš„æ€§èƒ½ç“¶é¢ˆå¤§éƒ¨åˆ†æ˜¯CPUè°ƒåº¦é—®é¢˜ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> // <span class="title">Go</span>è¯­è¨€å¯åŠ¨åç¨‹ï¼Œåªéœ€è¦ä½¿ç”¨<span class="title">go</span>å…³é”®å­—å³å¯å¯åŠ¨åç¨‹è¿è¡Œå‡½æ•°ã€‚ä½¿ç”¨<span class="title">go</span>å…³é”®å­—åˆ›å»ºçš„è¿™ä¸ªåç¨‹å°±å«åš`<span class="title">goroutine</span>`</span></span><br></pre></td></tr></table></figure><p>ä¹‹å‰è¯´äº†goroutineæ˜¯Goè¯­è¨€çš„åç¨‹ï¼Œå…¶å®è¿™ä¹ˆç†è§£æ˜¯å¯ä»¥çš„ä½†goroutineæ¯”åç¨‹æ›´å¼ºå¤§ã€‚å®ƒä»¬ä½¿ç”¨çš„çº¿ç¨‹æ¨¡å‹æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>goroutineé€šè¿‡é€šé“æ¥é€šä¿¡ï¼Œè€Œåç¨‹é€šè¿‡è®©å‡ºæ‰§è¡Œå’Œæ¢å¤æ“ä½œæ¥é€šä¿¡ã€‚</p><p>goroutineé€šè¿‡Goè¯­è¨€çš„è°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦ï¼Œè€Œåç¨‹é€šè¿‡ç¨‹åºæœ¬èº«è°ƒåº¦ã€‚</p></blockquote><p>å¤§éƒ¨åˆ†è¯­è¨€æˆ–è€…ç¬¬ä¸‰æ–¹åº“æä¾›çš„åç¨‹å°±æ˜¯ä½¿ç”¨çš„ç”¨æˆ·æ€çº¿ç¨‹æ¨¡å‹ï¼Œä½†goroutineä½¿ç”¨çš„ä¸æ˜¯ä¼ ç»Ÿçš„ç”¨æˆ·æ€çº¿ç¨‹æ¨¡å‹ã€‚ä»¥ä¸‹ä¸»æµçš„çº¿ç¨‹æ¨¡å‹ï¼š</p><ul><li>å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹<br>  å†…æ ¸çº§åˆ«çš„çº¿ç¨‹çš„çŠ¶æ€åˆ‡æ¢éœ€è¦å†…æ ¸ç›´æ¥å¤„ç†ï¼Œæ‰€ä»¥å†…æ ¸æ¸…æ¥šçš„çŸ¥é“æ¯ä¸€ä¸ªKSEï¼ˆKernel Scheduling Entityï¼‰çš„å­˜åœ¨ï¼ˆå³å†…æ ¸çº¿ç¨‹å’ŒKSEæ˜¯ä¸€å¯¹ä¸€å…³ç³»ï¼‰ï¼Œå®ƒä»¬å¯ä»¥å…¨ç³»ç»Ÿå†…è¿›è¡Œèµ„æºçš„ç«äº‰ã€‚</li><li>ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹ï¼ˆç”¨æˆ·æ€çº¿ç¨‹ï¼Œåç¨‹ï¼‰<br>  ç”¨æˆ·æ€çº§åˆ«çš„çº¿ç¨‹å—ç”¨æˆ·æ§åˆ¶ï¼Œå†…æ ¸å¹¶ä¸ç›´æ¥çŸ¥é“ç”¨æˆ·æ€çº¿ç¨‹çš„å­˜åœ¨ï¼ˆä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿå› ä¸ºç”¨æˆ·æ€çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹å­˜åœ¨ç€å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œå³å¤šä¸ªç”¨æˆ·æ€çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼‰ï¼Œä¸€èˆ¬ç”¨æˆ·æ€å¤šçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥å®ƒä»¬åªèƒ½åœ¨è¿›ç¨‹å†…è¿›è¡Œèµ„æºç«äº‰ã€‚</li><li>ä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼ˆæ··åˆå‹çº¿ç¨‹æ¨¡å‹ï¼‰<br>  ä¸¤çº§çº¿ç¨‹æ¨¡å‹å¸å–äº†å†…æ ¸çº§å’Œç”¨æˆ·çº§çº¿ç¨‹çš„ç»éªŒï¼Œä¸¤çº§çº¿ç¨‹æ¨¡å‹ä¸‹çš„çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹å¤„äºå¤šå¯¹å¤šçš„å…³ç³»ã€‚ä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å¯ä»¥åˆ†åˆ«ç»‘å®šå†…æ ¸çº¿ç¨‹ï¼Œæ—¢å¯ä»¥å¤šä¸ªçº¿ç¨‹ç»‘å®šå¤šä¸ªå†…æ ¸çº¿ç¨‹ä¹Ÿå¯ä»¥å¤šä¸ªçº¿ç¨‹ç»‘å®šä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå½“æŸä¸ªçº¿ç¨‹å†…çš„ç¨‹åºäº§ç”Ÿé˜»å¡å…¶ç»‘å®šçš„å†…æ ¸çº¿ç¨‹è¢«CPUä¸­æ–­å¤„ç†ï¼Œè¿›ç¨‹å†…çš„å…¶ä»–çº¿ç¨‹å¯ä»¥é‡æ–°ä¸å…¶ä»–å†…æ ¸çº¿ç¨‹ç»‘å®šã€‚</li></ul><p><img src="/assets/goroutine/thread_model.png" alt></p><p>goroutineä½¿ç”¨çš„æ­£æ˜¯ä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯è¿™ç§å¤šä¸ªçº¿ç¨‹è·‘åœ¨å¤šä¸ªå†…æ ¸ä¸­ï¼Œæ—¢ä¸æ˜¯ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹å®Œå…¨é è‡ªèº«è°ƒåº¦ä¹Ÿä¸æ˜¯å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹å®Œå…¨ä¾èµ–å†…æ ¸è°ƒåº¦ï¼Œè€Œæ˜¯ç”¨æˆ·å’Œå†…æ ¸ååŒè°ƒåº¦ã€‚å› ä¸ºè¿™ç§æ¨¡å‹å¤æ‚æ€§è¾ƒé«˜ï¼Œæ‰€ä»¥Goè¯­è¨€å¼€å‘äº†è‡ªå·±çš„runtimeè°ƒåº¦å™¨ã€‚</p><h3 id="ä¸‰ã€Go-runtimeè°ƒåº¦å™¨"><a href="#ä¸‰ã€Go-runtimeè°ƒåº¦å™¨" class="headerlink" title="ä¸‰ã€Go runtimeè°ƒåº¦å™¨"></a>ä¸‰ã€Go runtimeè°ƒåº¦å™¨</h3><p>Go runtimeè°ƒåº¦å™¨çš„ç»“æ„ç”±ä¸‰éƒ¨åˆ†ç»„æˆ:</p><ul><li>G<br>  Goroutineï¼Œæ¯ä¸ªgoroutineæœ‰å¯¹åº”çš„Gç»“æ„ä½“ï¼ŒGç»“æ„ä½“å‚¨å­˜goroutineçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚Gå¹¶ä¸èƒ½ç›´æ¥è¢«è°ƒåº¦ï¼Œéœ€è¦ç»‘å®šå¯¹åº”çš„Pæ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œã€‚</li><li><p>P<br>  Processorï¼Œä¸ºGå’ŒMè¿›è¡Œè°ƒåº¦çš„é€»è¾‘å¤„ç†å™¨ï¼Œå¯¹äºGæ¥è¯´Påƒæ˜¯å†…æ ¸ï¼Œè€Œåœ¨Mçœ‹æ¥Pç›¸å½“äºä¸Šä¸‹æ–‡ã€‚Pçš„æ•°é‡å¯ä»¥åœ¨ç¨‹åºä¸­ä»£ç æ§åˆ¶ï¼Œå¦‚ä¸‹:</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runtime.GOMAXPROCS(runtime.NumCPU()) <span class="comment">// è¯¥å€¼æœ€å¤§ä¸º256ã€‚</span></span><br></pre></td></tr></table></figure></li><li><p>M<br>  Machineï¼Œè´Ÿè´£è°ƒåº¦ä»»åŠ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºå†…æ ¸çº¿ç¨‹çš„æŠ½è±¡ï¼‰ï¼Œä»£è¡¨ç€æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œæ˜¯çœŸæ­£å¤„ç†ä»»åŠ¡çš„æœåŠ¡ã€‚Mçš„æ•°é‡ä¸æ˜¯å›ºå®šçš„ï¼Œå—Go runtimeè°ƒåº¦å™¨æ§åˆ¶ã€‚ï¼ˆä¸è¿‡è¯¥å€¼æœ€å¤§ä¸º10000ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://github.com/golang/go/blob/master/src/runtime/proc.go#L540" target="_blank" rel="noopener">src/runtime/proc.go</a>ï¼‰</p></li></ul><p>å€¼å¾—ä¸€æçš„æ˜¯Goè¯­è¨€åœ¨æœ€åˆçš„ç‰ˆæœ¬ä¸­Go runtimeè°ƒåº¦å™¨çš„ç»“æ„æ˜¯GMæ¨¡å‹ï¼ˆå¹¶éGMPæ¨¡å‹ï¼‰ï¼ŒPæœåŠ¡æ˜¯å› ä¸ºGMæ¨¡å‹åœ¨å¹¶å‘ä¸Šå‡ºç°å¾ˆå¤§çš„æ€§èƒ½æŸè€—ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹ä¸€ä¸‹Go runtimeçš„æ ¸å¿ƒå¼€å‘è€…Dmitry Vyukovå‘ç°çš„é—®é¢˜<a href="https://docs.google.com/document/d/1TTj4T2JO42uD5ID9e89oa0sLKhJYD0Y_kqxDv3I3XMw/edit#heading=h.mmq8lm48qfcw" target="_blank" rel="noopener">Scalable Go Scheduler Design Doc</a>ã€‚</p><p>ç®€å•è¯´äº†ä¸€ä¸‹Go runtimeè°ƒåº¦å™¨ä¸­çš„GPMæ¨¡å‹çš„æ¦‚å¿µï¼Œé‚£ä¹ˆGPMç©¶ç«Ÿæ˜¯æ€ä¹ˆè°ƒåº¦çš„å‘¢ï¼Ÿ<br>é¦–å…ˆå½“é€šè¿‡<code>go func()</code>åˆ›å»ºä¸€ä¸ªGå¯¹è±¡çš„æ—¶å€™ï¼ŒGä¼šè¢«ä¼˜å…ˆæ”¾å…¥Pçš„æœ¬åœ°é˜Ÿåˆ—ã€‚ä¸ºäº†æ‰§è¡ŒG Méœ€è¦ç»‘å®šä¸€ä¸ªPï¼Œç„¶åMå¯åŠ¨å†…æ ¸çº¿ç¨‹å¹¶å¾ªç¯ä»Pçš„æœ¬åœ°é˜Ÿåˆ—å–å‡ºGå¹¶æ‰§è¡Œã€‚<br><img src="/assets/goroutine/gmp.png" alt></p><p>å½“På‘ç°å½“å‰ç»‘å®šçš„Mè¢«é˜»å¡æ—¶ä¼šè½¬å…¥ç»‘å®šå…¶ä»–Mï¼ˆæ–°çš„Må¯èƒ½æ˜¯è¢«åˆ›å»ºæˆ–è€…ä»å†…æ ¸çº¿ç¨‹ç¼“å­˜ä¸­å–å‡ºï¼‰ã€‚<br><img src="/assets/goroutine/gmp-m.png" alt></p><p>å¦‚æœMå¤„ç†å®Œäº†å½“å‰Pçš„æœ¬åœ°é˜Ÿåˆ—é‡Œçš„Gåï¼ŒPä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—é‡Œå–Gæ¥æ‰§è¡Œï¼ˆåŒæ ·Pä¹Ÿä¼šå‘¨æœŸæ€§çš„æ£€æŸ¥å…¨å±€é˜Ÿåˆ—æ˜¯å¦æœ‰Gå¯ä»¥æ‰§è¡Œï¼‰ã€‚å¦‚æœå…¨å±€é˜Ÿåˆ—æ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„Gï¼ŒPä¼šéšæœºæŒ‘é€‰å¦å¤–ä¸€ä¸ªPå¹¶ä»å®ƒçš„æœ¬åœ°é˜Ÿåˆ—ä¸­å–å‡ºä¸€åŠGåˆ°è‡ªå·±çš„æœ¬åœ°é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚è¿™ä¸ªåŠ¨ä½œä½¿ç”¨è°ƒåº¦ç®—æ³•<code>work-stealing</code>ï¼ˆå·¥ä½œçªƒå–ç®—æ³•ï¼‰å®ç°ã€‚</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>ä»¥ä¸Šå°±æ˜¯Go runtimeè°ƒåº¦å™¨çš„è¿è¡ŒåŸç†ï¼ˆå¤§æ¦‚ï¼‰ï¼Œåé¢æœ‰æ›´æ·±å…¥çš„ç†è§£ä¼šè¡¥å……è¿›æ¥ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ç°åœ¨å¤§æ•°æ®ã€é«˜å¹¶å‘ï¼Œåˆ°å¤„éƒ½å……æ–¥ç€æµé‡çš„äº’è”ç½‘æ—¶ä»£ï¼Œèƒ½ä¸èƒ½åº”å¯¹é«˜å¹¶å‘ä¿¨ç„¶å·²ç»å‘å±•æˆä¸€ä¸ªè¡¡é‡æœåŠ¡ç«¯æ¶æ„æ˜¯å¦åˆæ ¼çš„æ ‡å‡†ï¼Œä½œä¸ºç¨‹åºåª›æˆ‘ä»¬æ€è€ƒå¦‚ä½•åˆ©ç”¨è¯­è¨€åœ¨ä»£ç å±‚é¢æœ€ä¼˜è®¾è®¡èƒ½åº”å¯¹å¹¶å‘çš„ç¨‹åºå»å¹¶è¡Œå¤„ç†ä»»åŠ¡ã€‚åœ¨ç¨‹åºä¸­å¯¹äºä»»åŠ¡å¹¶è¡Œå¤„ç†ä¸€èˆ¬è¶‹äºä½¿ç”¨ï¼šè¿›ç¨‹ã€çº¿ç¨‹ï¼Œä»¥åŠå¦å¤–ä¸€ç§ï¼š&lt;code&gt;åç¨‹&lt;/code&gt;ã€‚æ”¯æŒåç¨‹çš„è¯­è¨€æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šC/C++ã€Rubyã€ Pythonï¼ˆ2.5+ï¼‰ã€Golangç­‰ç­‰ï¼Œå®ƒä»¬æœ‰äº›æ˜¯æœ¬èº«è¯­è¨€æ”¯æŒåç¨‹ï¼Œæœ‰äº›åˆ™æ˜¯éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…æ¥ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸»è¦æ¥å­¦ä¹ ä¸€ä¸‹Golangè¿™é—¨è¯­è¨€ï¼ˆç®€ç§°Goï¼‰ï¼Œå®ƒæ˜¯å¦‚ä½•ç†è§£ä»¥åŠå®ç°åç¨‹çš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ&quot;&gt;&lt;a href=&quot;#ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ&quot;&gt;&lt;/a&gt;ä¸€ã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„å‰ä¸–ä»Šç”Ÿ&lt;/h3&gt;&lt;p&gt;éƒ½çŸ¥é“ä¸€å°è®¡ç®—æœºçš„æ ¸å¿ƒæ˜¯CPUï¼Œå®ƒæ‰¿æ‹…ç€æ‰€æœ‰çš„è¿ç®—ã€‚è€Œè®¡ç®—æœºæ‰¿è½½çš„æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰åˆ™æ˜¯è´Ÿè´£æ‰€æœ‰ä»»åŠ¡çš„å¤„ç†å’Œè°ƒåº¦CPUä»¥åŠèµ„æºçš„åˆ†é…ã€‚å¦‚æœç”¨äººç±»æ¥æ¯”å–»ï¼Œå¤§è„‘æ˜¯CPUï¼Œæ€ç»´åˆ™æ˜¯æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&quot;è¿›ç¨‹&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹&quot;&gt;&lt;/a&gt;è¿›ç¨‹&lt;/h4&gt;&lt;p&gt;æœ€æ—©çš„è®¡ç®—æœºæ¯æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œå¦‚æœè¿˜æœ‰å…¶ä»–ç¨‹åºéœ€è¦æ‰§è¡Œåˆ™è¦æ’é˜Ÿç­‰å¾…ã€‚åæ¥CPUè¿ç®—èƒ½åŠ›æé«˜äº†ï¼Œè¿™ç§æ–¹å¼è¿‡äºåŸå§‹æœ‰äº›æµªè´¹æ€§èƒ½ï¼Œäºæ˜¯å°è¯•è®©å¤šä¸ªç¨‹åºå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œä½†æ˜¯è¿™æ ·é¢ä¸´ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šè·‘åœ¨åŒä¸€ä¸ªCPUä¸­çš„ç¨‹åºéƒ½ä¼šä½¿ç”¨è®¡ç®—æœºèµ„æºï¼Œé‚£ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œæ•°æ®æ€ä¹ˆä¿éšœï¼Ÿ&lt;code&gt;è¿›ç¨‹&lt;/code&gt;ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;è¿›ç¨‹æ˜¯å†…æ ¸èµ„æºç®¡ç†åˆ†é…çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚å†…æ ¸ä¸­çš„æ¯ä¸ªç¨‹åºéƒ½è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸Šä¸‹æ–‡æ˜¯ç”±ç¨‹åºæ­£å¸¸è¿è¡Œéœ€è¦çš„ä¸€ç³»åˆ—å‚æ•°ç»„æˆï¼Œå‚æ•°åŒ…æ‹¬å­˜å‚¨å™¨ä¸­çš„ä»£ç å’Œæ•°æ®ï¼Œå¯„å­˜å™¨ä¸­çš„å†…å®¹ä»¥åŠè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ–‡ä»¶å¥æŸ„ï¼‰ç­‰ã€‚å¯ä»¥æŠŠä¸Šä¸‹æ–‡é€šä¿—ç†è§£ä¸ºï¼š`ç¯å¢ƒ`ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦è¿›è¡ŒIOæ“ä½œï¼ŒIOæ“ä½œé˜»å¡äº†ç¨‹åºåé¢çš„è®¡ç®—ï¼Œè¿™æ—¶å€™CPUå±äºç©ºé—²çŠ¶æ€ï¼Œé‚£å†…æ ¸ä¼šæŠŠCPUåˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹å»å¤„ç†ã€‚ä¸è¿‡å½“è¿›ç¨‹æ•°é‡å˜é«˜ä»¥åï¼Œè®¡ç®—æœºçš„å¤§éƒ¨åˆ†èµ„æºéƒ½è¢«è¿›ç¨‹åˆ‡æ¢è¿™ä¸ªæ“ä½œæ¶ˆè€—æ‰äº†ã€‚ä¸ºä»€ä¹ˆè¯´è¿›ç¨‹åˆ‡æ¢æ“ä½œæ¶ˆè€—èµ„æºä»£ä»·æ¯”è¾ƒé«˜ï¼Ÿ&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;æ‰€è°“è¿›ç¨‹åˆ‡æ¢å…¶å®å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œéœ€è¦åˆ‡æ¢æ–°çš„é¡µè¡¨å¹¶åŠ è½½æ–°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€åˆ‡æ¢å†…æ ¸æ ˆä»¥åŠç¡¬ä»¶ä¸Šä¸‹æ–‡ç­‰ã€‚åªè¦å‘ç”Ÿè¿›ç¨‹åˆ‡æ¢æ“ä½œå°±å¾—åå¤è¿›å…¥å†…æ ¸ï¼ŒåŠ è½½åˆ‡æ¢ä¸€ç³»åˆ—çŠ¶æ€ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹&quot;&gt;&lt;/a&gt;çº¿ç¨‹&lt;/h4&gt;&lt;p&gt;ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼Œ&lt;code&gt;çº¿ç¨‹&lt;/code&gt;åº”è¿è€Œç”Ÿã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;çº¿ç¨‹æ˜¯å†…æ ¸è°ƒåº¦CPUæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡çš„é€»è¾‘æµï¼Œçº¿ç¨‹æ˜¯å…·ä½“æ‰§è¡Œç¨‹åºçš„å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘åŒ…å«ä¸€ä¸ªä¸»çº¿ç¨‹ï¼ˆå¯ä»¥æ‹¥æœ‰å¤šä¸ªå­çº¿ç¨‹ï¼‰ï¼Œä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½å­˜åœ¨äºä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹åˆ‡æ¢ç›¸æ¯”è¿›ç¨‹åˆ‡æ¢å¼€é”€å°±å°äº†å¾ˆå¤šï¼Œçº¿ç¨‹åˆ‡æ¢åªéœ€è¦æŠŠå¯„å­˜å™¨åˆ·æ–°å³å¯ã€‚&lt;/p&gt;
&lt;h4 id=&quot;åç¨‹&quot;&gt;&lt;a href=&quot;#åç¨‹&quot; class=&quot;headerlink&quot; title=&quot;åç¨‹&quot;&gt;&lt;/a&gt;åç¨‹&lt;/h4&gt;&lt;p&gt;åé¢ç¨‹åºåª›ä»¬å‘ç°çº¿ç¨‹è¿™æ ·è¿˜æ˜¯æœ‰æ€§èƒ½ç“¶é¢ˆï¼ˆIOé˜»å¡ï¼‰ï¼Œæ— è®ºæ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹å› ä¸ºæ¶‰åŠåˆ°å¤§é‡çš„è®¡ç®—æœºèµ„æºï¼Œæ‰€ä»¥éƒ½æ˜¯ç”±å†…æ ¸è°ƒåº¦ç®¡ç†ã€‚èƒ½ä¸èƒ½å¼€å‘ä¸€ç§ç”±ä»£ç æ§åˆ¶çš„çº¿ç¨‹å‘¢ï¼Ÿè¿™å°±æ˜¯&lt;code&gt;åç¨‹&lt;/code&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="goroutine" scheme="http://xupin.im/tags/goroutine/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå°çŸ¥è¯† - æŸ¥æ‰¾è¿ç»­ç¼–å·ä¸­çš„ç¼ºå¤±ç¼–å·</title>
    <link href="http://xupin.im/2020/04/13/mysql-trick/"/>
    <id>http://xupin.im/2020/04/13/mysql-trick/</id>
    <published>2020-04-12T16:00:00.000Z</published>
    <updated>2022-12-15T04:31:13.452Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å’Œå°ä¼™ä¼´è®¨è®ºé—®é¢˜çš„æ—¶å€™ï¼Œå°ä¼™ä¼´çªç„¶é—®äº†æˆ‘è¿™æ ·ä¸€ä¸ªå°é—®é¢˜ï¼Œæ•°æ®åº“ä¸­å¦‚ä½•æŸ¥æ‰¾è¿ç»­ç¼–å·ä¸­çš„ç¼ºå¤±ç¼–å·ï¼Ÿ</p><h3 id="1-æè¿°"><a href="#1-æè¿°" class="headerlink" title="1.æè¿°"></a>1.æè¿°</h3><p>åœºæ™¯å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œæœ‰ä¸€ä»½è¿ç»­æ•°æ®IDï¼š1 â€¦ 27ï¼Œå…¶ä¸­IDï¼š6ï¼Œ7ï¼Œ14çš„æ•°æ®ä¸¢äº†ã€‚ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`letter`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">27</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_unicode_ci ROW_FORMAT = <span class="keyword">Compact</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'A'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'B'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">'C'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">'D'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="string">'E'</span>);</span><br><span class="line"><span class="comment"># INSERT INTO `letter` VALUES (6, 'F');</span></span><br><span class="line"><span class="comment"># INSERT INTO `letter` VALUES (7, 'J');</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">8</span>, <span class="string">'H'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">9</span>, <span class="string">'I'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">10</span>, <span class="string">'J'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">11</span>, <span class="string">'K'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">12</span>, <span class="string">'L'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">13</span>, <span class="string">'M'</span>);</span><br><span class="line"><span class="comment"># INSERT INTO `letter` VALUES (14, 'N');</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">15</span>, <span class="string">'O'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">16</span>, <span class="string">'P'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">17</span>, <span class="string">'Q'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">18</span>, <span class="string">'R'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">19</span>, <span class="string">'S'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">20</span>, <span class="string">'T'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">21</span>, <span class="string">'U'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">22</span>, <span class="string">'V'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">23</span>, <span class="string">'W'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">24</span>, <span class="string">'X'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">25</span>, <span class="string">'Y'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`letter`</span> <span class="keyword">VALUES</span> (<span class="number">26</span>, <span class="string">'Z'</span>);</span><br></pre></td></tr></table></figure></p><p>æ€ä¹ˆæŠŠ6ï¼Œ7ï¼Œ14è¿™ä¸‰æ¡æ•°æ®æ‰¾å‡ºæ¥ï¼Ÿæ–¹æ³•æœ‰å¾ˆå¤šç§å“ˆï¼Œä»Šå¤©æˆ‘ä»¬è¯´ä¸€ä¸‹å¦‚ä½•åˆ©ç”¨SQLå¿«é€ŸæŸ¥è¯¢å‡ºæ¥ã€‚å¤§æ¦‚æ€è·¯æ˜¯æŠŠID+1ï¼Œç„¶åæŸ¥è¯¢ID+1è¿™ä¸ªå€¼æ˜¯å¦å­˜åœ¨IDåˆ—è¡¨ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨é‚£è‚¯å®šå°±æ˜¯ç¼ºå¤±çš„ã€‚SQLå¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">id</span> + <span class="number">1</span> <span class="keyword">AS</span> <span class="keyword">id</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="string">`letter`</span> </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">id</span> + <span class="number">1</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> <span class="string">`letter`</span> )</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯MAX(id)+1ï¼ˆ27ï¼‰ä¹Ÿä¼šè¢«æŸ¥è¯¢å‡ºæ¥ï¼Œæ‰€ä»¥ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">id</span> + <span class="number">1</span> <span class="keyword">AS</span> <span class="keyword">id</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="string">`letter`</span> </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">id</span> + <span class="number">1</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> <span class="string">`letter`</span> ) </span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">id</span> &lt;(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">max</span>( <span class="keyword">id</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="string">`letter`</span> </span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h3 id="2-ä¼˜åŒ–"><a href="#2-ä¼˜åŒ–" class="headerlink" title="2.ä¼˜åŒ–"></a>2.ä¼˜åŒ–</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">start_id,</span><br><span class="line">( <span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>)- <span class="number">1</span> <span class="keyword">FROM</span> <span class="string">`letter`</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; start_id ) <span class="keyword">AS</span> end_id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">id</span> + <span class="number">1</span> <span class="keyword">AS</span> start_id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="string">`letter`</span> </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">id</span> + <span class="number">1</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> <span class="string">`letter`</span> ) </span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">id</span> &lt;(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">id</span>) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="string">`letter`</span> </span><br><span class="line">) </span><br><span class="line">) <span class="keyword">AS</span> max_id </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">start_id</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µé€‚ç”¨äºæŸ¥æ‰¾æ•´æ•°ç±»å‹çš„è¿ç»­ç¼–å·ï¼Œé‚£ä¹ˆå¦‚æœç¼–å·æ˜¯stringç±»å‹çš„å‘¢ï¼Ÿåé¢æœ‰æœºä¼šå†è¡¥å……è¿›æ¥=,=ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨å’Œå°ä¼™ä¼´è®¨è®ºé—®é¢˜çš„æ—¶å€™ï¼Œå°ä¼™ä¼´çªç„¶é—®äº†æˆ‘è¿™æ ·ä¸€ä¸ªå°é—®é¢˜ï¼Œæ•°æ®åº“ä¸­å¦‚ä½•æŸ¥æ‰¾è¿ç»­ç¼–å·ä¸­çš„ç¼ºå¤±ç¼–å·ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;1-æè¿°&quot;&gt;&lt;a href=&quot;#1-æè¿°&quot; class=&quot;headerlink&quot; title=&quot;1.æè¿°&quot;&gt;&lt;/a&gt;1.æè¿°&lt;/h3&gt;&lt;p&gt;åœºæ™¯å¤§æ¦‚æ˜¯è¿™</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="biscuits" scheme="http://xupin.im/tags/biscuits/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®° - é›†ç¾¤</title>
    <link href="http://xupin.im/2020/03/27/redis-cluster/"/>
    <id>http://xupin.im/2020/03/27/redis-cluster/</id>
    <published>2020-03-26T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.756Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ç²—æµ…çš„å­¦ä¹ äº†Redisä¸‰ç§é›†ç¾¤ç­–ç•¥çš„ä¸»ä»å¤åˆ¶å’Œå“¨å…µç­–ç•¥ï¼Œç°åœ¨æœ€åè¿™ç¯‡æ¥å­¦ä¹ ä¸€ä¸‹Redis Clusterä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªé›†ç¾¤ç­–ç•¥ã€‚</p><h3 id="1-ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ</h3><p>é›†ç¾¤ï¼ˆClusterï¼‰ï¼ŒRedis2.6ç‰ˆæœ¬ï¼ˆæ­£å¼ç‰ˆæœ¬æ˜¯3.0ï¼‰æ¨å‡ºçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œæœ‰æ•ˆè§£å†³äº†å•MasterèŠ‚ç‚¹å†™æ“ä½œçš„å‹åŠ›å¹¶ä¸”åˆ†å¸ƒå¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤§æé«˜äº†è´Ÿè½½èƒ½åŠ›ã€‚</p><blockquote><p>åœ¨Rediså‘å¸ƒ3.0æ­£å¼ç‰ˆæœ¬å‰ï¼Œä¸€èˆ¬ä½¿ç”¨ä»£ç†ä¸­é—´ä»¶æ¥å®ç°åˆ†å¸ƒå¼é›†ç¾¤ç­–ç•¥ã€‚è¿™é‡Œä¸å±•å¼€å­¦ä¹ äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´è‡ªè¡Œç ”ç©¶ã€‚</p></blockquote><ul><li><p>ç‰¹ç‚¹</p><ol><li>Clusterç­–ç•¥æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’åè°ƒå·¥ä½œã€‚<blockquote><p>å› ä¸ºå¯¹ä¸»ä»å¤åˆ¶å’Œå“¨å…µç­–ç•¥éƒ½ç§°ä¸ºé›†ç¾¤ç­–ç•¥ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢è¯¯è§£åœ¨ä¸‹æ–‡ä¸­æåŠçš„é›†ç¾¤ï¼ˆClusterï¼‰ç­–ç•¥ï¼Œç›´æ¥ç”¨Clusterç§°å‘¼ã€‚</p></blockquote></li><li>Clusterè‡³å°‘è¦3ä¸ªMasterèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯æ— ä¸­å¿ƒåŒ–è®¾è®¡ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨Clusterï¼Œä¸éœ€è¦è¿æ¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªéœ€è¦è¿æ¥Clusterä¸­ä»»æ„ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</li><li>æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ä¸éœ€è¦æŒ‡å®šï¼ŒClusterä¼šè‡ªåŠ¨å®Œæˆã€‚</li></ol></li><li><p>ä¼˜ç‚¹</p><ol><li>Clusterç­–ç•¥æ‹¥æœ‰ä¸»ä»å¤åˆ¶å’Œå“¨å…µç­–ç•¥çš„ä¼˜ç‚¹ã€‚</li><li>è§£å†³äº†å•MasterèŠ‚ç‚¹å†™æ“ä½œçš„å‹åŠ›ã€‚</li><li>åˆ†å¸ƒå¼å­˜å‚¨æ•°æ®ï¼Œæé«˜äº†è´Ÿè½½èƒ½åŠ›ã€‚</li><li>æ”¯æŒçº¿æ€§æ‰©å®¹ã€‚</li></ol></li></ul><a id="more"></a><ul><li>ç¼ºç‚¹<ol><li>éƒ¨åˆ†æ“ä½œå‘½ä»¤å—é™ï¼Œæ¯”å¦‚msetï¼Œç›®å‰åªèƒ½æ”¯æŒåŒä¸€ä¸ªæ’æ§½ï¼ˆslotï¼‰çš„keyè¿›è¡Œæ“ä½œã€‚</li><li>äº‹åŠ¡æœºåˆ¶ä¸æ”¯æŒå¤šèŠ‚ç‚¹æ“ä½œã€‚</li><li>ä¸æ”¯æŒå¤šæ•°æ®åº“ï¼Œå³åªæœ‰db0ã€‚</li></ol></li></ul><h3 id="2-å¦‚ä½•é…ç½®ï¼ˆæ–°æ—§æ–¹å¼ï¼‰"><a href="#2-å¦‚ä½•é…ç½®ï¼ˆæ–°æ—§æ–¹å¼ï¼‰" class="headerlink" title="2.å¦‚ä½•é…ç½®ï¼ˆæ–°æ—§æ–¹å¼ï¼‰"></a>2.å¦‚ä½•é…ç½®ï¼ˆæ–°æ—§æ–¹å¼ï¼‰</h3><ul><li>æ—§æ–¹å¼ï¼Œ./redis-trib.rb create â€“replicas {SLAVE_NUM} {IP}:{PORT} â€¦ {IP}:{PORT}</li><li>æ–°æ–¹å¼ï¼Œ./redis-cli â€“cluster create â€“cluster-replicas {SLAVE_NUM} {IP}:{PORT} â€¦ {IP}:{PORT}</li></ul><p>redis.confç¤ºä¾‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œ</span></span><br><span class="line">daemonize yes/no</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯å¦å¯ç”¨Cluster</span></span><br><span class="line">cluster-enabled yes/no</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ä¿¡æ¯é…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆã€‚</span></span><br><span class="line"><span class="comment"># FILE_NAMEï¼šé…ç½®æ–‡ä»¶å</span></span><br><span class="line">cluster-cluster-config-file &#123;FILE_NAME&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment"># MSï¼šè¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šMillisecondï¼‰</span></span><br><span class="line">cluster-node-timeout &#123;MS&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3-å·¥ä½œæœºåˆ¶"><a href="#3-å·¥ä½œæœºåˆ¶" class="headerlink" title="3.å·¥ä½œæœºåˆ¶"></a>3.å·¥ä½œæœºåˆ¶</h3><ul><li>RedisèŠ‚ç‚¹å¯åŠ¨ï¼ŒèŠ‚ç‚¹æ ¹æ®é…ç½®<code>cluster-enabled</code>åˆ¤æ–­æ˜¯å¦åŠ å…¥Clusterã€‚</li><li>æ–°èŠ‚ç‚¹é€šè¿‡<code>cluster meet {IP} {PORT}</code>å‘½ä»¤å’Œå…¶ä»–èŠ‚ç‚¹æ„ŸçŸ¥å¹¶å»ºç«‹è¿æ¥ï¼ŒèŠ‚ç‚¹é—´ä¼šé€šè¿‡<code>Gossipåè®®</code>PING/PONGå‘½ä»¤æ¥æ£€æµ‹çŠ¶æ€å’Œäº¤æ¢ä¿¡æ¯ã€‚ </li><li>Clusterè®¡ç®—å¹¶ä¸”åˆ†é…ä¸»èŠ‚ç‚¹æ’æ§½æ•°é‡ã€‚<code>è¿™ä¸ªåœ°æ–¹æ³¨æ„ï¼Œä¸æ˜¯æ’æ§½æ•°é‡ï¼Œæ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„æ’æ§½æ•°é‡ã€‚æ’æ§½æ•°é‡æ˜¯å›ºå®šçš„ï¼š16384ã€‚</code></li><li>æ’æ§½åˆ†é…æˆåŠŸä¹‹åï¼ŒClusterå¼€å§‹æœåŠ¡ã€‚</li></ul><h3 id="4-å¦‚ä½•æ„ŸçŸ¥æ–°èŠ‚ç‚¹ï¼Ÿ"><a href="#4-å¦‚ä½•æ„ŸçŸ¥æ–°èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="4.å¦‚ä½•æ„ŸçŸ¥æ–°èŠ‚ç‚¹ï¼Ÿ"></a>4.å¦‚ä½•æ„ŸçŸ¥æ–°èŠ‚ç‚¹ï¼Ÿ</h3><p>å½“ç»™æŸä¸€èŠ‚ç‚¹å‘é€å‘½ä»¤<code>cluster meet {IP} {PORT}</code>ï¼ˆæ–°èŠ‚ç‚¹ï¼‰ï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šå°è¯•ä¸æ–°èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå…·ä½“æµç¨‹ï¼š</p><ul><li>è¯¥èŠ‚ç‚¹å‘æ–°èŠ‚ç‚¹å‘é€MEETå‘½ä»¤ã€‚</li><li>æ–°èŠ‚ç‚¹æ¥æ”¶åˆ°MEETå‘½ä»¤åï¼Œå›å¤PONGå‘½ä»¤ã€‚</li><li>è¯¥èŠ‚ç‚¹æ¥æ”¶åˆ°æ–°èŠ‚ç‚¹è¿”å›çš„PONGå‘½ä»¤ï¼ŒçŸ¥é“æ–°èŠ‚ç‚¹æˆåŠŸæ¥æ”¶äº†è‡ªå·±çš„MEETå‘½ä»¤ã€‚</li><li>è¯¥èŠ‚ç‚¹å‘æ–°èŠ‚ç‚¹å‘é€PINGå‘½ä»¤ã€‚</li><li>æ–°èŠ‚ç‚¹æ¥æ”¶åˆ°è¯¥èŠ‚ç‚¹å‘é€çš„PINGå‘½ä»¤ï¼ŒçŸ¥é“è¯¥èŠ‚ç‚¹å·²ç»æˆåŠŸæ¥æ”¶åˆ°è‡ªå·±è¿”å›çš„PONGå‘½ä»¤ã€‚</li><li>è¯¥èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹æ¡æ‰‹å®Œæˆï¼Œå»ºç«‹è¿æ¥ã€‚</li><li>æœ€åï¼Œè¯¥èŠ‚ç‚¹ä¼šå°†æ–°èŠ‚ç‚¹çš„ä¿¡æ¯é€šè¿‡<code>Gossipåè®®</code>åŒæ­¥ç»™Clusterä¸­çš„å…¶ä»–èŠ‚ç‚¹ï¼Œè®©å…¶ä»–èŠ‚ç‚¹ä¹Ÿä¸æ–°èŠ‚ç‚¹è¿›è¡Œæ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥ã€‚</li></ul><blockquote><p>å¯ä»¥é€šè¿‡<code>cluster nodes</code>å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¸­å“ªäº›èŠ‚ç‚¹å·²ç»å»ºç«‹è¿æ¥ã€‚</p></blockquote><h3 id="5-æ•°æ®æ’æ§½"><a href="#5-æ•°æ®æ’æ§½" class="headerlink" title="5.æ•°æ®æ’æ§½"></a>5.æ•°æ®æ’æ§½</h3><p>è¯´åˆ°æ’æ§½ï¼ˆslotï¼‰ä¸å¾—ä¸æä¸€ä¸‹ï¼Œä¸ºäº†èƒ½å¤Ÿè®©æ•°æ®å¹³å‡åˆ†é…åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šè€Œé‡‡ç”¨çš„æ•°æ®åˆ†åŒºç®—æ³•ã€‚å¸¸è§çš„æ•°æ®åˆ†åŒºç®—æ³•ï¼šèŒƒå›´ï¼ˆRangeï¼‰ã€å“ˆå¸Œï¼ˆHashï¼‰ã€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å’Œè™šæ‹Ÿå“ˆå¸Œæ§½ç­‰ã€‚</p><p>Clusteré‡‡ç”¨çš„è™šæ‹Ÿå“ˆå¸Œæ§½æ•°æ®åˆ†åŒºç®—æ³•ï¼Œæ‰€æœ‰çš„keyæ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°0 ~ 16383æ’æ§½å†…ï¼ˆå…¬å¼ï¼šslot = crc16(key) &amp; 16383ï¼‰ï¼Œä¹‹å‰ä¹Ÿæåˆ°è¿‡æ’æ§½ä¹Ÿæ˜¯å¹³å‡åˆ†é…åˆ°æ¯ä¸ªMasterèŠ‚ç‚¹çš„ã€‚</p><ul><li>è™šæ‹Ÿå“ˆå¸Œæ§½çš„ç‰¹ç‚¹<ol><li>é™ä½äº†èŠ‚ç‚¹å’Œæ•°æ®ä¹‹é—´çš„è€¦åˆæ€§ï¼Œæ–¹ä¾¿çº¿æ€§æ‰©å®¹&amp;åŠ¨æ€ç®¡ç†èŠ‚ç‚¹ã€‚</li><li>èŠ‚ç‚¹è‡ªå·±ç®¡ç†å’Œæ’æ§½çš„å¯¹åº”å…³ç³»ã€‚</li><li>æ”¯æŒæŸ¥è¯¢èŠ‚ç‚¹ã€æ’æ§½å’Œkeyçš„å¯¹åº”å…³ç³»ã€‚</li></ol></li></ul><p>å¯ä»¥é€šä¿—ç†è§£ä¸ºï¼Œæ’æ§½æ˜¯Clusterç®¡ç†æ•°æ®çš„åŸºæœ¬å•ä½ã€‚</p><h3 id="6-åŠ¨æ€ç®¡ç†èŠ‚ç‚¹"><a href="#6-åŠ¨æ€ç®¡ç†èŠ‚ç‚¹" class="headerlink" title="6.åŠ¨æ€ç®¡ç†èŠ‚ç‚¹"></a>6.åŠ¨æ€ç®¡ç†èŠ‚ç‚¹</h3><p>å‡å¦‚æˆ‘ä»¬åŸæœ‰4ä¸ªMasterèŠ‚ç‚¹ï¼ˆM1 â€¦ M4ï¼‰ï¼Œä½†æ˜¯ç°åœ¨å› ä¸ºæ•°æ®å¢é‡é—®é¢˜ä¸´æ—¶åŠ ä¸€ä¸ªMasterèŠ‚ç‚¹ï¼ˆM5ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ</p><ul><li>å¯åŠ¨M5èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯å‘é€MEETå‘½ä»¤è®©M5èŠ‚ç‚¹åŠ å…¥åˆ°Clusterä¸­ï¼Œç°åœ¨M5èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•æ’æ§½æ‰€ä»¥ä¸ä¼šæ¥å—ä»»ä½•è¯»å†™æ“ä½œã€‚</li><li>åœ¨M5èŠ‚ç‚¹æ‰§è¡Œ<code>cluster setslot {SLOT} importing {SOURCE_NODE_ID}</code>å‘½ä»¤ï¼Œè®©M5èŠ‚ç‚¹å‡†å¤‡å¯¼å…¥{SLOT}æ’æ§½ã€‚</li><li>åœ¨æ‹¥æœ‰è¿™ä¸ª{SLOT}æ’æ§½çš„æºèŠ‚ç‚¹ä¸Šé¢æ‰§è¡Œ<code>cluster setslot {SLOT} migrating {M5_NODE_ID}</code>ï¼Œè®©æºèŠ‚ç‚¹å‡†å¤‡å¥½è¿å‡ºæ’æ§½ã€‚</li><li>è¿™æ—¶å€™å¦‚æœå®¢æˆ·ç«¯æ“ä½œçš„keyå­˜åœ¨äº{SLOT}æ’æ§½ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œç”±æºèŠ‚ç‚¹å¤„ç†ã€‚å¦‚æœkeyä¸å­˜åœ¨äº{SLOT}æ’æ§½ä¸­ï¼Œè¿™ä¸ªæ“ä½œå°†ç”±M5èŠ‚ç‚¹æ“ä½œã€‚</li><li>ç°åœ¨æºèŠ‚ç‚¹çš„{SLOT}æ’æ§½ä¸ä¼šåˆ›å»ºä»»ä½•æ–°çš„keyï¼Œéœ€è¦æŠŠæºèŠ‚ç‚¹{SLOT}æ’æ§½ä¸­çš„keyè¿ç§»åˆ°M5èŠ‚ç‚¹ã€‚æ‰§è¡Œ<code>cluster getkeysinslot {SLOT} {COUNT}</code>å‘½ä»¤è·å–{SLOT}æ’æ§½ä¸­æŒ‡å®š{COUNT}æ•°é‡çš„keyåˆ—è¡¨ã€‚</li><li>åœ¨æºèŠ‚ç‚¹å¯¹æ¯ä¸ªkeyæ‰§è¡Œ<code>migrate</code>å‘½ä»¤ï¼ŒæŠŠkeyè¿ç§»åˆ°M5èŠ‚ç‚¹ã€‚</li><li>åœ¨æºèŠ‚ç‚¹å’ŒM5èŠ‚ç‚¹æ‰§è¡Œ<code>cluster setslot {SLOT} NODE {M5_NODE_ID}</code>ï¼Œå®Œæˆè¿ç§»ã€‚</li></ul><p>è¿™å°±æ˜¯åŠ¨æ€å¢åŠ èŠ‚ç‚¹çš„æµç¨‹äº†ï¼Œå¯èƒ½åœ¨æ–°çš„Redisç‰ˆæœ¬ä¸­å¢åŠ äº†èŠ‚ç‚¹è¿ç§»å·¥å…·ï¼Œä½†æ˜¯æ ¸å¿ƒæµç¨‹åº”è¯¥è¿˜æ˜¯è¿™æ ·ã€‚</p><h3 id="7-Hash-Tag"><a href="#7-Hash-Tag" class="headerlink" title="7.Hash Tag"></a>7.Hash Tag</h3><p>å­¦ä¹ äº†æ•°æ®æ’æ§½ï¼Œæˆ‘ä»¬çŸ¥é“Redisåœ¨keyåˆ†é…åˆ°æ’æ§½çš„è¿™ä¸€æ“ä½œå®Œå…¨æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œä¸è¿‡å½“æˆ‘ä»¬æœ‰éœ€æ±‚å¯¹ä¸åŒçš„keyéœ€è¦æ”¾åˆ°åŒä¸€æ’æ§½ä¸­çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™è¦æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦åœ¨keyä¸­åŠ å…¥{}ç¬¦å·å³å¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>{UID_1001}:following</li><li>{UID_1001}:followers</li></ul><p>è¿™ä¸¤ä¸ªkeyä¼šè¢«åˆ†é…åˆ°åŒä¸€æ’æ§½ï¼ŒåŸç†å°±æ˜¯å½“keyä¸­å­˜åœ¨{}ç¬¦å·ï¼Œå“ˆå¸Œç®—æ³•åªä¼šé’ˆå¯¹{}ç¬¦å·å†…çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="8-æ’æ§½ä¸ºä»€ä¹ˆæ˜¯16384ï¼Ÿè¿™ä¸ªå€¼èƒ½ä¿®æ”¹å—ï¼Ÿ"><a href="#8-æ’æ§½ä¸ºä»€ä¹ˆæ˜¯16384ï¼Ÿè¿™ä¸ªå€¼èƒ½ä¿®æ”¹å—ï¼Ÿ" class="headerlink" title="8.æ’æ§½ä¸ºä»€ä¹ˆæ˜¯16384ï¼Ÿè¿™ä¸ªå€¼èƒ½ä¿®æ”¹å—ï¼Ÿ"></a>8.æ’æ§½ä¸ºä»€ä¹ˆæ˜¯16384ï¼Ÿè¿™ä¸ªå€¼èƒ½ä¿®æ”¹å—ï¼Ÿ</h3><p>é¦–å…ˆcrc16ç®—æ³•ç®—å‡ºçš„å€¼æœ‰16bitï¼Œ2^16å³65536ã€‚ä¹Ÿå°±æ˜¯è¯´è¯¥ç®—æ³•çš„å€¼åœ¨0 ~ 65535ä¹‹é—´ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä½œè€…è¿˜æ˜¯é€‰æ‹©äº†16384å³0 ~ 16383ã€‚</p><p>å¾ˆå¼€å¿ƒï¼Œå¯¹äºè¿™ä¸ªç–‘é—®Redisä½œè€…ç»™äº†æ˜ç¡®çš„å›ç­”ã€‚å‰é¢æˆ‘ä»¬çŸ¥é“æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼šä»¥æ¯ç§’1æ¬¡çš„é¢‘ç‡äº’ç›¸å‘é€å¿ƒè·³åŒ…ï¼ˆPINGï¼‰&amp;äº¤æ¢ä¿¡æ¯ï¼ˆä¿¡æ¯åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼‰ï¼Œä¹‹å‰ä¹Ÿæäº†äº¤æ¢çš„ä¿¡æ¯ä½“é‡Œé¢ä¸»è¦åŒ…å«èŠ‚ç‚¹çš„ä¿¡æ¯ç­‰ï¼Œé‚£ä¹ˆæ¶ˆæ¯å¤´çš„å†…å®¹å‘¢ï¼Ÿå¦‚ä¸‹ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> sig[<span class="number">4</span>];        <span class="comment">/* Siganture "RCmb" (Redis Cluster message bus). */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> totlen;    <span class="comment">/* Total length of this message */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> ver;       <span class="comment">/* Protocol version, currently set to 1. */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> port;      <span class="comment">/* TCP base port number. */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> type;      <span class="comment">/* Message type */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> count;     <span class="comment">/* Only used for some kind of messages. */</span></span><br><span class="line">    <span class="keyword">uint64_t</span> currentEpoch;  <span class="comment">/* The epoch accordingly to the sending node. */</span></span><br><span class="line">    <span class="keyword">uint64_t</span> configEpoch;   <span class="comment">/* The config epoch if it's a master, or the last</span></span><br><span class="line"><span class="comment">                               epoch advertised by its master if it is a</span></span><br><span class="line"><span class="comment">                               slave. */</span></span><br><span class="line">    <span class="keyword">uint64_t</span> offset;    <span class="comment">/* Master replication offset if node is a master or</span></span><br><span class="line"><span class="comment">                           processed replication offset if node is a slave. */</span></span><br><span class="line">    <span class="keyword">char</span> sender[CLUSTER_NAMELEN]; <span class="comment">/* Name of the sender node */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> myslots[CLUSTER_SLOTS/<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">char</span> slaveof[CLUSTER_NAMELEN];</span><br><span class="line">    <span class="keyword">char</span> myip[NET_IP_STR_LEN];    <span class="comment">/* Sender IP, if not all zeroed. */</span></span><br><span class="line">    <span class="keyword">char</span> notused1[<span class="number">34</span>];  <span class="comment">/* 34 bytes reserved for future usage. */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> cport;      <span class="comment">/* Sender TCP cluster bus port */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> flags;      <span class="comment">/* Sender node flags */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> state; <span class="comment">/* Cluster state from the POV of the sender */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> mflags[<span class="number">3</span>]; <span class="comment">/* Message flags: CLUSTERMSG_FLAG[012]_... */</span></span><br><span class="line">    <span class="keyword">union</span> clusterMsgData data; <span class="comment">/* message body*/</span></span><br><span class="line">&#125; clusterMsg;</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­æœ‰ä¸ª<code>myslots</code>å­—æ®µè¦æ³¨æ„ï¼Œè¯¥å­—æ®µä½¿ç”¨ä½å›¾ï¼Œå³1bitä»£è¡¨1slotï¼Œå¦‚æœè¯¥bitä¸º1å³è¯´æ˜è¯¥æ’æ§½å±äºè¿™ä¸ªèŠ‚ç‚¹ã€‚é‚£ä¹ˆè¯¥å­—æ®µçš„å¤§å°ä¸ºï¼š16384 / 8bit / 1024b = 2kbã€‚ä¹Ÿå°±æ˜¯æ¶ˆæ¯å¤´ä¸è€ƒè™‘å…¶ä»–ä¿¡æ¯çš„æƒ…å†µï¼Œå•æ˜¯<code>myslots</code>å°±å·²ç»æœ‰2kbå¤§å°ã€‚</p><p>é‚£ä¹ˆæ¶ˆæ¯ä½“å‘¢ï¼Ÿä¹‹å‰å·²ç»æåˆ°äº†æ¶ˆæ¯ä½“ä¸­ä¼šåŒ…å«èŠ‚ç‚¹ä¿¡æ¯ã€‚å…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿæ¶ˆæ¯ä½“æ¯æ¬¡æºå¸¦æœ€å°‘3ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ•°é‡çº¦ä¸ºæ€»èŠ‚ç‚¹æ•°çš„1/10ã€‚å¦‚æœèŠ‚ç‚¹æ•°é‡è¶Šå¤šï¼Œæ¶ˆæ¯ä½“è¶Šå¤§ã€‚</p><ol><li>å¦‚æœæ’æ§½æ•°é‡æ˜¯65535ï¼Œé‚£ä¹ˆè¯¥å­—æ®µçš„å¤§å°æ”¾å¤§ä¸ºï¼š65535 / 8bit / 1024b = 8kbã€‚è¿™å¯¹äºæ¯ç§’1æ¬¡é¢‘ç‡çš„å¿ƒè·³åŒ…æ¥è®²ï¼Œå¸¦å®½å¼€é”€æ˜¯æå¤§çš„ã€‚</li><li>ä¸Šé¢è¯´äº†èŠ‚ç‚¹è¶Šå¤šï¼Œæ¶ˆæ¯ä½“ä¹Ÿå°±è¶Šå¤§ï¼Œå¦‚æœèŠ‚ç‚¹è¶…è¿‡1000ä¸ªä¹Ÿä¼šå¯¼è‡´ç½‘ç»œæ‹¥å µï¼Œå› ä¸ºRedisä½œè€…ä¸å»ºè®®ClusterèŠ‚ç‚¹çš„æ•°é‡è¶…è¿‡1000ï¼Œé‚£ä¹ˆå¯¹äº1000ä¸ªä»¥ä¸‹çš„èŠ‚ç‚¹æ¥è¯´16384ä¸ªæ’æ§½ä¹Ÿå°±å¤Ÿç”¨äº†ã€‚</li><li>ç¬¬ä¸‰ä¸ªè€ƒè™‘æ˜¯å…³äºä½å›¾çš„å‹ç¼©é—®é¢˜ï¼Œæˆ‘è¿˜æ²¡æœ‰ææ˜ç™½~~æ‰€ä»¥è¿™é‡Œä¸å±•å¼€è¯´äº†ï¼Œå…ˆåŸ‹ä¸ªå‘ã€‚</li></ol><p>è¿™ä¸ªå€¼èƒ½ä¿®æ”¹å—ï¼Ÿ<code>16384æ’æ§½æ•°é‡æ˜¯å†™æ­»åœ¨Redisæºä»£ç ä¸­çš„ï¼Œæ‰€ä»¥æ˜¯ä¸å¯ä»¥æ›´æ”¹çš„ã€‚</code></p><p>é™„ä¸Šå…³äºä½œè€…çš„å›ç­”</p><blockquote><p><a href="https://github.com/antirez/redis/issues/2576" target="_blank" rel="noopener">https://github.com/antirez/redis/issues/2576</a></p></blockquote><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>Clusteråœ¨æ•…éšœæ¢å¤ä¸»ä»åˆ‡æ¢çš„æœºåˆ¶ï¼ˆåŒ…æ‹¬ï¼šä¸»è§‚å®•æœºã€å®¢è§‚å®•æœºã€æŠ•ç¥¨é€‰ä¸¾ã€ä¸»ä»åˆ‡æ¢ï¼‰å’Œå“¨å…µç­–ç•¥åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°±ä¸å­¦ä¹ Clusterå…³äºæ•…éšœæ¢å¤ä¸»ä»åˆ‡æ¢çš„ç›¸å…³çŸ¥è¯†äº†ã€‚</p><p>å‰é¢æåˆ°è¿‡Gossipåè®®ï¼Œå®ƒä¸»è¦èŒè´£å°±æ˜¯å„èŠ‚ç‚¹é—´çš„ä¿¡æ¯äº¤æ¢ï¼Œå¸¸ç”¨çš„Gossipæ¶ˆæ¯å¯åˆ†ä¸ºï¼š</p><ul><li>ping</li><li>pong</li><li>meet</li><li>fail</li></ul><p>åé¢ä¼šä¸“é—¨æ¥å­¦ä¹ Gossipåè®®çš„çŸ¥è¯†ï¼ˆ-,-å†æ¬¡åŸ‹ä¸ªå‘ï¼‰ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰ç²—æµ…çš„å­¦ä¹ äº†Redisä¸‰ç§é›†ç¾¤ç­–ç•¥çš„ä¸»ä»å¤åˆ¶å’Œå“¨å…µç­–ç•¥ï¼Œç°åœ¨æœ€åè¿™ç¯‡æ¥å­¦ä¹ ä¸€ä¸‹Redis Clusterä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªé›†ç¾¤ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ&quot;&gt;&lt;/a&gt;1.ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ&lt;/h3&gt;&lt;p&gt;é›†ç¾¤ï¼ˆClusterï¼‰ï¼ŒRedis2.6ç‰ˆæœ¬ï¼ˆæ­£å¼ç‰ˆæœ¬æ˜¯3.0ï¼‰æ¨å‡ºçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œæœ‰æ•ˆè§£å†³äº†å•MasterèŠ‚ç‚¹å†™æ“ä½œçš„å‹åŠ›å¹¶ä¸”åˆ†å¸ƒå¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤§æé«˜äº†è´Ÿè½½èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨Rediså‘å¸ƒ3.0æ­£å¼ç‰ˆæœ¬å‰ï¼Œä¸€èˆ¬ä½¿ç”¨ä»£ç†ä¸­é—´ä»¶æ¥å®ç°åˆ†å¸ƒå¼é›†ç¾¤ç­–ç•¥ã€‚è¿™é‡Œä¸å±•å¼€å­¦ä¹ äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´è‡ªè¡Œç ”ç©¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç‰¹ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Clusterç­–ç•¥æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’åè°ƒå·¥ä½œã€‚&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºå¯¹ä¸»ä»å¤åˆ¶å’Œå“¨å…µç­–ç•¥éƒ½ç§°ä¸ºé›†ç¾¤ç­–ç•¥ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢è¯¯è§£åœ¨ä¸‹æ–‡ä¸­æåŠçš„é›†ç¾¤ï¼ˆClusterï¼‰ç­–ç•¥ï¼Œç›´æ¥ç”¨Clusterç§°å‘¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;Clusterè‡³å°‘è¦3ä¸ªMasterèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯æ— ä¸­å¿ƒåŒ–è®¾è®¡ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä½¿ç”¨Clusterï¼Œä¸éœ€è¦è¿æ¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªéœ€è¦è¿æ¥Clusterä¸­ä»»æ„ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ä¸éœ€è¦æŒ‡å®šï¼ŒClusterä¼šè‡ªåŠ¨å®Œæˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¼˜ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Clusterç­–ç•¥æ‹¥æœ‰ä¸»ä»å¤åˆ¶å’Œå“¨å…µç­–ç•¥çš„ä¼˜ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³äº†å•MasterèŠ‚ç‚¹å†™æ“ä½œçš„å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼å­˜å‚¨æ•°æ®ï¼Œæé«˜äº†è´Ÿè½½èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒçº¿æ€§æ‰©å®¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="redis" scheme="http://xupin.im/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®° - å“¨å…µ</title>
    <link href="http://xupin.im/2020/03/26/redis-sentinel/"/>
    <id>http://xupin.im/2020/03/26/redis-sentinel/</id>
    <published>2020-03-25T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.757Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨è¿™ç¯‡æ¥å­¦ä¹ ä¸€ä¸‹Redis Sentinelå³å“¨å…µç­–ç•¥çš„ç›¸å…³çŸ¥è¯†ã€‚</p><h3 id="1-ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ</h3><p>å“¨å…µï¼ˆSentinelï¼‰ï¼ŒRedis2.6ç‰ˆæœ¬ï¼ˆæ­£å¼ç‰ˆæœ¬æ˜¯2.8ï¼Œç°2.6ç‰ˆæœ¬å·²è¢«åºŸå¼ƒï¼‰å¼€å§‹æä¾›çš„ä¸€ç§é›†ç¾¤ç­–ç•¥ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯è§£å†³äº†ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰åœ¨MasterèŠ‚ç‚¹æ•…éšœï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢SlaveèŠ‚ç‚¹ä¸ºæ–°MasterèŠ‚ç‚¹çš„é—®é¢˜ã€‚</p><ul><li><p>ç‰¹ç‚¹</p><ol><li>å“¨å…µç­–ç•¥æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’åè°ƒå·¥ä½œã€‚</li><li>å“¨å…µé›†ç¾¤è‡³å°‘è¦3ä¸ªèŠ‚ç‚¹ã€‚</li><li>å¯ä»¥æŠŠå“¨å…µçœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„RedisæœåŠ¡ã€‚</li></ol></li><li><p>ä¼˜ç‚¹</p><ol><li>å“¨å…µç­–ç•¥æ‹¥æœ‰ä¸»ä»å¤åˆ¶çš„ä¼˜ç‚¹ã€‚</li><li>å“¨å…µç­–ç•¥è§£å†³äº†MasterèŠ‚ç‚¹æ•…éšœï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢SlaveèŠ‚ç‚¹ä¸ºæ–°MasterèŠ‚ç‚¹çš„é—®é¢˜ã€‚</li></ol></li></ul><a id="more"></a><ul><li>ç¼ºç‚¹<ol><li>MasterèŠ‚ç‚¹å†™æ“ä½œçš„å‹åŠ›æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚</li><li>æ•°æ®å­˜å‚¨èƒ½åŠ›è¿˜æ˜¯å—åˆ°å•èŠ‚ç‚¹é™åˆ¶ã€‚</li></ol></li></ul><h3 id="2-å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰"><a href="#2-å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰" class="headerlink" title="2.å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰"></a>2.å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰</h3><ul><li>å¯åŠ¨Rediså“¨å…µï¼Œ./redis-sentinel redis-sentinel.conf</li><li>å¯åŠ¨RedisæœåŠ¡æ—¶å¹¶ä¸”å¯åŠ¨å“¨å…µï¼Œ./redis-server redis-sentinel.conf â€“sentinel</li></ul><p>redis-sentinel.confç¤ºä¾‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å“¨å…µç›‘æ§çš„èŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># MASTER_NAMEï¼šè‡ªå®šä¹‰çš„MasterèŠ‚ç‚¹åç§°ã€‚</span></span><br><span class="line"><span class="comment"># IPï¼šMasterèŠ‚ç‚¹çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="comment"># PORTï¼šMasterèŠ‚ç‚¹çš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># QUORUMï¼šå½“MasterèŠ‚ç‚¹æ•…éšœï¼Œç¡®è®¤MasterèŠ‚ç‚¹odownæœ€å°‘çš„å“¨å…µæ•°é‡ã€‚</span></span><br><span class="line">sentinel monitor &#123;MASTER_NAME&#125; &#123;IP&#125; &#123;PORT&#125; &#123;QUORUM&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å“¨å…µéªŒè¯</span></span><br><span class="line"><span class="comment"># PASSï¼šMasterèŠ‚ç‚¹çš„authï¼Œéœ€è¦æ³¨æ„çš„æ—¶å“¨å…µä¸èƒ½åŒæ—¶ä¸ºMasterèŠ‚ç‚¹å’ŒSlaveèŠ‚ç‚¹è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥authéœ€è¦ä¿æŒä¸€è‡´ã€‚</span></span><br><span class="line">sentinel auth-pass &#123;MASTER_NAME&#125; &#123;PASS&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å“¨å…µå¿ƒè·³Pingæœ€å¤§æ—¶é—´ï¼Œå¦‚æœå“¨å…µå‘MasterèŠ‚ç‚¹å‘é€Pingè¶…è¿‡è¿™ä¸ªæ—¶é—´æˆ–è€…å›å¤errï¼Œé‚£ä¹ˆå“¨å…µä¼šä¸»è§‚ï¼ˆsdownï¼‰è®¤ä¸ºè¯¥MasterèŠ‚ç‚¹å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment"># MSï¼šå¿ƒè·³Pingç­‰å¾…å“åº”çš„æœ€å¤§æ—¶é—´ï¼ˆå•ä½ï¼šMillisecondï¼‰ã€‚</span></span><br><span class="line">sentinel down-after-milliseconds &#123;MASTER_NAME&#125; &#123;MS&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ—¶åŒæ­¥æ•°æ®çš„SlaveèŠ‚ç‚¹æ•°é‡</span></span><br><span class="line"><span class="comment"># SLAVE_NUMï¼šå½“MasterèŠ‚ç‚¹æ•…éšœï¼ŒSlaveèŠ‚ç‚¹é€šè¿‡ç«é€‰å½“é€‰æ–°MasterèŠ‚ç‚¹ï¼Œæœ€å¤šå…è®¸å‡ ä¸ªSlaveèŠ‚ç‚¹å¼€å§‹åŒæ­¥æ–°Masterçš„æ•°æ®ã€‚</span></span><br><span class="line">sentinel parallel-syncs &#123;MASTER_NAME&#125; &#123;SLAVE_NUM&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»ä»èŠ‚ç‚¹åˆ‡æ¢æ‰€éœ€è¦çš„æœ€å¤§æ—¶é—´ã€‚</span></span><br><span class="line"><span class="comment"># MSï¼šä¸»ä»èŠ‚ç‚¹åˆ‡æ¢æ‰€éœ€è¦çš„æœ€å¤§æ—¶é—´ï¼ˆå•ä½ï¼šMillisecondï¼‰ã€‚</span></span><br><span class="line">sentinel failover-timeout &#123;MASTER_NAME&#125; &#123;MS&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># MasterèŠ‚ç‚¹æ•…éšœè°ƒç”¨çš„è„šæœ¬</span></span><br><span class="line"><span class="comment"># SCRIPT_PATHï¼šè„šæœ¬è·¯å¾„</span></span><br><span class="line">sentinel notification-script &#123;MASTER_NAME&#125; &#123;SCRIPT_PATH&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3-å·¥ä½œæœºåˆ¶"><a href="#3-å·¥ä½œæœºåˆ¶" class="headerlink" title="3.å·¥ä½œæœºåˆ¶"></a>3.å·¥ä½œæœºåˆ¶</h3><ol><li>å“¨å…µå‘å·²çŸ¥èŠ‚ç‚¹å’Œå“¨å…µå‘é€å¿ƒè·³åŒ…æ£€æµ‹çŠ¶æ€ã€‚</li><li>MasterèŠ‚ç‚¹æ— æ•ˆå›å¤ï¼Œå“¨å…µåˆ¤æ–­MasterèŠ‚ç‚¹çŠ¶æ€ï¼šä¸»è§‚å®•æœºï¼Œå®¢è§‚å®•æœºã€‚</li><li>MasterèŠ‚ç‚¹è¢«ç¡®å®šå®¢è§‚å®•æœºï¼Œè¿›è¡Œé¢†å¤´ï¼ˆLeaderï¼‰å“¨å…µé€‰ä¸¾ã€‚</li><li>å‡†å¤‡è¿›è¡Œä¸»ä»åˆ‡æ¢çš„é¢†å¤´å“¨å…µè·å–å…¶ä»–å“¨å…µçš„æˆæƒã€‚</li><li>æˆæƒæˆåŠŸï¼Œä»SlaveèŠ‚ç‚¹ä¸­é€‰ä¸¾æ–°MasterèŠ‚ç‚¹ã€‚</li><li>é¢†å¤´å“¨å…µæŠŠæ–°MasterèŠ‚ç‚¹ä¿¡æ¯åŒæ­¥ç»™å…¶ä»–å“¨å…µï¼Œå…¶ä»–å“¨å…µæŠŠæ–°MasterèŠ‚ç‚¹ä¿¡æ¯åŒæ­¥å¯¹åº”SlaveèŠ‚ç‚¹ã€‚</li></ol><h3 id="4-å¿ƒè·³åŒ…"><a href="#4-å¿ƒè·³åŒ…" class="headerlink" title="4.å¿ƒè·³åŒ…"></a>4.å¿ƒè·³åŒ…</h3><p>æ¯ä¸ªå“¨å…µä»¥æ¯ç§’é’Ÿ1æ¬¡çš„é¢‘ç‡å‘å®ƒå·²çŸ¥çš„MasterèŠ‚ç‚¹ã€SlaveèŠ‚ç‚¹å’Œå…¶ä»–å“¨å…µå‘é€PINGå‘½ä»¤ï¼Œå¸Œæœ›å¾—åˆ°çš„æœ‰æ•ˆå›å¤å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PING replied with +PONG.</span><br><span class="line">PING replied with -LOADING error.</span><br><span class="line">PING replied with -MASTERDOWN error.</span><br></pre></td></tr></table></figure></p><p>å…¶å®ƒä»»ä½•å›å¤æˆ–è€…æ— å›å¤éƒ½æ˜¯æ— æ•ˆå›å¤ã€‚</p><h3 id="5-å“¨å…µå’ŒèŠ‚ç‚¹ä¹‹é—´çš„è‡ªåŠ¨å‘ç°æœºåˆ¶"><a href="#5-å“¨å…µå’ŒèŠ‚ç‚¹ä¹‹é—´çš„è‡ªåŠ¨å‘ç°æœºåˆ¶" class="headerlink" title="5.å“¨å…µå’ŒèŠ‚ç‚¹ä¹‹é—´çš„è‡ªåŠ¨å‘ç°æœºåˆ¶"></a>5.å“¨å…µå’ŒèŠ‚ç‚¹ä¹‹é—´çš„è‡ªåŠ¨å‘ç°æœºåˆ¶</h3><p>é€šè¿‡Redisçš„pub/subç³»ç»Ÿå®ç°ï¼Œæ¯ä¸ªå“¨å…µéƒ½ä¼šå‘è‡ªå·±ç›‘æ§çš„èŠ‚ç‚¹å¯¹åº”çš„channelï¼š<strong>sentinel</strong>:helloå‘é€ä¸€æ¡æ¶ˆæ¯ï¼ˆæ¶ˆæ¯ä½“åŒ…å«è‡ªå·±çš„{IP}ã€{PORT}å’Œ{RUNID}ä»¥åŠMasterèŠ‚ç‚¹çš„å®Œæ•´é…ç½®ï¼‰ï¼Œæ¯ä¸ªè®¢é˜…è¯¥channelçš„å“¨å…µéƒ½å¯ä»¥æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯å¹¶ä¸”èƒ½å‘ç°åˆ°å…¶ä»–å“¨å…µçš„å­˜åœ¨ï¼Œå¦‚æœæŸä¸ªå“¨å…µå‘ç°è‡ªå·±ç»´æŠ¤çš„èŠ‚ç‚¹é…ç½®ä½äºæ–°æ¥æ”¶çš„èŠ‚ç‚¹é…ç½®ï¼Œåˆ™ä¼šç”¨æ–°çš„èŠ‚ç‚¹é…ç½®è¿›è¡Œè¦†ç›–ã€‚</p><h3 id="6-ä¸»è§‚-å®¢è§‚å®•æœº"><a href="#6-ä¸»è§‚-å®¢è§‚å®•æœº" class="headerlink" title="6.ä¸»è§‚/å®¢è§‚å®•æœº"></a>6.ä¸»è§‚/å®¢è§‚å®•æœº</h3><p>å¦‚æœä¸€ä¸ªMasterèŠ‚ç‚¹åœ¨æ”¶åˆ°PINGå‘½ä»¤åæ²¡æœ‰åœ¨æœ‰æ•ˆæ—¶é—´å†…ï¼ˆdown-after-millisecondsï¼‰è¿›è¡Œæœ‰æ•ˆå›å¤ï¼Œåˆ™ä¼šè¢«æ ‡è®°ä¸ºä¸»è§‚å®•æœºï¼ˆsdownï¼ŒSubjectively Downï¼‰ã€‚</p><p>å“¨å…µä¼šè·å–å…¶ä»–å“¨å…µæ£€æµ‹è¯¥èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># IPï¼šä¸»è§‚å®•æœºçš„MasterèŠ‚ç‚¹åœ°å€</span></span><br><span class="line"><span class="comment"># PORTï¼šä¸»è§‚å®•æœºçš„MasterèŠ‚ç‚¹ç«¯å£</span></span><br><span class="line"><span class="comment"># CURRENT_EPOCHï¼šå“¨å…µçš„é…ç½®çºªå…ƒï¼Œç”¨äºé¢†å¤´å“¨å…µé€‰ä¸¾ã€‚</span></span><br><span class="line"><span class="comment"># RUNIDï¼šå¯ä»¥æ˜¯*å’Œå“¨å…µçš„RunIDï¼Œå½“å€¼æ˜¯ * ä»£è¡¨æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦ä¸»è§‚å®•æœºï¼Œå¦‚æœæ˜¯RunIDåˆ™ç”¨äºé¢†å¤´å“¨å…µé€‰ä¸¾ã€‚</span></span><br><span class="line">SENTINEL is-master-down-byaddr &#123;IP&#125; &#123;PORT&#125; &#123;CURRENT_EPOCH&#125; &#123;RUNID&#125;</span><br></pre></td></tr></table></figure></p><p>å½“æœ‰è¶³å¤Ÿæ•°é‡ï¼ˆ{QUORUM}ï¼‰çš„å“¨å…µéƒ½è®¤ä¸ºè¯¥MasterèŠ‚ç‚¹å¤„äºä¸»è§‚å®•æœºçŠ¶æ€ã€‚åˆ™è¯¥MasterèŠ‚ç‚¹ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚å®•æœºï¼ˆodownï¼ŒObjectively Downï¼‰ï¼Œè‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„å“¨å…µéƒ½è®¤ä¸ºè¯¥MasterèŠ‚ç‚¹å¤„äºä¸»è§‚å®•æœºçŠ¶æ€ï¼Œåˆ™ä¸ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚å®•æœºï¼ŒåŒæ—¶å¦‚æœè¯¥MasterèŠ‚ç‚¹é‡æ–°è¿”å›å“¨å…µæœ‰æ•ˆå›å¤ï¼Œè¯¥MasterèŠ‚ç‚¹ä¸»è§‚å®•æœºçŠ¶æ€ä¼šè¢«ç§»é™¤ã€‚</p><h3 id="7-é¢†å¤´å“¨å…µé€‰ä¸¾"><a href="#7-é¢†å¤´å“¨å…µé€‰ä¸¾" class="headerlink" title="7.é¢†å¤´å“¨å…µé€‰ä¸¾"></a>7.é¢†å¤´å“¨å…µé€‰ä¸¾</h3><p>å› ä¸ºåªéœ€è¦ä¸€ä¸ªå“¨å…µå®Œæˆä¸»ä»åˆ‡æ¢ï¼Œæ‰€ä»¥éœ€è¦é€‰ä¸¾ä¸€ä¸ªé¢†å¤´å“¨å…µã€‚</p><ol><li>æ¯ä¸ªå“¨å…µéƒ½ä¼šå‘é€<code>SENTINEL is-master-down-byaddr</code>å‘½ä»¤å¸Œæœ›æˆä¸ºé¢†å¤´å“¨å…µã€‚æ”¶åˆ°è¯¥å‘½ä»¤çš„å“¨å…µå¦‚æœæ²¡æœ‰åŒæ„è¿‡å…¶ä»–å“¨å…µçš„åŒæ ·å‘½ä»¤ï¼Œé‚£ä¹ˆåŒæ„è¯¥è¯·æ±‚ï¼Œå¦åˆ™æ‹’ç»ã€‚</li><li>å¦‚æœæŸä¸€å“¨å…µå‘ç°åŒæ„è‡ªå·±è¯·æ±‚çš„å“¨å…µæ•°é‡å¹¶ä¸”æ•°é‡å¤§äºç­‰äº{QUORUM}ï¼Œé‚£ä¹ˆå®ƒå°†æˆä¸ºé¢†å¤´å“¨å…µã€‚</li><li>å¦‚æœé€‰ä¸¾è¿‡ç¨‹ä¸­æœ‰å¤šä¸ªå“¨å…µå½“é€‰é¢†å¤´å“¨å…µï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åé€‰ä¸¾ä¼šé‡æ–°è¿›è¡Œã€‚</li></ol><blockquote><p>è¯¥æ–¹æ³•åŸºäºraftç®—æ³•é¢†å¤´é€‰ä¸¾æ–¹æ³•å®ç°ã€‚</p></blockquote><h3 id="8-ä¸»ä»åˆ‡æ¢æˆæƒ"><a href="#8-ä¸»ä»åˆ‡æ¢æˆæƒ" class="headerlink" title="8.ä¸»ä»åˆ‡æ¢æˆæƒ"></a>8.ä¸»ä»åˆ‡æ¢æˆæƒ</h3><p>å½“é€‰ä¸¾å‡ºé¢†å¤´å“¨å…µä¹‹åå¹¶æœªé©¬ä¸Šè¿›è¡Œä¸»ä»åˆ‡æ¢ï¼Œé¢†å¤´å“¨å…µè¿˜éœ€è¦è·å–{MAJORITY}æ•°é‡çš„å“¨å…µæˆæƒã€‚<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># MAJORITYï¼šè¯¥å€¼ä¸å¯é…ç½®ï¼ŒRedisè‡ªè¡Œè®¡ç®—ã€‚å…¬å¼ï¼šmajority = voters / <span class="number">2</span> + <span class="number">1</span></span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœ{QUORUM} &lt; {MAJORITY}ï¼Œé¢†å¤´å“¨å…µéœ€è¦{MAJORITY}æ•°é‡çš„å“¨å…µè¿›è¡Œæˆæƒã€‚</li><li>å¦‚æœ{QUORUM} &gt;= {MAJORITY}ï¼Œé‚£ä¹ˆé¢†å¤´å“¨å…µéœ€è¦{QUORUM}æ•°é‡çš„å“¨å…µæˆæƒæ‰å¯ä»¥ã€‚</li></ul><p>å½“é¢†å¤´å“¨å…µè·å¾—æˆæƒä¹‹åï¼Œæ­£å¼å¼€å§‹ä¸»ä»åˆ‡æ¢æµç¨‹ã€‚</p><h3 id="9-ä¸»ä»åˆ‡æ¢"><a href="#9-ä¸»ä»åˆ‡æ¢" class="headerlink" title="9.ä¸»ä»åˆ‡æ¢"></a>9.ä¸»ä»åˆ‡æ¢</h3><p>å¼€å§‹ä¸»ä»åˆ‡æ¢ï¼ˆfailoverï¼‰ï¼Œé¦–å…ˆé¢†å¤´å“¨å…µä¼šé€‰ä¸¾å‡ºä¸€ä¸ªSlaveèŠ‚ç‚¹å‡ºæ¥ä½œä¸ºæ–°MasterèŠ‚ç‚¹ï¼Œè¯¥SlaveèŠ‚ç‚¹é€‰ä¸¾å‚è€ƒå‚æ•°ï¼š</p><ul><li><p>è¯¥èŠ‚ç‚¹å’ŒMasterèŠ‚ç‚¹æ–­å¼€çš„æ—¶é•¿ï¼Œå¦‚æœä¸€ä¸ªSlaveèŠ‚ç‚¹ä¸MasterèŠ‚ç‚¹æ–­å¼€è¿æ¥æ—¶é—´å·²ç»è¶…è¿‡<code>down-after-milliseconds</code>å‚æ•°çš„<code>10å€</code>ï¼Œå†åŠ ä¸ŠMasterå®•æœºçš„æ—¶é•¿ï¼Œè¯¥SlaveèŠ‚ç‚¹å°±ä¼šè¢«è®¤ä¸ºä¸é€‚åˆé€‰ä¸¾ä¸ºæ–°çš„MasterèŠ‚ç‚¹ã€‚</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(down-after-milliseconds * 10) + milliseconds_since_master_is_in_SDOWN_state</span><br></pre></td></tr></table></figure></li><li><p>SlaveèŠ‚ç‚¹çš„ä¼˜å…ˆçº§ï¼ˆslave-priorityï¼‰ï¼Œslave-priorityè¶Šä½ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p></li><li>å¤åˆ¶æ•°æ®åç§»é‡ï¼ˆå¤åˆ¶æ•°æ®æœ€å®Œæ•´ï¼‰</li><li>RunIDï¼ˆæœ€å°çš„ï¼‰</li></ul><h3 id="10-é…ç½®åŒæ­¥"><a href="#10-é…ç½®åŒæ­¥" class="headerlink" title="10.é…ç½®åŒæ­¥"></a>10.é…ç½®åŒæ­¥</h3><p>åœ¨é¢†å¤´å“¨å…µå®Œæˆä¸»ä»åˆ‡æ¢ä¹‹åï¼Œä¼šåœ¨æœ¬åœ°ç”Ÿæˆæœ€æ–°çš„Masteré…ç½®ç„¶åé€šè¿‡pub/subæ¶ˆæ¯æœºåˆ¶åŒæ­¥ç»™å…¶ä»–å“¨å…µï¼Œå…¶ä»–å“¨å…µåˆ™æ›´æ–°å¯¹åº”çš„MasterèŠ‚ç‚¹é…ç½®ã€‚</p><p>é‚£ä¹ˆå…¶ä»–å“¨å…µæ€ä¹ˆçŸ¥é“è¿™ä»½é…ç½®æ˜¯æœ€æ–°çš„å‘¢ï¼Ÿ</p><blockquote><p>é¢†å¤´å“¨å…µå‡†å¤‡æ‰§è¡Œä¸»ä»åˆ‡æ¢å‰ï¼Œä¼šä»è¦åˆ‡æ¢æˆæ–°MasterèŠ‚ç‚¹çš„SlaveèŠ‚ç‚¹å–å¾—ä¸€ä¸ªconfiguration epochï¼Œå¯ä»¥ç†è§£ä¸ºé…ç½®ç‰ˆæœ¬å·ã€‚å¦‚æœé¢†å¤´å“¨å…µä¸»ä»åˆ‡æ¢å¤±è´¥äº†ï¼Œé‚£ä¹ˆå…¶ä»–å“¨å…µä¼šç­‰å¾…<code>failover-timeout</code>æ—¶é—´ç„¶åæ¥æ›¿ç»§ç»­æ‰§è¡Œåˆ‡æ¢ï¼Œæ¯æ¬¡æ¥æ›¿éƒ½ä¼šé‡æ–°è·å–ä¸€ä¸ªconfiguration epochï¼Œä½œä¸ºæ–°çš„é…ç½®ç‰ˆæœ¬å·ã€‚å¦‚æœé¢†å¤´å“¨å…µåˆ‡æ¢æˆåŠŸï¼Œé‚£ä¹ˆå…¶ä»–å“¨å…µä¼šæ ¹æ®è‡ªå·±çš„é…ç½®ç‰ˆæœ¬å·æ¥æ›´æ–°å¯¹åº”SlaveèŠ‚ç‚¹çš„MasterèŠ‚ç‚¹é…ç½®ã€‚</p></blockquote><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>ä¸ºä»€ä¹ˆè¯´å“¨å…µæœ€å°‘è¦3ä¸ªèŠ‚ç‚¹ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><blockquote><p>å¦‚æœæ˜¯2ä¸ªèŠ‚ç‚¹ï¼Œ{QUORUM}å€¼ä¸º1ï¼Œæ­¤æ—¶å…¶ä¸­ä¸€å°æœåŠ¡å™¨å‡ºç°å®¢è§‚å®•æœºã€‚é¢†å¤´å“¨å…µéœ€è¦è¿›è¡Œä¸»ä»åˆ‡æ¢ï¼Œåœ¨è¿›è¡Œä¸»ä»åˆ‡æ¢å‰éœ€è¦è·å–{MAJORITY}æ•°é‡çš„å“¨å…µåŒæ„ï¼Œè¯¥{MAJORITY}å‚æ•°æœ€å°çš„å€¼æ˜¯ï¼š2ï¼Œæ­¤æ—¶é¢†å¤´å“¨å…µæ— æ³•è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</p><p><a href="https://redis.io/topics/sentinel" target="_blank" rel="noopener">https://redis.io/topics/sentinel</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç°åœ¨è¿™ç¯‡æ¥å­¦ä¹ ä¸€ä¸‹Redis Sentinelå³å“¨å…µç­–ç•¥çš„ç›¸å…³çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ&quot;&gt;&lt;/a&gt;1.ä»€ä¹ˆæ˜¯å“¨å…µï¼Ÿ&lt;/h3&gt;&lt;p&gt;å“¨å…µï¼ˆSentinelï¼‰ï¼ŒRedis2.6ç‰ˆæœ¬ï¼ˆæ­£å¼ç‰ˆæœ¬æ˜¯2.8ï¼Œç°2.6ç‰ˆæœ¬å·²è¢«åºŸå¼ƒï¼‰å¼€å§‹æä¾›çš„ä¸€ç§é›†ç¾¤ç­–ç•¥ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯è§£å†³äº†ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰åœ¨MasterèŠ‚ç‚¹æ•…éšœï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢SlaveèŠ‚ç‚¹ä¸ºæ–°MasterèŠ‚ç‚¹çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç‰¹ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å“¨å…µç­–ç•¥æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’åè°ƒå·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;å“¨å…µé›†ç¾¤è‡³å°‘è¦3ä¸ªèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥æŠŠå“¨å…µçœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„RedisæœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¼˜ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å“¨å…µç­–ç•¥æ‹¥æœ‰ä¸»ä»å¤åˆ¶çš„ä¼˜ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å“¨å…µç­–ç•¥è§£å†³äº†MasterèŠ‚ç‚¹æ•…éšœï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢SlaveèŠ‚ç‚¹ä¸ºæ–°MasterèŠ‚ç‚¹çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="redis" scheme="http://xupin.im/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®° - ä¸»ä»å¤åˆ¶</title>
    <link href="http://xupin.im/2020/03/25/redis-replication/"/>
    <id>http://xupin.im/2020/03/25/redis-replication/</id>
    <published>2020-03-24T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.756Z</updated>
    
    <content type="html"><![CDATA[<p>Rediså•ç‚¹é…ç½®çš„æƒ…å†µä¸‹å¦‚æœæœåŠ¡å‡ºç°æ•…éšœå®•æœºï¼Œé‚£ä¹ˆæœåŠ¡ä¹Ÿå°±å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå‡å¦‚æ˜¯ç”Ÿäº§ç¯å¢ƒé‚£ä¹ˆå¸¦æ¥çš„åæœä¼šæœ‰å¾ˆä¸¥é‡ï¼Œæ‰€ä»¥å‡ºç°äº†é«˜å¯ç”¨æ–¹æ¡ˆï¼šé›†ç¾¤ç­–ç•¥ã€‚</p><h3 id="1-ä¸‰ç§é›†ç¾¤ç­–ç•¥"><a href="#1-ä¸‰ç§é›†ç¾¤ç­–ç•¥" class="headerlink" title="1.ä¸‰ç§é›†ç¾¤ç­–ç•¥"></a>1.ä¸‰ç§é›†ç¾¤ç­–ç•¥</h3><p>Redisæä¾›äº†ä¸‰ç§é›†ç¾¤ç­–ç•¥ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul><li>ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰</li><li>å“¨å…µï¼ˆSentinelï¼‰</li><li>é›†ç¾¤ï¼ˆClusterï¼‰</li></ul><p>è¿™ä¸‰ç§ç­–ç•¥ä¼šé€ä¸€å­¦ä¹ ï¼Œæœ¬ç¯‡ä¸»è¦å­¦ä¹ ç­–ç•¥ä¹‹ä¸€ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰ã€‚</p><h3 id="2-ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ"><a href="#2-ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ" class="headerlink" title="2.ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ"></a>2.ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ</h3><p>åœ¨ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰ç­–ç•¥ä¸­ï¼ŒæœåŠ¡åˆ†ä¸ºä¸¤ç±»ï¼šMasterèŠ‚ç‚¹ã€SlaveèŠ‚ç‚¹ã€‚</p><ul><li><p>ç‰¹ç‚¹</p><ol><li>MasterèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å¤šä¸ªSlaveèŠ‚ç‚¹ï¼Œä½†SlaveèŠ‚ç‚¹åªèƒ½æœåŠ¡ä¸€ä¸ªMasterèŠ‚ç‚¹ã€‚</li><li>æ•°æ®å¤åˆ¶æ–¹å‘åªèƒ½æ˜¯MasterèŠ‚ç‚¹-&gt;SlaveèŠ‚ç‚¹ã€‚</li></ol></li><li><p>ä¼˜ç‚¹</p><ol><li>å®ç°äº†å¤šæœºçƒ­æ•°æ®å¤‡ä»½ï¼Œæé«˜äº†é¢å¯¹å®•æœºæ•°æ®æ¢å¤çš„ç¾å¤‡èƒ½åŠ›ã€‚</li><li>åœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šå®ç°è¯»å†™åˆ†ç¦»æé«˜æœåŠ¡ååé‡ï¼Œå³ï¼šMasterèŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼ŒSlaveèŠ‚ç‚¹æä¾›è¯»æœåŠ¡ã€‚</li><li>å¦‚æœMasterèŠ‚ç‚¹å®•æœºå¯ä»¥å¿«é€Ÿåˆ‡æ¢ä½¿ç”¨SlaveèŠ‚ç‚¹æä¾›æœåŠ¡ã€‚</li></ol></li></ul><a id="more"></a><ul><li>ç¼ºç‚¹<ol><li>MasterèŠ‚ç‚¹æ•…éšœï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢SlaveèŠ‚ç‚¹ä¸ºæ–°MasterèŠ‚ç‚¹çš„é—®é¢˜ã€‚</li><li>MasterèŠ‚ç‚¹å†™æ“ä½œçš„å‹åŠ›æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚</li><li>æ•°æ®å­˜å‚¨èƒ½åŠ›è¿˜æ˜¯å—åˆ°å•èŠ‚ç‚¹é™åˆ¶ã€‚</li></ol></li></ul><h3 id="3-å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰"><a href="#3-å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰" class="headerlink" title="3.å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰"></a>3.å¦‚ä½•é…ç½®ï¼ˆå¤šç§æ–¹å¼ï¼‰</h3><ul><li>åœ¨SlaveèŠ‚ç‚¹æœåŠ¡å™¨redis.confå¢åŠ é…ç½®è¡Œï¼Œslaveof {MASTER_IP} {MASTER_PORT}ã€‚</li><li>å¯åŠ¨redis-serveræ—¶ï¼Œ./redis-server slaveof {MASTER_IP} {MASTER_PORT}ã€‚</li><li>åœ¨redis-cliå‘½ä»¤è¡Œç•Œé¢è¾“å…¥ï¼Œslaveof {MASTER_IP} {MASTER_PORT}ã€‚</li></ul><h3 id="4-å·¥ä½œæœºåˆ¶"><a href="#4-å·¥ä½œæœºåˆ¶" class="headerlink" title="4.å·¥ä½œæœºåˆ¶"></a>4.å·¥ä½œæœºåˆ¶</h3><ol><li>SlaveèŠ‚ç‚¹æ‰§è¡Œslaveofå‘½ä»¤ï¼Œä¿å­˜MasterèŠ‚ç‚¹ä¿¡æ¯ã€‚</li><li>èŠ‚ç‚¹å†…éƒ¨çš„å®šæ—¶ä»»åŠ¡å‘ç°ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¼€å§‹å°è¯•Socketè¿æ¥ä¸»èŠ‚ç‚¹ã€‚</li><li>è¿æ¥å»ºç«‹æˆåŠŸï¼ŒSlaveèŠ‚ç‚¹å‘é€pingå‘½ä»¤ï¼ŒæœŸæœ›å¾—åˆ°pongå‘½ä»¤å“åº”ï¼Œå¦åˆ™å‘èµ·é‡è¿ã€‚</li><li>å¦‚æœä¸»èŠ‚ç‚¹æœ‰è®¾ç½®authï¼Œé‚£ä¹ˆè¿›è¡ŒauthéªŒè¯ï¼ŒæˆåŠŸç»§ç»­ï¼Œå¤±è´¥ç»ˆæ­¢ã€‚ï¼ˆéå¿…é¡»ï¼Œæ ¹æ®MasterèŠ‚ç‚¹æ˜¯å¦é…ç½®authå†³å®šï¼‰</li><li>SlaveèŠ‚ç‚¹åŒæ­¥MasterèŠ‚ç‚¹å…¨é‡æ•°æ®é›†ã€‚ï¼ˆè¯¥æ“ä½œæ˜¯MasterèŠ‚ç‚¹å‘SlaveèŠ‚ç‚¹å‘é€æ•°æ®å“Ÿï¼‰</li><li>MasterèŠ‚ç‚¹æŒç»­æŠŠå†™å‘½ä»¤åŒæ­¥SlaveèŠ‚ç‚¹ã€‚</li></ol><h3 id="5-åŒæ­¥å‘½ä»¤"><a href="#5-åŒæ­¥å‘½ä»¤" class="headerlink" title="5.åŒæ­¥å‘½ä»¤"></a>5.åŒæ­¥å‘½ä»¤</h3><p>Redisä¸»ä»å¤åˆ¶æ•°æ®æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼Œsyncå’Œpsyncï¼Œsyncæ˜¯Redis2.8ç‰ˆæœ¬ä¹‹å‰çš„åŒæ­¥æ–¹æ³•ï¼Œpsyncæ˜¯Redis2.8ç‰ˆæœ¬ä»¥åä¼˜åŒ–syncæ–°è®¾è®¡åŒæ­¥æ–¹æ³•ã€‚åœ¨è¿™ä¼šç€é‡å­¦ä¹ psyncï¼Œä¹Ÿä¼šæå¸¦è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆsyncä¼šè¢«ä¼˜åŒ–ã€‚</p><p>é¦–å…ˆï¼Œpsyncéœ€è¦3ä¸ªå‚æ•°æ”¯æŒï¼š</p><ul><li><p>MasterèŠ‚ç‚¹å’ŒSlaveèŠ‚ç‚¹å¤åˆ¶æ•°æ®çš„åç§»é‡ã€‚</p>  <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">Master</span>èŠ‚ç‚¹å’Œ<span class="literal">Slave</span>èŠ‚ç‚¹å¤åˆ¶æ•°æ®çš„åç§»é‡ï¼Œä¸»è¦ä½œç”¨æ˜¯é€šè¿‡å¯¹æ¯”å¤åˆ¶åç§»é‡ï¼Œæ¥åˆ¤æ–­<span class="literal">Master</span>èŠ‚ç‚¹å’Œ<span class="literal">Slave</span>èŠ‚ç‚¹æ•°æ®æ˜¯å¦ä¸€è‡´ã€‚</span><br></pre></td></tr></table></figure></li><li><p>MasterèŠ‚ç‚¹å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psyncçš„ç‰¹æ€§ä¹‹ä¸€ï¼Œç”¨äºå¢é‡æ•°æ®å¤åˆ¶å’Œè¡¥æ•‘ä¸¢å¤±çš„å¤åˆ¶æ•°æ®ã€‚</span><br></pre></td></tr></table></figure></li><li><p>MasterèŠ‚ç‚¹çš„RunIDï¼ˆReplication IDï¼‰ã€‚</p>  <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RedisæœåŠ¡å¯åŠ¨çš„æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ª<span class="number">40</span>ä½çš„å”¯ä¸€RunIDã€‚</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>MasterèŠ‚ç‚¹å’ŒSlaveèŠ‚ç‚¹å¤åˆ¶æ•°æ®çš„åç§»é‡ï¼šæ¯ä¸ªå‚ä¸å¤åˆ¶æ•°æ®çš„èŠ‚ç‚¹éƒ½ä¼šç»´æŠ¤ä¸€ä»½å¤åˆ¶åç§»é‡ï¼ŒMasterèŠ‚ç‚¹åœ¨å¤„ç†å®Œå†™å‘½ä»¤åï¼Œä¼šæŠŠå‘½ä»¤çš„å­—èŠ‚é•¿åº¦è¿›è¡Œç´¯åŠ ï¼ŒSlaveèŠ‚ç‚¹æ¯ç§’é’Ÿä¼šå‘MasterèŠ‚ç‚¹ä¸ŠæŠ¥è‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œå› æ­¤MasterèŠ‚ç‚¹ä¹Ÿä¼šè®°å½•SlaveèŠ‚ç‚¹çš„åç§»é‡ã€‚MasterèŠ‚ç‚¹æŒç»­æŠŠå†™å‘½ä»¤åŒæ­¥SlaveèŠ‚ç‚¹ï¼ŒSlaveèŠ‚ç‚¹æˆåŠŸæ¥æ”¶åˆ°ä¹‹åä¹Ÿä¼šç´¯åŠ è‡ªèº«çš„åç§»é‡ã€‚æŸ¥çœ‹åç§»é‡ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;info replication</span><br><span class="line">master_repl_offset:&#123;NUM&#125; <span class="comment"># MasterèŠ‚ç‚¹åç§»é‡</span></span><br><span class="line">slave_repl_offset:&#123;NUM&#125; <span class="comment"># SlaveèŠ‚ç‚¹åç§»é‡</span></span><br></pre></td></tr></table></figure></p><p>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼šå¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¸€ä¸ªä¿å­˜åœ¨MasterèŠ‚ç‚¹æ‹¥æœ‰å›ºå®šé•¿åº¦çš„é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼Œå¤§å°å—repl-backlog-sizeå‚æ•°æ§åˆ¶ï¼ˆé»˜è®¤ï¼š1MBï¼‰ï¼ŒæŸ¥çœ‹ç¼“å†²åŒºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;info replication</span><br><span class="line">repl_backlog_size:&#123;NUM&#125;ï¼ˆbyteï¼‰</span><br></pre></td></tr></table></figure></p><p>MasterèŠ‚ç‚¹çš„RunIDï¼ˆReplication IDï¼‰ï¼šè¯¥IDä¸»è¦æ˜¯ç”¨æ¥è¯†åˆ«RedisæœåŠ¡èŠ‚ç‚¹ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨IP+PORTæ–¹å¼ï¼Œå‡å¦‚MasterèŠ‚ç‚¹é‡å¯ä¹‹åä¿®æ”¹äº†RDB/AOFå¤‡ä»½æ–‡ä»¶ï¼Œæ­¤æ—¶SlaveèŠ‚ç‚¹å†åŸºäºåŸæ¥çš„å¤åˆ¶åç§»é‡è¿›è¡Œå¤åˆ¶æ•°æ®æ˜¯ä¸å¯é çš„ã€‚æŸ¥çœ‹RunIDï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;info server</span><br><span class="line">run_id:8d252f66c3ef89bd60a060cf8dc5cfe3d511c5e4</span><br></pre></td></tr></table></figure></p><p>psyncå‘½ä»¤ä½¿ç”¨æ–¹å¼<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">psync </span><span class="template-variable">&#123;RUNID&#125;</span><span class="xml"> </span><span class="template-variable">&#123;OFFSET&#125;</span></span><br></pre></td></tr></table></figure></p></blockquote><h3 id="6-å¢é‡-å…¨é‡å¤åˆ¶"><a href="#6-å¢é‡-å…¨é‡å¤åˆ¶" class="headerlink" title="6.å¢é‡/å…¨é‡å¤åˆ¶"></a>6.å¢é‡/å…¨é‡å¤åˆ¶</h3><p>çŸ¥é“äº†å‘½ä»¤å¦‚ä½•ä½¿ç”¨ï¼Œé‚£ä¹ˆå½“SlaveèŠ‚ç‚¹å‘é€psyncå‘½ä»¤ç»™MasterèŠ‚ç‚¹ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæµç¨‹åˆ†ä¸ºå…¨é‡å¤åˆ¶å’Œå¢é‡å¤åˆ¶ä¸¤ç§ã€‚</p><ul><li><p>å…¨é‡å¤åˆ¶ï¼Œå¦‚æœSlaveèŠ‚ç‚¹å‘é€çš„å‘½ä»¤æ˜¯ï¼špsync ? -1</p><blockquote><p>MasterèŠ‚ç‚¹çŸ¥é“SlaveèŠ‚ç‚¹è¦å…¨é‡å¤åˆ¶æ•°æ®ï¼Œè¿”å›å‘½ä»¤åˆ™æ˜¯ï¼š+fullresync {RUNID} {OFFSET}ï¼ŒåŒæ—¶MasterèŠ‚ç‚¹ä¼šæ‰§è¡ŒRDBå¤‡ä»½å¹¶ä¸”ä½¿ç”¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ¥è®°å½•æ­¤åæ‰€æœ‰çš„å†™å‘½ä»¤ã€‚MasterèŠ‚ç‚¹ RDBå¤‡ä»½å®Œæˆä¹‹åå‘SlaveèŠ‚ç‚¹å‘é€å¤‡ä»½æ–‡ä»¶ï¼ŒåŒæ—¶ç»§ç»­ç¼“å†²å†™å‘½ä»¤ï¼Œåœ¨å¤‡ä»½æ–‡ä»¶å‘é€å®Œæ¯•åMasterèŠ‚ç‚¹ä¼šå‘SlaveèŠ‚ç‚¹å‘é€ç¼“å†²åŒºçš„å†™å‘½ä»¤ã€‚SlaveèŠ‚ç‚¹åœ¨æ”¶åˆ°MasterèŠ‚ç‚¹å‘é€çš„å¤‡ä»½æ–‡ä»¶ä¹‹åï¼Œä¼šä¸¢å¼ƒæ‰€æœ‰çš„æ—§æ•°æ®ï¼Œå¼€å§‹è½½å…¥å¤‡ä»½æ–‡ä»¶å¹¶ä¸”å¼€å§‹æ‰§è¡ŒMasterèŠ‚ç‚¹å‘é€ç¼“å†²åŒºçš„å†™å‘½ä»¤ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨SlaveèŠ‚ç‚¹åŠ è½½å¤‡ä»½æ–‡ä»¶çš„æ—¶å€™æ•°æ®å¤„äºä¸å¯é é˜¶æ®µï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡å‚æ•°slave-server-stale-dataï¼ˆyesã€noï¼‰é…ç½®æ˜¯å¦å“åº”è¯·æ±‚ï¼Œyeså“åº”ï¼Œnoåˆ™æŠ›å‡ºâ€œSYNC with master in progressâ€ã€‚</p><p>å¦‚æœå¤‡ä»½ä»åˆ›å»ºåˆ°ä¼ è¾“å®Œæ¯•æ¶ˆè€—æ—¶é—´å¤§äºrepl-timeoutå‚æ•°çš„å€¼ï¼ŒSlaveèŠ‚ç‚¹å°†ä¼šæ”¾å¼ƒæ¥æ”¶å¤‡ä»½æ–‡ä»¶å¹¶ä¸”æ¸…ç†å·²ç»ä¸‹è½½çš„ä¸´æ—¶æ–‡ä»¶ã€‚</p></blockquote></li><li><p>å¢é‡å¤åˆ¶ï¼ŒMasterèŠ‚ç‚¹ä¼šæ ¹æ®{RUNID}å’Œ{OFFSET}å†³å®šè¿”å›ç»“æœã€‚</p><blockquote><p>MasterèŠ‚ç‚¹é¦–å…ˆä¼šæ£€æŸ¥{RUNID}æ˜¯å¦ä¸è‡ªèº«ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°†ä¼šæ‰§è¡Œå…¨é‡æ•°æ®å¤åˆ¶ã€‚å¦‚æœä¸€è‡´ä¼šæ ¹æ®{OFFSET}å‚æ•°åœ¨ç¼“å†²åŒºæŸ¥æ‰¾ï¼Œå¦‚æœæ•°æ®åç§»é‡ä¹‹åçš„æ•°æ®å­˜åœ¨ç¼“å†²åŒºï¼Œè¿”å›å‘½ä»¤ï¼š+continueï¼Œè¡¨ç¤ºå¯ä»¥å¢é‡å¤åˆ¶æ•°æ®ã€‚å¦‚æœè¿”å›å‘½ä»¤+errï¼Œè¡¨ç¤ºMasterèŠ‚ç‚¹ç‰ˆæœ¬è¿‡ä½ä¸æ”¯æŒpsyncå‘½ä»¤ï¼Œå°†ä¼šä½¿ç”¨syncè¿›è¡Œå…¨é‡å¤åˆ¶æ•°æ®ã€‚</p></blockquote></li></ul><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>æœ€åå­¦ä¹ ä¸€ä¸‹ä¸ºä»€ä¹ˆsyncä¼šè¢«ä¼˜åŒ–ï¼Ÿ</p><blockquote><p>ä½¿ç”¨syncå‘½ä»¤ï¼Œåœ¨ç½‘ç»œæˆ–è€…å…¶ä»–ä¸å¯æŠ—åŠ›å› ç´ å¯¼è‡´MasterèŠ‚ç‚¹å’ŒSlaveèŠ‚ç‚¹æ–­å¼€è¿æ¥ï¼Œéœ€è¦é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡æ•°æ®å¤åˆ¶ï¼ŒSlaveèŠ‚ç‚¹æ•°æ®æ¢å¤æˆæœ¬æé«˜ã€‚</p><p><a href="https://redis.io/topics/replication" target="_blank" rel="noopener">https://redis.io/topics/replication</a></p><p><a href="http://try.redis.io" target="_blank" rel="noopener">http://try.redis.io</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Rediså•ç‚¹é…ç½®çš„æƒ…å†µä¸‹å¦‚æœæœåŠ¡å‡ºç°æ•…éšœå®•æœºï¼Œé‚£ä¹ˆæœåŠ¡ä¹Ÿå°±å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå‡å¦‚æ˜¯ç”Ÿäº§ç¯å¢ƒé‚£ä¹ˆå¸¦æ¥çš„åæœä¼šæœ‰å¾ˆä¸¥é‡ï¼Œæ‰€ä»¥å‡ºç°äº†é«˜å¯ç”¨æ–¹æ¡ˆï¼šé›†ç¾¤ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä¸‰ç§é›†ç¾¤ç­–ç•¥&quot;&gt;&lt;a href=&quot;#1-ä¸‰ç§é›†ç¾¤ç­–ç•¥&quot; class=&quot;headerlink&quot; title=&quot;1.ä¸‰ç§é›†ç¾¤ç­–ç•¥&quot;&gt;&lt;/a&gt;1.ä¸‰ç§é›†ç¾¤ç­–ç•¥&lt;/h3&gt;&lt;p&gt;Redisæä¾›äº†ä¸‰ç§é›†ç¾¤ç­–ç•¥ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰&lt;/li&gt;
&lt;li&gt;å“¨å…µï¼ˆSentinelï¼‰&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ï¼ˆClusterï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸‰ç§ç­–ç•¥ä¼šé€ä¸€å­¦ä¹ ï¼Œæœ¬ç¯‡ä¸»è¦å­¦ä¹ ç­–ç•¥ä¹‹ä¸€ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#2-ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;2.ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ&quot;&gt;&lt;/a&gt;2.ä¸»ä»å¤åˆ¶çš„æ¦‚å¿µ&lt;/h3&gt;&lt;p&gt;åœ¨ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰ç­–ç•¥ä¸­ï¼ŒæœåŠ¡åˆ†ä¸ºä¸¤ç±»ï¼šMasterèŠ‚ç‚¹ã€SlaveèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç‰¹ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;MasterèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å¤šä¸ªSlaveèŠ‚ç‚¹ï¼Œä½†SlaveèŠ‚ç‚¹åªèƒ½æœåŠ¡ä¸€ä¸ªMasterèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®å¤åˆ¶æ–¹å‘åªèƒ½æ˜¯MasterèŠ‚ç‚¹-&amp;gt;SlaveèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¼˜ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ç°äº†å¤šæœºçƒ­æ•°æ®å¤‡ä»½ï¼Œæé«˜äº†é¢å¯¹å®•æœºæ•°æ®æ¢å¤çš„ç¾å¤‡èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šå®ç°è¯»å†™åˆ†ç¦»æé«˜æœåŠ¡ååé‡ï¼Œå³ï¼šMasterèŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼ŒSlaveèŠ‚ç‚¹æä¾›è¯»æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœMasterèŠ‚ç‚¹å®•æœºå¯ä»¥å¿«é€Ÿåˆ‡æ¢ä½¿ç”¨SlaveèŠ‚ç‚¹æä¾›æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="redis" scheme="http://xupin.im/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - åˆ†ç‰‡å’Œåˆ†åŒº</title>
    <link href="http://xupin.im/2020/03/23/mysql-sharding-partition/"/>
    <id>http://xupin.im/2020/03/23/mysql-sharding-partition/</id>
    <published>2020-03-22T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.754Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åœ¨å¤ä¹ Mysqlä¸»ä»çŸ¥è¯†çš„åŒæ—¶ï¼Œå°ä¼™ä¼´è€ƒäº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œåˆ†ç‰‡å’Œåˆ†åŒºæœ‰ä»€ä¹ˆå·®åˆ« â€¦ ä¹ä¸€å¬å¯èƒ½åªæ˜¯åè¯ä¸Šçš„ä¸åŒï¼Œä½†å…¶å®å®ƒä»¬ä¿©çš„ç¡®ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</p><h3 id="1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ</h3><p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œä¸€å¼ æ–‡ç« è¡¨ã€‚<br>ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`mark`</span>.<span class="string">`article`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`type`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç±»å‹'</span>,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ ‡é¢˜'</span>,</span><br><span class="line">  <span class="string">`content`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'å†…å®¹'</span>,</span><br><span class="line">  <span class="string">`author`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ä½œè€…'</span>,</span><br><span class="line">  <span class="string">`date`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ—¥æœŸ'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>éœ€æ±‚å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·æ‰“å¼€appä¼šç›´æ¥å±•ç¤ºæ–‡ç« åˆ—è¡¨ï¼ˆç±»å‹ï¼Œæ ‡é¢˜ï¼Œä½œè€…ï¼Œæ—¥æœŸï¼‰</li><li>ç‚¹å‡»æ–‡ç« æŸ¥çœ‹è¯¦æƒ…</li></ol><p>é‚£ä¹ˆè¿™å¼ è¡¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°çš„åˆæœŸåº”å¯¹è®¿é—®æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚ä½†æ˜¯éšç€æ•°æ®é‡æ—¥ç›Šè†¨èƒ€ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šè¶Šæ¥è¶Šä½ï¼Œå› ä¸ºé‡Œé¢<code>content</code>å­—æ®µéå¸¸å·¨å¤§ã€‚</p><p>è¿™æ—¶å€™è¦æ€ä¹ˆä¼˜åŒ–å‘¢ï¼ŸæŠŠ<code>content</code>å­—æ®µæ‹†å‡ºå»ï¼Œå› ä¸ºè®¿é—®æœ€å¤šçš„è¯·æ±‚å¹¶ä¸éœ€è¦<code>content</code>ï¼Œæ€ä¹ˆæ‹†å‘¢ï¼Ÿç»“æ„å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡ç« è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`mark`</span>.<span class="string">`article`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`type`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç±»å‹'</span>,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ ‡é¢˜'</span>,</span><br><span class="line">  <span class="string">`c_id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ–‡ç« ID'</span>,</span><br><span class="line">  <span class="string">`author`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ä½œè€…'</span>,</span><br><span class="line">  <span class="string">`created_at`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ—¥æœŸ'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment"># æ–‡ç« å†…å®¹è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`mark`</span>.<span class="string">`article_content`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`content`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'å†…å®¹'</span>,</span><br><span class="line">  <span class="string">`created_at`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ—¥æœŸ'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="2-å‚ç›´ï¼ˆçºµå‘ï¼‰åˆ‡åˆ†"><a href="#2-å‚ç›´ï¼ˆçºµå‘ï¼‰åˆ‡åˆ†" class="headerlink" title="2.å‚ç›´ï¼ˆçºµå‘ï¼‰åˆ‡åˆ†"></a>2.å‚ç›´ï¼ˆçºµå‘ï¼‰åˆ‡åˆ†</h3><p>ä¸Šè¿°è¿™ç§æƒ…å†µå°±æ˜¯åˆ†ç‰‡çš„ä¸€ç§ï¼Œ<code>å‚ç›´åˆ‡åˆ†</code>ä¹Ÿè¢«ç§°ä¸º<code>çºµå‘åˆ‡åˆ†</code>ï¼Œè¿™ç§åˆ†ç‰‡çš„æ–¹å¼ä¸ä»…å¯ä»¥è·¨è¡¨ä¹Ÿå¯ä»¥è·¨åº“ã€‚</p><p>ä¼˜ç‚¹</p><ol><li>æ‹†åˆ†è§„åˆ™ç®€å•ã€‚</li><li>æ•°æ®æ¨¡å—æ¸…æ™°ã€‚</li><li>å®¹æ˜“ç»´æŠ¤ï¼Œå®¹æ˜“å®šä½é—®é¢˜ã€‚</li></ol><p>ç¼ºç‚¹</p><ol><li>å¦‚æœåˆ†ç‰‡è¡¨è·¨åº“ï¼Œé‚£ä¹ˆåœ¨SQLå±‚æ— æ³•è¿›è¡Œè¿è¡¨æŸ¥è¯¢ï¼Œåªèƒ½åœ¨ç¨‹åºå±‚å¤„ç†ã€‚</li><li>äº‹åŠ¡å¤„ç†å¤æ‚åº¦å˜é«˜ã€‚</li><li>åæœŸè¡¨ç»“æ„çš„æ‰©å±•æ€§å—é™ã€‚</li></ol><h3 id="3-æ°´å¹³ï¼ˆæ¨ªå‘ï¼‰åˆ‡åˆ†"><a href="#3-æ°´å¹³ï¼ˆæ¨ªå‘ï¼‰åˆ‡åˆ†" class="headerlink" title="3.æ°´å¹³ï¼ˆæ¨ªå‘ï¼‰åˆ‡åˆ†"></a>3.æ°´å¹³ï¼ˆæ¨ªå‘ï¼‰åˆ‡åˆ†</h3><p>è¯´åˆ°äº†å‚ç›´åˆ‡åˆ†ï¼Œé‚£å°±ä¸å¾—ä¸æä¸€ä¸‹<code>æ°´å¹³åˆ‡åˆ†</code>ä¹Ÿè¢«ç§°ä¹‹ä¸º<code>æ¨ªå‘åˆ‡åˆ†</code>ã€‚<br>åŒæ ·ä¸¾ä¸ªä¾‹å­ï¼Œä¸€å¼ ç”¨æˆ·æ—¥å¿—è¡¨ã€‚<br>ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`mark`</span>.<span class="string">`user_log`</span>  (</span><br><span class="line">  <span class="string">`u_id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·ID'</span>,</span><br><span class="line">  <span class="string">`content`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ—¥å¿—å†…å®¹'</span>,</span><br><span class="line">  <span class="string">`created_at`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºæ—¥æœŸ'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>éœ€æ±‚å¦‚ä¸‹ï¼š</p><ol><li>æ ¹æ®ç”¨æˆ·IDå¿«é€Ÿæ£€ç´¢æ—¥å¿—ä¿¡æ¯</li></ol><p>æƒ…å†µä¸€æ ·ï¼Œåœ¨æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™åŠŸèƒ½å“åº”é€Ÿåº¦åº”è¯¥è¿˜å¯ä»¥ï¼Œä½†æ˜¯éšç€æ•°æ®é‡å¢é•¿çš„æ¯”è¾ƒå‰å®³ã€‚æŸ¥è¯¢æ•ˆç‡ä¼šå‘ˆæ–­å´–å¼ä¸‹é™ã€‚</p><p>é‚£ä¹ˆè¿™æ—¶å€™è¦æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿæˆ‘ä»¬æŒ‰ç…§ç”¨æˆ·IDå»æ‹†åˆ†è¡¨ï¼Œå³æ¯ä¸ªç”¨æˆ·å­˜å‚¨çš„æ—¥å¿—å›ºå®šåœ¨ä¸€å¼ è¡¨ã€‚ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`mark`</span>.<span class="string">`user_log_&#123;NUM&#125;`</span>  (</span><br><span class="line">  <span class="string">`u_id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·ID'</span>,</span><br><span class="line">  <span class="string">`content`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ—¥å¿—å†…å®¹'</span>,</span><br><span class="line">  <span class="string">`created_at`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºæ—¥æœŸ'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†çœäº‹ï¼Œåé¢{NUM}æ˜¯ä¸ªæ•°å­—å“ˆï¼Œæ¯ä¸ªç”¨æˆ·è¿›æ¥æˆ‘ä»¬ä¼šåˆ©ç”¨æ‘˜è¦ç®—æ³•ï¼ˆæ¯”å¦‚ï¼šcrc32ï¼‰å–ä¸ªå›ºå®šæ•°å€¼ï¼Œç„¶åå›ºå®šæŠŠå¯¹åº”çš„æ•°æ®å­˜å‚¨åˆ°ç›¸åº”çš„è¡¨å†…ã€‚</p><p>ä¼˜ç‚¹</p><ol><li>ä¸ä¼šå‡ºç°è·¨åº“æ— æ³•è¿è¡¨æŸ¥è¯¢çš„æƒ…å†µã€‚</li><li>äº‹åŠ¡å¤„ç†ç›¸å¯¹ç®€å•ã€‚</li><li>å¾ˆéš¾å‡ºç°æ‰©å±•æ€§å—é™çš„é—®é¢˜ã€‚</li></ol><p>ç¼ºç‚¹</p><ol><li>æ•°æ®åˆ†å¸ƒä¸å¹³å‡ï¼Œå¯èƒ½ä¸€å¼ è¡¨10Wè¡Œï¼Œå¦å¤–ä¸€å¼ 100Wè¡Œã€‚</li><li>éš¾ç»´æŠ¤ï¼Œå®šä½é—®é¢˜éœ€è¦å‰ç½®ç®—æ³•æŸ¥è¯¢ã€‚</li><li>åæœŸæ•°æ®è¿ç§»æ¯”è¾ƒéº»çƒ¦ã€‚</li></ol><h3 id="4-ä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿ" class="headerlink" title="4.ä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿ"></a>4.ä»€ä¹ˆæ˜¯åˆ†åŒºï¼ˆPartitionï¼‰ï¼Ÿ</h3><p>åˆ†ç‰‡ç®€å•è¯´äº†è¯´ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦å­¦ä¹ ä¸€ä¸‹åˆ†åŒºã€‚åˆ†åŒºå’Œåˆ†ç‰‡æ¯”è¾ƒæ˜æ˜¾çš„ä¸€ç‚¹æ˜¯ï¼šåˆ†ç‰‡å¤šæ˜¯åˆ©ç”¨ç¨‹åºé…åˆæ¥å®ç°ï¼Œåˆ†åŒºåˆ™æ˜¯æ•°æ®åº“ï¼ˆä¸ä»…ä»…æ˜¯Mysqlï¼Œå…¶å®ƒæ•°æ®åº“ä¹Ÿæœ‰ï¼‰æä¾›çš„æœºåˆ¶ã€‚</p><p>é¦–å…ˆï¼Œåˆ†åŒºåˆ†ä¸º4ç§æ¨¡å¼ï¼š</p><ul><li>Range</li><li>List</li><li>Hash</li><li>Key</li></ul><h3 id="5-Range"><a href="#5-Range" class="headerlink" title="5.Range"></a>5.Range</h3><p>Rangeï¼ˆèŒƒå›´ï¼‰å¤§æ¦‚çš„æ€æƒ³æ˜¯å°†æ•°æ®è¿›è¡Œåˆ†æ®µï¼Œæ¯”å¦‚æŒ‰ç…§æ—¥æœŸå°†å†…è´­è¡¨è¿›è¡Œæ‹†åˆ†ï¼Œåˆ†ä¸ºä¸åŒçš„å¹´ä»½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> purchase (<span class="keyword">id</span> <span class="built_in">INT</span>, app_id <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>), money <span class="built_in">NUMERIC</span>(<span class="number">20</span>,<span class="number">4</span>),currency <span class="built_in">VARCHAR</span>(<span class="number">10</span>),created_at <span class="built_in">DATE</span>)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>( <span class="keyword">YEAR</span>(created_at) ) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p0 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">1990</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">1995</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2005</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2010</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p5 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2015</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥æŒ‰ç…§é‡‘é¢æ¥è¿›è¡Œåˆ†åŒºã€‚</span></span><br><span class="line"><span class="comment"># PARTITION BY RANGE( money ) ();</span></span><br></pre></td></tr></table></figure><p>å†™å…¥ä»¥ä¸‹æ•°æ®<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> purchase(app_id,<span class="keyword">name</span>,money,currency,created_at) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">600001</span>,<span class="string">'desk organiser'</span>,<span class="number">6.0000</span>,<span class="string">'CNY'</span>,<span class="string">'2003-10-15'</span>),</span><br><span class="line">(<span class="number">600001</span>,<span class="string">'alarm clock'</span>,<span class="number">12.0000</span>,<span class="string">'CNY'</span>,<span class="string">'1997-11-05'</span>),</span><br><span class="line">(<span class="number">600002</span>,<span class="string">'chair'</span>,<span class="number">30.0000</span>,<span class="string">'CNY'</span>,<span class="string">'2009-03-10'</span>),</span><br><span class="line">(<span class="number">600002</span>,<span class="string">'bookcase'</span>,<span class="number">68.0000</span>,<span class="string">'CNY'</span>,<span class="string">'1989-01-10'</span>),</span><br><span class="line">(<span class="number">600002</span>,<span class="string">'exercise bike'</span>,<span class="number">128.0000</span>,<span class="string">'CNY'</span>,<span class="string">'2014-05-09'</span>),</span><br><span class="line">(<span class="number">600003</span>,<span class="string">'sofa'</span>,<span class="number">258.0000</span>,<span class="string">'CNY'</span>,<span class="string">'1987-06-05'</span>),</span><br><span class="line">(<span class="number">600003</span>,<span class="string">'espresso maker'</span>,<span class="number">648.0000</span>,<span class="string">'CNY'</span>,<span class="string">'2011-11-22'</span>),</span><br><span class="line">(<span class="number">600004</span>,<span class="string">'aquarium'</span>,<span class="number">99.0000</span>,<span class="string">'USD'</span>,<span class="string">'1992-08-04'</span>),</span><br><span class="line">(<span class="number">600005</span>,<span class="string">'study desk'</span>,<span class="number">129.0000</span>,<span class="string">'USD'</span>,<span class="string">'2006-09-16'</span>),</span><br><span class="line">(<span class="number">600006</span>,<span class="string">'lava lamp'</span>,<span class="number">299.0000</span>,<span class="string">'USD'</span>,<span class="string">'1998-12-25'</span>);</span><br></pre></td></tr></table></figure></p><p>ç„¶åæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ï¼Œå¯èƒ½é€šè¿‡è‚‰çœ¼çœ‹æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œæ‰§è¡Œè¿™æ¡æŸ¥çœ‹åˆ†åŒºçŠ¶æ€çš„SQL<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">partition_name part,</span><br><span class="line">partition_expression expr,</span><br><span class="line">table_rows </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">information_schema.PARTITIONS </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">table_schema = <span class="keyword">SCHEMA</span> () </span><br><span class="line"><span class="keyword">AND</span> table_name = <span class="string">'&#123;TABLE&#125;'</span>;</span><br><span class="line"><span class="comment"># ç»“æœå¦‚ä¸‹</span></span><br><span class="line">part    |   expr              |   descr |   table_rows</span><br><span class="line">p0      |   YEAR(created_at)  |   1990  |   2</span><br><span class="line">p1      |   YEAR(created_at)  |   1995  |   1</span><br><span class="line">p2      |   YEAR(created_at)  |   2000  |   2</span><br><span class="line">p3      |   YEAR(created_at)  |   2005  |   1</span><br><span class="line">p4      |   YEAR(created_at)  |   2010  |   2</span><br><span class="line">p5      |   YEAR(created_at)  |   2015  |   2</span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜æ˜¾ï¼Œæ•°æ®åˆ†åˆ«æŒ‰ç…§è§„åˆ™å†™è¿›äº†åˆ†åŒºè¡¨p0 ~ p5ã€‚</p><h3 id="6-List"><a href="#6-List" class="headerlink" title="6.List"></a>6.List</h3><p>Listï¼ˆåˆ—è¡¨ï¼‰æ¨¡å¼ï¼Œå¤šç”¨äºå¯¹äºæŒ‡å®šå­—æ®µçš„æ•°å€¼è¿›è¡Œæ˜ç¡®çš„æ•°æ®æ‹†åˆ†ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> purchase (<span class="keyword">id</span> <span class="built_in">INT</span>, app_id <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>), money <span class="built_in">NUMERIC</span>(<span class="number">20</span>,<span class="number">4</span>),currency <span class="built_in">VARCHAR</span>(<span class="number">10</span>),created_at <span class="built_in">DATE</span>)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">LIST</span>( app_id ) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p0 <span class="keyword">VALUES</span> <span class="keyword">IN</span> (<span class="number">600001</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">IN</span> (<span class="number">600002</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">IN</span> (<span class="number">600003</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">IN</span> (<span class="number">600004</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">IN</span> (<span class="number">600005</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p5 <span class="keyword">VALUES</span> <span class="keyword">IN</span> (<span class="number">600006</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å†™å…¥åŒæ ·çš„æ•°æ®ï¼Œä¹‹åæ‰§è¡ŒæŸ¥çœ‹åˆ†åŒºçŠ¶æ€çš„SQLã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">part    |   expr    |   descr   |   table_rows</span><br><span class="line">p0      |   app_id  |   600001  |   2</span><br><span class="line">p1      |   app_id  |   600002  |   3</span><br><span class="line">p2      |   app_id  |   600003  |   2</span><br><span class="line">p3      |   app_id  |   600004  |   1</span><br><span class="line">p4      |   app_id  |   600005  |   1</span><br><span class="line">p5      |   app_id  |   600006  |   1</span><br></pre></td></tr></table></figure></p><h3 id="7-Hash"><a href="#7-Hash" class="headerlink" title="7.Hash"></a>7.Hash</h3><p>Hashï¼ˆå“ˆå¸Œï¼‰æ¨¡å¼é€šè¿‡å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µè¿›è¡ŒHashè®¡ç®—ï¼Œé€šè¿‡è¿™ä¸ªHashå€¼æ¥è¿›è¡Œåˆ†åŒºï¼ˆæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆåƒåˆ†ç‰‡ï¼Œå…¶å®åˆ†ç‰‡çš„æ€æƒ³å°±æ˜¯æ ¹æ®åˆ†åŒºè¡ç”Ÿè€Œæ¥ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> purchase (<span class="keyword">id</span> <span class="built_in">INT</span>, app_id <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>), money <span class="built_in">NUMERIC</span>(<span class="number">20</span>,<span class="number">4</span>),currency <span class="built_in">VARCHAR</span>(<span class="number">10</span>),created_at <span class="built_in">DATE</span>)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">HASH</span>( <span class="keyword">YEAR</span>(created_at) )</span><br><span class="line"><span class="keyword">PARTITIONS</span> <span class="number">4</span>; <span class="comment"># ä¸ºäº†åŒºåˆ«ï¼Œè®¾4ä¸ªåˆ†åŒºã€‚</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†™å…¥åŒæ ·çš„æ•°æ®ï¼Œä¹‹åæ‰§è¡ŒæŸ¥çœ‹åˆ†åŒºçŠ¶æ€çš„SQLã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">part|   expr              |  descr |   table_rows</span><br><span class="line">p0  |   YEAR(created_at)  |  NULL  |   1</span><br><span class="line">p1  |   YEAR(created_at)  |  NULL  |   3</span><br><span class="line">p2  |   YEAR(created_at)  |  NULL  |   3</span><br><span class="line">p3  |   YEAR(created_at)  |  NULL  |   3</span><br></pre></td></tr></table></figure></p><h3 id="8-Key"><a href="#8-Key" class="headerlink" title="8.Key"></a>8.Key</h3><p>Keyï¼ˆé”®ï¼‰æ¨¡å¼å’ŒHashæ¨¡å¼æå…¶ç›¸ä¼¼ï¼Œå¯èƒ½æœ‰ä¸€ç‚¹åŒºåˆ«å°±æ˜¯ï¼ŒHashæ¨¡å¼ä¸‹æ˜¯ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™è¿›è¡ŒHashè®¡ç®—ï¼Œè€ŒKeyæ¨¡å¼æ˜¯Mysqlä½¿ç”¨è‡ªå·±çš„å‡½æ•°è¿›è¡ŒHashè®¡ç®—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> purchase (<span class="keyword">id</span> <span class="built_in">INT</span>, app_id <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>), money <span class="built_in">NUMERIC</span>(<span class="number">20</span>,<span class="number">4</span>),currency <span class="built_in">VARCHAR</span>(<span class="number">10</span>),created_at <span class="built_in">DATE</span>)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">KEY</span>( created_at )</span><br><span class="line"><span class="keyword">PARTITIONS</span> <span class="number">3</span>; <span class="comment"># ä¸ºäº†åŒºåˆ«ï¼Œè®¾3ä¸ªåˆ†åŒºã€‚</span></span><br></pre></td></tr></table></figure><p>é‡å¤æ­¥éª¤ï¼Œå†™å…¥åŒæ ·çš„æ•°æ®ï¼Œä¹‹åæ‰§è¡ŒæŸ¥çœ‹åˆ†åŒºçŠ¶æ€çš„SQLã€‚<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">part|   <span class="type">expr</span>          |  <span class="type">descr</span> |   <span class="type">table_rows</span></span><br><span class="line">p0  |   <span class="type">`created_at</span>`  |  <span class="type">NULL</span>  |   <span class="type">2</span></span><br><span class="line">p1  |   <span class="type">`created_at</span>`  |  <span class="type">NULL</span>  |   <span class="type">3</span></span><br><span class="line">p2  |   <span class="type">`created_at</span>`  |  <span class="type">NULL</span>  |   <span class="type">5</span></span><br></pre></td></tr></table></figure></p><p>Keyæ¨¡å¼å’ŒHashæ¨¡å¼åœ¨<code>expr</code>ä¸Šé¢æœ‰äº†ç›´è§‚çš„ä¸åŒè¡¨ç°ï¼ŒHashæ¨¡å¼æ˜¯ï¼šYEAR(created_at)ï¼Œè€ŒKeyæ¨¡å¼æ˜¯ï¼šcreated_atã€‚è¿™å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„Hashè®¡ç®—æ–¹å¼çš„åŒºåˆ«ã€‚</p><h3 id="9-æœ€å"><a href="#9-æœ€å" class="headerlink" title="9.æœ€å"></a>9.æœ€å</h3><p>å…¶å®Mysqlåˆ†åŒºè¿˜æœ‰ç¬¬5ç§æ¨¡å¼ï¼Œå«åšCompositeï¼ˆå¤åˆï¼‰æ¨¡å¼ï¼Œæ¯”å¦‚ï¼šRange - Key<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> purchase (<span class="keyword">id</span> <span class="built_in">INT</span>, app_id <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>), money <span class="built_in">NUMERIC</span>(<span class="number">20</span>,<span class="number">4</span>),currency <span class="built_in">VARCHAR</span>(<span class="number">10</span>),created_at <span class="built_in">DATE</span>)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>( <span class="keyword">YEAR</span>( created_at ) ) </span><br><span class="line"><span class="keyword">SUBPARTITION</span> <span class="keyword">BY</span> <span class="keyword">KEY</span>( created_at )</span><br><span class="line"><span class="keyword">SUBPARTITIONS</span> <span class="number">3</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">PARTITION</span> p0 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">1990</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">1995</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2005</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2010</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p5 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2015</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå°±ä¸å±•å¼€Compositeï¼ˆå¤åˆï¼‰æ¨¡å¼çš„å­¦ä¹ äº†ï¼Œæœ€åé€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œå¯ä»¥çœ‹å‡ºåˆ†åŒºä¹Ÿæ˜¯æœ‰å‚ç›´åˆ†åŒºå’Œæ°´å¹³åˆ†åŒºçš„è¯´æ³•çš„ã€‚</p><blockquote><p><a href="https://dev.mysql.com/doc/mysql-partitioning-excerpt/5.7/en/partitioning-management.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/mysql-partitioning-excerpt/5.7/en/partitioning-management.html</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰åœ¨å¤ä¹ Mysqlä¸»ä»çŸ¥è¯†çš„åŒæ—¶ï¼Œå°ä¼™ä¼´è€ƒäº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œåˆ†ç‰‡å’Œåˆ†åŒºæœ‰ä»€ä¹ˆå·®åˆ« â€¦ ä¹ä¸€å¬å¯èƒ½åªæ˜¯åè¯ä¸Šçš„ä¸åŒï¼Œä½†å…¶å®å®ƒä»¬ä¿©çš„ç¡®ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ&quot;&gt;&lt;/a&gt;1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼ˆShardingï¼‰ï¼Ÿ&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œä¸€å¼ æ–‡ç« è¡¨ã€‚&lt;br&gt;ç»“æ„å¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;`mark`&lt;/span&gt;.&lt;span class=&quot;string&quot;&gt;`article`&lt;/span&gt;  (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`type`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;ç±»å‹&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`title`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;æ ‡é¢˜&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`content`&lt;/span&gt; longtext &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;å†…å®¹&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`author`&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;ä½œè€…&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;`date`&lt;/span&gt; datetime &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;æ—¥æœŸ&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PRIMARY &lt;span class=&quot;keyword&quot;&gt;KEY&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;`id`&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;éœ€æ±‚å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·æ‰“å¼€appä¼šç›´æ¥å±•ç¤ºæ–‡ç« åˆ—è¡¨ï¼ˆç±»å‹ï¼Œæ ‡é¢˜ï¼Œä½œè€…ï¼Œæ—¥æœŸï¼‰&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»æ–‡ç« æŸ¥çœ‹è¯¦æƒ…&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‚£ä¹ˆè¿™å¼ è¡¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°çš„åˆæœŸåº”å¯¹è®¿é—®æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚ä½†æ˜¯éšç€æ•°æ®é‡æ—¥ç›Šè†¨èƒ€ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šè¶Šæ¥è¶Šä½ï¼Œå› ä¸ºé‡Œé¢&lt;code&gt;content&lt;/code&gt;å­—æ®µéå¸¸å·¨å¤§ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ—¶å€™è¦æ€ä¹ˆä¼˜åŒ–å‘¢ï¼ŸæŠŠ&lt;code&gt;content&lt;/code&gt;å­—æ®µæ‹†å‡ºå»ï¼Œå› ä¸ºè®¿é—®æœ€å¤šçš„è¯·æ±‚å¹¶ä¸éœ€è¦&lt;code&gt;content&lt;/code&gt;ï¼Œæ€ä¹ˆæ‹†å‘¢ï¼Ÿç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - åˆ·è„æœºåˆ¶</title>
    <link href="http://xupin.im/2020/03/21/mysql-checkpoint/"/>
    <id>http://xupin.im/2020/03/21/mysql-checkpoint/</id>
    <published>2020-03-20T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.752Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰å­¦ä¹ äº†LRUç®—æ³•å’ŒMysqlç¼“å†²æ± ä½¿ç”¨çš„LRUå˜ä½“ç®—æ³•ï¼Œå…¶ä¸­æœ‰ä¸ªå…±åŒç‚¹å°±æ˜¯å½“LRUé“¾è¡¨å†™æ»¡ä»¥åå¦‚æœå†æœ‰æ–°æ•°æ®è¿›æ¥ä¼šæ·˜æ±°å°¾éƒ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆMysqlæ·˜æ±°è¿™äº›å°¾éƒ¨æ•°æ®çš„æ—¶å€™æ˜¯å¦ä¼šè¿›è¡Œä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬åœ¨æœ€åæåˆ°äº†ä¸€ä¸ªå‚æ•°<code>Modified db pages</code>ï¼Œå³è„é¡µã€‚</p><h3 id="1-ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ</h3><ul><li>è„é¡µï¼Œè¿™ä¸ªåè¯å¾ˆæŠ½è±¡ä»å­—é¢æ„æ€å»çœ‹å¯èƒ½å¾ˆä¸è§£ï¼Œè„é¡µæ˜¯å½“å†…å­˜ä¸­çš„æ•°æ®é¡µå’Œç£ç›˜ä¸­çš„æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´æ—¶ï¼Œè¿™ä¸ªæ•°æ®é¡µç§°ä¹‹ä¸ºè„é¡µã€‚å› ä¸ºä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥è®²ï¼Œè‡ªå·±è¯»å…¥çš„æ•°æ®è¢«å¤–éƒ¨æ‰€ä¿®æ”¹ç­‰äºè¢«æ±¡æŸ“ï¼Œæ‰€ä»¥å«è„é¡µã€‚</li><li>å½“å†…å­˜ä¸­çš„æ•°æ®é¡µå’Œç£ç›˜ä¸­çš„æ•°æ®é¡µæ•°æ®ä¸€è‡´ï¼Œå«å¹²å‡€é¡µã€‚</li></ul><h3 id="2-è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ"><a href="#2-è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ" class="headerlink" title="2.è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ"></a>2.è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ</h3><ol><li>ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ç©ºé—´ä¸è¶³ï¼Œä¹Ÿå°±æ˜¯LRUé“¾è¡¨å†™æ»¡æ—¶ï¼Œæ–°æ•°æ®è¿›æ¥æ—¶æ·˜æ±°æ‰çš„å°¾éƒ¨æ•°æ®è„é¡µã€‚</li><li>redo logä¸å¯ç”¨æ—¶ï¼Œéœ€è¦å¼ºåˆ¶å°†è„é¡µåˆ—è¡¨ä¸­çš„ä¸€äº›æ•°æ®é¡µåˆ·å…¥ç£ç›˜ã€‚</li><li>Mysqlåœ¨æœåŠ¡å™¨è´Ÿè½½è¾ƒå°æ—¶ï¼Œä¼šä¸»åŠ¨è¿›è¡Œåˆ·è„æ“ä½œã€‚</li><li>MysqlæœåŠ¡æ­£å¸¸å…³é—­ï¼Œä¼šåˆ·æ–°æ‰€æœ‰è„é¡µã€‚</li></ol><h3 id="3-ä»€ä¹ˆæ˜¯redo-logï¼Ÿ"><a href="#3-ä»€ä¹ˆæ˜¯redo-logï¼Ÿ" class="headerlink" title="3.ä»€ä¹ˆæ˜¯redo logï¼Ÿ"></a>3.ä»€ä¹ˆæ˜¯redo logï¼Ÿ</h3><p>InnoDBä¸­ä¸¤å—éå¸¸é‡è¦çš„æ—¥å¿—ï¼Œä¸€ä¸ªæ˜¯undo logï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„redo logã€‚å‰è€…ç”¨æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ä»¥åŠInnoDBçš„MVCCï¼ˆMutil-Version Concurrency Controlï¼‰ï¼Œåè€…ç”¨æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™å†™redo logå‘¢ï¼Ÿå½“æ•°æ®åº“å¯¹æ•°æ®åšä¿®æ”¹çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®é¡µä»ç£ç›˜è¯»åˆ°ç¼“å†²æ± ä¸­ï¼Œç„¶ååœ¨ç¼“å†²æ± ä¸­è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯InnoDBé‡‡ç”¨çš„æ˜¯WALï¼ˆWrite Ahead Logï¼‰ç­–ç•¥æ¥é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡æäº¤æ—¶ï¼Œå…ˆå†™redo logæ‰ä¼šå†å»ä¿®æ”¹å†…å­˜æ•°æ®é¡µã€‚</p><p>redo logçš„æ–‡ä»¶åé»˜è®¤ä»¥ib_logfile{NUM}ï¼Œå­˜å‚¨åœ¨my.cnfä¸­datadirç›®å½•ä¸‹é¢ï¼Œå—ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°æ§åˆ¶</p><ul><li>innodb_log_file_sizeï¼Œæ—¥å¿—å¤§å°</li><li>innodb_log_files_in_groupï¼Œæ—¥å¿—ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯2ä¸ªã€‚</li></ul><p>æ‰€ä»¥redo logçš„å¤§å°ç­‰äºinnodb_log_files_in_group*innodb_log_file_sizeã€‚</p><p>æ—¢ç„¶redo logä¼šäº§ç”Ÿï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šè¢«è¦†ç›–å‘¢ï¼Ÿredo logè¢«è®¾è®¡æˆå¯å¾ªç¯ä½¿ç”¨ï¼Œå½“æ—¥å¿—æ–‡ä»¶å†™æ»¡æ—¶é‚£äº›å·²ç»è¢«åˆ·å…¥ç£ç›˜ä¸­çš„æ•°æ®å°±å¯ä»¥è¢«è¦†ç›–å•¦ã€‚</p><blockquote><p>WALï¼ˆWrite Ahead Logï¼‰ï¼Œæ˜¯å…³ç³»æ•°æ®åº“ç³»ç»Ÿä¸­ç”¨äºæä¾›åŸå­æ€§å’ŒæŒä¹…æ€§ï¼ˆACIDå±æ€§ä¸­çš„ä¸¤ä¸ªï¼‰çš„ä¸€ç³»åˆ—æŠ€æœ¯ï¼ŒARIESæ˜¯WALç³»åˆ—æŠ€æœ¯å¸¸ç”¨çš„ç®—æ³•ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­WALé€šå¸¸ç§°ä¸ºjournalingã€‚WALçš„ä¸»è¦æ€æƒ³æ˜¯å°†å…ƒæ•°æ®çš„å®æ—¶å˜æ›´æ“ä½œå†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ç³»ç»Ÿè´Ÿè½½è¾ƒå°æ—¶å†æŠŠæ—¥å¿—åˆ·å…¥ç£ç›˜ã€‚ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘ç£ç›˜çš„IOæ“ä½œï¼Œæ­¤å¤„å°±ä¸å±•å¼€å­¦ä¹ äº†ã€‚å…ˆMarkä¸€ä¸‹</p></blockquote><a id="more"></a><h3 id="4-Checkpoint"><a href="#4-Checkpoint" class="headerlink" title="4.Checkpoint"></a>4.Checkpoint</h3><p>Checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­ä¸€èˆ¬æ˜¯ç”¨æ¥æŠŠredo logè„é¡µåˆ·å…¥ç£ç›˜çš„ä¸€ä¸ªæ“ä½œï¼Œé€šè¿‡LSNä¿å­˜è®°å½•ï¼Œä½œç”¨æ˜¯å½“å‘ç”Ÿå®•æœºç­‰crashæƒ…å†µæ—¶ï¼Œå†æ¬¡å¯åŠ¨æ—¶ä¼šæŸ¥è¯¢Checkpointï¼Œåœ¨è¯¥Checkpointä¹‹åå‘ç”Ÿçš„äº‹åŠ¡ä¿®æ”¹æ¢å¤åˆ°ç£ç›˜ã€‚é€šä¿—æ¥è§£é‡Šï¼Œå°±åƒæˆ‘ä»¬ç©ä¸€äº›æ¸¸æˆæ¯è¿‡ä¸ä¹…å°±ä¼šå­˜ä¸€æ¬¡æ¡£ï¼Œç„¶åå¦‚æœæ¸¸æˆå®¢æˆ·ç«¯ä¸å¹¸crashé‡æ–°è¿›å…¥æœ€è¿‘çš„ä¸€æ¬¡å­˜æ¡£å³å¯ï¼ŒåŒç†ã€‚</p><p>Checkpointå­˜åœ¨çš„ç›®çš„ï¼š</p><ol><li>ç¼©çŸ­æ¢å¤æ•°æ®æ—¶é—´ã€‚</li><li>ç¼“å†²æ± å†™æ»¡æ—¶ï¼Œæ·˜æ±°è„é¡µåˆ·å…¥ç£ç›˜ã€‚</li><li>redo logå†™æ»¡æ—¶ï¼Œè¿›è¡Œåˆ·è„æ“ä½œã€‚</li></ol><p>é‚£ä¹ˆæ€ä¹ˆæŸ¥çœ‹æˆ‘ä»¬çš„æ£€æŸ¥ç‚¹å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤show engine innodb statusæ¥æŸ¥çœ‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;show engine innodb status\G;</span><br><span class="line">---</span><br><span class="line">LOG</span><br><span class="line">---</span><br><span class="line">Log sequence number 1597945</span><br><span class="line">Log flushed up to   1597945</span><br><span class="line">Last Checkpoint at  1597945</span><br><span class="line">Max Checkpoint age    7782360</span><br><span class="line">Checkpoint age target 7539162</span><br><span class="line">Modified age          0</span><br><span class="line">Checkpoint age        0</span><br><span class="line">0 pending <span class="built_in">log</span> writes, 0 pending chkp writes</span><br><span class="line">8 <span class="built_in">log</span> i/o<span class="string">'s done, 0.42 log i/o'</span>s/second</span><br></pre></td></tr></table></figure></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Log</span> sequence number     <span class="string">|   å½“å‰ç³»ç»ŸLSNæœ€å¤§å€¼ï¼Œæ–°çš„æ—¥å¿—LSNå°†åœ¨æ­¤åŸºç¡€ä¸Šç”Ÿæˆï¼ˆLSN+æ–°æ—¥å¿—çš„å¤§å°ï¼‰ã€‚</span></span><br><span class="line"><span class="built_in">Log</span> flushed up to       <span class="string">|   å½“å‰å·²ç»å†™å…¥æ—¥å¿—æ–‡ä»¶çš„LSNã€‚</span></span><br><span class="line">Last Checkpoint at      <span class="string">|   å½“å‰å·²ç»å†™å…¥Checkpointçš„LSNã€‚</span></span><br><span class="line">Max Checkpoint age      <span class="string">|   Perconaçš„XtraDBå‚æ•°ï¼Œæ­¤å¤„ä¸è¿‡å¤šè§£é‡Šã€‚</span></span><br><span class="line">Checkpoint age target   <span class="string">|   åŒä¸Šã€‚</span></span><br></pre></td></tr></table></figure><blockquote><p>LSNï¼ˆLog Sequence Numberï¼‰ï¼ŒLSNæ˜¯æ—¥å¿—ç©ºé—´ä¸­æ¯æ¡æ—¥å¿—çš„ç»“æŸç‚¹ï¼Œç”¨å­—èŠ‚åç§»é‡æ¥è¡¨ç¤ºã€‚æ¯ä¸ªæ•°æ®é¡µæœ‰LSNï¼Œredo logä¹Ÿæœ‰LSNï¼ŒCheckpointäº¦æœ‰LSNã€‚è¯¥LSNè®°å½•å½“å‰æ•°æ®é¡µæœ€åä¸€æ¬¡ä¿®æ”¹çš„LSNå·ï¼Œç”¨äºåœ¨æ¢å¤æ•°æ®æ—¶å¯¹æ¯”é‡åšæ—¥å¿—LSNå·å†³å®šæ˜¯å¦å¯¹è¯¥æ•°æ®é¡µè¿›è¡Œæ¢å¤æ•°æ®ã€‚å¯ä»¥é€šä¿—ç†è§£ä¸ºï¼Œå­˜æ¡£ç¼–å·ã€‚</p></blockquote><h3 id="5-Checkpointä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ï¼Ÿ"><a href="#5-Checkpointä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ï¼Ÿ" class="headerlink" title="5.Checkpointä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ï¼Ÿ"></a>5.Checkpointä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ï¼Ÿ</h3><p>InnoDBå­˜å‚¨å¼•æ“æœ‰ä¸¤ç§Checkpointï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>Sharp Checkpoint</li><li>Fuzzy Checkpoint</li></ul><p>Sharp Checkpointå‘ç”Ÿåœ¨æ•°æ®åº“æœåŠ¡å…³é—­æ—¶ï¼Œå°†æ‰€æœ‰è„é¡µåˆ·å…¥ç£ç›˜ï¼Œæ­¤æ—¶innodb_fast_shutdownå‚æ•°çš„å€¼ä¸º1ï¼ˆinnodb_fast_shutdownå‚æ•°çš„å€¼ï¼š0ã€1ã€2ï¼‰ï¼Œè¿™æ˜¯é»˜è®¤æœºåˆ¶ã€‚ä½†æ˜¯è€ƒè™‘åˆ°å¦‚æœæ•°æ®åº“åœ¨ä½¿ç”¨æ—¶ä¹Ÿæ‰§è¡Œè¿™ç§æœºåˆ¶ï¼Œæ•°æ®åº“çš„æ€§èƒ½ä¼šå—åˆ°å½±å“ï¼Œæ‰€ä»¥Fuzzy Checkpointåˆ·æ–°éƒ¨åˆ†è„é¡µçš„è¿™ç§æœºåˆ¶äº§ç”Ÿäº†ã€‚</p><p>Fuzzy Checkpointåˆ·æ–°éƒ¨åˆ†è„é¡µï¼Œä¹Ÿåˆ†ä¸ºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ul><li>Master Thread Checkpoint</li><li>FLUSH_LRU_LIST Checkpoint</li><li>Dirty Page too much Checkpoint</li><li>Async/Sync Flush Checkpoint</li></ul><p>Master Thread Checkpoint</p><blockquote><p>ä¸»çº¿ç¨‹ä»¥æ¯ç§’æˆ–è€…æ¯åç§’ä»ç¼“å†²æ± çš„è„é¡µåˆ—è¡¨ï¼ˆFlush Listï¼‰åˆ·æ–°ä¸€å®šæ¯”ä¾‹çš„æ•°æ®é¡µå›ç£ç›˜ï¼Œè¿™ä¸ªæ“ä½œè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</p></blockquote><p>FLUSH_LRU_LIST Checkpoint</p><blockquote><p>InnoDBéœ€è¦ä¿è¯LRUé“¾è¡¨ä¸­æœ‰è¶³å¤Ÿç©ºé—²é¡µå¯ä»¥ä½¿ç”¨ï¼Œåœ¨InnoDB1.1.xç‰ˆæœ¬å‰ï¼Œå¦‚æœLRUé“¾è¡¨å†™æ»¡æœ‰æ–°çš„æ•°æ®è¿›æ¥å¦‚æœæ·˜æ±°å°¾éƒ¨è„é¡µï¼Œä¼šè§¦å‘Checkpointæœºåˆ¶å¼ºåˆ¶è¿›è¡Œåˆ·è„æ“ä½œã€‚è¯¥æ“ä½œæ˜¯é˜»å¡çº¿ç¨‹çš„ï¼Œæ‰€ä»¥åœ¨InnoDB1.2.xç‰ˆæœ¬å¼€å§‹ï¼Œè¿™ä¸ªæ“ä½œæ”¾åˆ°Page Cleaner Threadæ¥å¤„ç†ï¼Œæ¯æ¬¡åˆ·æ–°LRUé“¾è¡¨è„é¡µçš„æ•°é‡å—innodb_lru_scan_depthå‚æ•°æ§åˆ¶ï¼ˆé»˜è®¤ï¼š1024ï¼‰ã€‚</p></blockquote><p>Dirty Page too much Checkpoint</p><blockquote><p>å½“LRUé“¾è¡¨ä¸­è„é¡µæ•°é‡è¿‡å¤šæ—¶ï¼ˆæ¯”ä¾‹ï¼‰ï¼ŒInnoDBä¸ºäº†ä¿è¯ç¼“å†²æ± ä¸­æœ‰è¶³å¤Ÿå¤šçš„ç©ºé—²é¡µå¯ä»¥ä½¿ç”¨ï¼Œä¼šå¼ºåˆ¶è§¦å‘Checkpointæœºåˆ¶è¿›è¡Œåˆ·è„æ“ä½œã€‚æ­¤å€¼å—innodb_max_dirty_pages_pctå‚æ•°æ§åˆ¶ï¼ˆé»˜è®¤ï¼š75%ï¼‰ã€‚</p></blockquote><p>Async/Sync Flush Checkpoint</p><blockquote><p>ä¸ºäº†ä¿è¯redo logå¾ªç¯ä½¿ç”¨çš„å¯é‡ç”¨æ€§ï¼Œåœ¨redo logä¸å¯ç”¨æ—¶ä¼šå¼ºåˆ¶è§¦å‘Checkpointåˆ·è„æ“ä½œã€‚åœ¨InnoDB1.2.xç‰ˆæœ¬ä»¥å‰ï¼ŒAsync Flush Checkpointä¼šé˜»å¡å½“å‰æŸ¥è¯¢çº¿ç¨‹ï¼ŒSync Flush Checkpointä¼šé˜»å¡æ‰€æœ‰æŸ¥è¯¢çº¿ç¨‹ã€‚InnoDB1.2.Xä¹‹åæ”¾åˆ°å•ç‹¬çš„Page Cleaner Threadæ¥å¤„ç†ã€‚</p></blockquote><h3 id="6-æœ€å"><a href="#6-æœ€å" class="headerlink" title="6.æœ€å"></a>6.æœ€å</h3><p>å…³äºAsync/Sync Flush Checkpointåˆ·è„æ–¹å¼çš„åŸç†æœ‰äº›å¤æ‚ï¼Œè¿™é‡Œå…ˆMarkä¸€ä¸‹ï¼Œæš‚æ—¶ä¸å±•å¼€å­¦ä¹ äº†ã€‚</p><p><code>å‰é¢è¯´åˆ°çš„Percona XtraDB</code></p><blockquote><p><a href="https://www.percona.com/doc/percona-server/8.0/scalability/innodb_io.html" target="_blank" rel="noopener">https://www.percona.com/doc/percona-server/8.0/scalability/innodb_io.html</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰å­¦ä¹ äº†LRUç®—æ³•å’ŒMysqlç¼“å†²æ± ä½¿ç”¨çš„LRUå˜ä½“ç®—æ³•ï¼Œå…¶ä¸­æœ‰ä¸ªå…±åŒç‚¹å°±æ˜¯å½“LRUé“¾è¡¨å†™æ»¡ä»¥åå¦‚æœå†æœ‰æ–°æ•°æ®è¿›æ¥ä¼šæ·˜æ±°å°¾éƒ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆMysqlæ·˜æ±°è¿™äº›å°¾éƒ¨æ•°æ®çš„æ—¶å€™æ˜¯å¦ä¼šè¿›è¡Œä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬åœ¨æœ€åæåˆ°äº†ä¸€ä¸ªå‚æ•°&lt;code&gt;Modified db pages&lt;/code&gt;ï¼Œå³è„é¡µã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ&quot;&gt;&lt;/a&gt;1.ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è„é¡µï¼Œè¿™ä¸ªåè¯å¾ˆæŠ½è±¡ä»å­—é¢æ„æ€å»çœ‹å¯èƒ½å¾ˆä¸è§£ï¼Œè„é¡µæ˜¯å½“å†…å­˜ä¸­çš„æ•°æ®é¡µå’Œç£ç›˜ä¸­çš„æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´æ—¶ï¼Œè¿™ä¸ªæ•°æ®é¡µç§°ä¹‹ä¸ºè„é¡µã€‚å› ä¸ºä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥è®²ï¼Œè‡ªå·±è¯»å…¥çš„æ•°æ®è¢«å¤–éƒ¨æ‰€ä¿®æ”¹ç­‰äºè¢«æ±¡æŸ“ï¼Œæ‰€ä»¥å«è„é¡µã€‚&lt;/li&gt;
&lt;li&gt;å½“å†…å­˜ä¸­çš„æ•°æ®é¡µå’Œç£ç›˜ä¸­çš„æ•°æ®é¡µæ•°æ®ä¸€è‡´ï¼Œå«å¹²å‡€é¡µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ&quot;&gt;&lt;a href=&quot;#2-è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;2.è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ&quot;&gt;&lt;/a&gt;2.è„é¡µä»€ä¹ˆæ—¶å€™ä¼šåˆ·æ–°ï¼Ÿ&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ç©ºé—´ä¸è¶³ï¼Œä¹Ÿå°±æ˜¯LRUé“¾è¡¨å†™æ»¡æ—¶ï¼Œæ–°æ•°æ®è¿›æ¥æ—¶æ·˜æ±°æ‰çš„å°¾éƒ¨æ•°æ®è„é¡µã€‚&lt;/li&gt;
&lt;li&gt;redo logä¸å¯ç”¨æ—¶ï¼Œéœ€è¦å¼ºåˆ¶å°†è„é¡µåˆ—è¡¨ä¸­çš„ä¸€äº›æ•°æ®é¡µåˆ·å…¥ç£ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;Mysqlåœ¨æœåŠ¡å™¨è´Ÿè½½è¾ƒå°æ—¶ï¼Œä¼šä¸»åŠ¨è¿›è¡Œåˆ·è„æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;MysqlæœåŠ¡æ­£å¸¸å…³é—­ï¼Œä¼šåˆ·æ–°æ‰€æœ‰è„é¡µã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;3-ä»€ä¹ˆæ˜¯redo-logï¼Ÿ&quot;&gt;&lt;a href=&quot;#3-ä»€ä¹ˆæ˜¯redo-logï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;3.ä»€ä¹ˆæ˜¯redo logï¼Ÿ&quot;&gt;&lt;/a&gt;3.ä»€ä¹ˆæ˜¯redo logï¼Ÿ&lt;/h3&gt;&lt;p&gt;InnoDBä¸­ä¸¤å—éå¸¸é‡è¦çš„æ—¥å¿—ï¼Œä¸€ä¸ªæ˜¯undo logï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„redo logã€‚å‰è€…ç”¨æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ä»¥åŠInnoDBçš„MVCCï¼ˆMutil-Version Concurrency Controlï¼‰ï¼Œåè€…ç”¨æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆä»€ä¹ˆæ—¶å€™å†™redo logå‘¢ï¼Ÿå½“æ•°æ®åº“å¯¹æ•°æ®åšä¿®æ”¹çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®é¡µä»ç£ç›˜è¯»åˆ°ç¼“å†²æ± ä¸­ï¼Œç„¶ååœ¨ç¼“å†²æ± ä¸­è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯InnoDBé‡‡ç”¨çš„æ˜¯WALï¼ˆWrite Ahead Logï¼‰ç­–ç•¥æ¥é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡æäº¤æ—¶ï¼Œå…ˆå†™redo logæ‰ä¼šå†å»ä¿®æ”¹å†…å­˜æ•°æ®é¡µã€‚&lt;/p&gt;
&lt;p&gt;redo logçš„æ–‡ä»¶åé»˜è®¤ä»¥ib_logfile{NUM}ï¼Œå­˜å‚¨åœ¨my.cnfä¸­datadirç›®å½•ä¸‹é¢ï¼Œå—ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°æ§åˆ¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;innodb_log_file_sizeï¼Œæ—¥å¿—å¤§å°&lt;/li&gt;
&lt;li&gt;innodb_log_files_in_groupï¼Œæ—¥å¿—ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯2ä¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥redo logçš„å¤§å°ç­‰äºinnodb_log_files_in_group*innodb_log_file_sizeã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶redo logä¼šäº§ç”Ÿï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šè¢«è¦†ç›–å‘¢ï¼Ÿredo logè¢«è®¾è®¡æˆå¯å¾ªç¯ä½¿ç”¨ï¼Œå½“æ—¥å¿—æ–‡ä»¶å†™æ»¡æ—¶é‚£äº›å·²ç»è¢«åˆ·å…¥ç£ç›˜ä¸­çš„æ•°æ®å°±å¯ä»¥è¢«è¦†ç›–å•¦ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WALï¼ˆWrite Ahead Logï¼‰ï¼Œæ˜¯å…³ç³»æ•°æ®åº“ç³»ç»Ÿä¸­ç”¨äºæä¾›åŸå­æ€§å’ŒæŒä¹…æ€§ï¼ˆACIDå±æ€§ä¸­çš„ä¸¤ä¸ªï¼‰çš„ä¸€ç³»åˆ—æŠ€æœ¯ï¼ŒARIESæ˜¯WALç³»åˆ—æŠ€æœ¯å¸¸ç”¨çš„ç®—æ³•ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­WALé€šå¸¸ç§°ä¸ºjournalingã€‚WALçš„ä¸»è¦æ€æƒ³æ˜¯å°†å…ƒæ•°æ®çš„å®æ—¶å˜æ›´æ“ä½œå†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ç³»ç»Ÿè´Ÿè½½è¾ƒå°æ—¶å†æŠŠæ—¥å¿—åˆ·å…¥ç£ç›˜ã€‚ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘ç£ç›˜çš„IOæ“ä½œï¼Œæ­¤å¤„å°±ä¸å±•å¼€å­¦ä¹ äº†ã€‚å…ˆMarkä¸€ä¸‹&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>PHPå­¦ä¹ ç¬”è®° - æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ </title>
    <link href="http://xupin.im/2020/03/19/laravel-chunk-upload/"/>
    <id>http://xupin.im/2020/03/19/laravel-chunk-upload/</id>
    <published>2020-03-18T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.751Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ</h3><ul><li>å¦‚æœæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸Šä¼ çš„æ—¶é—´åº”è¯¥ä¼šæ¯”è¾ƒä¹…ï¼Œå†åŠ ä¸Šç½‘ç»œä¸ç¨³å®šå„ç§å› ç´ çš„å½±å“ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ä¼ è¾“ä¸­æ–­ã€‚</li><li>æœåŠ¡ç«¯ä¸€èˆ¬éƒ½ä¼šè®¾ç½®å›ºå®šå¤§å°çš„æ¥æ”¶BUFFï¼Œå¾€å¾€ä¸Šä¼ æ–‡ä»¶çš„ä½“ç§¯æ˜¯è¯¥å€¼çš„å‡ ä½•å€æ•°ã€‚</li></ul><p>åˆ†ç‰‡ä¸Šä¼ çš„åŸç†å¤§è‡´å¯ä»¥æè¿°ä¸ºï¼ŒæŠŠä¸€ä¸ªè¾ƒå¤§æ–‡ä»¶åˆ†æˆè‹¥å¹²ä»½çš„åˆ†ç‰‡ä¸€ä¸ªä¸€ä¸ªä¼ è¾“ï¼ŒæœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°æœ€åä¸€ä¸ªåˆ†ç‰‡åè¿›è¡Œåˆå¹¶èµ„æºã€‚</p><h3 id="2-å‰ç«¯"><a href="#2-å‰ç«¯" class="headerlink" title="2.å‰ç«¯"></a>2.å‰ç«¯</h3><p>å‰ç«¯ä½¿ç”¨Dropzoneæ§ä»¶ï¼ŒDropzoneJSæ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œæä¾›å¸¦æœ‰å›¾åƒé¢„è§ˆçš„æ‹–æ”¾æ–‡ä»¶ä¸Šä¼ å¹¶ä¸”æœ‰åˆ†å‰²æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ çš„æœºåˆ¶ï¼Œå½“ç„¶è¯¥æ§ä»¶ä¸ä»…ä»…å¯ä»¥ä¸Šä¼ å›¾ç‰‡ï¼Œç»æµ‹è¯•è§†é¢‘ï¼ŒWordç­‰æ–‡ä»¶ä¸€æ ·å¯ä»¥ã€‚</p><p>Dropzoneå®˜ç½‘æä¾›äº†ä¸€ä¸ª<a href="https://gitlab.com/meno/dropzone/raw/master/website/examples/simple.html" target="_blank" rel="noopener">simple.html</a>çš„ä¸Šä¼ demoï¼ˆjsã€cssæ–‡ä»¶è·¯å¾„æœ‰æ”¹åŠ¨è¿‡ï¼‰ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Dropzone simple example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  DO NOT SIMPLY COPY THOSE LINES. Download the JS and CSS files from the</span></span><br><span class="line"><span class="comment">  latest release (https://github.com/enyo/dropzone/releases/latest), and</span></span><br><span class="line"><span class="comment">  host them yourself!</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dropzone.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./dropzone.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  This is the most minimal example of Dropzone. The upload in this example</span><br><span class="line">  doesn't work, because there is no actual server to handle the file upload.</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Change /upload-target to your upload address --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"api/upload"</span> <span class="attr">class</span>=<span class="string">"dropzone"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>Dropzoneå®˜æ–¹æä¾›çš„demoé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯åˆ†ç‰‡ä¸Šä¼ çš„ï¼Œéœ€è¦ä¿®æ”¹dropzone.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Whether you want files to be uploaded in chunks to your server. This can't be</span></span><br><span class="line"><span class="comment"> * used in combination with `uploadMultiple`.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * See [chunksUploaded](#config-chunksUploaded) for the callback to finalise an upload.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">chunking: <span class="literal">false</span>, <span class="comment">// ä¿®æ”¹ä¸ºtrue,å³å¼€å¯åˆ†ç‰‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If `chunking` is `true`, then this defines the chunk size in bytes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">chunkSize: <span class="number">2000000</span>, <span class="comment">// é»˜è®¤åˆ†ç‰‡å¤§å°ï¼Œå•ä½ï¼šByte</span></span><br></pre></td></tr></table></figure></p><h3 id="3-åç«¯"><a href="#3-åç«¯" class="headerlink" title="3.åç«¯"></a>3.åç«¯</h3><blockquote><p>æ¡†æ¶ï¼šLaravel 6.8<br>æ‰©å±•ï¼š<a href="https://github.com/pionl/laravel-chunk-upload" target="_blank" rel="noopener">laravel-chunk-upload</a><br>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// create the file receiver</span></span><br><span class="line">$receiver = <span class="keyword">new</span> FileReceiver(<span class="string">"file"</span>, $request, HandlerFactory::classFromRequest($request));</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if the upload is success, throw exception or return response you need</span></span><br><span class="line"><span class="keyword">if</span> ($receiver-&gt;isUploaded() === <span class="keyword">false</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UploadMissingFileException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// receive the file</span></span><br><span class="line">$save = $receiver-&gt;receive();</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if the upload has finished (in chunk mode it will send smaller files)</span></span><br><span class="line"><span class="keyword">if</span> ($save-&gt;isFinished()) &#123;</span><br><span class="line">    <span class="comment">// save the file and return any response you need, current example uses `move` function. If you are</span></span><br><span class="line">    <span class="comment">// not using move, you need to manually delete the file by unlink($save-&gt;getFile()-&gt;getPathname())</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;saveFile($save-&gt;getFile());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// we are in chunk mode, lets send the current progress</span></span><br><span class="line"><span class="comment">/** <span class="doctag">@var</span> AbstractHandler $handler */</span></span><br><span class="line">$handler = $save-&gt;handler();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> response()-&gt;json([</span><br><span class="line">    <span class="string">"done"</span> =&gt; $handler-&gt;getPercentageDone(),</span><br><span class="line">    <span class="string">'status'</span> =&gt; <span class="keyword">true</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="4-Demo"><a href="#4-Demo" class="headerlink" title="4.Demo"></a>4.Demo</h3><blockquote><p><a href="https://github.com/xupin/chunk-upload-example" target="_blank" rel="noopener">https://github.com/xupin/chunk-upload-example</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ&quot;&gt;&lt;/a&gt;1.ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸Šä¼ çš„æ—¶é—´åº”è¯¥ä¼šæ¯”è¾ƒä¹…ï¼Œ</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="laravel" scheme="http://xupin.im/tags/laravel/"/>
    
    <category term="dropzone" scheme="http://xupin.im/tags/dropzone/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - LRUç®—æ³•</title>
    <link href="http://xupin.im/2020/03/18/mysql-lru/"/>
    <id>http://xupin.im/2020/03/18/mysql-lru/</id>
    <published>2020-03-17T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.753Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-ä»€ä¹ˆæ˜¯LRUï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯LRUï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯LRUï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯LRUï¼Ÿ</h3><p>LRUï¼ˆLeast recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•æ ¹æ®æ•°æ®çš„å†å²è®¿é—®è®°å½•æ¥è¿›è¡Œæ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œæœ€è¿‘ä½¿ç”¨çš„é¡µé¢æ•°æ®ä¼šåœ¨æœªæ¥ä¸€æ®µæ—¶æœŸå†…ä»ç„¶è¢«ä½¿ç”¨,å·²ç»å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„é¡µé¢å¾ˆæœ‰å¯èƒ½åœ¨æœªæ¥è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´å†…ä»ç„¶ä¸ä¼šè¢«ä½¿ç”¨â€ã€‚</p><h3 id="2-LRUçš„å®ç°"><a href="#2-LRUçš„å®ç°" class="headerlink" title="2.LRUçš„å®ç°"></a>2.LRUçš„å®ç°</h3><p>LRUç®—æ³•æœ€å¸¸è§çš„å®ç°æ˜¯ä½¿ç”¨é“¾è¡¨æ¥ä¿å­˜æ•°æ®ï¼Œè¯¥é“¾è¡¨æ˜¯åŒå‘é“¾è¡¨ï¼Œç„¶ååˆ©ç”¨å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œæœ€æ–°å†™å…¥çš„æ•°æ®ä¼šæœ€å¿«è¢«è·å–ã€‚</p><ul><li>è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œç¼“å­˜æ•°æ®åˆ™ä¼šå†™å…¥é“¾è¡¨çš„å¤´éƒ¨ï¼Œé“¾è¡¨å†™æ»¡æ—¶ä¼šæ·˜æ±°æ‰å°¾éƒ¨çš„ç¼“å­˜æ•°æ®ã€‚</li><li>å½“ç¼“å­˜æ•°æ®è¢«è®¿é—®æ—¶ï¼Œåˆ™å°†è¯¥ç¼“å­˜æ•°æ®å‘é“¾è¡¨å¤´éƒ¨ç§»åŠ¨ã€‚</li></ul><p><img src="/assets/lru/struct.png" alt></p><blockquote><p>ä¼˜ç‚¹ï¼šé¢å¯¹é¢‘ç¹è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜</p><p>ç¼ºç‚¹ï¼šå¦‚æœä¸€æ¬¡æŸ¥è¯¢æ‰«æå…¨è¡¨ï¼Œé‚£ä¹ˆLRUåˆ—è¡¨ä¼šè¢«æ±¡æŸ“</p></blockquote><h3 id="3-Mysql-LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ"><a href="#3-Mysql-LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ" class="headerlink" title="3.Mysql LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ"></a>3.Mysql LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ</h3><p>Mysqlï¼ˆInnoDBï¼‰çš„ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ä½¿ç”¨äº†LRUç®—æ³•çš„å˜ä½“ï¼Œå°†é“¾è¡¨åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šyoungã€midpointã€oldã€‚é“¾è¡¨æ¯”ä¾‹(5ã€3)åˆ†é…ç»™youngã€oldã€‚å…¶ä¸­youngå æ®5/8ï¼Œoldå æ®3/8ï¼Œæ­¤æ¯”ä¾‹å—å‚æ•°innodb_old_blocks_pctæ§åˆ¶ã€‚</p><blockquote><p>youngæ˜¯é“¾è¡¨ä¸­æœ€è¿‘è®¿é—®è¿‡çš„æ–°å­è¡¨ã€‚</p><p>oldæ˜¯é“¾è¡¨ä¸­æœ€è¿‘è®¿é—®çš„æ—§å­è¡¨ã€‚</p><p>midpointæ˜¯ä»‹äºæ–°å­è¡¨ &amp; æ—§å­è¡¨çš„è¾¹ç•Œä¸­é—´ä½ç½®ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ—§å­è¡¨çš„å¤´éƒ¨ï¼‰ã€‚</p></blockquote><a id="more"></a><ul><li>æ•°æ®åº“åˆšå¯åŠ¨LRUé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œæ­¤æ—¶ä¼šæ£€æŸ¥Free Listä¸­æ˜¯å¦æœ‰ç©ºé—²çš„æ•°æ®é¡µï¼Œå¦‚æœæœ‰åˆ™ä»Free Listä¸­åˆ é™¤å¹¶ä¸”åœ¨LRUé“¾è¡¨ä¸­å†™å…¥ç›¸åŒçš„æ•°æ®é¡µã€‚</li><li>è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®é¡µæ—¶ï¼Œæ•°æ®é¡µä¸ä¼šç›´æ¥å†™å…¥é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œæ˜¯å†™å…¥ä¸­é—´ä½ç½®ï¼Œå¦‚æœé“¾è¡¨æ»¡äº†åˆ™ä¼šä»æ—§å­è¡¨å°¾éƒ¨æ·˜æ±°æ•°æ®é¡µã€‚</li><li>å½“æ•°æ®é¡µè¢«è®¿é—®æ—¶ï¼Œåˆ™åˆ¤æ–­è®¿é—®æ•°æ®é¡µçš„æ—¶é—´æ˜¯å¦å¤§äºè®¾å®šinnodb_old_blocks_timeï¼ˆé»˜è®¤ï¼š1000msï¼‰ï¼Œå¦‚æœå¤§äºåˆ™å‘é“¾è¡¨å¤´éƒ¨ç§»åŠ¨ï¼Œå¦‚æœå°äºå…¶ä½ç½®ä¸å˜ã€‚</li></ul><p><img src="/assets/lru/innodb-buffer-pool-list.png" alt></p><blockquote><p>æ”¹è¿›ä¼˜ç‚¹ï¼šèƒ½å¤Ÿé˜²æ­¢å•æ¬¡å¤§é‡çš„å…¨è¡¨æ‰«ææ±¡æŸ“æ•´ä¸ªLRUé“¾è¡¨ã€‚</p></blockquote><h3 id="4-Mysql-LRUç›¸å…³æŸ¥è¯¢å‘½ä»¤"><a href="#4-Mysql-LRUç›¸å…³æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="4.Mysql LRUç›¸å…³æŸ¥è¯¢å‘½ä»¤"></a>4.Mysql LRUç›¸å…³æŸ¥è¯¢å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt;show engine innodb status\G;</span><br><span class="line">----------------------</span><br><span class="line">BUFFER POOL AND MEMORY</span><br><span class="line">----------------------</span><br><span class="line">Total memory allocated 137756672; <span class="keyword">in</span> additional pool allocated 0</span><br><span class="line">Total memory allocated by <span class="built_in">read</span> views 88</span><br><span class="line">Internal <span class="built_in">hash</span> tables (constant factor + variable factor)</span><br><span class="line">    Adaptive <span class="built_in">hash</span> index 2217584         (2213368 + 4216)</span><br><span class="line">    Page <span class="built_in">hash</span>           139112 (buffer pool 0 only)</span><br><span class="line">    Dictionary cache    593780  (554768 + 39012)</span><br><span class="line">    File system         83536   (82672 + 864)</span><br><span class="line">    Lock system         333248  (332872 + 376)</span><br><span class="line">    Recovery system     0       (0 + 0)</span><br><span class="line">Dictionary memory allocated 39012</span><br><span class="line">Buffer pool size        8191</span><br><span class="line">Buffer pool size, bytes 134201344</span><br><span class="line">Free buffers            8048</span><br><span class="line">Database pages          143</span><br><span class="line">Old database pages      0</span><br><span class="line">Modified db pages       0</span><br><span class="line">Pending reads 0</span><br><span class="line">Pending writes: LRU 0, flush list 0, single page 0</span><br><span class="line">Pages made young 0, not young 0</span><br><span class="line">0.00 youngs/s, 0.00 non-youngs/s</span><br><span class="line">Pages <span class="built_in">read</span> 143, created 0, written 0</span><br><span class="line">0.00 reads/s, 0.00 creates/s, 0.00 writes/s</span><br><span class="line">No buffer pool page gets since the last printout</span><br><span class="line">Pages <span class="built_in">read</span> ahead 0.00/s, evicted without access 0.00/s, Random <span class="built_in">read</span> ahead 0.00/s</span><br><span class="line">LRU len: 143, unzip_LRU len: 0</span><br><span class="line">I/O sum[0]:cur[0], unzip sum[0]:cur[0]</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Buffer<span class="built_in"> pool </span>size                    |   innodb_buffer_poolçš„å¤§å°</span><br><span class="line">Free buffers                        |   å½“å‰Free Listä¸­æ•°æ®é¡µæ•°é‡</span><br><span class="line">Database pages                      |   LRUé“¾è¡¨ä¸­æ•°æ®é¡µæ•°é‡</span><br><span class="line">Old database pages                  |   LRUé“¾è¡¨ä¸­æ—§å­è¡¨æ•°æ®é¡µæ•°é‡</span><br><span class="line">Modified db pages                   |   LRUé“¾è¡¨ä¸­è„é¡µæ•°é‡</span><br><span class="line">Pages made young 0, <span class="keyword">not</span> young 0     |   æ•°æ®é¡µä»oldç§»è‡³youngçš„è¡Œä¸ºï¼špage made young,æ•°æ®é¡µå› ä¸ºinnodb_old_blocks_timeå¯¼è‡´æ²¡æœ‰ä»oldç§»è‡³youngçš„è¡Œä¸ºï¼špage <span class="keyword">not</span> youngã€‚åé¢çš„æ•°å€¼æ˜¯è¯¥è¡Œä¸ºå‘ç”Ÿçš„æ¬¡æ•°ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;1-ä»€ä¹ˆæ˜¯LRUï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯LRUï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1.ä»€ä¹ˆæ˜¯LRUï¼Ÿ&quot;&gt;&lt;/a&gt;1.ä»€ä¹ˆæ˜¯LRUï¼Ÿ&lt;/h3&gt;&lt;p&gt;LRUï¼ˆLeast recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•æ ¹æ®æ•°æ®çš„å†å²è®¿é—®è®°å½•æ¥è¿›è¡Œæ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œæœ€è¿‘ä½¿ç”¨çš„é¡µé¢æ•°æ®ä¼šåœ¨æœªæ¥ä¸€æ®µæ—¶æœŸå†…ä»ç„¶è¢«ä½¿ç”¨,å·²ç»å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„é¡µé¢å¾ˆæœ‰å¯èƒ½åœ¨æœªæ¥è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´å†…ä»ç„¶ä¸ä¼šè¢«ä½¿ç”¨â€ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-LRUçš„å®ç°&quot;&gt;&lt;a href=&quot;#2-LRUçš„å®ç°&quot; class=&quot;headerlink&quot; title=&quot;2.LRUçš„å®ç°&quot;&gt;&lt;/a&gt;2.LRUçš„å®ç°&lt;/h3&gt;&lt;p&gt;LRUç®—æ³•æœ€å¸¸è§çš„å®ç°æ˜¯ä½¿ç”¨é“¾è¡¨æ¥ä¿å­˜æ•°æ®ï¼Œè¯¥é“¾è¡¨æ˜¯åŒå‘é“¾è¡¨ï¼Œç„¶ååˆ©ç”¨å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œæœ€æ–°å†™å…¥çš„æ•°æ®ä¼šæœ€å¿«è¢«è·å–ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œç¼“å­˜æ•°æ®åˆ™ä¼šå†™å…¥é“¾è¡¨çš„å¤´éƒ¨ï¼Œé“¾è¡¨å†™æ»¡æ—¶ä¼šæ·˜æ±°æ‰å°¾éƒ¨çš„ç¼“å­˜æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å½“ç¼“å­˜æ•°æ®è¢«è®¿é—®æ—¶ï¼Œåˆ™å°†è¯¥ç¼“å­˜æ•°æ®å‘é“¾è¡¨å¤´éƒ¨ç§»åŠ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/assets/lru/struct.png&quot; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šé¢å¯¹é¢‘ç¹è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå¦‚æœä¸€æ¬¡æŸ¥è¯¢æ‰«æå…¨è¡¨ï¼Œé‚£ä¹ˆLRUåˆ—è¡¨ä¼šè¢«æ±¡æŸ“&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;3-Mysql-LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ&quot;&gt;&lt;a href=&quot;#3-Mysql-LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;3.Mysql LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ&quot;&gt;&lt;/a&gt;3.Mysql LRUç®—æ³•æœ‰ä½•ä¸åŒï¼Ÿ&lt;/h3&gt;&lt;p&gt;Mysqlï¼ˆInnoDBï¼‰çš„ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ä½¿ç”¨äº†LRUç®—æ³•çš„å˜ä½“ï¼Œå°†é“¾è¡¨åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šyoungã€midpointã€oldã€‚é“¾è¡¨æ¯”ä¾‹(5ã€3)åˆ†é…ç»™youngã€oldã€‚å…¶ä¸­youngå æ®5/8ï¼Œoldå æ®3/8ï¼Œæ­¤æ¯”ä¾‹å—å‚æ•°innodb_old_blocks_pctæ§åˆ¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;youngæ˜¯é“¾è¡¨ä¸­æœ€è¿‘è®¿é—®è¿‡çš„æ–°å­è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;oldæ˜¯é“¾è¡¨ä¸­æœ€è¿‘è®¿é—®çš„æ—§å­è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;midpointæ˜¯ä»‹äºæ–°å­è¡¨ &amp;amp; æ—§å­è¡¨çš„è¾¹ç•Œä¸­é—´ä½ç½®ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ—§å­è¡¨çš„å¤´éƒ¨ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - Inté•¿åº¦çš„é—®é¢˜</title>
    <link href="http://xupin.im/2020/03/15/mysql-int-length/"/>
    <id>http://xupin.im/2020/03/15/mysql-int-length/</id>
    <published>2020-03-15T11:30:00.000Z</published>
    <updated>2022-07-15T02:59:17.753Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ›å»ºæ•°æ®è¡¨çš„æ—¶å€™æˆ‘ä»¬æ€»æ˜¯è¦è€ƒè™‘å­˜å‚¨æ•°æ®çš„å­—æ®µè¯¥ç”¨å“ªç§ç±»å‹ã€å¤šå°‘é•¿åº¦æ¯”è¾ƒåˆé€‚ï¼Œä¸è¿‡åœ¨Mysqlä¸­å¦‚æœå­—æ®µç±»å‹æ˜¯Intï¼Œæ­¤æ—¶é•¿åº¦æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚</p><h3 id="1-Intç±»å‹çš„é•¿åº¦é—®é¢˜"><a href="#1-Intç±»å‹çš„é•¿åº¦é—®é¢˜" class="headerlink" title="1.Intç±»å‹çš„é•¿åº¦é—®é¢˜"></a>1.Intç±»å‹çš„é•¿åº¦é—®é¢˜</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `test` (</span><br><span class="line">  `id` int(3) NOT NULL,</span><br><span class="line">  `name` varchar(20) COLLATE utf8mb4_unicode_ci NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure><p>æœ‰è¿™æ ·ä¸€å¼ è¡¨ï¼Œ<code>id</code>æ˜¯Intç±»å‹é•¿åº¦3çš„å­—æ®µï¼Œé‚£ä¹ˆç†è®ºä¸Šæ˜¯ä¸èƒ½å­˜å‚¨é•¿åº¦è¶…è¿‡3çš„å€¼ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `test`(`id`, `name`) VALUES (1000000, &apos;name&apos;);</span><br></pre></td></tr></table></figure></p><p>ä¸è¿‡ç»“æœæ˜¯æ„å¤–çš„ï¼Œè¿™æ¡æ•°æ®å¯ä»¥æ­£å¸¸å†™å…¥ã€‚</p><h3 id="2-Intç±»å‹çš„é•¿åº¦ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ"><a href="#2-Intç±»å‹çš„é•¿åº¦ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ" class="headerlink" title="2.Intç±»å‹çš„é•¿åº¦ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ"></a>2.Intç±»å‹çš„é•¿åº¦ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ</h3><p>ç¿»äº†ä¸€ä¸‹Mysqlçš„<a href="https://dev.mysql.com/doc/refman/5.6/en/data-types.html" target="_blank" rel="noopener">æ•°æ®ç±»å‹æ–‡æ¡£</a>ï¼Œå‘ç°è¿™ä¹ˆä¸€å¥è¯ï¼š</p><blockquote><p>å¯¹äºæ•´æ•°ç±»å‹ï¼ŒMè¡¨ç¤ºæœ€å¤§æ˜¾ç¤ºå®½åº¦ã€‚ å¯¹äºæµ®ç‚¹å’Œå®šç‚¹ç±»å‹ï¼ŒMæ˜¯å¯ä»¥å­˜å‚¨çš„æ€»ä½æ•°ï¼ˆç²¾åº¦ï¼‰ã€‚ å¯¹äºå­—ç¬¦ä¸²ç±»å‹ï¼ŒMæ˜¯æœ€å¤§é•¿åº¦ã€‚ Mçš„æœ€å¤§å…è®¸å€¼å–å†³äºæ•°æ®ç±»å‹ã€‚</p></blockquote><p>æ‰€ä»¥è¿™ä¸ªIntç±»å‹çš„â€œé•¿åº¦â€å…¶å®å«å®½åº¦ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ˜¾ç¤ºé•¿åº¦ã€‚</p><h3 id="3-å¦‚æœå­˜å‚¨çš„æ•°æ®é•¿åº¦ä½äºæ˜¾ç¤ºå®½åº¦ä¼šæ€æ ·ï¼Ÿ"><a href="#3-å¦‚æœå­˜å‚¨çš„æ•°æ®é•¿åº¦ä½äºæ˜¾ç¤ºå®½åº¦ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="3.å¦‚æœå­˜å‚¨çš„æ•°æ®é•¿åº¦ä½äºæ˜¾ç¤ºå®½åº¦ä¼šæ€æ ·ï¼Ÿ"></a>3.å¦‚æœå­˜å‚¨çš„æ•°æ®é•¿åº¦ä½äºæ˜¾ç¤ºå®½åº¦ä¼šæ€æ ·ï¼Ÿ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `test`(`id`, `name`) VALUES (1, &apos;name&apos;);</span><br></pre></td></tr></table></figure><p>å½“ç„¶æ˜¯å¯ä»¥å†™å…¥çš„ï¼Œä½†æ˜¯å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ä¸ä¸€æ ·ï¼Œä¸è¿‡æˆ‘ä»¬å†æ‰§è¡Œä¸€æ¡SQL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `test` MODIFY COLUMN `id` int(3) UNSIGNED ZEROFILL;</span><br></pre></td></tr></table></figure></p><p>è¿™æ¬¡æ•°æ®äº§ç”Ÿå˜åŒ–äº†ï¼Œå˜æˆäº†è¿™æ ·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id      |   name</span><br><span class="line">001     |   name</span><br><span class="line">1000000 |   name</span><br></pre></td></tr></table></figure></p><h3 id="4-ä¸ºä»€ä¹ˆè¦è®¾è®¡æ˜¾ç¤ºå®½åº¦ï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆè¦è®¾è®¡æ˜¾ç¤ºå®½åº¦ï¼Ÿ" class="headerlink" title="4.ä¸ºä»€ä¹ˆè¦è®¾è®¡æ˜¾ç¤ºå®½åº¦ï¼Ÿ"></a>4.ä¸ºä»€ä¹ˆè¦è®¾è®¡æ˜¾ç¤ºå®½åº¦ï¼Ÿ</h3><p>æˆ‘ä¹Ÿæ²¡æœ‰å¾—å‡ºæ˜ç¡®çš„ç­”æ¡ˆï¼Œå’Œå°ä¼™ä¼´è®¨è®ºè¿™ä¸ªé—®é¢˜~taè§‰å¾—æ˜¯ä¸ºäº†æ–¹ä¾¿<code>æ’åº</code>ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åˆ›å»ºæ•°æ®è¡¨çš„æ—¶å€™æˆ‘ä»¬æ€»æ˜¯è¦è€ƒè™‘å­˜å‚¨æ•°æ®çš„å­—æ®µè¯¥ç”¨å“ªç§ç±»å‹ã€å¤šå°‘é•¿åº¦æ¯”è¾ƒåˆé€‚ï¼Œä¸è¿‡åœ¨Mysqlä¸­å¦‚æœå­—æ®µç±»å‹æ˜¯Intï¼Œæ­¤æ—¶é•¿åº¦æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-Intç±»å‹çš„é•¿åº¦é—®é¢˜&quot;&gt;&lt;a href=&quot;#1-Intç±»å‹çš„é•¿åº¦é—®é¢˜&quot; class=&quot;headerlink&quot;</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql int length" scheme="http://xupin.im/tags/mysql-int-length/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - å®šæ—¶ä»»åŠ¡è°ƒåº¦</title>
    <link href="http://xupin.im/2020/01/19/go-console/"/>
    <id>http://xupin.im/2020/01/19/go-console/</id>
    <published>2020-01-18T16:00:00.000Z</published>
    <updated>2022-12-13T12:48:48.864Z</updated>
    
    <content type="html"><![CDATA[<p>æ¯ä¸€ä¸ªä»»åŠ¡éƒ½éœ€è¦ç¼–å†™ä¸€ä¸ªCrontabå‘½ä»¤ï¼Œè¿™æ˜¯ä»¶å¾ˆéº»çƒ¦ä¸”å¾ˆä¸å‹å¥½çš„äº‹æƒ…ã€‚ ä»»åŠ¡è°ƒåº¦å™¨å…è®¸ä½ ä»¥ä»£ç çš„å½¢å¼å®šä¹‰è°ƒåº¦å‘½ä»¤ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šåªéœ€è¦ä¸€ä¸ªCrontabå‘½ä»¤å³å¯, ä»»åŠ¡è°ƒåº¦åˆæ˜¯æˆ‘ä»¬ä¿—ç§°çš„ â€œè®¡åˆ’ä»»åŠ¡â€</p><h3 id="1-å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨"><a href="#1-å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨" class="headerlink" title="1.å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨"></a>1.å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨</h3><p>Githubä¸€ç•ªæœç´¢ï¼Œå‘ç°Golangæœ‰ä¸ªcronåŒ…ï¼ˆ<a href="https://github.com/robfig/cron" target="_blank" rel="noopener">robfig/cron</a>ï¼‰å¤§æ¦‚æ»¡è¶³éœ€æ±‚ï¼Œäºæ˜¯å­¦ä¹ ä¸€ä¸‹ã€‚</p><h3 id="2-ä»‹ç»"><a href="#2-ä»‹ç»" class="headerlink" title="2.ä»‹ç»"></a>2.ä»‹ç»</h3><p>çœ‹äº†ä¸€éæ–‡æ¡£ï¼ŒcronåŒ…æ”¯æŒçš„å·²ç»å¾ˆå…¨é¢äº†~~~ä¸ç”¨è‡ªå·±é€ è½®å­äº†ã€‚</p><p>è¡¨è¾¾å¼</p><blockquote><p>å…¼å®¹Linuxçš„crontabè¡¨è¾¾å¼ï¼ˆæ”¯æŒåˆ†é’Ÿçº§åˆ«ï¼‰ã€‚</p></blockquote><p>æ—¥å¿—</p><blockquote><p>å¯ä»¥å¾ˆè¯¦ç»†çš„è®°å½•è°ƒåº¦çš„ä»»åŠ¡çŠ¶æ€</p></blockquote><p>æ—¶åŒº</p><blockquote><p>æ”¯æŒä»»åŠ¡çº§åˆ«çš„æ—¶åŒºé…ç½®</p></blockquote><p>é¢„å®šä¹‰è®¡åˆ’</p><blockquote><p>æ”¯æŒåœ¨æœªæ¥æŒ‡å®šçš„æ—¶é—´å»è¿è¡Œ</p></blockquote><p><code>çº¿ç¨‹å®‰å…¨é—®é¢˜</code></p><blockquote><p>è¯¥cron libç®¡ç†ä»»åŠ¡é˜Ÿåˆ—çš„sliceæ²¡æœ‰åšå¹¶å‘å®‰å…¨è€ƒè™‘ï¼Œå¯èƒ½ä¼šå‡ºç°ä»»åŠ¡ç«ŸæŠ¢è¡Œä¸ºã€‚</p></blockquote><a id="more"></a><h3 id="3-å®ä¾‹"><a href="#3-å®ä¾‹" class="headerlink" title="3.å®ä¾‹"></a>3.å®ä¾‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"github.com/robfig/cron"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := cron.New()</span><br><span class="line">    c.AddFunc(<span class="string">"* * * * * *"</span>, test)</span><br><span class="line">    c.Start()</span><br><span class="line"></span><br><span class="line">    timer := time.NewTimer(time.Second * <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-timer.C:</span><br><span class="line">            timer.Reset(time.Second * <span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"I'm a test script!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go run .</span><br><span class="line">I<span class="string">'m a test script!!!</span></span><br><span class="line"><span class="string">I'</span>m a <span class="built_in">test</span> script!!!</span><br><span class="line">I<span class="string">'m a test script!!!</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><h3 id="4-ç®€å•å°è£…"><a href="#4-ç®€å•å°è£…" class="headerlink" title="4.ç®€å•å°è£…"></a>4.ç®€å•å°è£…</h3><ul><li><p>main.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"cron-example/console"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    quitChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// console</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        console.Default()</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    &lt;-quitChan</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>console.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> console</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"cron-example/console/commands"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"github.com/robfig/cron"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">schedule</span><span class="params">(c *cron.Cron)</span></span> &#123;</span><br><span class="line">    c.AddFunc(<span class="string">"* * * * * *"</span>, commands.Test)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Starting..."</span>)</span><br><span class="line"></span><br><span class="line">    c := cron.New()</span><br><span class="line">    c.Start()</span><br><span class="line"></span><br><span class="line">    schedule(c)</span><br><span class="line"></span><br><span class="line">    timer := time.NewTimer(time.Second * <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-timer.C:</span><br><span class="line">            timer.Reset(time.Second * <span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¯ä¸€ä¸ªä»»åŠ¡éƒ½éœ€è¦ç¼–å†™ä¸€ä¸ªCrontabå‘½ä»¤ï¼Œè¿™æ˜¯ä»¶å¾ˆéº»çƒ¦ä¸”å¾ˆä¸å‹å¥½çš„äº‹æƒ…ã€‚ ä»»åŠ¡è°ƒåº¦å™¨å…è®¸ä½ ä»¥ä»£ç çš„å½¢å¼å®šä¹‰è°ƒåº¦å‘½ä»¤ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šåªéœ€è¦ä¸€ä¸ªCrontabå‘½ä»¤å³å¯, ä»»åŠ¡è°ƒåº¦åˆæ˜¯æˆ‘ä»¬ä¿—ç§°çš„ â€œè®¡åˆ’ä»»åŠ¡â€&lt;/p&gt;
&lt;h3 id=&quot;1-å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨&quot;&gt;&lt;a href=&quot;#1-å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨&quot; class=&quot;headerlink&quot; title=&quot;1.å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨&quot;&gt;&lt;/a&gt;1.å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨&lt;/h3&gt;&lt;p&gt;Githubä¸€ç•ªæœç´¢ï¼Œå‘ç°Golangæœ‰ä¸ªcronåŒ…ï¼ˆ&lt;a href=&quot;https://github.com/robfig/cron&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;robfig/cron&lt;/a&gt;ï¼‰å¤§æ¦‚æ»¡è¶³éœ€æ±‚ï¼Œäºæ˜¯å­¦ä¹ ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-ä»‹ç»&quot;&gt;&lt;a href=&quot;#2-ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;2.ä»‹ç»&quot;&gt;&lt;/a&gt;2.ä»‹ç»&lt;/h3&gt;&lt;p&gt;çœ‹äº†ä¸€éæ–‡æ¡£ï¼ŒcronåŒ…æ”¯æŒçš„å·²ç»å¾ˆå…¨é¢äº†~~~ä¸ç”¨è‡ªå·±é€ è½®å­äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¡¨è¾¾å¼&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…¼å®¹Linuxçš„crontabè¡¨è¾¾å¼ï¼ˆæ”¯æŒåˆ†é’Ÿçº§åˆ«ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ—¥å¿—&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯ä»¥å¾ˆè¯¦ç»†çš„è®°å½•è°ƒåº¦çš„ä»»åŠ¡çŠ¶æ€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ—¶åŒº&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ”¯æŒä»»åŠ¡çº§åˆ«çš„æ—¶åŒºé…ç½®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¢„å®šä¹‰è®¡åˆ’&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ”¯æŒåœ¨æœªæ¥æŒ‡å®šçš„æ—¶é—´å»è¿è¡Œ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯¥cron libç®¡ç†ä»»åŠ¡é˜Ÿåˆ—çš„sliceæ²¡æœ‰åšå¹¶å‘å®‰å…¨è€ƒè™‘ï¼Œå¯èƒ½ä¼šå‡ºç°ä»»åŠ¡ç«ŸæŠ¢è¡Œä¸ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="golang" scheme="http://xupin.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>PHPå°çŸ¥è¯† - aliyundb SQLSetStatement is NOT supported</title>
    <link href="http://xupin.im/2020/01/07/php-aliyundb/"/>
    <id>http://xupin.im/2020/01/07/php-aliyundb/</id>
    <published>2020-01-06T16:00:00.000Z</published>
    <updated>2022-12-15T04:31:18.371Z</updated>
    
    <content type="html"><![CDATA[<p>PHPé¡¹ç›®åœ¨æ•°æ®åº“è¿ç§»ä½¿ç”¨ADBï¼ˆaliyundbï¼‰æ—¶å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“é”™è¯¯æè¿°æ˜¯ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQLSTATE[HY000]: General error: 1815 [15022, 2020010711034801025210201503151413416] statement type: class com.alibaba.fastsql.sql.ast.statement.SQLSetStatement is NOT supported! (SQL: <span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">`users`</span>)</span><br></pre></td></tr></table></figure></p><p>åœ¨æ’æŸ¥è¯¥é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œå°è¯•äº†å„ç§æ–¹å¼ï¼Œé™ç‰ˆæœ¬ã€ä½¿ç”¨åŸç”Ÿè¯­å¥ç­‰ï¼Œç”šè‡³æŸ¥æ‰¾ADBæ‰‹å†Œå’ŒIssueè¿˜æ˜¯æ— æ³•è§£å†³ã€‚</p><h3 id="1-åŸå› "><a href="#1-åŸå› " class="headerlink" title="1.åŸå› "></a>1.åŸå› </h3><p>å› ä¸ºADBå…¼å®¹Mysqlä½†æ˜¯æœ‰äº›æœºåˆ¶è¿˜æ˜¯ç•¥æœ‰ä¸åŒï¼Œé˜…è¯»æºç åå‘ç°æ¯”å¦‚ï¼šADBå°±ä¸èƒ½å¾ˆå¥½çš„æ”¯æŒæœ¬åœ°é¢„å¤„ç†è¯­å¥ï¼Œè¿™ä¹Ÿæ˜¯è¯¥å¼‚å¸¸çš„åŸå› ã€‚</p><h3 id="2-è§£å†³æ–¹æ¡ˆ"><a href="#2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2.è§£å†³æ–¹æ¡ˆ"></a>2.è§£å†³æ–¹æ¡ˆ</h3><p>PHP PDOé“¾æ¥çš„å±æ€§å€¼<code>PDO::ATTR_EMULATE_PREPARES</code>éœ€è¦è®¾ç½®ä¸º<code>true</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PDO::<span class="function"><span class="params">ATTR_EMULATE_PREPARES</span> =&gt;</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;PHPé¡¹ç›®åœ¨æ•°æ®åº“è¿ç§»ä½¿ç”¨ADBï¼ˆaliyundbï¼‰æ—¶å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“é”™è¯¯æè¿°æ˜¯ï¼š&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="biscuits" scheme="http://xupin.im/tags/biscuits/"/>
    
    <category term="php" scheme="http://xupin.im/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>Goå­¦ä¹ ç¬”è®° - WEBæ¡†æ¶Gin</title>
    <link href="http://xupin.im/2019/12/31/go-gin/"/>
    <id>http://xupin.im/2019/12/31/go-gin/</id>
    <published>2019-12-30T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.750Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">Gin</a> æ˜¯ä¸€ä¸ªç”¨ Go (Golang) ç¼–å†™çš„ HTTP web æ¡†æ¶ã€‚ å®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼äº martini ä½†æ‹¥æœ‰æ›´å¥½æ€§èƒ½çš„ API æ¡†æ¶, ç”±äº httprouterï¼Œé€Ÿåº¦æé«˜äº†è¿‘ 40 å€ã€‚</p><h3 id="1-æœ‰å“ªäº›ä¼˜ç‚¹"><a href="#1-æœ‰å“ªäº›ä¼˜ç‚¹" class="headerlink" title="1.æœ‰å“ªäº›ä¼˜ç‚¹"></a>1.æœ‰å“ªäº›ä¼˜ç‚¹</h3><blockquote><p>è¾ƒé«˜çš„æ€§èƒ½ï¼ˆ<a href="https://github.com/julienschmidt/go-http-routing-benchmark" target="_blank" rel="noopener">Golang WEBæ¡†æ¶æ¯”å¯¹æ•°æ®</a>ï¼‰</p><p>ç®€å•æ˜“ç”¨çš„ä¸­é—´ä»¶</p><p>ä½¿ç”¨äº†æ€§èƒ½é«˜å¯æ‰©å±•çš„HTTPè·¯ç”±<a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="noopener">httprouter</a></p><p>ç¤¾åŒºé•¿æœŸæœ‰ç€å¾ˆé«˜çš„æ´»è·ƒåº¦</p><p>Githubæ˜Ÿæ˜Ÿå¤šï¼ˆOrzï¼‰</p></blockquote><p>â€¦ç­‰</p><a id="more"></a><h3 id="2-å®‰è£…-æ›´æ–°"><a href="#2-å®‰è£…-æ›´æ–°" class="headerlink" title="2.å®‰è£…/æ›´æ–°"></a>2.å®‰è£…/æ›´æ–°</h3><p>å®‰è£…<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/gin-gonic/gin</span><br></pre></td></tr></table></figure></p><p>æ›´æ–°<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/gin-gonic/gin</span><br></pre></td></tr></table></figure></p><h3 id="3-Hello-World"><a href="#3-Hello-World" class="headerlink" title="3.Hello World"></a>3.Hello World</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// æ¡†æ¶</span></span><br><span class="line">    g := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·¯ç”±</span></span><br><span class="line">    g.GET(<span class="string">"/t"</span>, test)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœåŠ¡ç«¯å£</span></span><br><span class="line">    g.Run(<span class="string">":4000"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">"Hallo!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go</span><br></pre></td></tr></table></figure></p><p>è®¿é—® <a href="http://127.0.0.1:4000/t" target="_blank" rel="noopener">http://127.0.0.1:4000/t</a> ï¼Œé¡µé¢è¾“å‡ºHallo!ã€‚</p><h3 id="4-è·¯ç”±"><a href="#4-è·¯ç”±" class="headerlink" title="4.è·¯ç”±"></a>4.è·¯ç”±</h3><p>Ginæ”¯æŒçš„è·¯ç”±æ–¹å¼å’Œå¤§éƒ¨åˆ†ä¸»æµæ¡†æ¶åŸºæœ¬ä¸€è‡´ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    g := gin.Default()</span><br><span class="line"></span><br><span class="line">    g.GET(<span class="string">"/someGet"</span>, getting)</span><br><span class="line">    g.POST(<span class="string">"/somePost"</span>, posting)</span><br><span class="line">    g.PUT(<span class="string">"/somePut"</span>, putting)</span><br><span class="line">    g.DELETE(<span class="string">"/someDelete"</span>, deleting)</span><br><span class="line">    g.PATCH(<span class="string">"/somePatch"</span>, patching)</span><br><span class="line">    g.HEAD(<span class="string">"/someHead"</span>, head)</span><br><span class="line">    g.OPTIONS(<span class="string">"/someOptions"</span>, options)</span><br><span class="line"></span><br><span class="line">    g.Run(<span class="string">":4000"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>GinåŒæ ·ä¹Ÿæ”¯æŒè·¯ç”±å‚æ•°ï¼Œä¸è¿‡ä¸æ”¯æŒè·¯ç”±æ­£åˆ™è¡¨è¾¾å¼ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    g := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤ handler åªèƒ½åŒ¹é… /user/&#123;PARAM&#125;</span></span><br><span class="line">    g.GET(<span class="string">"/user/:name"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">        c.String(http.StatusOK, <span class="string">"Hello %s"</span>, name)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤ handler ä¼šåŒ¹é… /user/&#123;PARAM&#125;/ å’Œ /user/&#123;PARAM&#125;/&#123;ACTION_2&#125;</span></span><br><span class="line">    <span class="comment">// å¦‚æœè®¿é—® /user/&#123;PARAM&#125;ï¼Œåœ¨æ²¡æœ‰ "/user/:name" è·¯ç”±çš„æƒ…å†µä¸‹ï¼Œä¼šé‡å®šå‘è‡³ /user/&#123;PARAM&#125;/ åŒ¹é…å½“å‰è·¯ç”±ã€‚</span></span><br><span class="line">    g.GET(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">        action := c.Param(<span class="string">"action"</span>)</span><br><span class="line">        message := name + <span class="string">" is "</span> + action</span><br><span class="line">        c.String(http.StatusOK, message)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    g.Run(<span class="string">":4000"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="5-è·¯ç”±ç»„"><a href="#5-è·¯ç”±ç»„" class="headerlink" title="5.è·¯ç”±ç»„"></a>5.è·¯ç”±ç»„</h3><p>Ginåœ¨è·¯ç”±åˆ†ç»„ä¸Šçš„åšæ³•å’Œå…¶ä»–æ¡†æ¶ä¹Ÿéƒ½æ˜¯ä¸€è‡´çš„ï¼Œå†æ¬¡ä½“ç°äº†Ginç®€å•æ˜“ç”¨æå®¹æ˜“ä¸Šæ‰‹çš„ä¼˜ç‚¹ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    g := gin.Default()</span><br><span class="line"></span><br><span class="line">    userGroup := g.Group(<span class="string">"/user"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        userGroup.POST(<span class="string">"/login"</span>, ctrls.Login)</span><br><span class="line">        userGroup.POST(<span class="string">"/logout"</span>, ctrls.Logout)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    reportGroup := g.Group(<span class="string">"/report"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        reportGroup.POST(<span class="string">"/revenue"</span>, ctrls.RevenueReport)</span><br><span class="line">        reportGroup.POST(<span class="string">"/cost"</span>, ctrls.CostReport)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g.Run(<span class="string">":4000"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="6-ä¸­é—´ä»¶"><a href="#6-ä¸­é—´ä»¶" class="headerlink" title="6.ä¸­é—´ä»¶"></a>6.ä¸­é—´ä»¶</h3><p>Ginçš„ä¸­é—´ä»¶åˆ†ä¸ºï¼šå…¨å±€ï¼Œè·¯ç”±ç»„ï¼Œè·¯ç”±çº§åˆ«ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    g := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¨å±€ä¸­é—´ä»¶</span></span><br><span class="line">    g.Use(middleware)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·¯ç”±ç»„ä¸­é—´ä»¶</span></span><br><span class="line">    routerGroup := g.Group(<span class="string">"/user"</span>, middleware)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è·¯ç”±ä¸­é—´ä»¶</span></span><br><span class="line">        routerGroup.GET(<span class="string">"/login"</span>, middleware, ctrls.Login)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g.Run(<span class="string">":4000"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="7-å‚æ•°"><a href="#7-å‚æ•°" class="headerlink" title="7.å‚æ•°"></a>7.å‚æ•°</h3><p>Ginå¦‚ä½•è·å–è¯·æ±‚å‚æ•°ï¼Ÿä¸‹é¢çš„ç®€å•ä¾‹å­ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    g := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// URLå‚æ•°</span></span><br><span class="line">    <span class="comment">// URLï¼š/user?email=mark@im.com</span></span><br><span class="line">    g.GET(<span class="string">"/user"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ DefaultQuery æˆ–è€… Query</span></span><br><span class="line">        email := c.DefaultQuery(<span class="string">"email"</span>, <span class="string">"default value"</span>)</span><br><span class="line">        email = c.Query(<span class="string">"email"</span>)</span><br><span class="line"></span><br><span class="line">        c.String(http.StatusOK, <span class="string">"Hallo, %s"</span>, email)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// POSTå‚æ•°</span></span><br><span class="line">    g.POST(<span class="string">"/user/login"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ DefaultPostForm æˆ–è€… PostForm</span></span><br><span class="line">        email := c.PostForm(<span class="string">"email"</span>)</span><br><span class="line">        email = c.DefaultPostForm(<span class="string">"email"</span>, <span class="string">"default value"</span>)</span><br><span class="line"></span><br><span class="line">        c.String(http.StatusOK, <span class="string">"Hallo, %s"</span>, email)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    g.Run(<span class="string">":4000"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>Ginæ”¯æŒçš„æ“ä½œè¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šæ•°æ®ç»‘å®šã€æ•°æ®éªŒè¯ã€ä¸Šä¼ æ–‡ä»¶ã€é™æ€èµ„æºåµŒå…¥ç­‰ã€‚ </p><p>Ginæ²¡æœ‰æä¾›çš„ç»„ä»¶ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šORMã€Consoleã€æ—¥å¿—æ»šåŠ¨åˆ†å‰²ç­‰ã€‚ </p><p>ä»è€…è§ä»æ™ºè€…è§æ™ºï¼ŒGinä¸“æ³¨åšHTTP WEBæ¡†æ¶çš„æ ¸å¿ƒï¼Œæ›´å¤šæ‰©å±•éœ€è¦å¼€å‘äººå‘˜è‡ªå·±å»é€‰æ‹©ï¼Œç»„ä»¶åŒ–çš„è®¾è®¡æ— ç–‘æ˜¯å¥½çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/gin-gonic/gin&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Gin&lt;/a&gt; æ˜¯ä¸€ä¸ªç”¨ Go (Golang) ç¼–å†™çš„ HTTP web æ¡†æ¶ã€‚ å®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼äº martini ä½†æ‹¥æœ‰æ›´å¥½æ€§èƒ½çš„ API æ¡†æ¶, ç”±äº httprouterï¼Œé€Ÿåº¦æé«˜äº†è¿‘ 40 å€ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-æœ‰å“ªäº›ä¼˜ç‚¹&quot;&gt;&lt;a href=&quot;#1-æœ‰å“ªäº›ä¼˜ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;1.æœ‰å“ªäº›ä¼˜ç‚¹&quot;&gt;&lt;/a&gt;1.æœ‰å“ªäº›ä¼˜ç‚¹&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;è¾ƒé«˜çš„æ€§èƒ½ï¼ˆ&lt;a href=&quot;https://github.com/julienschmidt/go-http-routing-benchmark&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Golang WEBæ¡†æ¶æ¯”å¯¹æ•°æ®&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;ç®€å•æ˜“ç”¨çš„ä¸­é—´ä»¶&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨äº†æ€§èƒ½é«˜å¯æ‰©å±•çš„HTTPè·¯ç”±&lt;a href=&quot;https://github.com/julienschmidt/httprouter&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;httprouter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç¤¾åŒºé•¿æœŸæœ‰ç€å¾ˆé«˜çš„æ´»è·ƒåº¦&lt;/p&gt;
&lt;p&gt;Githubæ˜Ÿæ˜Ÿå¤šï¼ˆOrzï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€¦ç­‰&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="golang" scheme="http://xupin.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>ESå­¦ä¹ ç¬”è®° - å®ç°åˆ—åˆ†ç»„ç»Ÿè®¡</title>
    <link href="http://xupin.im/2019/12/17/elasticsearch-group/"/>
    <id>http://xupin.im/2019/12/17/elasticsearch-group/</id>
    <published>2019-12-16T16:00:00.000Z</published>
    <updated>2023-08-03T03:26:58.972Z</updated>
    
    <content type="html"><![CDATA[<p>Elasticsearchæ˜¯Elastic Stackæ ¸å¿ƒçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚</p><h3 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1.èƒŒæ™¯"></a>1.èƒŒæ™¯</h3><p>å› ä¸ºä¸šåŠ¡è°ƒæ•´é‡‡ç”¨äº†ESä½œä¸ºæ•°æ®åº“ï¼Œæ‰€ä»¥éœ€è¦äº†è§£ESå¯¹äºè¿™ä¸€å—çš„è®¾è®¡å¦‚ä½•å®ç°ç±»ä¼¼Mysqlä¸­Group Byçš„æŸ¥è¯¢çš„æ•ˆæœã€‚</p><h3 id="2-å®ç°æ–¹å¼"><a href="#2-å®ç°æ–¹å¼" class="headerlink" title="2.å®ç°æ–¹å¼"></a>2.å®ç°æ–¹å¼</h3><p>ESå®ç°Group Byæœ‰ä¸¤ç§æ–¹å¼ï¼šTermsAggã€CompositeAggï¼Œå®ƒä»¬ä¹Ÿå…·æœ‰ä¸åŒç¨‹åº¦çš„ä¼˜ç¼ºç‚¹ã€‚</p><p>TermsAggçš„ä½¿ç”¨æ–¹å¼éå¸¸ç²—æš´ï¼Œç›´æ¥è¿›è¡Œæ¡¶åµŒå¥—å³å¯ï¼Œå¦‚ä¸‹:</p><p>TermsAggè¯·æ±‚DSLè¯­å¥<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"aggregations"</span>: &#123;</span><br><span class="line"><span class="attr">"group_app"</span>: &#123;</span><br><span class="line"><span class="attr">"terms"</span>: &#123;</span><br><span class="line"><span class="attr">"field"</span>: <span class="string">"app"</span>,</span><br><span class="line"><span class="attr">"size"</span>: <span class="number">1000000</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"aggregations"</span>: &#123;</span><br><span class="line"><span class="attr">"group_campaign_id"</span>: &#123;</span><br><span class="line"><span class="attr">"terms"</span>: &#123;</span><br><span class="line"><span class="attr">"field"</span>: <span class="string">"campaign_id"</span>,</span><br><span class="line"><span class="attr">"size"</span>: <span class="number">1000000</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"size"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>TermsAggæ‰§è¡Œç»“æœ<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"took"</span>: <span class="number">142</span>,</span><br><span class="line">    <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"hits"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">175033</span>,</span><br><span class="line">        <span class="attr">"max_score"</span>: <span class="number">0.0</span>,</span><br><span class="line">        <span class="attr">"hits"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"aggregations"</span>: &#123;</span><br><span class="line">        <span class="attr">"group_app"</span>: &#123;</span><br><span class="line">            <span class="attr">"doc_count_error_upper_bound"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"sum_other_doc_count"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"buckets"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="string">"com.aa.bb.cc"</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">59929</span>,</span><br><span class="line">                    <span class="attr">"group_campaign_id"</span>: &#123;</span><br><span class="line">                        <span class="attr">"doc_count_error_upper_bound"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"sum_other_doc_count"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"buckets"</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">"key"</span>: <span class="string">"Campaign_118"</span>,</span><br><span class="line">                                <span class="attr">"doc_count"</span>: <span class="number">56466</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">"key"</span>: <span class="string">"Campaign_119"</span>,</span><br><span class="line">                                <span class="attr">"doc_count"</span>: <span class="number">1937</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="string">"com.dd.ee.ff"</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">23231</span>,</span><br><span class="line">                    <span class="attr">"group_campaign_id"</span>: &#123;</span><br><span class="line">                        <span class="attr">"doc_count_error_upper_bound"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"sum_other_doc_count"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"buckets"</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">"key"</span>: <span class="string">"Campaign_120"</span>,</span><br><span class="line">                                <span class="attr">"doc_count"</span>: <span class="number">16692</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">"key"</span>: <span class="string">"Campaign_121"</span>,</span><br><span class="line">                                <span class="attr">"doc_count"</span>: <span class="number">5336</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>CompositeAggçš„ä½¿ç”¨æ–¹å¼ç•¥å¾®æœ‰ä¸€äº›ä¸åŒï¼Œä¸‹é¢ï¼š</p><p>CompositeAggè¯·æ±‚DSLè¯­å¥<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"aggregations"</span>: &#123;</span><br><span class="line"><span class="attr">"group_by"</span>: &#123;</span><br><span class="line"><span class="attr">"composite"</span>: &#123;</span><br><span class="line"><span class="attr">"sources"</span>: [</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"app"</span>: &#123;</span><br><span class="line">        <span class="attr">"terms"</span>: &#123;</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"app"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"campaign_id"</span>: &#123;</span><br><span class="line">    <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"campaign_id"</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line">                <span class="attr">"size"</span>: <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"size"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>CompositeAggæ‰§è¡Œç»“æœ<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"took"</span>: <span class="number">14</span>,</span><br><span class="line">    <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"hits"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">175033</span>,</span><br><span class="line">        <span class="attr">"max_score"</span>: <span class="number">0.0</span>,</span><br><span class="line">        <span class="attr">"hits"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"aggregations"</span>: &#123;</span><br><span class="line">        <span class="attr">"group_by"</span>: &#123;</span><br><span class="line">            <span class="attr">"after_key"</span>: &#123;</span><br><span class="line">                <span class="attr">"app"</span>: <span class="string">"com.dd.ee.ff"</span>,</span><br><span class="line">                <span class="attr">"campaign_id"</span>: <span class="string">"Campaign_120"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"buckets"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: &#123;</span><br><span class="line">                        <span class="attr">"app"</span>: <span class="string">"com.aa.bb.cc"</span>,</span><br><span class="line">                        <span class="attr">"campaign_id"</span>: <span class="string">"Campaign_119"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">182</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: &#123;</span><br><span class="line">                        <span class="attr">"app"</span>: <span class="string">"com.dd.ee.ff"</span>,</span><br><span class="line">                        <span class="attr">"campaign_id"</span>: <span class="string">"Campaign_120"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">40</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3-ä¼˜ç¼ºç‚¹"><a href="#3-ä¼˜ç¼ºç‚¹" class="headerlink" title="3.ä¼˜ç¼ºç‚¹"></a>3.ä¼˜ç¼ºç‚¹</h3><p>TermsAgg</p><blockquote><p>ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ã€æ²¡æœ‰æ•°æ®é‡é™åˆ¶ã€‚</p><p>ç¼ºç‚¹ï¼šæ•°æ®ç»“æ„å±‚æ¬¡æ·±ã€ä¸æ”¯æŒåˆ†é¡µã€‚</p></blockquote><p>CompositeAgg</p><blockquote><p>ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ã€æ•°æ®ç»“æ„æ¸…æ™°å¯è¯»ï¼Œæ”¯æŒåˆ†é¡µã€‚</p><p>ç¼ºç‚¹ï¼šæœ‰æ•°æ®é‡é™åˆ¶ã€‚</p></blockquote><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>è‡³äºESè¿™ä¸¤ç§åˆ†ç»„æ–¹å¼çš„<code>æ€§èƒ½æ–¹é¢è¿˜æ²¡æœ‰ç ”ç©¶ï¼Œåç»­å­¦ä¹ ç¬”è®°ä¼šæ›´æ–°æ€§èƒ½ä¸Šé¢çš„å·®å¼‚ã€‚</code></p><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-composite-aggregation.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-composite-aggregation.html</a> // é™„ä¸ŠESå®˜æ–¹æ–‡æ¡£</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Elasticsearchæ˜¯Elastic Stackæ ¸å¿ƒçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#1-èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;1.èƒŒæ™¯&quot;&gt;&lt;/a&gt;1.èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;å› ä¸ºä¸šåŠ¡è°ƒæ•´é‡‡ç”¨äº†ESä½œä¸º</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="elasticsearch" scheme="http://xupin.im/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Nginx - æ­£å‘/åå‘ä»£ç†</title>
    <link href="http://xupin.im/2019/12/17/nginx-proxy/"/>
    <id>http://xupin.im/2019/12/17/nginx-proxy/</id>
    <published>2019-12-16T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.754Z</updated>
    
    <content type="html"><![CDATA[<p>ä»£ç†é€šå¸¸ç”¨äºåœ¨å‡ å°æœåŠ¡å™¨ä¹‹é—´åˆ†é…è´Ÿè½½ï¼Œæ— ç¼æ˜¾ç¤ºæ¥è‡ªä¸åŒç½‘ç«™çš„å†…å®¹æˆ–é€šè¿‡é™¤HTTPä¹‹å¤–çš„åè®®å°†å¤„ç†è¯·æ±‚ä¼ é€’ç»™åº”ç”¨æœåŠ¡å™¨ã€‚</p><h3 id="1-ä»£ç†çš„å¸¸ç”¨åœºæ™¯åŠä¼˜ç‚¹"><a href="#1-ä»£ç†çš„å¸¸ç”¨åœºæ™¯åŠä¼˜ç‚¹" class="headerlink" title="1.ä»£ç†çš„å¸¸ç”¨åœºæ™¯åŠä¼˜ç‚¹"></a>1.ä»£ç†çš„å¸¸ç”¨åœºæ™¯åŠä¼˜ç‚¹</h3><p>æ­£å‘ä»£ç†</p><blockquote><p>gfwç§‘å­¦ä¸Šç½‘ã€‚</p><p>å®¢æˆ·ç«¯è®¿é—®é‰´æƒã€‚</p></blockquote><p>åå‘ä»£ç†</p><blockquote><p>è´Ÿè½½å‡è¡¡ã€‚</p><p>ä¿è¯å†…ç½‘çš„å®‰å…¨ï¼Œé˜»æ­¢webæ”»å‡»ã€‚</p></blockquote><h3 id="2-æ­£å‘ä»£ç†å’Œåå‘ä»£ç†æœ‰ä»€ä¹ˆä¸åŒ"><a href="#2-æ­£å‘ä»£ç†å’Œåå‘ä»£ç†æœ‰ä»€ä¹ˆä¸åŒ" class="headerlink" title="2.æ­£å‘ä»£ç†å’Œåå‘ä»£ç†æœ‰ä»€ä¹ˆä¸åŒ"></a>2.æ­£å‘ä»£ç†å’Œåå‘ä»£ç†æœ‰ä»€ä¹ˆä¸åŒ</h3><p>æ¯”è¾ƒé€šä¿—çš„æ¥è§£é‡Šï¼šæ­£å‘ä»£ç†ä»£ç†çš„æ˜¯å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¸çŸ¥é“å®é™…å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯ã€åå‘ä»£ç†ä»£ç†çš„æ˜¯æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ä¸çŸ¥é“å®é™…æ¥æ”¶è¯·æ±‚çš„æœåŠ¡ç«¯ã€‚</p><p>ä¸€å¼ å›¾è¡¨ç¤ºï¼ˆæ¥æºï¼š<a href="https://zhuanlan.zhihu.com/p/82300486" target="_blank" rel="noopener">çŸ¥ä¹wplulala</a>ï¼‰<br><img src="/assets/nginx-proxy/relation.jpg" alt></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»£ç†é€šå¸¸ç”¨äºåœ¨å‡ å°æœåŠ¡å™¨ä¹‹é—´åˆ†é…è´Ÿè½½ï¼Œæ— ç¼æ˜¾ç¤ºæ¥è‡ªä¸åŒç½‘ç«™çš„å†…å®¹æˆ–é€šè¿‡é™¤HTTPä¹‹å¤–çš„åè®®å°†å¤„ç†è¯·æ±‚ä¼ é€’ç»™åº”ç”¨æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-ä»£ç†çš„å¸¸ç”¨åœºæ™¯åŠä¼˜ç‚¹&quot;&gt;&lt;a href=&quot;#1-ä»£ç†çš„å¸¸ç”¨åœºæ™¯åŠä¼˜ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;1</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="nginx" scheme="http://xupin.im/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - ç´¢å¼•</title>
    <link href="http://xupin.im/2019/12/16/mysql-index/"/>
    <id>http://xupin.im/2019/12/16/mysql-index/</id>
    <published>2019-12-16T11:30:00.000Z</published>
    <updated>2022-07-15T02:59:17.752Z</updated>
    
    <content type="html"><![CDATA[<p>ç´¢å¼•ç”¨äºå¿«é€ŸæŸ¥æ‰¾å…·æœ‰ç‰¹å®šåˆ—å€¼çš„è¡Œã€‚æ²¡æœ‰ç´¢å¼•ï¼ŒMySQLå¿…é¡»ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œç„¶åé€šè¯»æ•´ä¸ªè¡¨ä»¥æ‰¾åˆ°ç›¸å…³çš„è¡Œã€‚å¦‚æœè¡¨ä¸­æœ‰ç›¸å…³â€‹â€‹åˆ—çš„ç´¢å¼•ï¼ŒMySQLå¯ä»¥å¿«é€Ÿç¡®å®šè¦åœ¨æ•°æ®æ–‡ä»¶ä¸­é—´æŸ¥æ‰¾çš„ä½ç½®ï¼Œè€Œä¸å¿…æŸ¥çœ‹æ‰€æœ‰æ•°æ®ã€‚è¿™æ¯”é¡ºåºè¯»å–æ¯ä¸€è¡Œè¦å¿«å¾—å¤šã€‚<br>InnoDBå’ŒMyIsamåªæ”¯æŒBtreeï¼Œå› æ­¤é»˜è®¤å‡æ˜¯Btreeï¼ŒMemoryå’ŒHeapæ”¯æŒHashå’ŒBtreeï¼Œå¦‚æ— æ˜ç¡®å£°æ˜ï¼Œåˆ™é»˜è®¤ç´¢å¼•å‡æ˜¯Hashï¼ˆåŒ…æ‹¬ä¸»é”®ï¼‰ã€‚</p><h3 id="1-Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•"><a href="#1-Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•" class="headerlink" title="1.Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•"></a>1.Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•</h3><blockquote><p>ä¸»é”®ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ä¸ºnullï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</p><p>å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸ºnullï¼Œä¸€ä¸ªè¡¨å…è®¸å¤šä¸ªåˆ—åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</p><p>æ™®é€šç´¢å¼•ï¼šåŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰å”¯ä¸€æ€§çš„é™åˆ¶ï¼Œå…è®¸ä¸ºnullã€‚</p><p>å…¨æ–‡ç´¢å¼•ï¼šå…¨æ–‡ç´¢å¼•æ˜¯ç›®å‰å®ç°å¤§æ•°æ®æœç´¢çš„å…³é”®æŠ€æœ¯ã€‚</p></blockquote><h3 id="2-Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™"><a href="#2-Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™" class="headerlink" title="2.Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™"></a>2.Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™</h3><p>Mysqlçš„ç´¢å¼•éµå¾ªæœ€å·¦åŸåˆ™ï¼Œåœ¨åˆ›å»ºå¤šåˆ—ç´¢å¼•æ—¶ï¼Œè¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œwhereæ¡ä»¶ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„ä¸€åˆ—æ”¾åœ¨æœ€å·¦è¾¹ã€‚</p><a id="more"></a><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">index</span><span class="params">(a,b,c)</span></span></span><br><span class="line">where <span class="selector-tag">a</span> = v <span class="comment">// ä½¿ç”¨a</span></span><br><span class="line">where <span class="selector-tag">a</span> = v and <span class="selector-tag">b</span> = v <span class="comment">// ä½¿ç”¨a,b</span></span><br><span class="line">where <span class="selector-tag">a</span> = v and <span class="selector-tag">b</span> = v and c = v <span class="comment">// ä½¿ç”¨a,b,c</span></span><br><span class="line"></span><br><span class="line">where <span class="selector-tag">b</span> = v <span class="comment">// æœªä½¿ç”¨ç´¢å¼•</span></span><br><span class="line">where <span class="selector-tag">a</span> = v and c = v <span class="comment">// ä½¿ç”¨a</span></span><br><span class="line">where <span class="selector-tag">b</span> = v and c = v <span class="comment">// æœªä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">where <span class="selector-tag">a</span> &gt; v <span class="comment">// æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œå–å†³äºæŸ¥è¯¢ç»“æœé›†ï¼Œå¦‚æœå…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨ç´¢å¼•ã€‚</span></span><br><span class="line"></span><br><span class="line">where <span class="selector-tag">a</span> like <span class="string">"v%"</span> <span class="comment">// ä½¿ç”¨a</span></span><br><span class="line">where <span class="selector-tag">a</span> like <span class="string">"%v%"</span> <span class="comment">// ä¸é€‚ç”¨ç´¢å¼•</span></span><br></pre></td></tr></table></figure><h3 id="3-å¦‚ä½•åˆ†æSQLè¯­å¥æ‰§è¡Œæ€§èƒ½"><a href="#3-å¦‚ä½•åˆ†æSQLè¯­å¥æ‰§è¡Œæ€§èƒ½" class="headerlink" title="3.å¦‚ä½•åˆ†æSQLè¯­å¥æ‰§è¡Œæ€§èƒ½"></a>3.å¦‚ä½•åˆ†æSQLè¯­å¥æ‰§è¡Œæ€§èƒ½</h3><p>ä»¥ä¸‹æ˜¯ä¸¤ç§åˆ†æSQLæ€§èƒ½çš„å¸¸ç”¨æ–¹å¼ï¼Œexplainã€show profiles/show profileã€‚</p><blockquote><p>explain + SQLè¯­å¥ï¼Œè·å–SQLåˆ†ææ•°æ®</p><ul><li>select_typeï¼šå¯¹åº”SQLè¯­å¥çš„æŸ¥è¯¢å¤æ‚åº¦ã€‚</li><li>tableï¼šæ­£åœ¨è®¿é—®çš„è¡¨ã€‚</li><li>partitionsï¼šæ•°æ®æ‰€åœ¨çš„åˆ†åŒºã€‚</li><li>typeï¼šè¡¨ç¤ºæ˜¯å¦ç”¨ä¸Šç´¢å¼•ï¼Œä»¥åŠç´¢å¼•æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œæ­¤å­—æ®µå†³å®šç´¢å¼•çš„æ€§èƒ½ã€‚<code>ALL&lt;TYPE&lt;RANGE&lt;REF&lt;CONST</code></li><li>possible_keysï¼šæŸ¥è¯¢æ¡ä»¶å­˜åœ¨çš„ç´¢å¼•ã€‚</li><li>keyï¼šè§¦å‘çš„ç´¢å¼•ã€‚</li><li>key_lenï¼šç´¢å¼•å­—æ®µçš„é•¿åº¦ã€‚</li><li>refï¼šç´¢å¼•è®¿é—®ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•å€¼çš„è¡Œã€‚</li><li>rowsï¼šæ‰§è¡ŒæŸ¥è¯¢å¿…é¡»æ£€æŸ¥çš„è¡Œæ•°ï¼Œåœ¨InnoDBä¸­æ­¤å€¼ä¸ç²¾ç¡®ã€‚</li><li>filteredï¼šæ¡ä»¶è¿‡æ»¤å‡ºçš„è¡Œæ•°çš„ç™¾åˆ†æ¯”ã€‚</li><li>extraï¼šæŸ¥è¯¢åˆ†æç»“æœçš„é¢å¤–ä¿¡æ¯ï¼Œå¾ˆé‡è¦ e.g. Using indexã€Using where â€¦</li></ul><p>show profilesè·å¾—å½“å‰ä¼šè¯ä¸­æ‰§è¡Œçš„SQLè¯­å¥ï¼Œå­—æ®µä¸ºï¼šQuery_ID, Duration, Queryï¼Œshow profile all for query {Query_ID}</p></blockquote><h3 id="4-Mysqlä¸­ç´¢å¼•å»ºç«‹å¸¸è§é—®é¢˜"><a href="#4-Mysqlä¸­ç´¢å¼•å»ºç«‹å¸¸è§é—®é¢˜" class="headerlink" title="4.Mysqlä¸­ç´¢å¼•å»ºç«‹å¸¸è§é—®é¢˜"></a>4.Mysqlä¸­ç´¢å¼•å»ºç«‹å¸¸è§é—®é¢˜</h3><ol><li>ä¸ºç»å¸¸éœ€è¦æ’åºã€åˆ†ç»„å’Œè”åˆæ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>ä¸ºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>ç´¢å¼•åˆ—å€¼ä¿è¯å”¯ä¸€æ€§</li><li>ç´¢å¼•å»ºç«‹çš„æ•°é‡ä¸è¦è¿‡å¤š</li><li>ç´¢å¼•åˆ—ä¸è¦ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼</li><li>è¡Œé”ä¾èµ–ç´¢å¼•çš„å»ºç«‹</li><li>æ™®é€šç´¢å¼•çš„æ•°æ®é‡å¤ç‡è¿‡é«˜ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li><li><code>æœ€å·¦åŸåˆ™</code></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç´¢å¼•ç”¨äºå¿«é€ŸæŸ¥æ‰¾å…·æœ‰ç‰¹å®šåˆ—å€¼çš„è¡Œã€‚æ²¡æœ‰ç´¢å¼•ï¼ŒMySQLå¿…é¡»ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œç„¶åé€šè¯»æ•´ä¸ªè¡¨ä»¥æ‰¾åˆ°ç›¸å…³çš„è¡Œã€‚å¦‚æœè¡¨ä¸­æœ‰ç›¸å…³â€‹â€‹åˆ—çš„ç´¢å¼•ï¼ŒMySQLå¯ä»¥å¿«é€Ÿç¡®å®šè¦åœ¨æ•°æ®æ–‡ä»¶ä¸­é—´æŸ¥æ‰¾çš„ä½ç½®ï¼Œè€Œä¸å¿…æŸ¥çœ‹æ‰€æœ‰æ•°æ®ã€‚è¿™æ¯”é¡ºåºè¯»å–æ¯ä¸€è¡Œè¦å¿«å¾—å¤šã€‚&lt;br&gt;InnoDBå’ŒMyIsamåªæ”¯æŒBtreeï¼Œå› æ­¤é»˜è®¤å‡æ˜¯Btreeï¼ŒMemoryå’ŒHeapæ”¯æŒHashå’ŒBtreeï¼Œå¦‚æ— æ˜ç¡®å£°æ˜ï¼Œåˆ™é»˜è®¤ç´¢å¼•å‡æ˜¯Hashï¼ˆåŒ…æ‹¬ä¸»é”®ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•&quot;&gt;&lt;a href=&quot;#1-Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•&quot; class=&quot;headerlink&quot; title=&quot;1.Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•&quot;&gt;&lt;/a&gt;1.Mysqlæœ‰å“ªäº›å¸¸ç”¨çš„ç´¢å¼•&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸»é”®ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ä¸ºnullï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚&lt;/p&gt;
&lt;p&gt;å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸ºnullï¼Œä¸€ä¸ªè¡¨å…è®¸å¤šä¸ªåˆ—åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;æ™®é€šç´¢å¼•ï¼šåŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰å”¯ä¸€æ€§çš„é™åˆ¶ï¼Œå…è®¸ä¸ºnullã€‚&lt;/p&gt;
&lt;p&gt;å…¨æ–‡ç´¢å¼•ï¼šå…¨æ–‡ç´¢å¼•æ˜¯ç›®å‰å®ç°å¤§æ•°æ®æœç´¢çš„å…³é”®æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;2-Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™&quot;&gt;&lt;a href=&quot;#2-Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™&quot; class=&quot;headerlink&quot; title=&quot;2.Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™&quot;&gt;&lt;/a&gt;2.Mysqlç´¢å¼•çš„å»ºç«‹åŸåˆ™&lt;/h3&gt;&lt;p&gt;Mysqlçš„ç´¢å¼•éµå¾ªæœ€å·¦åŸåˆ™ï¼Œåœ¨åˆ›å»ºå¤šåˆ—ç´¢å¼•æ—¶ï¼Œè¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œwhereæ¡ä»¶ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„ä¸€åˆ—æ”¾åœ¨æœ€å·¦è¾¹ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - äº‹åŠ¡éš”ç¦»çº§åˆ«</title>
    <link href="http://xupin.im/2019/12/05/mysql-transaction/"/>
    <id>http://xupin.im/2019/12/05/mysql-transaction/</id>
    <published>2019-12-05T04:30:00.000Z</published>
    <updated>2022-07-15T02:59:17.754Z</updated>
    
    <content type="html"><![CDATA[<p>ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿäº‹åŠ¡ï¼ˆTransactionï¼‰ä¸€èˆ¬æ˜¯æŒ‡è¦åšçš„æˆ–æ‰€åšçš„äº‹æƒ…ã€‚åœ¨è®¡ç®—æœºæœ¯è¯­ä¸­æ˜¯æŒ‡è®¿é—®å¹¶å¯èƒ½æ›´æ–°æ•°æ®åº“ä¸­å„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªç¨‹åºæ‰§è¡Œå•å…ƒ(unit)ï¼Œå…·æœ‰4ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼Œç®€ç§°ACIDã€‚</p><p>é‚£ä¹ˆMysqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«åˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸMysqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«åˆ†åˆ«æ˜¯4ç§ï¼šæœªæäº¤è¯»ï¼ˆRead Uncommittedï¼‰ã€å·²æäº¤è¯»ï¼ˆRead Committedï¼‰ã€Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰ã€Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºMysqläº‹åŠ¡çš„4ç§æ‰§è¡Œæ ‡å‡†ã€‚</p><h3 id="ä¸€ã€ACIDç‰¹æ€§"><a href="#ä¸€ã€ACIDç‰¹æ€§" class="headerlink" title="ä¸€ã€ACIDç‰¹æ€§"></a>ä¸€ã€ACIDç‰¹æ€§</h3><blockquote><p>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚</p></blockquote><p><br></p><blockquote><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸åŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚</p></blockquote><p><br></p><blockquote><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</p></blockquote><p><br></p><blockquote><p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p></blockquote><h3 id="äºŒã€Mysqläº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äºŒã€Mysqläº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äºŒã€Mysqläº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äºŒã€Mysqläº‹åŠ¡éš”ç¦»çº§åˆ«</h3><blockquote><p>æœªæäº¤è¯»ï¼ˆRead Uncommittedï¼‰ï¼ŒæŒ‡å½“å‰äº‹åŠ¡å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡è¿˜æœªæäº¤çš„æ•°æ®å˜åŒ–ï¼Œæœ€å®¹æ˜“å¸¦æ¥çš„é—®é¢˜æ˜¯è„è¯»ï¼ˆDirty Readï¼‰ï¼Œå¾ˆå°‘åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p></blockquote><p><br></p><blockquote><p>å·²æäº¤è¯»ï¼ˆRead Committedï¼‰ï¼Œå¤§éƒ¨åˆ†æ•°æ®åº“é»˜è®¤éš”ç¦»çº§åˆ«ä½†ä¸åŒ…æ‹¬Mysqlï¼ŒæŒ‡å½“å‰äº‹åŠ¡å¯ä»¥è¯»å–å…¶ä»–äº‹åŠ¡å·²æäº¤çš„æ•°æ®å˜åŒ–ï¼Œå…·æœ‰éš”ç¦»æ€§çš„åŸºæœ¬æ ‡å‡†ï¼Œä½†æ˜¯åœ¨å‡ºç°äº¤å‰äº‹åŠ¡çš„å¹¶å‘æ“ä½œåœºæ™¯ä¸­ä¼šå‘ç”Ÿä¸¤æ¬¡è¯»å–çš„æ•°æ®ç»“æœé›†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå³ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ã€‚</p></blockquote><p><br></p><blockquote><p>Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰ï¼ŒMysqlæ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œè¿™é‡Œé¡ºä¾¿è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆMysqlçš„éš”ç¦»çº§åˆ«ä¸æ˜¯Read Committedï¼Œå› ä¸ºåœ¨Mysql5.0ä¹‹å‰æ—¥å¿—æ ¼å¼åªæœ‰statementè¿™ä¸€ç§ï¼Œè¿™ç§æ ¼å¼å¯¼è‡´ä¸»ä»å¤åˆ¶ä¸€è‡´æ€§å¾ˆéš¾å¾—åˆ°ä¿è¯ã€‚è¿™ç§éš”ç¦»çº§åˆ«å¯ä»¥è§£å†³Nonrepeatable Readçš„é—®é¢˜ï¼Œä½†å¦‚æœä¹Ÿå‡ºç°åœ¨äº¤å‰äº‹åŠ¡çš„å¹¶å‘æ“ä½œåœºæ™¯ä¼šå‡ºç°å¹»è¯»ï¼ˆPhantom Readï¼‰çš„ç°è±¡ï¼Œè¿™ä¸€è¡Œä¸ºçŠ¶æ€æ˜¯å½“å‰äº‹åŠ¡ä¸èƒ½åŠæ—¶æœ‰æ•ˆçš„è¯»å–å…¶ä»–äº‹åŠ¡çš„æ•°æ®å˜åŒ–ã€‚</p></blockquote><p><br></p><blockquote><p>Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰ï¼ŒMysqläº‹åŠ¡éš”ç¦»æœ€é«˜çº§åˆ«ï¼Œæœ›æ–‡ç”Ÿä¹‰å¤§æ¦‚æ„æ€æ˜¯äº‹åŠ¡çš„æ‰§è¡Œæ˜¯æœ‰åºï¼ˆä¸²è¡ŒåŒ–é¡ºåºï¼‰çš„ï¼Œä¸å­˜åœ¨äº‹åŠ¡äº¤å‰æ‰§è¡Œçš„åœºæ™¯ä»è€Œè§£å†³äº†Phantom Readçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ä¸‹è¯·æ±‚ä¼šå‡ºç°é˜»å¡ã€è¶…æ—¶ã€é”ç«ŸæŠ¢çš„é—®é¢˜ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§ä¹Ÿéšä¹‹é™ä½ã€‚</p></blockquote><h3 id="æ”¶å°¾"><a href="#æ”¶å°¾" class="headerlink" title="æ”¶å°¾"></a>æ”¶å°¾</h3><blockquote><p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html</a> // Mysqläº‹åŠ¡å®˜æ–¹æ–‡æ¡£</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿäº‹åŠ¡ï¼ˆTransactionï¼‰ä¸€èˆ¬æ˜¯æŒ‡è¦åšçš„æˆ–æ‰€åšçš„äº‹æƒ…ã€‚åœ¨è®¡ç®—æœºæœ¯è¯­ä¸­æ˜¯æŒ‡è®¿é—®å¹¶å¯èƒ½æ›´æ–°æ•°æ®åº“ä¸­å„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªç¨‹åºæ‰§è¡Œå•å…ƒ(unit)ï¼Œå…·æœ‰4ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼Œç®€ç§°ACIDã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆMysqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«åˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸMys</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysqlå­¦ä¹ ç¬”è®° - æ‚²è§‚é”/ä¹è§‚é”</title>
    <link href="http://xupin.im/2019/12/04/pessimistic-optimistic/"/>
    <id>http://xupin.im/2019/12/04/pessimistic-optimistic/</id>
    <published>2019-12-04T11:30:00.000Z</published>
    <updated>2022-07-15T02:59:17.755Z</updated>
    
    <content type="html"><![CDATA[<p>ä»€ä¹ˆæ˜¯é”ï¼Ÿåœ¨å¤šè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç¼–ç¨‹ä¸­ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§ï¼Œå¦‚æœä¸€èµ„æºè¢«æŸè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ä¸Šé”ï¼Œé‚£ä¹ˆåœ¨é‡Šæ”¾é”ä¹‹å‰å…¶ä»–è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ— æ³•è¿›è¡Œæ“ä½œæˆ–è€…ç­‰å¾…è·å–ï¼ˆä¸Šï¼‰é”ã€‚</p><h3 id="ä¸€ã€æ‚²è§‚é”"><a href="#ä¸€ã€æ‚²è§‚é”" class="headerlink" title="ä¸€ã€æ‚²è§‚é”"></a>ä¸€ã€æ‚²è§‚é”</h3><p>æ‚²è§‚é”ï¼ˆPessimistic lockingï¼‰ï¼Œé¡¾åæ€ä¹‰å¯¹å¾…ä»»ä½•äº‹åŠ¡éƒ½æŒæ‚²è§‚æ€åº¦ï¼Œåšä»»ä½•äº‹æƒ…éƒ½ä¼šè®¤ä¸ºä¼šæœ‰ç«æŠ¢è¡Œä¸º~æ‰€ä»¥åœ¨è¿›è¡Œä»»ä½•æ“ä½œä¹‹å‰éƒ½è¦åšå¥½ä¸‡å…¨å‡†å¤‡ï¼ˆä¸Šé”ï¼‰æ‰ä¼šç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚é€šå¸¸æ˜¯åˆ©ç”¨ç³»ç»Ÿæä¾›çš„é”æœºåˆ¶æ¥å®ç°ã€‚<br>æ¯”å¦‚ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mysqlä¸­çš„ä¸Šé”å‘½ä»¤ï¼šfor <span class="keyword">update</span>ã€<span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>ç­‰</span><br><span class="line">Redisä¸­çš„ä¸€äº›æ“ä½œå‘½ä»¤ï¼šsetnxã€getsetç­‰ï¼ˆåŸå­æ“ä½œï¼‰</span><br></pre></td></tr></table></figure></p><h3 id="äºŒã€ä¹è§‚é”"><a href="#äºŒã€ä¹è§‚é”" class="headerlink" title="äºŒã€ä¹è§‚é”"></a>äºŒã€ä¹è§‚é”</h3><p>ä¹è§‚é”ï¼ˆOptimistic lockingï¼‰ï¼Œå’Œæ‚²è§‚é”ç›¸åå¯¹å¾…ä»»ä½•äº‹åŠ¡éƒ½æŒä¹è§‚æ€åº¦ï¼Œåªä¼šåœ¨æœ€åå³å°†æ‰§è¡Œæ“ä½œçš„æ—¶åˆ»å‰æ‰ä¼šè¿›è¡ŒéªŒè¯ã€‚é€šå¸¸æ˜¯é€šè¿‡ç¨‹åºé…åˆæ¥å®ç°ã€‚<br>æ¯”å¦‚ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="string">`orders`</span> <span class="keyword">set</span> <span class="keyword">hash</span> = <span class="keyword">md5</span>(<span class="keyword">now</span>()) <span class="keyword">where</span> uid = <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">hash</span> = &#123;lastHash&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="ä¸‰ã€ä¼˜ç¼ºç‚¹"><a href="#ä¸‰ã€ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¸‰ã€ä¼˜ç¼ºç‚¹"></a>ä¸‰ã€ä¼˜ç¼ºç‚¹</h3><p>æ‚²è§‚é”ä¼˜ç‚¹å¾ˆé²œæ˜ï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œçš„æ“ä½œéƒ½æ˜¯ç‹¬å çš„ï¼Œæ•°æ®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§ã€å®‰å…¨æ€§è¾ƒé«˜ã€‚ä½†ç¼ºç‚¹åŒæ ·çªå‡ºï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šäº§ç”Ÿä¸Šé”çš„å¼€é”€ï¼Œåœ¨å¹¶å‘è¯·æ±‚æ¯”è¾ƒå¯†é›†çš„æƒ…å†µä¸‹å®¹æ˜“é˜»å¡æˆ–è€…é©³å›è¯·æ±‚ï¼Œç”šè‡³æ˜¯é€ æˆæ­»é”ï¼Œä¹Ÿå¤§å¤§é™ä½äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>ä¹è§‚é”ä¼˜ç‚¹æ˜¯çœå»äº†é”çš„å¼€é”€ï¼Œèƒ½è¾ƒé«˜çš„æé«˜ç³»ç»Ÿååé‡ï¼Œç¼ºç‚¹æ˜¯å¦‚æœå‡ºç°åœ¨å¹¶å‘é«˜ä¸”ç«ŸæŠ¢ï¼ˆå†²çªï¼‰è¡Œä¸ºæ¯”è¾ƒå¤šçš„åœºæ™¯ä¸‹æ•°æ®çš„ä¸€è‡´æ€§å¾ˆéš¾ä¿è¯ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»€ä¹ˆæ˜¯é”ï¼Ÿåœ¨å¤šè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç¼–ç¨‹ä¸­ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§ï¼Œå¦‚æœä¸€èµ„æºè¢«æŸè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ä¸Šé”ï¼Œé‚£ä¹ˆåœ¨é‡Šæ”¾é”ä¹‹å‰å…¶ä»–è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ— æ³•è¿›è¡Œæ“ä½œæˆ–è€…ç­‰å¾…è·å–ï¼ˆä¸Šï¼‰é”ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸€ã€æ‚²è§‚é”&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ‚²è§‚é”&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="mysql" scheme="http://xupin.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®° - æŒä¹…åŒ–æ–¹å¼</title>
    <link href="http://xupin.im/2019/12/03/redis-aof-rdb/"/>
    <id>http://xupin.im/2019/12/03/redis-aof-rdb/</id>
    <published>2019-12-03T07:30:00.000Z</published>
    <updated>2022-07-15T02:59:17.756Z</updated>
    
    <content type="html"><![CDATA[<p>Redisæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç ï¼ˆBSDè®¸å¯ï¼‰çš„å†…å­˜ä¸­æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ï¼Œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚</p><h3 id="ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§"><a href="#ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§" class="headerlink" title="ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§"></a>ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å•çº¯çš„ç¼“å­˜æ¨¡å¼, æ•´ä¸ªæ•°æ®çš„ç”Ÿå‘½å‘¨æœŸéšç€Redis <span class="built_in">Server</span>çš„åœæ­¢è€Œæ¶ˆå¤±ã€‚</span><br><span class="line">persistenceæ¨¡å¼, æ•°æ®ä¼šæŒç»­å¤‡ä»½åˆ°ç£ç›˜æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure><h3 id="äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚"><a href="#äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚" class="headerlink" title="äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚"></a>äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">RDB</span><span class="params">(Redis DataBase)</span></span></span><br><span class="line"><span class="function"><span class="title">AOF</span><span class="params">(Append-only file)</span></span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="ä¸‰ã€RDB"><a href="#ä¸‰ã€RDB" class="headerlink" title="ä¸‰ã€RDB"></a>ä¸‰ã€RDB</h3><p>RDBçš„å·¥ä½œåŸç†æœ‰ç‚¹åƒè¿ç»´è„šæœ¬è‡ªåŠ¨åŒ–å®šæ—¶å¤‡ä»½æ•°æ®ä¸€æ ·ï¼Œå½“å†…å­˜ä¸­çš„æ•°æ®åˆ°è¾¾é…ç½®çš„é˜ˆå€¼å°±ä¼šæ‰§è¡ŒDUMPæ“ä½œå¤‡ä»½æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶,å¤‡ä»½æˆåŠŸç»“æŸåé‡å‘½åä¸ºdump.rdbæ–‡ä»¶ã€‚<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¼˜ç‚¹ï¼š<span class="keyword">fork</span>å­è¿›ç¨‹æ¥è¿›è¡Œå¤‡ä»½,çˆ¶è¿›ç¨‹ä¸ä¼šè¿›è¡Œioæ“ä½œã€‚æ¢å¤æ•°æ®æ—¶çš„é€Ÿåº¦å¾ˆå¿«ã€‚</span><br><span class="line">ç¼ºç‚¹ï¼šè¿™ç§æ–¹å¼æ˜¯æ¯éš”ä¸€æ¬¡æ‰ä¼šè¿›è¡Œå¤‡ä»½,å‡å¦‚ä¸‹ä¸€æ¬¡å¤‡ä»½å‰downæœºä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®ã€‚è€Œä¸”å¦‚æœå¤‡ä»½çš„æ•°æ®æ¯”è¾ƒå¤§ï¼Œ<span class="keyword">fork</span>çš„å­è¿›ç¨‹å°†ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè¿™æ®µæ—¶é—´å†…ä¼šå¯¼è‡´çˆ¶è¿›ç¨‹é˜»å¡ã€‚</span><br><span class="line">è¡¥å……ï¼šå› ä¸ºè¿™ç§æ¯éš”ä¸€æ®µæ—¶é—´å»å¤‡ä»½ä¸€æ¬¡çš„æ–¹å¼ï¼Œç±»ä¼¼å¿«ç…§ã€‚æ‰€ä»¥åˆå« Snapshotã€‚</span><br></pre></td></tr></table></figure></p><h3 id="å››ã€AOF"><a href="#å››ã€AOF" class="headerlink" title="å››ã€AOF"></a>å››ã€AOF</h3><p>AOFçš„å·¥ä½œåŸç†æ˜¯è®²å†™æ“ä½œï¼ˆæ•°æ®ï¼‰æ ¼å¼åŒ–è¿½åŠ åˆ°æ—¥å¿—å°¾éƒ¨ï¼Œè¯¥æ—¥å¿—æ–‡ä»¶ä¿å­˜äº†æ‰€æœ‰çš„å†å²æ“ä½œæ•°æ®ï¼Œè¿™ä¸€ç‚¹éå¸¸ç±»ä¼¼Mysqlä¸­çš„bin.logã€‚<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¼˜ç‚¹ï¼šAOFè¿™ç§æ–¹å¼å¯ä»¥ä¿è¯è¾ƒé«˜çš„æ•°æ®å®Œæ•´æ€§ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„ç­–ç•¥ï¼Œæ¯”å¦‚ä¸ä¿å­˜ï¼Œæ¯ä¸€ç§’é’Ÿä¿å­˜ä¸€æ¬¡ï¼Œæˆ–è€…æ¯æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ä¿å­˜ä¸€æ¬¡ã€‚AOFçš„é»˜è®¤ç­–ç•¥ä¸ºæ¯ä¸€ç§’é’Ÿä¿å­˜ä¸€æ¬¡, å°±ç®—å‡ºç°downæœºæœ€å¤šä¹Ÿå°±ä¸¢å¤±<span class="number">1</span>ç§’é’Ÿçš„æ•°æ®, AOFå¤‡ä»½æ•°æ®å› ä¸ºæ˜¯åœ¨åå°çº¿ç¨‹æ‰§è¡Œforkå­è¿›ç¨‹, æ‰€ä»¥ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</span><br><span class="line">ç¼ºç‚¹ï¼šå¯¹äºåŒæ ·è§„æ¨¡çš„æ•°æ®å¤‡ä»½çš„æ–‡ä»¶ä½“ç§¯AOFè¦å¤§äºRDBã€‚åœ¨å¤‡ä»½é€Ÿåº¦ä¸Šé¢ä¹Ÿä¼šæ…¢äºRDBï¼Œæ¢å¤é€Ÿåº¦åŒæ ·ä¹Ÿæ²¡æœ‰RDBå¿«ã€‚</span><br></pre></td></tr></table></figure></p><h3 id="äº”ã€AOFå¤‡ä»½è§¦å‘æœºåˆ¶"><a href="#äº”ã€AOFå¤‡ä»½è§¦å‘æœºåˆ¶" class="headerlink" title="äº”ã€AOFå¤‡ä»½è§¦å‘æœºåˆ¶"></a>äº”ã€AOFå¤‡ä»½è§¦å‘æœºåˆ¶</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> RedisæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯bgrewriteaofæŒ‡ä»¤è¯·æ±‚ï¼Œå¦‚æœå½“å‰æ²¡æœ‰åœ¨è¿›è¡Œå¤‡ä»½é‚£ä¹ˆç«‹å³è¿›è¡Œå¤‡ä»½ï¼Œå¦åˆ™ç­‰å¾…å¤‡ä»½å®Œæ¯•ä¹‹åå†æ‰§è¡Œå¤‡ä»½ã€‚</span><br><span class="line"><span class="number">2.</span> Redis confé…ç½®äº†<span class="keyword">auto</span>-aof-rewrite-percentageå’Œ<span class="keyword">auto</span>-aof-rewrite-<span class="built_in">min</span>-<span class="built_in">size</span>å‚æ•°ï¼Œå¹¶ä¸”å½“å‰AOFæ–‡ä»¶å¤§å°server.aof_current_sizeå¤§äº<span class="keyword">auto</span>-aof-rewrite-<span class="built_in">min</span>-<span class="built_in">size</span>ï¼Œä¸”AOFæ–‡ä»¶å¤§å°çš„å¢é•¿ç‡å¤§äº<span class="keyword">auto</span>-aof-rewrite-percentageæ—¶è§¦å‘å¤‡ä»½ã€‚</span><br><span class="line"><span class="number">3.</span> ä½¿ç”¨<span class="built_in">config</span> <span class="built_in">set</span> appendonly yeså‘½ä»¤æ—¶ï¼Œè°ƒç”¨startAppendOnly()å‡½æ•°è§¦å‘å¤‡ä»½ã€‚</span><br></pre></td></tr></table></figure><h3 id="å…­ã€é‚£ç©¶ç«Ÿä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ"><a href="#å…­ã€é‚£ç©¶ç«Ÿä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ" class="headerlink" title="å…­ã€é‚£ç©¶ç«Ÿä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ"></a>å…­ã€é‚£ç©¶ç«Ÿä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RDB ä¼šæœ‰ä¸¢å¤±æ•°æ®é£é™©ï¼Œå¤‡ä»½æ–‡ä»¶ä½“ç§¯å°ï¼Œæ•°æ®å¤‡ä»½/æ¢å¤é€Ÿåº¦å¿«ã€‚</span><br><span class="line">AOF æ•°æ®å®Œæ•´æ€§æ›´åŠ å®‰å…¨ï¼Œä½†æ˜¯é¢‘ç¹å¤‡ä»½éœ€è¦è¿‡å¤šçš„<span class="built_in">io</span>æ“ä½œæ€§èƒ½ä¼šå—åˆ°å½±å“ï¼Œå¤‡ä»½æ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼Œæ•°æ®æ¢å¤é€Ÿåº¦æ…¢ã€‚</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ˜ç™½AOF, RDBçš„ä¼˜ç¼ºç‚¹ä¹‹åå¯ä»¥æ¦‚æ‹¬å‡º: AOFé€‚åˆçƒ­å¤‡ï¼ŒRDBé€‚åˆå†·å¤‡ï¼ŒRedis4.0ä»¥åå…è®¸ä½¿ç”¨aof-use-rdb-preambleé…ç½®é¡¹æ‰“å¼€RDB-AOFæ··åˆæŒä¹…åŒ–ã€‚</p><h3 id="ä¸ƒã€RDB-AOFæ··åˆä½¿ç”¨çš„ä¹‹åå¤‡ä»½æ–‡ä»¶çš„å˜åŒ–"><a href="#ä¸ƒã€RDB-AOFæ··åˆä½¿ç”¨çš„ä¹‹åå¤‡ä»½æ–‡ä»¶çš„å˜åŒ–" class="headerlink" title="ä¸ƒã€RDB/AOFæ··åˆä½¿ç”¨çš„ä¹‹åå¤‡ä»½æ–‡ä»¶çš„å˜åŒ–"></a>ä¸ƒã€RDB/AOFæ··åˆä½¿ç”¨çš„ä¹‹åå¤‡ä»½æ–‡ä»¶çš„å˜åŒ–</h3><p>å½“RDBå’ŒAOFåŒæ—¶å¼€å¯ä¹‹å<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>Redisé»˜è®¤ä¼šä¼˜å…ˆåŠ è½½AOFçš„é…ç½®æ–‡ä»¶ã€‚</span><br><span class="line"><span class="bullet">2. </span>AOFå¤‡ä»½æ–‡ä»¶çš„å†…å®¹æ ¼å¼å‘ç”Ÿæ”¹å˜ï¼Œå¤‡ä»½æ–‡ä»¶å‰åŠæ®µæ˜¯RDBæ ¼å¼çš„å…¨é‡æ•°æ®ååŠæ®µæ˜¯Rediså‘½ä»¤æ ¼å¼çš„å¢é‡æ•°æ®ã€‚</span><br></pre></td></tr></table></figure></p><h3 id="å…«ã€AOFæ–‡ä»¶å†…å®¹æ ¼å¼"><a href="#å…«ã€AOFæ–‡ä»¶å†…å®¹æ ¼å¼" class="headerlink" title="å…«ã€AOFæ–‡ä»¶å†…å®¹æ ¼å¼"></a>å…«ã€AOFæ–‡ä»¶å†…å®¹æ ¼å¼</h3><p>AOFæ–‡ä»¶å†…å®¹æ ¼å¼æ˜¯Redisé€šè®¯åè®®RESPï¼ˆREdis Serialization Protocolï¼‰æ ¼å¼çš„å‘½ä»¤æ–‡æœ¬å­˜å‚¨ï¼Œåœ¨æ­¤ä¸å±•å¼€å­¦ä¹ åç»­ä¼šä¸“é—¨å­¦ä¹ Redisçš„RESPåè®®ã€‚</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>é™„ä¸ŠRediså¯¹äºæŒä¹…åŒ–æ–¹å¼è¯´æ˜çš„æ–‡æ¡£</p><blockquote><p><a href="https://redis.io/topics/persistence" target="_blank" rel="noopener">https://redis.io/topics/persistence</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Redisæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç ï¼ˆBSDè®¸å¯ï¼‰çš„å†…å­˜ä¸­æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ï¼Œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§&quot;&gt;&lt;a href=&quot;#ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§&quot;&gt;&lt;/a&gt;ä¸€ã€Redisæ•°æ®å­˜å‚¨çš„æ–¹å¼æœ‰ä¸¤ç§&lt;/h3&gt;&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å•çº¯çš„ç¼“å­˜æ¨¡å¼, æ•´ä¸ªæ•°æ®çš„ç”Ÿå‘½å‘¨æœŸéšç€Redis &lt;span class=&quot;built_in&quot;&gt;Server&lt;/span&gt;çš„åœæ­¢è€Œæ¶ˆå¤±ã€‚&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;persistenceæ¨¡å¼, æ•°æ®ä¼šæŒç»­å¤‡ä»½åˆ°ç£ç›˜æ–‡ä»¶ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚&quot;&gt;&lt;a href=&quot;#äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚&quot; class=&quot;headerlink&quot; title=&quot;äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚&quot;&gt;&lt;/a&gt;äºŒã€Rediså¦‚ä½•å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ŸRedisæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚&lt;/h3&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;RDB&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Redis DataBase)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;AOF&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Append-only file)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="redis" scheme="http://xupin.im/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>è®¾å¤‡é€šçŸ¥æ¨é€ - Google FCM</title>
    <link href="http://xupin.im/2017/02/28/google-msg-push/"/>
    <id>http://xupin.im/2017/02/28/google-msg-push/</id>
    <published>2017-02-27T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.751Z</updated>
    
    <content type="html"><![CDATA[<p>Firebase æ˜¯ä¸€ä¸ªç§»åŠ¨å¹³å°ï¼Œå¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿå¼€å‘é«˜å“è´¨åº”ç”¨ï¼Œæ‰©å¤§ç”¨æˆ·ç¾¤ï¼Œå¹¶èµšå–æ›´å¤šæ”¶ç›Šã€‚Firebase ç”±å¤šç§äº’è¡¥åŠŸèƒ½ç»„æˆï¼Œæ‚¨å¯ä»¥è‡ªè¡Œç»„åˆå’ŒåŒ¹é…è¿™äº›åŠŸèƒ½ä»¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚</p><h3 id="1-è·å–Googleæ¨é€çš„KEY-Googleåº”ç”¨åå°"><a href="#1-è·å–Googleæ¨é€çš„KEY-Googleåº”ç”¨åå°" class="headerlink" title="1.è·å–Googleæ¨é€çš„KEY(Googleåº”ç”¨åå°)"></a>1.è·å–Googleæ¨é€çš„KEY(Googleåº”ç”¨åå°)</h3><blockquote><p>AIzaSyCm5Vufc1FAtWE1kupGhVDRb0ThkCoWC7d // è¿™ä¸ªæ˜¯æˆ‘çš„</p></blockquote><h3 id="2-PHPæ¨é€ä»£ç "><a href="#2-PHPæ¨é€ä»£ç " class="headerlink" title="2.PHPæ¨é€ä»£ç "></a>2.PHPæ¨é€ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ç¯å¢ƒ</span></span><br><span class="line">$url = <span class="string">'https://fcm.googleapis.com/fcm/send'</span>;</span><br><span class="line">$ch = curl_init($url);</span><br><span class="line">curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">false</span>);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</span><br><span class="line">curl_setopt($ch, CURLOPT_POST, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">$header = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">'Content-Type: application/json'</span>,</span><br><span class="line"><span class="string">'Authorization: key=AIzaSyCm5Vufc1FAtWE1kupGhVDRb0ThkCoWC7d'</span> <span class="comment">// è¿™é‡Œæ˜¯åˆšæ‰çš„KEY</span></span><br><span class="line">);</span><br><span class="line">curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºæ¶ˆæ¯ä½“,jsonç¼–ç </span></span><br><span class="line">$content = json_encode([</span><br><span class="line"><span class="string">'notification'</span>=&gt;[</span><br><span class="line"><span class="string">'title'</span> =&gt; <span class="string">'è¿™é‡Œæ˜¯æ ‡é¢˜'</span>, </span><br><span class="line"><span class="string">'body'</span> =&gt; <span class="string">'è¿™é‡Œæ˜¯å†…å®¹'</span>, </span><br><span class="line"><span class="string">'icon'</span> =&gt; <span class="string">'è¿™é‡Œæ˜¯åå°è®¾ç½®çš„iconName'</span></span><br><span class="line">],</span><br><span class="line"><span class="string">'to'</span>=&gt;<span class="string">'è®¾å¤‡æ ‡è¯†(Google SDKå¯ä»¥è·å–)'</span>,</span><br><span class="line"><span class="string">'registration_ids'</span>=&gt;[<span class="string">'è®¾å¤‡æ ‡è¯†'</span>,<span class="string">'è®¾å¤‡æ ‡è¯†'</span>] <span class="comment">// å¦‚æœè¦æ¨é€å¤šå°è®¾å¤‡,å¯ä»¥ä½¿ç”¨æ­¤å­—æ®µ,æœ€å¤šæ”¯æŒ1000å°è®¾å¤‡</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">curl_setopt($ch, CURLOPT_POSTFIELDS, $content);</span><br><span class="line"></span><br><span class="line">$ret = json_decode(curl_exec($ch), <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">$ret[<span class="string">'success'</span>]; <span class="comment">// æ¨é€æˆåŠŸæ•°</span></span><br><span class="line"></span><br><span class="line">$ret[<span class="string">'failure'</span>]; <span class="comment">// æ¨é€å¤±è´¥æ•°</span></span><br></pre></td></tr></table></figure><h3 id="3-è¿”å›å€¼ç¤ºä¾‹"><a href="#3-è¿”å›å€¼ç¤ºä¾‹" class="headerlink" title="3.è¿”å›å€¼ç¤ºä¾‹"></a>3.è¿”å›å€¼ç¤ºä¾‹</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"multicast_id"</span>: <span class="number">7669649331143639654</span>,</span><br><span class="line">    <span class="attr">"success"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">"failure"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"canonical_ids"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"results"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"message_id"</span>: <span class="string">"0:1488360060090224%6490a2d16490a2d1"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"message_id"</span>: <span class="string">"0:1488360060095871%6490a2d16490a2d1"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"message_id"</span>: <span class="string">"0:1488360060090765%6490a2d16490a2d1"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Google-FCM-æ–‡æ¡£"><a href="#4-Google-FCM-æ–‡æ¡£" class="headerlink" title="4.Google(FCM) æ–‡æ¡£"></a>4.Google(FCM) æ–‡æ¡£</h3><blockquote><p><a href="https://firebase.google.com/docs" target="_blank" rel="noopener">https://firebase.google.com/docs</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Firebase æ˜¯ä¸€ä¸ªç§»åŠ¨å¹³å°ï¼Œå¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿå¼€å‘é«˜å“è´¨åº”ç”¨ï¼Œæ‰©å¤§ç”¨æˆ·ç¾¤ï¼Œå¹¶èµšå–æ›´å¤šæ”¶ç›Šã€‚Firebase ç”±å¤šç§äº’è¡¥åŠŸèƒ½ç»„æˆï¼Œæ‚¨å¯ä»¥è‡ªè¡Œç»„åˆå’ŒåŒ¹é…è¿™äº›åŠŸèƒ½ä»¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-è·å–Googleæ¨é€çš„KEY-Googleåº”ç”¨åå°&quot;&gt;&lt;a href</summary>
      
    
    
    
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
    <category term="google fcm" scheme="http://xupin.im/tags/google-fcm/"/>
    
  </entry>
  
  <entry>
    <title>è®¾å¤‡é€šçŸ¥æ¨é€ - Apple APNS</title>
    <link href="http://xupin.im/2017/02/22/apple-msg-push/"/>
    <id>http://xupin.im/2017/02/22/apple-msg-push/</id>
    <published>2017-02-21T16:00:00.000Z</published>
    <updated>2022-07-15T02:59:17.748Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-åˆæˆè¯ä¹¦-éœ€è¦ä¸¤ä¸ªæ–‡ä»¶-cer-p12-è‹¹æœå¼€å‘è€…åå°è·å–"><a href="#1-åˆæˆè¯ä¹¦-éœ€è¦ä¸¤ä¸ªæ–‡ä»¶-cer-p12-è‹¹æœå¼€å‘è€…åå°è·å–" class="headerlink" title="1.åˆæˆè¯ä¹¦(éœ€è¦ä¸¤ä¸ªæ–‡ä»¶.cer,.p12,è‹¹æœå¼€å‘è€…åå°è·å–)"></a>1.åˆæˆè¯ä¹¦(éœ€è¦ä¸¤ä¸ªæ–‡ä»¶<em>.cer,</em>.p12,è‹¹æœå¼€å‘è€…åå°è·å–)</h3><blockquote><p>ios.cer,ios.p12 // æˆ‘è¿™é‡Œçš„æ–‡ä»¶å</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -<span class="keyword">in</span> ios.cer -inform der -out ios_cer.pem</span><br><span class="line">$ openssl pkcs12 -nocerts -out ios_p12.pem -<span class="keyword">in</span> ios.p12</span><br><span class="line">Enter Import Password: // è¿™é‡Œè¾“å…¥Appleåå°æ–‡ä»¶å¯¼å‡ºæ—¶çš„å¯†ç </span><br><span class="line">MAC verified OK</span><br><span class="line">Enter PEM pass phrase: // è¿™é‡Œè¾“å…¥æ–°çš„pemå¯†ç (ç”¨äºä»£ç ä¸­),æˆ‘è¾“å…¥çš„æ˜¯123456789</span><br><span class="line">$ cat ios_cer.pem ios_p12.pem &gt; key.pem</span><br></pre></td></tr></table></figure><h3 id="2-PHPæ¨é€ä»£ç "><a href="#2-PHPæ¨é€ä»£ç " class="headerlink" title="2.PHPæ¨é€ä»£ç "></a>2.PHPæ¨é€ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ç¯å¢ƒ</span></span><br><span class="line">$ctx = stream_context_create();</span><br><span class="line"></span><br><span class="line">stream_context_set_option($ctx, <span class="string">'ssl'</span>, <span class="string">'local_cert'</span>, <span class="string">'assets/key/key.pem'</span>); <span class="comment">// keyæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">stream_context_set_option($ctx, <span class="string">'ssl'</span>, <span class="string">'passphrase'</span>, <span class="string">'123456789'</span>); <span class="comment">// ç”Ÿæˆpemè¾“å…¥çš„å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å»ºç«‹APNSè¿æ¥</span></span><br><span class="line">$fp = stream_socket_client( <span class="string">'ssl://gateway.push.apple.com:2195'</span>, $err, $errstr, <span class="number">60</span>, STREAM_CLIENT_CONNECT|STREAM_CLIENT_PERSISTENT, $ctx);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºæ¶ˆæ¯ä½“,jsonç¼–ç </span></span><br><span class="line">$payload = json_encode( <span class="keyword">array</span>( <span class="string">'aps'</span>=&gt;<span class="keyword">array</span>(<span class="string">'alert'</span> =&gt; <span class="string">'è¿™é‡Œæ˜¯å†…å®¹'</span>, <span class="string">'sound'</span> =&gt; <span class="string">'è¿™é‡Œæ˜¯æç¤ºå£°éŸ³'</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢äºŒè¿›åˆ¶</span></span><br><span class="line">$msg = chr(<span class="number">0</span>) . pack(<span class="string">'n'</span>, <span class="number">32</span>) . pack(<span class="string">'H*'</span>, <span class="string">'è®¾å¤‡æ ‡è¯†(Apple SDKå¯ä»¥è·å–)'</span>) . pack(<span class="string">'n'</span>, strlen($payload)) . $payload;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">$result = fwrite($fp, $msg, strlen($msg));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$result)&#123;</span><br><span class="line"><span class="comment">// æ¨é€å¤±è´¥</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// æ¨é€æˆåŠŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose($fp);</span><br></pre></td></tr></table></figure><h3 id="3-APNSæ–‡æ¡£"><a href="#3-APNSæ–‡æ¡£" class="headerlink" title="3.APNSæ–‡æ¡£"></a>3.APNSæ–‡æ¡£</h3><blockquote><p><a href="https://developer.apple.com/notifications/" target="_blank" rel="noopener">https://developer.apple.com/notifications/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-åˆæˆè¯ä¹¦-éœ€è¦ä¸¤ä¸ªæ–‡ä»¶-cer-p12-è‹¹æœå¼€å‘è€…åå°è·å–&quot;&gt;&lt;a href=&quot;#1-åˆæˆè¯ä¹¦-éœ€è¦ä¸¤ä¸ªæ–‡ä»¶-cer-p12-è‹¹æœå¼€å‘è€…åå°è·å–&quot; class=&quot;headerlink&quot; title=&quot;1.åˆæˆè¯ä¹¦(éœ€è¦ä¸¤ä¸ªæ–‡ä»¶.cer,.p12,è‹¹æœå¼€å‘è€…åå°</summary>
      
    
    
    
    
    <category term="apns" scheme="http://xupin.im/tags/apns/"/>
    
    <category term="develop" scheme="http://xupin.im/tags/develop/"/>
    
  </entry>
  
</feed>
